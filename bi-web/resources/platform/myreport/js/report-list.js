define(["sabace","mymessage"],function(f,c){var g=20;var b=0;var e="";jQuery(function(){jQuery(".btn-group button").bind("click",function(){jQuery(this).removeClass("normalButton").addClass("clickedButton theme-background").siblings().addClass("normalButton").removeClass("clickedButton theme-background")});jQuery(".btn-group").on("mouseover",".normalButton",function(){jQuery(".normalButton").removeClass("theme-background");jQuery(this).addClass("theme-background")}).on("mouseleave",".normalButton",function(){jQuery(this).removeClass("theme-background")});var n="all";jQuery("#layer").draggable({handle:".layerHead"});var k=0;jQuery("#content").on("click",".homeSetting",function(){if(k==1){return}var o=0;var r=jQuery(this).parents(".thumbnail").attr("reportId");jQuery.each(jQuery(".layerBody img"),function(u,t){if(jQuery(t).attr("reportId")==r){bi.dialog.show({title:f.getMessage("home.label.TipBox"),message:f.getMessage("home.msg.repeatMsg"),cssClass:"register-dialog",nl2br:false,closable:true});o=1}});if(o==1){k=0;return}jQuery("#layer").show();k=1;var q=jQuery(this).parents(".thumbnail").find(".repImg").attr("atr");if(jQuery(".layerBody img").size()==0){var s=jQuery("<div>",{});var p=jQuery("<img>",{src:q,reportId:r});s.append(p);jQuery(".layerBody").prepend(s);k=0;return}if(jQuery(".layerBody>div").size()>=5){jQuery(".layerBody>div").eq(4).remove()}jQuery(".layerBody>div").eq(0).animate({marginLeft:"78px"},400,function(){var u=jQuery("<div>",{style:"margin-right:-78px;"});var t=jQuery("<img>",{src:q,reportId:r});u.append(t);jQuery(".layerBody").prepend(u);k=0})});jQuery("#content").on("click",".foucsbtn",function(){var p=jQuery(this);var o=p.parents(".thumbnail").attr("reportId");f.ajax({data:{reportId:o},url:f.handleUrlParam("/platform/myreport/view/foucs"),success:function(q){p.removeClass("foucsbtn").addClass("nofoucsbtn");p.html("<span>"+f.getMessage("report.button.unfocus")+"</span>").append('<i class="fa fa-heart butFa"></i>')},error:function(q){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:f.getMessage("top.label.fail"),message:q.responseText})}})});jQuery("#content").on("click",".nofoucsbtn",function(){var p=jQuery(this);var o=p.parents(".thumbnail").attr("reportId");f.ajax({data:{reportId:o},url:f.handleUrlParam("/platform/myreport/view/nofoucs"),success:function(q){p.removeClass("nofoucsbtn").addClass("foucsbtn");p.html("<span>"+f.getMessage("report.button.focus")+"</span>").append('<i class="fa fa-heart-o butFa"></i>')},error:function(q){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:f.getMessage("top.label.fail"),message:q.responseText})}})});jQuery(".manage button").bind("click",function(){window.location.href=f.handleUrlParam("/platform/myreport/manage/report-list")});jQuery(".top").on("click",".more",function(){jQuery(".moreLabel").toggle();var o=f.getMessage("report.label.more");if(jQuery(this).find("strong").html()==o){o=f.getMessage("report.label.back")}jQuery(this).find("strong").html(o)});var m="";jQuery(".search-btn-group button").bind("click",function(){n=jQuery(this).val();i(0,n,m)});jQuery("#firstbutton").click();f.ajax({url:f.handleUrlParam("/platform/myreport/view/query-label"),success:function(o){if(o.length>0){jQuery(".report-panel .top>div,.report-panel .top>hr").show()}jQuery.each(o,function(t,r){var s=jQuery("<label>",{"class":"checkbox-diy col-xs-1",value:r.labelId});var q=jQuery("<input>",{type:"checkbox","data-toggle":"checkbox"});var p=jQuery("<label>",{html:r.labelName});s.append(q).append(p);if(t>4){s.addClass("moreLabel");jQuery(".more").show()}jQuery(".more").before(s)});jQuery('[data-toggle="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"});$("input").on("ifChanged",function(p){var q=jQuery(".top").find(":checked").parents(".checkbox-diy");m="";jQuery.each(q,function(s,r){if(s==0){m+=jQuery(r).attr("value")}else{m=m+","+jQuery(r).attr("value")}});i(0,n,m)})},error:function(o){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:f.getMessage("top.label.fail"),message:o.responseText})}});jQuery("#search").bind("click",function(){i(0,n,m)});jQuery("#searchInput").keydown(function(o){if(o.keyCode==13){jQuery("#search").trigger("click")}});jQuery(".tool button").bind("click",function(){f.ajax({async:false,url:f.handleUrlParam("/platform/myreport/view/get-all-Data"),success:function(o){if((o.importList==null||o.importList.length==0)&&(o.dbList==null||o.dbList.length==0)&&(o.linkList=null||o.linkList.length==0)){bi.dialog.show({title:"页面跳转提醒",message:'您好，您还没有上传数据源，无法制作报表！<span class="timeSpan">5</span> 秒钟将自动跳转到上传数据源页面！<br><a href="'+f.handleUrlParam("/platform/resmanage/data/data-file-import")+'">立即跳转</a>',cssClass:"timeout-dialog",onshown:function(){f.interval(function(){jQuery(".timeSpan").html(jQuery(".timeSpan").html()-1)},1000);f.interval(function(){top.document.location.href=f.handleUrlParam("/platform/resmanage/data/data-file-import")},5000)}})}else{window.open(f.handleUrlParam("/platform/dataview/create"))}},error:function(o){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:f.getMessage("top.label.fail"),message:o.responseText})}})});var j;function l(){f.ajax({url:f.handleUrlParam("/platform/myreport/view/query-myhome"),success:function(o){j=o;jQuery(".layerBody").html("");jQuery.each(o,function(r,q){var s=jQuery("<div>",{});var p=jQuery("<img>",{src:q.imgByte,alt:"",reportId:q.reportId});s.append(p);jQuery(".layerBody").append(s)})},error:function(o){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:f.getMessage("top.label.fail"),message:o.responseText})}})}l();jQuery(".cancle,.close").bind("click",function(){jQuery("#layer").hide();jQuery(".layerBody").html("");jQuery.each(j,function(q,p){var r=jQuery("<div>",{});var o=jQuery("<img>",{src:p.imgByte,alt:"",reportId:p.reportId});r.append(o);jQuery(".layerBody").append(r)})});jQuery(".sure").bind("click",function(){var o=[];jQuery.each(jQuery(".layerBody img"),function(q,p){o.push(jQuery(p).attr("reportId"))});f.ajax({loading:{title:f.getMessage("home.msg.execution"),text:f.getMessage("home.msg.submitMsg")},url:f.handleUrlParam("/platform/myreport/view/set-home/"),data:{reportIds:o.toString()},success:function(p){l();bi.dialog.show({title:f.getMessage("home.label.TipBox"),message:f.getMessage("home.msg.successSet"),cssClass:"register-dialog",nl2br:false,closable:true})},error:function(p){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:f.getMessage("top.label.fail"),message:p.responseText})}})});jQuery("#content").on("click",".repImg,.txt",function(){var o=jQuery(this).parents(".thumbnail").attr("reportId");window.open(f.handleUrlParam("/platform/dataview/view")+"?reportId="+o)});jQuery(window).scroll(function(){if(jQuery(window).scrollTop()>=100){jQuery(".actGotop").fadeIn(300);jQuery(".report-panel").addClass("suspension")}else{if(jQuery(window).scrollTop()<90){jQuery(".actGotop").fadeOut(300);jQuery(".report-panel").removeClass("suspension")}}});jQuery(".actGotop").click(function(){jQuery("html,body").animate({scrollTop:"0px"},800)})});function d(l,j,k){jQuery(".loadingbar.waiting.reportLoading").remove();jQuery("<div>",{id:"loadingbar2","class":"loadingbar waiting reportLoading",html:"<dt/><dd/>"}).appendTo(".report-panel .butRow");jQuery("#loadingbar2").width((50+Math.random()*30)+"%");f.ajax({url:f.handleUrlParam("/platform/myreport/view/query-reps/"),data:{page:l,rows:g,type:j,labelIds:k,searchText:e},success:function(o){jQuery("#content").html("");$("body,html").animate({scrollTop:0},100);if(o.reportList.rows.length==0){var m=[];var p=k.split(",");if(p!=""){jQuery(p).each(function(u,s){var t=jQuery("label[value='"+s+"']").find("strong").html();if(u==0){t=f.getMessage("report.label.noReportLabel")+t}m.push(t)})}if(searchText!=""){m.push(f.getMessage("report.label.noReportTxt")+searchText)}if(!jQuery("#firstbutton").hasClass("clickedButton")){var n=m.length==0?"":f.getMessage("report.label.noReportAnd");m.push(n+jQuery(".report-panel .search-btn-group .clickedButton").html().replace(/&nbsp;/g,""))}var r="";if(m.length==0){r="<div>!</div><div>"+f.getMessage("report.label.noReport3")+"</div>"}else{r="<div>!</div><div>"+f.getMessage("report.label.noReport1")+'<span style="font-weight:bold;">“'+m+"”</span>"+f.getMessage("report.label.noReport2")+"</div>"}var q=jQuery("<div>",{"class":"noreport-msg",html:r});jQuery("#content").html(q)}else{jQuery.each(o.reportList.rows,function(t,s){a(s)})}jQuery("#loadingbar2").css("width","99.5%").delay(200).fadeOut(400,function(){$(this).remove()})},error:function(m){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:"异常",message:"查询报表异常，请稍后再试 ！"})}})}function i(l,j,k){jQuery(".loadingbar.waiting.reportLoading").remove();jQuery("<div>",{id:"loadingbar2","class":"loadingbar waiting reportLoading",html:"<dt/><dd/>"}).appendTo(".report-panel .butRow");jQuery("#loadingbar2").width((50+Math.random()*30)+"%");var m=jQuery("#searchInput").val();f.ajax({url:f.handleUrlParam("/platform/myreport/view/query-reps/"),data:{page:l,rows:g,type:j,labelIds:k,searchText:m,appType:appType},success:function(r){b=0;e=m;jQuery("#content").html("");$("body,html").animate({scrollTop:0},100);if(r.reportList.rows.length==0){var o=[];var s=k.split(",");if(s!=""){jQuery(s).each(function(y,w){var x=jQuery("label[value='"+w+"']").find("strong").html();if(y==0){x=f.getMessage("report.label.noReportLabel")+x}o.push(x)})}if(m!=""){o.push(f.getMessage("report.label.noReportTxt")+m)}if(!jQuery("#firstbutton").hasClass("clickedButton")){var q=o.length==0?"":f.getMessage("report.label.noReportAnd");o.push(q+jQuery(".report-panel .search-btn-group .clickedButton").html().replace(/&nbsp;/g,""))}var u="";if(o.length==0){u="<div>!</div><div>"+f.getMessage("report.label.noReport3")+"</div>"}else{u="<div>!</div><div>"+f.getMessage("report.label.noReport1")+'<span style="font-weight:bold;">“'+o+"”</span>"+f.getMessage("report.label.noReport2")+"</div>"}var t=jQuery("<div>",{"class":"noreport-msg",html:u});jQuery("#content").html(t)}jQuery.each(r.reportList.rows,function(x,w){a(w)});jQuery("#page").page("destroy");jQuery("#page").page({total:r.reportList.total,pageSize:g,showJump:true,firstBtnText:f.getMessage("home.page.first"),lastBtnText:f.getMessage("home.page.last"),jumpBtnText:f.getMessage("home.page.jump")}).on("pageClicked",function(w,v){b=v;d(v,j,k)}).on("jumpClicked",function(w,v){b=v;d(v,j,k)});var n=jQuery(".page").width();var p=Number(jQuery(".m-pagination-page").width())+Number(jQuery(".m-pagination-jump").width());jQuery(".m-pagination-page").css("margin-left",(n-p)/2+"px");jQuery("#loadingbar2").css("width","99.5%").delay(200).fadeOut(400,function(){$(this).remove()})},error:function(n){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:"异常",message:"查询报表异常，请稍后再试 ！"})}})}var h=(window.screen.width*0.21-30)/2;function a(n){var D=jQuery("<div>",{"class":"thumbnail effect",reportId:n.reportId});var C=jQuery("<div>",{css:{height:h+"px",background:"url("+n.imgByte+") no-repeat","background-size":"100% auto"},"class":"repImg",atr:n.imgByte});var o=jQuery("<div>",{"class":"txt"});var B=jQuery("<strong>",{html:n.reportName,style:"margin-left:2%",title:n.reportName});var x=jQuery("<div>",{"class":"help-block",html:'<div class="comment">'+f.getMessage("home.label.comment")+"<strong> "+(n.commentCount==null?0:n.commentCount)+" </strong></div>"});var w=n.score;var u=jQuery("<i>",{"class":"fa fa-star-o",});var t=jQuery("<i>",{"class":"fa fa-star-o",});var s=jQuery("<i>",{"class":"fa fa-star-o",});var r=jQuery("<i>",{"class":"fa fa-star-o",});var q=jQuery("<i>",{"class":"fa fa-star-o",});var A=[];A.push(u);A.push(t);A.push(s);A.push(r);A.push(q);if(w.length==1){for(var v=1;v<=w;v++){A[v-1].attr("class","fa fa-star")}}else{for(var v=1;v<=w.substring(0,1);v++){A[v-1].attr("class","fa fa-star")}A[w.substring(0,1)].attr("class","fa fa-star-half-o")}var l=jQuery("<div>",{"class":"stars"});var y='<div class="visit">'+f.getMessage("home.label.visit")+'<strong class="times"> '+n.visitCount+" </strong></div>";var z=jQuery("<hr>",{});var p=jQuery("<div>",{"class":"but"});var m=jQuery("<div>",{"class":"homeSetting",html:'<i class="fa fa-home butFa"></i><span>'+f.getMessage("report.button.homeset")+"</span>"});if(n.hasFoucs==false){var k=jQuery("<div>",{"class":"foucsbtn",html:'<i class="fa fa-heart-o butFa"></i><span>'+f.getMessage("report.button.focus")+"</span>"})}else{var k=jQuery("<div>",{type:"button","class":"nofoucsbtn",html:'<i class="fa fa-heart butFa"></i><span>'+f.getMessage("report.button.unfocus")+"</span>"})}p.append(m).append(k);l.append(A);x.append(l).append(y);o.append(B).append(x);D.append(C).append(o).append(z).append(p);jQuery("#content").append(D)}});