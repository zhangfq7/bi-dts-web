define(["sabace","userSelect"],function(q,f){var c="0";var j="";var s=1;var t=20;var o=null;jQuery(function(){g();jQuery("#searchButton button").on("click",function(){h(true)});jQuery("#search").on("click",function(){h(true)});jQuery("#searchText").keydown(function(w){if(w.keyCode==13){jQuery("#search").trigger("click")}});n();h(true);jQuery("#tplList").on("click","#quoteTpl",k);jQuery("#tplList").on("click","#delTpl",a);jQuery("#tplList").on("click","#shareTpl",l);jQuery("#tplList").on("click","#tplImg",p)});function g(){jQuery("#searchButton button").on("click",function(){jQuery(this).removeClass("normal-button").addClass("clicked-button theme-background").siblings().addClass("normal-button").removeClass("clicked-button theme-background")});jQuery("#searchButton").on("mouseover",".normal-button",function(){jQuery(".normalButton").removeClass("theme-background");jQuery(this).addClass("theme-background")}).on("mouseleave",".normal-button",function(){jQuery(this).removeClass("theme-background")})}function h(w){v();c=jQuery("#searchButton .clicked-button").attr("id");j=jQuery("#searchText").val();q.ajax({url:q.handleUrlParam("/platform/myreport/tpl/query-tpl-list"),data:{pageNum:s,pageSize:t,queryType:c,queryText:j},success:function(x){if(x.resFlag=="success"){o=x.companyFlag;b(x.tplList.rows,x.tplList.total,w,x.jobId,x.userId)}else{bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:q.getMessage("report.tpl.tipTitle"),message:q.getMessage("msg.tpl.queryTipFail")})}},error:function(x){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:q.getMessage("report.tpl.tipTitle"),message:q.getMessage("msg.tpl.queryTipError")})}})}function b(x,y,C,w,B){jQuery("#tplList").html("");$("body,html").animate({scrollTop:0},100);if(x.length==0){jQuery("#page").page("destroy");u()}else{var A="";for(var z=0;z<x.length;z++){A+=r(x[z],w,B)}jQuery("#tplList").append(A);e(y,C)}jQuery("#tplLoading").css("width","99.5%").delay(200).fadeOut(400,function(){jQuery(this).remove()})}function u(){var y="";var w="";w+="<div>!</div>";if(j!=null&&j!=""){y+=q.getMessage("report.tpl.queryContent")+j}if(c!=0){if(y.length>0){y+=q.getMessage("report.tpl.and")}if(c==1){y+=q.getMessage("report.tpl.queryBySingle")}else{if(c==2){y+=q.getMessage("report.tpl.queryByMuch")}else{y+=q.getMessage("report.tpl.queryByLatest")}}}if(y.length==0){w+="<div>"+q.getMessage("report.tpl.noTip")+"</div>"}else{w+="<div>"+q.getMessage("report.tpl.notFind")+'<span class="noTpl-msg-font">“'+y+"”</span> "+q.getMessage("report.tpl.relatedTpl")+"</div>"}var x=jQuery("<div>",{"class":"noTpl-msg",html:w});jQuery("#tplList").html(x)}var i=(window.screen.width*0.2-62)/2;function r(D,y,C){var z=D.tplId;var x=D.tplName;var H=D.tplType;var I=null;if(H=="1"){I=q.getMessage("report.tpl.SingleType")}else{I=q.getMessage("report.tpl.muchType")}var w=D.usedNum;var G=D.createTime.substring(0,10);var F=D.thumbImg;var E=D.tplDesc;var B=D.createId;var A="";A+='<div class="thumbnail tpl-data tpl-effect" tplId='+z+" tplType="+H+">";A+='	<div class="tpl-data-top">';A+='   	<div class="tpl-data-thumbnail">';A+='           <div id="tplImg" class="tpl-img" style="height:'+i+"px;background:url("+F+') no-repeat;background-size:100% 100%;"></div>';A+="       </div>";A+='       <div class="tpl-data-info">';A+='       	<span class="tpl-name f15" title='+x+">"+x+"</span>";A+='           <span class="line-class f12">'+q.getMessage("report.tpl.type")+'&nbsp;:<span class="tpl-info-span line-class f14">'+I+"</span></span>";A+='           <span class="f12">'+q.getMessage("report.tpl.useAmount")+'&nbsp;:<span class="tpl-info-span line-class f14">'+w+'</span><span class="line-class">&nbsp;'+q.getMessage("report.tpl.second")+"</span></span>";A+='           <span><i class="fa fa-calendar"></i>&nbsp;:<span class="tpl-info-span line-class f13">'+G+"</span></span>";A+="       </div>";A+="   </div>";A+='   <div class="tpl-desc" title='+E+">"+E+"</div>";A+="   <hr>";A+='   <div class="tpl-data-tools">';A+='   	<div id="quoteTpl" class="tpl-data-quote"><i class="fa fa-cogs button-fa"></i><span>'+q.getMessage("report.tpl.quote")+"</span></div>";if(y=="A"||(y=="B"&&C==B)||(y=="C"&&C==B)){A+='   <div id="delTpl" class="tpl-data-del"><i class="fa fa-trash-o button-fa"></i><span>'+q.getMessage("report.tpl.del")+"</span></div>"}if(o=="1"){if(y=="A"||(y=="B"&&C==B)||(y=="C"&&C==B)){A+='   <div id="shareTpl" class="tpl-data-share"><i class="fa fa-share button-fa"></i><span>'+q.getMessage("report.tpl.share")+"</span></div>"}}A+="   </div>";A+="</div>";return A}function e(y,z){if(z){jQuery("#page").page("destroy");jQuery("#page").page({total:y,pageSize:t,showJump:true,firstBtnText:q.getMessage("report.tpl.first"),lastBtnText:q.getMessage("report.tpl.last"),jumpBtnText:q.getMessage("report.tpl.jump")}).on("pageClicked",function(B,A){s=A+1;h(false)}).on("jumpClicked",function(B,A){s=A+1;h(false)});var w=jQuery(".page").width();var x=Number(jQuery(".m-pagination-page").width())+Number(jQuery(".m-pagination-jump").width());jQuery(".m-pagination-page").css("margin-left",(w-x)/2+"px")}}function v(){jQuery("#tplLoading").remove();jQuery("<div>",{id:"tplLoading","class":"loadingbar waiting tplLoading",html:"<dt/><dd/>"}).appendTo(".tpl-top .tpl-select");jQuery("#tplLoading").width((50+Math.random()*30)+"%")}function n(){jQuery(window).scroll(function(){if(jQuery(window).scrollTop()>=100){jQuery(".actGotop").fadeIn(300);jQuery(".main-panel").addClass("tpl-suspension")}else{jQuery(".actGotop").fadeOut(300);jQuery(".main-panel").removeClass("tpl-suspension")}});jQuery(".actGotop").click(function(){jQuery("html,body").animate({scrollTop:"0px"},800)})}function a(){var w=jQuery(this).parent().parent().attr("tplId");bi.dialog.confirm({title:q.getMessage("report.tpl.tipTitle"),message:q.getMessage("msg.tpl.confirmDelTpl"),callback:function(x){if(x){d(w)}}})}function d(w){q.ajax({url:q.handleUrlParam("/platform/myreport/tpl/del-tpl"),loading:{title:q.getMessage("report.tpl.executing"),text:q.getMessage("report.tpl.delWait")},data:{tplId:w},success:function(x){if(x.resFlag=="success"){bi.dialog.show({type:bi.dialog.TYPE_INFO,title:q.getMessage("report.tpl.tipTitle"),message:q.getMessage("report.tpl.delSuccess")});h(false)}else{bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:q.getMessage("report.tpl.tipTitle"),message:q.getMessage("report.tpl.delFail")})}},error:function(x){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:q.getMessage("report.tpl.tipTitle"),message:q.getMessage("report.tpl.delError")})}})}function l(){var w=jQuery("#companyFlag").val();if(w=="0"){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:q.getMessage("report.tpl.tipTitle"),message:q.getMessage("report.tpl.canNotShare")})}else{var x=jQuery(this).parent().parent().attr("tplId");m(x)}}function m(x){var w=q.handleUrlParam("/platform/resmanage/db/data-user-select");bi.dialog.show({title:q.getMessage("report.tpl.userSelect"),message:jQuery('<div id="tplUserList"></div>').load(w),spinicon:"glyphicon glyphicon-refresh",cssClass:"tpl-userList",onshown:function(y){f.init("3",x)},buttons:[{label:q.getMessage("report.tpl.sure"),cssClass:"btn-info",action:function(y){f.saveUserSelect()}},{label:q.getMessage("report.tpl.cancel"),cssClass:"btn-default",action:function(y){y.close()}}]})}function p(){var x=jQuery(this).css("background-image");x=x.replace("url(","").replace(")","");var w=jQuery("<form></form>",{method:"post",action:q.handleUrlParam("/platform/myreport/tpl/report-tpl-view"),target:"_blank",html:"<input name='thumbImg' value='"+x+"'/>"});jQuery("body").append(w);w.submit();jQuery(w).remove()}function k(){var y=jQuery(this).parent().parent().attr("tplType");if(y=="1"){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:q.getMessage("report.tpl.tipTitle"),message:q.getMessage("report.tpl.canNotQuote")});return false}var x=jQuery(this).parent().parent().attr("tplId");var w=jQuery("<form></form>",{method:"post",action:q.handleUrlParam("/platform/dataview/create"),target:"_blank",html:"<input name='tplId' value='"+x+"'/>"});jQuery("body").append(w);w.submit();jQuery(w).remove()}});