define(["sabace","safety/message"],function(b,c){function e(){$("#transUser").ajaxChosen({fields:["code","label"],searchAjaxParam:"userId",upperChosenId:"companyType",findPage:false,disabled:true,url:b.handleUrlParam("/platform/sysmanage/safety/query-company-user")});jQuery("#submit").on("click",a)}function a(){var f=/^(U|u)+\d{7}$/;var g=jQuery(".chosen-single >span").text();if(!f.test(g)){bi.dialog.show({type:"type-warning",title:b.getMessage("safety.msg.prompt"),message:b.getMessage("safety.msg.userId.empty"),});return}bi.dialog.confirm({title:b.getMessage("safety.msg.transAuth"),message:b.getMessage("safety.msg.confirmTrans"),callback:function(h){if(h){b.ajax({url:b.handleUrlParam("/platform/sysmanage/safety/trans-auth"),data:{transUserId:g},success:function(i){if(!i.validateFlag){bi.dialog.alert({type:bi.dialog.TYPE_DANGER,title:b.getMessage("safety.msg.error"),message:b.getMessage(i.errorMsg),callback:function(j){if(i.expireFlag){var k={};k.type=5;d(b.handleUrlParam("/platform/sysmanage/safety/validate"),k)}}})}else{bi.dialog.show({title:b.getMessage("safety.msg.success"),message:b.getMessage("safety.msg.successfully"),closeByBackdrop:false,closeByKeyboard:false,});b.timeout(function(){top.document.location.href=b.handleUrlParam("/platform/sysmanage/user/safety")},3000)}},error:function(i){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("safety.msg.error"),message:i.responseText||b.getMessage("safety.msg.exception")})}})}}})}function d(h,j){var i="";for(var g in j){i+="<input name='"+g+"' value='"+j[g]+"'/>"}var f=jQuery("<form></form>",{method:"post",action:h,html:i});jQuery("body").append(f);f.submit();jQuery(f).remove()}return{init:e}});