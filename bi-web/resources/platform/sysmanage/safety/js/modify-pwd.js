define(["sabace","safety/message"],function(b,c){function f(){jQuery("#validate-sub").on("click",d)}function d(){var i=jQuery("#oldPsd").val();var j=jQuery("#newPsd").val();var h=jQuery("#reNewPsd").val();if(b.IsEmpty(i)){a(b.getMessage("safety.msg.oldPsd.empty"));return}if(b.IsEmpty(j)){a(b.getMessage("safety.msg.newPsd.empty"));return}if(j.length<6){a(b.getMessage("safety.msg.password.short"));return}if(b.IsEmpty(h)){a(b.getMessage("safety.msg.reNewPsd.empty"));return}if(j!=h){a(b.getMessage("safety.msg.password.diff"));return}if(j==i){a(b.getMessage("safety.msg.oldNewPsd.same"));return}var g={oldPassword:i,newPassword:j};b.ajax({url:b.handleUrlParam("/platform/sysmanage/safety/edit-pwd"),data:g,success:function(k){if(!k.validateFlag){bi.dialog.alert({type:bi.dialog.TYPE_DANGER,title:b.getMessage("safety.msg.error"),message:b.getMessage(k.errorMsg),callback:function(l){if(k.expireFlag){var m={};m.type=1;e(b.handleUrlParam("/platform/sysmanage/safety/validate"),m)}}})}else{bi.dialog.show({title:b.getMessage("safety.msg.success"),message:b.getMessage("safety.msg.successfully"),closeByBackdrop:false,closeByKeyboard:false,});b.timeout(function(){if(forceChangePwd=="1"){top.document.location.href=webpath+"/platform/frame/login"}else{top.document.location.href=b.handleUrlParam("/platform/sysmanage/user/safety")}},3000)}},error:function(k){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("safety.msg.error"),message:k.responseText||b.getMessage("safety.msg.exception")})}})}function e(i,k){var j="";for(var h in k){j+="<input name='"+h+"' value='"+k[h]+"'/>"}var g=jQuery("<form></form>",{method:"post",action:i,html:j});jQuery("body").append(g);g.submit();jQuery(g).remove()}function a(g){bi.dialog.show({type:"type-warning",title:b.getMessage("safety.msg.prompt"),message:g})}return{init:f}});