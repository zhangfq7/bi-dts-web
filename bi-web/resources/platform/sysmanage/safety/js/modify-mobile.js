define(["sabace","safety/message"],function(b,c){function f(){jQuery("#validate-sub").on("click",d)}function d(){var k=/^((13[0-9])|(15[0-9])|(17[0-9])|(18[0-9]))+\d{8}$/;var h=jQuery("#oldMobile").val();var j=jQuery("#newMobile").val();var i=jQuery("#reNewMobile").val();if(b.IsEmpty(h)){a(b.getMessage("safety.msg.oldMobile.empty"));return}if(b.IsEmpty(j)){a(b.getMessage("safety.msg.newMobile.empty"));return}if(b.IsEmpty(i)){a(b.getMessage("safety.msg.reNewMobile.empty"));return}if(!k.test(h)){a(b.getMessage("safety.msg.oldMobile.error"));return}if(!k.test(j)){a(b.getMessage("safety.msg.newMobile.error"));return}if(j!=i){a(b.getMessage("safety.msg.mobile.diff"));return}var g={oldMobile:h,newMobile:j};b.ajax({url:b.handleUrlParam("/platform/sysmanage/safety/edit-mobile"),data:g,success:function(l){if(!l.validateFlag){bi.dialog.alert({type:bi.dialog.TYPE_DANGER,title:b.getMessage("safety.msg.error"),message:b.getMessage(l.errorMsg),callback:function(m){if(l.expireFlag){var n={};n.type=3;e(b.handleUrlParam("/platform/sysmanage/safety/validate"),n)}}})}else{bi.dialog.show({title:b.getMessage("safety.msg.success"),message:b.getMessage("safety.msg.successfully"),closeByBackdrop:false,closeByKeyboard:false,});b.timeout(function(){top.document.location.href=b.handleUrlParam("/platform/sysmanage/user/safety")},3000)}},error:function(l){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("safety.msg.error"),message:l.responseText||b.getMessage("safety.msg.exception")})}})}function e(i,k){var j="";for(var h in k){j+="<input name='"+h+"' value='"+k[h]+"'/>"}var g=jQuery("<form></form>",{method:"post",action:i,html:j});jQuery("body").append(g);g.submit();jQuery(g).remove()}function a(g){bi.dialog.show({type:"type-warning",title:b.getMessage("safety.msg.prompt"),message:g,})}return{init:f}});