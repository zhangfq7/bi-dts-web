define(["sabace","safety/message"],function(c,e){function f(){var g=jQuery("#mobileNum").html();if(c.IsEmpty(g)){document.location.href=c.handleUrlParam("/platform/sysmanage/user/safety")}jQuery(".captcha-class img").on("click",function(i,h){$(this).attr("src",webpath+"/ImageServlet?t="+Math.random())});jQuery("#sendCodeButton").on("click",b);jQuery(".tab-pane").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"bottomLeft",showOneMessage:true})}jQuery("#validateButton").on("click",function(j,h){var i=$(".tab-pane").validationEngine("validate");if(!i){return false}var g={};g.checkCode=jQuery("#checkCode").val();g.captcha=jQuery("#captcha").val();c.ajax({url:c.handleUrlParam("/platform/sysmanage/safety/validate-code"),data:g,loading:{title:c.getMessage("safety.msg.prompt"),text:c.getMessage("safety.msg.validateLoading")},success:function(l){if(!l.validateFlag){a(c.getMessage(l.errorMsg))}else{var k=jQuery("#type").val();if("1"==k){document.location.href=c.handleUrlParam("/platform/sysmanage/safety/edit-pwd-page")}if("2"==k){document.location.href=c.handleUrlParam("/platform/sysmanage/safety/edit-email-page")}if("3"==k){document.location.href=c.handleUrlParam("/platform/sysmanage/safety/edit-mobile-page")}if("4"==k){document.location.href=c.handleUrlParam("/platform/sysmanage/safety/bind-email-page")}if("5"==k){document.location.href=c.handleUrlParam("/platform/sysmanage/safety/trans-auth-page")}}},error:function(k){bi.dialog.alert({type:bi.dialog.TYPE_DANGER,title:c.getMessage("safety.msg.error"),message:c.getMessage("safety.msg.exception")})}})});function b(){jQuery("#tip .tip").show();d.init(this);c.ajax({url:c.handleUrlParam("/platform/sysmanage/safety/send-sms"),success:function(g){if(!g.validateFlag){a(c.getMessage(g.errorMsg))}},error:function(g){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("safety.msg.error"),message:g.responseText||c.getMessage("safety.msg.exception")})}})}var d={node:null,count:60,start:function(){if(this.count>0){this.node.innerHTML=this.count--+c.getMessage("safety.label.send.msg");var g=this;c.timeout(function(){g.start()},1000)}else{this.node.removeAttribute("disabled");this.node.innerHTML=c.getMessage("safety.button.getMsg");this.count=60}},init:function(g){this.node=g;this.node.setAttribute("disabled",true);this.start()}};function a(g){$("#captcha").val("");$(".captcha-class img").attr("src",c.handleUrlParam("/ImageServlet?")+Math.random());bi.dialog.show({type:"type-warning",title:c.getMessage("safety.msg.error"),message:g,})}return{init:f}});