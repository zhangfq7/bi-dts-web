define(["sabace","userEidt"],function(c,b){var a={};a.view={addOrEditUser:function(e){var d=c.handleUrlParam("/platform/sysmanage/userlist/user-edit-init");var f;if(e!=undefined){d+="?userId="+e;a.view.showAddPanel(d)}else{a.view.isFull().then(function(g){f=g.fullFlag;if(f==0){bi.dialog.show({title:c.getMessage("user.label.tip"),message:c.getMessage("user.userlist.label.signature"),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false})}else{a.view.showAddPanel(d)}},function(g){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("top.label.fail"),message:g.responseText})})}},isFull:function(){return c.ajax({type:"post",cache:false,dataType:"json",url:c.handleUrlParam("/platform/sysmanage/userlist/is-full-user/")})},showAddPanel:function(d){bi.dialog.show({title:c.getMessage("user.userlist.button.add"),message:$('<div id="add-user-dialog"></div>').load(d),spinicon:"glyphicon glyphicon-refresh",cssClass:"add-user-dialog",closeByBackdrop:false,closeByKeyboard:false,onshown:function(){b.init()},buttons:[{label:c.getMessage("user.userlist.button.cancel"),cssClass:"btn-default",action:function(e){e.close()}},{label:c.getMessage("user.userlist.button.save"),cssClass:"btn-info",action:function(e){b.saveUserInfo(e)}}]})},initUserList:function(){var g=$("#userId").val();var k=$("#userName").val();var j=$("#phone").val();var h=$("#userJob").val();var i=$("#userSex").val();var e=$("#email").val();var f=$("#deptlist").attr("truevalue");var d={};d.userID=g;d.userName=k;d.mobileNum=j;d.jobIds=h;d.sex=i;d.email=e;d.depId=f;$("#userListGrid").jqGrid({url:c.handleUrlParam("/platform/sysmanage/userlist/user-list"),styleUI:"Bootstrap",datatype:"json",postData:d,mtype:"post",forceFit:true,colModel:[{label:c.getMessage("user.userlist.label.userId"),name:"userID",width:75,align:"left",hlign:"center",sortable:false},{label:c.getMessage("user.userlist.label.userName"),name:"userName",width:90,align:"left",hlign:"center",sortable:false},{label:c.getMessage("user.userlist.label.job"),name:"jobName",width:100,align:"left",hlign:"center",sortable:false},{label:c.getMessage("user.userlist.label.sex"),name:"sex",width:80,align:"left",hlign:"center",sortable:false,formatter:function(l,m,n){if(l==1){return"男"}else{if(l==0){return"女"}else{return"保密"}}}},{label:c.getMessage("user.userlist.label.dept"),name:"depName",width:180,align:"left",hlign:"center",sortable:false},{label:c.getMessage("user.userlist.label.email"),name:"email",width:80,align:"left",hlign:"center",sortable:false},{label:c.getMessage("user.userlist.label.phone"),name:"mobileNum",width:80,align:"left",hlign:"center",sortable:false},{label:c.getMessage("user.userlist.label.operation"),name:"operate",width:80,align:"center",hlign:"center",sortable:false,formatter:function(l,m,o){var n=o.userID;return"<a href='javascript:void(0)' class='user-edit' userId='"+n+"'>修改</a> /  <a href='javascript:void(0)' class='user-del' userId='"+n+"'>删除</a> "}}],viewrecords:true,autowidth:true,height:"auto",rowNum:10,rowList:[10,20,30],rownumbers:true,pager:"#userListGridPager",jsonReader:{records:"total",total:"totalPages"},afterInsertRow:function(m,l){jQuery(this).jqGrid("setCell",rowid,"operate","<a>操作</a>")},regional:"cn"})}};a.controller={init:function(){$("#userSex").chosen({disable_search:true});$("#userJob").chosen({disable_search:true});jQuery("#deptlist").treeselect({height:200,searchAjaxParam:"depName",chkStyle:"checkbox",width:(jQuery("#deptlist").width()+21),url:c.handleUrlParam("/platform/sysmanage/dept/company-dept")});$(window).resize(function(){c.timeout(function(){$("#userListGrid").setGridWidth($("#listPanel").width()-5)},100)});$(".user-list-div input").css("height","28px");$("#addUserButton").on("click",function(){a.view.addOrEditUser()});a.view.initUserList();jQuery("#searchButton").on("click",function(){var g=$("#userId").val();var k=$("#userName").val();var j=$("#phone").val();var h=$("#userJob").val();var i=$("#userSex").val();var e=$("#email").val();var f=$("#deptlist").attr("truevalue");var d={};d.userID=g;d.userName=k;d.mobileNum=j;d.jobIds=h;d.sex=i;d.email=e;d.depId=f;jQuery("#userListGrid").jqGrid("setGridParam",{postData:d}).trigger("reloadGrid")});$("#userList").on("click",".user-edit",function(){var d=$(this).attr("userId");a.view.addOrEditUser(d)});$("#userList").on("click",".user-del",function(){var d=$(this).attr("userId");bi.dialog.confirm({title:c.getMessage("user.label.tip"),message:c.getMessage("user.label.del.confirm"),callback:function(e){if(e){c.ajax({type:"post",cache:false,dataType:"json",url:c.handleUrlParam("/platform/sysmanage/userlist/user-list-del/"),data:{userId:d},loading:{title:c.getMessage("user.label.tip"),text:c.getMessage("user.label.del.loading")},success:function(f){if(f.resFlag=="0"){bi.dialog.show({type:bi.dialog.TYPE_WARNING,title:c.getMessage("user.label.tip"),message:"不能删除当前用户",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false})}else{bi.dialog.show({title:c.getMessage("user.label.tip"),message:"用户信息删除成功！",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:"确定",cssClass:"btn-info",action:function(g){jQuery("#searchButton").trigger("click");g.close()}}]})}},error:function(f){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("user.label.error"),message:f.responseText||c.getMessage("user.label.delError")})}})}}})});jQuery("body").on("click",".orderusernum",function(){window.open(c.handleUrlParam("/platform/serviceopen/order-usernum"))})}};return a.controller});