define(["sabace","message"],function(b,c){function d(){jQuery("#createCompanyButton").on("click",a);jQuery("#joinCompanyButton").on("click",e);jQuery("#companyType").treeselect({height:200,chkStyle:"radio",searchAjaxParam:"companyTypeName",width:(jQuery("#companyType").width()+21),url:b.handleUrlParam("/platform/sysmanage/company/company-type")});jQuery("#create, #join").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"bottomLeft",showOneMessage:true});jQuery("#companyId").bind("blur",function(){var h=$("#companyId").validationEngine("validate");if(h){return false}var g=$("#companyId").val();var f={companyId:g.toUpperCase()};b.ajax({url:b.handleUrlParam("/platform/sysmanage/company/company-exist"),data:f,success:function(i){if(i.existFlag=="true"){$(".tip-class").html('<span class="f16 green"><i class="fa fa-check f16"></i></span>')}else{$(".tip-class").html('<span class="f14 red"><i class="fa fa-times-circle f16"></i>&nbsp;'+b.getMessage("company.msg.companyId.noExist"),+"</span>")}$(".tip-class").show()},error:function(i){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("company.label.error"),message:i.responseText||b.getMessage("company.label.sendError")})}})});jQuery("#companyId").on("keydown",function(f){$(".tip-class").html("");$(".tip-class").hide()})}function a(){var g=$("#create").validationEngine("validate");if(!g){return false}var f={companyName:$("#companyName").val().trim(),companyType:$("#companyType").attr("truevalue"),companyDesc:$("#companyDesc").val()};bi.dialog.confirm({title:b.getMessage("company.label.confirm"),message:b.getMessage("company.msg.saveCompany.confirm"),callback:function(h){if(!h){return}b.ajax({url:b.handleUrlParam("/platform/sysmanage/company/create-company"),data:f,loading:{title:b.getMessage("company.label.tip"),text:b.getMessage("company.label.pleaseWait")},success:function(i){if(i.createFlag=="true"){bi.dialog.show({title:b.getMessage("company.label.succeed"),message:b.getMessage("company.msg.saveCompany.success"),onhide:function(){setTimeout(function(){document.location.href=webpath+"/platform/frame/login"},200)}})}else{bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("company.label.error"),message:b.getMessage(i.errorMsg)})}},error:function(i){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("company.label.error"),message:i.responseText||b.getMessage("company.msg.saveCompany.error")})}})}})}function e(){var h=$("#join").validationEngine("validate");if(!h){return false}var g=$("#companyId").val();var i=$("#authMsg").val();var f={companyId:g.toUpperCase(),authMsg:i};bi.dialog.confirm({title:b.getMessage("company.label.confirm"),message:b.getMessage("company.msg.joinCompany.confirm"),callback:function(j){if(!j){return}b.ajax({url:b.handleUrlParam("/platform/sysmanage/company/join-company"),data:f,loading:{title:b.getMessage("company.label.tip"),text:b.getMessage("company.label.pleaseWait")},success:function(k){if(k.joinFlag=="9"){bi.dialog.show({title:b.getMessage("company.label.succeed"),message:b.getMessage("company.msg.joinCompany.success")})}else{if(k.joinFlag=="1"){bi.dialog.show({type:bi.dialog.TYPE_WARNING,title:b.getMessage("company.label.tip"),message:b.getMessage("company.msg.joinCompany.alreadyJoin")})}else{if(k.joinFlag=="2"){bi.dialog.show({type:bi.dialog.TYPE_WARNING,title:b.getMessage("company.label.tip"),message:b.getMessage("company.msg.joinCompany.alreadyAgree")})}else{if(k.joinFlag=="3"){bi.dialog.show({type:bi.dialog.TYPE_WARNING,title:b.getMessage("company.label.tip"),message:b.getMessage("company.msg.joinCompany.alreadySend")})}else{bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("company.label.error"),message:b.getMessage("company.msg.joinCompany.fail")})}}}}},error:function(k){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("company.label.error"),message:k.responseText||b.getMessage("company.msg.joinCompany.error")})}})}})}return{init:d}});