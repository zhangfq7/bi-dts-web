define(["sabace","company/message"],function(c,d){function b(){jQuery(".cisw-operate").on("click",function(){var h=$(this).attr("handleState");var l=$(this).attr("msgId");var f=$(this).attr("companyId");var i=$(this).attr("userId");var k=c.getMessage("company.label.tip");var j=c.getMessage("company.label.tip");var g=c.handleUrlParam("/platform/sysmanage/cisaw/cisaw-operate");switch(h){case"-1":k=c.getMessage("company.cisaw.msg.del");j=c.getMessage("company.cisaw.msg.success");g=c.handleUrlParam("/platform/sysmanage/cisaw/ciws-del");break;case"2":k=c.getMessage("company.cisaw.msg.agree");j=c.getMessage("company.cisaw.msg.agreesuccess");break;case"3":k=c.getMessage("company.cisaw.msg.blacklist");j=c.getMessage("company.cisaw.msg.success");break;case"4":k=c.getMessage("company.cisaw.msg.refuse");j=c.getMessage("company.cisaw.msg.success");break;default:k=c.getMessage("company.label.tip")}bi.dialog.confirm({title:c.getMessage("company.label.tip"),message:k,callback:function(m){if(m){c.ajax({url:g,data:{handleState:h,msgId:l,userId:i,companyId:f},loading:{title:c.getMessage("company.label.tip"),text:c.getMessage("company.label.pleaseWait")},success:function(n){if(n.flag=="0"){bi.dialog.show({title:c.getMessage("company.label.tip"),message:c.getMessage("company.cisaw.msg.maxNum"),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:c.getMessage("company.label.confirm"),cssClass:"btn-info",action:function(o){o.close()}}]})}else{bi.dialog.show({title:c.getMessage("company.label.tip"),message:j,nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:c.getMessage("company.label.confirm"),cssClass:"btn-info",action:function(o){var p=jQuery(".company-cisaw-btn").find(".clickedButton");p.trigger("click");o.close()}}]})}},error:function(n){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("company.label.error"),message:n.responseText||c.getMessage("company.cisaw.msg.delError")})}})}}})})}function e(){jQuery(".company-cisaw-btn button").bind("click",function(){jQuery(this).removeClass("normal-button").addClass("clicked-button theme-background").siblings().addClass("normal-button").removeClass("clicked-button theme-background")});jQuery(".company-cisaw-btn button").on("mouseover",".normal-button",function(){jQuery(".normalButton").removeClass("theme-background");jQuery(".company-cisaw-btn button").addClass("theme-background")}).on("mouseleave",".normal-button",function(){jQuery(".company-cisaw-btn button").removeClass("theme-background")});jQuery(".company-cisaw-btn").on("click",".btn",function(){var h=$(this).attr("flag");var l="";var g="";var j=new Date();var k=j.getTime();var i=j.getDay()==0?7:j.getDay();switch(h){case"1":l=k;g=k;break;case"2":l=k-(i-1)*24*60*60*1000;g=k;break;case"3":l=k-(i+6)*24*60*60*1000;g=k-i*24*60*60*1000;break;case"5":break;default:g=k-(j.getDay()+6)*24*60*60*1000}var f={flag:h,timeEnd:a(g,0),timeStart:a(l,1),};c.ajax({type:"post",cache:false,dataType:"json",url:c.handleUrlParam("/platform/sysmanage/cisaw/cisaw-list"),data:f,success:function(q){var n=jQuery("#company-cisw-content");n.html("");var m=q.companyAuthList;if(m==null){n.append("<div class='company-cisw-warning'>\n<div class='icon'>\n!</div>\n<div class='text'>"+c.getMessage("company.cisaw.list.tip")+"</div>\n</div>\n</div>\n")}else{var r="";for(var p=0;p<m.length;p++){r+="<div class='company-cisaw-time'>\n<label for='upload' class=''>"+m[p].adminTime+"</label>\n</div>\n   <div class='panel-cisaw company-cisaw-line'>\n          <div class='company-cisaw-table company-cisaw-img'>\n            <img class='toux' userId='"+m[p].userId+"' style='width: 60px;border-radius: 60px;' src='"+webpath+"/platform/readUserImg/OVERVIEW_SYS?userImgId="+m[p].userId+"' />\n          </div>\n          <div class='company-cisaw-table company-cisaw-first' title='"+m[p].userName+"'>"+m[p].userName+"</div>\n          <div class='company-cisaw-table company-cisaw-second'>"+c.getMessage("company.cisaw.label.add")+"</div>\n          <div class='company-cisaw-table company-cisaw-third'>\n            <div class='company-cisaw-label1'>"+c.getMessage("company.cisaw.label.Postscript")+"</div>\n            <div class='company-cisaw-label2' title='"+m[p].authMsg+"'>\n"+m[p].authMsg+"            </div>\n            <div style='clear:both;'></div>\n          </div>\n          <div class='company-cisaw-table'>";var o=m[p].handleState;if(o=="1"){r+="<button type='button' class='cisw-operate btn btn-info btn-sm' handleState='2' companyId='"+m[p].companyId+"' userId='"+m[p].userId+"' msgId='"+m[p].msgId+"'>"+c.getMessage("company.cisaw.button.agree")+"</button><button type='button' class='cisw-operate cisw-operate-bak btn btn-info btn-sm' handleState='3' companyId='"+m[p].companyId+"' userId='"+m[p].userId+"' msgId='"+m[p].msgId+"'>"+c.getMessage("company.cisaw.button.add")+"</button><button type='button' class='cisw-operate cisw-operate-bak btn btn-info btn-sm' handleState='4' companyId='"+m[p].companyId+"' userId='"+m[p].userId+"' msgId='"+m[p].msgId+"'>"+c.getMessage("company.cisaw.button.refuse")+"</button><button type='button' class='cisw-operate cisw-operate-bak btn btn-danger btn-sm' handleState='-1' companyId='"+m[p].companyId+"' userId='"+m[p].userId+"' msgId='"+m[p].msgId+"'>"+c.getMessage("company.cisaw.button.delete")+"</button>"}else{if(o=="2"){r+="<span style='  display: inline-block;width: 203px;'>"+c.getMessage("company.cisaw.label.agree")+"</span>"}else{if(o=="4"){r+="<span style='  display: inline-block;width: 203px;'>"+c.getMessage("company.cisaw.label.refuse")+"</span><button type='button' class='cisw-operate cisw-operate-bak btn btn-danger btn-sm' handleState='-1' companyId='"+m[p].companyId+"' userId='"+m[p].userId+"' msgId='"+m[p].msgId+"'>"+c.getMessage("company.cisaw.button.delete")+"</button>"}else{if(o=="9"){r+="<span style='  display: inline-block;width: 203px;'>"+c.getMessage("company.cisaw.label.handle")+"</span><button type='button' class='cisw-operate cisw-operate-bak btn btn-danger btn-sm' handleState='-1' companyId='"+m[p].companyId+"' userId='"+m[p].userId+"' msgId='"+m[p].msgId+"'>"+c.getMessage("company.cisaw.button.delete")+"</button>"}else{if(o=="6"){r+="<span style='  display: inline-block;width: 203px;'>"+c.getMessage("company.cisaw.label.Processing")+"</span>"}else{r+="<span style='  display: inline-block;width: 203px;'>"+c.getMessage("company.cisaw.label.revoke")+"</span><button type='button' class='cisw-operate cisw-operate-bak btn btn-danger btn-sm' handleState='-1' companyId='"+m[p].companyId+"' userId='"+m[p].userId+"' msgId='"+m[p].msgId+"'>"+c.getMessage("company.cisaw.button.delete")+"</button>"}}}}}r+="</div></div>"}}n.append(r);b()},error:function(m){}})});b();$("#black-info").on("click",function(){var f=c.handleUrlParam("/platform/sysmanage/cisaw/black-list");bi.dialog.show({title:c.getMessage("company.cisaw.label.blacklist"),message:jQuery('<div id="groupIframe" width="670px" height="450px"></div>').load(f),cssClass:"black-info-dialog",closeByBackdrop:false,closeByKeyboard:false})});$("#company-cisw-content").on("click",".company-cisaw-img",function(){var g=jQuery(this).find("img").attr("userId");var f=c.handleUrlParam("/platform/sysmanage/cisaw/details-list")+"?userId="+g;bi.dialog.show({title:"个人信息",message:jQuery('<div id="touxframe" ></div>').load(f),cssClass:"toux-info-dialog",closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:"确认",cssClass:"btn-info",action:function(h){h.close()}}]})})}function a(f,g){if(f==""){return""}else{var i=new Date(f);var j=i.getFullYear();var l=i.getMonth();var h=i.getDate();var k="";if(l==12){j=j+1;l=1}else{l=l+1}if(l<10){l="0"+l}if(h<10){h="0"+h}k=g=="1"?"00:00:00":"59:59:59";return j+"-"+l+"-"+h+" "+k}}return{init:e}});