require(["view/box","underscore","EBuilder"],function(a,b){$(window).on("chart.rander.complete",function(h,g,f){var e;$(g).EBuilder("_on","click",function(j,i){window.clearTimeout(e);e=window.setTimeout(function(){var m=c.buildChainParam4chart(i,j,g);var l=!(m.goalChoose&&m.goalChoose.length>2);if(l){if(!!~"scatter,radar".indexOf(i.dataParams.chartType)||!!~j.name.indexOf("||")){return false}var k=c.buildChainParam4chart(i,j,g);$(g).EBuilder("chainChart",k)}else{sessionStorage.goal=JSON.stringify(m);$("#penetrateShow").attr("src",resPath+"/platform/dataview/penetrate-show/manage_report?reportId=REPDACBF17E5E6D48F7AC08E41F85CC1426&appType=undefined&new="+Math.random());setTimeout('$("#penetrateShow").show()',500)}},300)},f);$(g).EBuilder("_on","dblclick",function(j,i){window.clearTimeout(e);log("chart双击事件触发!",j,i);if(!!~"scatter,radar".indexOf(i.dataParams.chartType)||!!~j.name.indexOf("||")){return false}$(g).EBuilder("drill",i,j)},f)});$(window).on("table.mainchain",function(h,i,j){var g=c.buildChainParam4table(i,j);var f=!(g.goalChoose&&g.goalChoose.length>2);if(f){var e=c.buildChainParam4table(i,j);j.EBuilder("chainChart",e)}else{sessionStorage.goal=JSON.stringify(g);$("#penetrateShow").attr("src",resPath+"/platform/dataview/penetrate-show/manage_report?reportId=REPDACBF17E5E6D48F7AC08E41F85CC1426&appType=undefined&new="+Math.random());setTimeout('$("#penetrateShow").show()',500)}});$(window).on("table.chain",function(h,f,e){var g=a.Widgets.plugins.table;e.config.build=f;g.apply(e,true)});var c={buildChainParam4chart:function(q,s,p){var l=$(p).parent("div");var q=$.extend(true,{},q);var u=l.siblings("div[id^='container_']");var n=$.extend(true,{},l.data("option"));var t=!(n.goalChoose&&n.goalChoose.length>2);if(!!l.data("isLinked")&&t){return}var j=b.find(q.data,{name:s.name});if(!j&&t){return false}var o;if(j.dimKey){o=[j.dimKey]}else{o=[s.name]}if(u.length==0&&t){return false}var k=$.map(u,function(x,w){var y=$(x).data("option");if(y.isInit){return{chartId:y.el,dataId:y.config.build.dataParams.dataId}}});if(k.length==0&&t){return false}var h=$.parseJSON(q.dataParams.dimAttrJsonStr);if(!(h.dimData[0].attrClass=="0"||h.dimData[0].attrClass=="3")){return false}if(h.dimData[0].levelId){return false}var f=h.dimData[0].dimId;var g=q.dataParams.dataId;var r=h.dimData[0].attrId;var i=h.dimData[0].attrClass;var m=h.dimData[0].attrType;var e={dataId:g,dimId:[f],attrId:[r],attrClass:[i],otherChart:k};var v={attrId:e.attrId,dimId:e.dimId,dataId:e.dataId,attrClass:e.attrClass,attrType:[m],filterType:[h.dimData[0].filterType],attrValue:o};return{chartLinkData:v,queryChainParam:e,name:s.name,goalChoose:n.goalChoose}},buildChainParam4table:function(p,e){var k=e.siblings("div[id^='container_']");var m=$.extend(true,{},e.data("option"));var q=!(m.goalChoose&&m.goalChoose.length>2);if(!!e.data("isLinked")&&q){return false}if(k.length==0&&q){return false}var j=$.map(k,function(s,r){var t=$(s).data("option");if(t.isInit){return{chartId:t.el,dataId:t.config.build.dataParams.dataId}}});if(j.length==0&&q){return false}var i=m.config.dataPanel.rowsData;var o=b.filter(i,function(r){return r.isChecked});var l=m.config.build.dataParams.dataId;var f=p.dimCode.split("---");var h=f.length;var n={dataId:l,dimId:(b.map(o,function(r){return r.dimId})).slice(0,h),attrId:(b.map(o,function(r){return r.attrId})).slice(0,h),attrClass:(b.map(o,function(r){return r.attrClass})).slice(0,h),otherChart:j};if(!b.every(n.attrClass,function(r){return !(r=="0"&&r=="3")})){return false}var g={attrId:n.attrId,dimId:n.dimId,dataId:n.dataId,attrClass:n.attrClass,attrType:(b.map(o,function(r){return r.attrType})).slice(0,h),filterType:(b.map(o,function(r){return r.filterType})).slice(0,h),attrValue:f};return{chartLinkData:g,queryChainParam:n,name:p.dimCode,goalChoose:m.goalChoose}}};var d=true;$(window).on("resize",function(f){setTimeout(function(){$(".chart[_echarts_instance_]").each(function(g,h){$(h).EBuilder("getInstanceByDom").resize()})},300);setTimeout(function(){if(d){d=false;$(window).trigger("resize")}else{d=true}},500)})});