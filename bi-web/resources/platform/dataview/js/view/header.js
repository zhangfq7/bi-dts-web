define(["view/box","view/header/data","view/header/widget","view/header/tools","bace","view/header/template","view/header/save","view/header/preview"],function(d,h,g,c,a,e,i,b){var f={};f.control={init:function(){log("初始化头部操作栏");f.view.init();d.Header.save.saveReport=i.saveReport}};f.module={configDataArray:[h.config,g.config,c.config,e.config,i.config,b.config],selected:0};f.view={init:function(){f.view.buildTabs();var j=a.handleUrlParam("/platform/dataview/is-send-email");jQuery.ajax({type:"post",url:j,dataType:"json",success:function(k){if(k.openEmailFlag!="1"){c.openSendEmail()}if(waterFlag=="1"){c.openWaterflag()}if(d.main.urlMenuInfo.length){c.config.groups[0].tools[0].panel[3].checked="checked";d.Widgets.openUrlPanel("open")}f.view.createGroup();f.view.bindMenuHover()}})},buildTabs:function(){if(discovery=="1"){$('#tabs a[shref="#tabs_data"],#tabs a[shref="#tabs_template"]').parent().remove();$("#tabs_data,#tabs_template").remove();f.module.configDataArray.splice(0,1);i.changeLayoutManage();c.discoveryUrlLayout()}if(tplUrlChange=="1"){c.discoveryUrlLayout()}jQuery("#tabs").tabs({active:f.module.selected,beforeActivate:function(j,k){}}).disableSelection();jQuery("#tabs").append($("<div></div>",{"class":"tabs-logo",html:"<div class='icon-logo'></div>"}).on("click",function(){}));jQuery("#tabs .ui-tabs-nav").on("dblclick",function(){var j=jQuery("#tabs").attr("data-toggle");if(j=="open"){myLayout.sizePane("north",33);jQuery("#tabs").attr("data-toggle","close")}else{myLayout.sizePane("north",120);jQuery("#tabs").attr("data-toggle","open")}});jQuery("#tabs .ui-tabs-anchor").on("click",function(k,l){var j=jQuery("#tabs").data("toggle");if(j=="open"){return}else{myLayout.sizePane("north",120);jQuery("#tabs").attr("data-toggle","open")}});jQuery("body").removeClass("invisible")},createGroup:function(){var Q=f.module.configDataArray;var O=jQuery("body").append('<div class="hide" id="menuDiv"></div>');var s=[];var D=[];for(var H=0,C=Q.length;H<C;H++){var J=Q[H];var q=J.id;var G=jQuery("#"+q);var u="";var L=J.groups;if(!L){continue}for(var F=0,E=L.length;F<E;F++){var v=L[F];var K=v.title;var I=v.tools;u+="<div class='group' ";if(v.style){u+=' style="'+v.style+'" '}u+="><ul>";for(var w=0,y=I.length;w<y;w++){var p=I[w];var l=p.menu;var A=p.panel;if(A){u+='<li style="margin-top:-2px;margin-left:-10px;">';for(var B=0;B<A.length;B++){u+='<div class="tools-panel">';u+='<div class="'+A[B].iconCls+'"></div>';u+='<div title="'+A[B].title+'">'+A[B].text+"</div>";u+='<input id="'+A[B].id+'" type="checkbox" class="switchbutton" style="width: 64px;"  ';if(A[B].checked){u+=' checked="checked" />'}else{u+="  />"}u+="</div>";D.push({id:A[B].id,change:A[B].change,option:A[B].option})}u+="</li>"}else{if(l){if(p.hidden){continue}u+='<li data-menu="'+l.id+'">';u+='<div class="bi-icon '+p.iconCls+'"></div>';u+="<div>"+p.text+"</div>";u+='<div class="down-arrow"></div>';u+="</li>";function o(k){var R=(k.id=="mapMenu")?'<div id="'+k.id+'" class="menu-content" style="width:425px;">':'<div id="'+k.id+'" class="menu-content" style="width:169px;">';for(var j=0,S=k.items.length;j<S;j++){var T=k.items[j];R+="<div class='menuTitle'>"+T.title+"</div>";var n=T.contents;R+="<div class='menuContent'>";for(var z=0,r=n.length;z<r;z++){var x=n[z];R+="<div bi-draggable='"+x+"'><div class='"+x+"'></div></div>"}R+="</div>"}R+="</div>";jQuery("#menuDiv").append(R)}if(l.html){jQuery("#menuDiv").append(l.html);(function(j){jQuery(document).on("click","#"+l.id+" .menuContent>div",function(){j.click.call(this)})})(p)}else{o(l)}}else{u+='<li id="'+p.id+'"';if(p.style){u+=' style="'+p.style+'" '}if(p.disabeld){u+=' class="tabs-menu-disabeld" '}u+='><div class="bi-icon '+p.iconCls+'"></div>';u+="<div>"+p.text+"</div>";u+="</li>";s.push({id:p.id,click:p.click})}}}u+="</ul>";if(K){u+="<div class='group-name'>"+K+"</div>"}u+="</div>";if(K){u+="<div class='group-sep'></div>"}else{u+="<div class='tools-group-sep'></div>"}}G.append(u)}for(var N=0,M=s.length;N<M;N++){var m=s[N];(function(j){jQuery("#"+j.id).on("click",function(){if(!jQuery(this).hasClass("tabs-menu-disabeld")){j.click.call(this)}})})(m)}for(var P=0,t=D.length;P<t;P++){var m=D[P];(function(j){$("#"+j.id).switchbutton(j.option).change(function(){j.change.call(this)})})(m)}},bindMenuHover:function(){jQuery("#tabs li[data-menu]").poshytip({content:function(){var j=jQuery(this).attr("data-menu");return jQuery("#"+j).outerHTML()},alignTo:"target",alignY:"bottom",alignX:"right",offsetY:2,offsetX:-55,showTimeout:200,keepInViewport:false,show:function(){f.view.initWidgetDrag()}})},initWidgetDrag:function(){jQuery(".menu-content div[bi-draggable]").draggable({revert:true,scroll:false,start:function(){},stop:function(){},appendTo:"body",cursor:"move",cursorAt:{left:76,top:76},drag:function(j,k){},helper:function(j){return jQuery("<div>",{"class":"container hp-container placeholder",chartType:$(this).attr("bi-draggable")}).html('<div style="margin:75px 125px">'+$(this).outerHTML()+"</div>")}})}};return f.control});