define(["bace","view/box","view/layout","view/pc/serach","view/widgets/property","view/widgets/plugins/table/table","view/widgets/plugins/echarts/echarts","view/widgets/plugins/text/text","view/eventBinder"],function(c,h,j,d,i,f,b,e){var g={currentPlugin:""};g.module={isHaveFilter:false,isHaveOper:false,thumbURLArray:[],thumbLen:null};var a={lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:"#fff",speed:1,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000};g.control={init:function(){g.view.init();g.view.gotop();h.Widgets.showLoading=g.view.showLoading;h.Widgets.hideLoading=g.view.hideLoading;h.Widgets.showTip=g.view.showTip;h.Widgets.hideTip=g.view.hideTip},getPluginByType:function(k){if(["pie","bar","line","radar","funnel","gauge","map","scatter"].indexOf(k)>-1){return h.Widgets.plugins.echarts}else{return h.Widgets.plugins[k]}},start:function(v){if(v=="render"){var m=arguments[1];var x=m.widgets;var k=m.filters;var u=$.toJSON(k);d.dataStart(k);if(k&&k.length>0){jQuery("#layout_body_title_panel").show();setTimeout(function(){j.toggleFilterPanel("open")},500);g.module.isHaveFilter=true}for(var o=0,l=x.length;o<l;o++){var q=x[o];var p=q.option;var r=q.layout;var A=p.config.build.dataParams.hasRight;var t=g.view.packageContainer($("#tableChartPanel"),{top:r.top,left:r._left},p.chartType,p.el,A);t.css({width:r._width,height:r.height,"border-width":r["border-width"],"border-color":r["border-color"],background:r.background,"box-shadow":r["box-shadow"],"border-radius":r["border-radius"]}).data("option",p);(function(n){setTimeout(function(){var B=g.control.getPluginByType(n.chartType).apply(n,true)},500)})(p)}var z=!m.openWaterflag;g.view.unCopy(z);var w=g.view.getLastBottom();var s=jQuery("<div>",{id:"shareAndDownload",css:{height:"120px",width:"100%",background:"#F8FCFF",position:"relative",top:w+"px"}});jQuery("#tableChartPanel").append(s);if(h.main.allowComment==1){var y=jQuery("<iframe>",{frameBorder:"0",width:"100%",border:"0",height:"450px",id:"commentIframe",css:{position:"absolute",top:w+120+"px"}});jQuery("#tableChartPanel").append(y);y[0].onload=function(){};y[0].src=c.handleUrlParam("/platform/myreport/comment/report-comment")+"?reportId="+h.main.reportId}setTimeout(function(){if(m.filters.length==0){jQuery("#layout_body_content_panel").addClass("toTop")}jQuery("body").removeClass("invisible")},800)}},bindEmailAndDownload:function(){$("#downloadEx")[0]&&$("#downloadEx").on("click",function(){if(report_config.smsCaptcha==1&&(report_config.mobileNum==""||report_config.mobileNum==null)){window.open(c.handleUrlParam("/platform/sysmanage/safety/bind-mobile-page"));return}$.dialog({title:"下载数据文件",lock:true,resize:true,width:700,height:318,padding:"0px 0px",content:'<iframe id="mainfrm" frameBorder="0" width="100%" border="0" height="100%" src="'+c.handleUrlParam(webpath+"/platform/download/to-download")+'"></iframe>',cancel:function(){return $("#mainfrm")[0].contentWindow.cancel()},ok:function(){var k=$("#mainfrm")[0].contentWindow.sure();if(k.flag){jQuery(".actGotop").hide();var l=$("#tableChartPanel .container");l.each(function(n,m){var p=$(m);var o=p.data("option");if(o.chartType=="table"){p.find("td[field]>div").each(function(){$(this).width($(this).width())})}});if(k.type=="pic"){g.view.downPic()}else{if(k.type=="ppt"){g.view.downPPT()}}}else{return false}}})});jQuery("#EmailEx")[0]&&jQuery("#EmailEx").bind("click",function(){g.view.getThumbURL(function(k){var l=$("<form></form>",{method:"post",action:c.handleUrlParam(webpath+"/platform/dataview/to-email"),target:"_blank",html:"<input name='reportId' value='"+h.main.reportId+"'/><input name='img' value='"+k+"'/>"});$("body").append(l);l.submit();$(l).remove()})})}};g.view={init:function(){g.view.initDroppable();for(var k in g.view.bindEvent){g.view.bindEvent[k]()}},initDroppable:function(){jQuery("#tableChartPanel").droppable({drop:function(k,s){var m=s.helper;var q=$(this);if(!m.hasClass("hp-container")){g.view.updateGridGraph();return}var n=g.view.autoPositionGrid(k,q);var p=m.attr("chartType");m.remove();var o=g.view.packageContainer(q,n,p);g.view.checkContainerOverlap(o);var l=o.siblings("div[id!='gridBg']");if(l.hasClass("container-error")){var r=g.view.getLastBottom(o);o.animate({top:r},500,function(){g.view.updateGridGraph()});setTimeout(function(){l.removeClass("container-error")},500);q.animate({scrollTop:r-21},500)}g.view.updateGridGraph();g.view.installWidgetsDraggableAndResize()}})},packageContainer:function(q,o,p,n,t){var k=n||"container_"+(new Date()).getTime();var r=p.split("-")[0];q.append($("<div></div>",{id:k,chartType:p,"class":"container allow",css:{position:"absolute",left:o.left,top:o.top,transform:"translateZ(0)"},html:function(){if(r=="text"){return'<div class="chart '+r+'"></div>'}else{return'<div class="tools"></div><div class="breadcrumbs"></div><div class="chainInfo"></div><div class="dimAttrSettingPanel" style="display:none"></div><div class="chart"><i class="iconfont icon-'+r+' exp"></i></div>'}}}));var s=$("#"+k);g.currentPlugin=g.control.getPluginByType(r);if(!g.currentPlugin){log("没有找到 "+r+" 对应的组件,请检查是否注册组件！")}else{g.currentPlugin.init();var m=(typeof _RSDFGHJJKK)==="undefined"?"preview":"container";$(".tools",s).append(g.currentPlugin.contanier.getTools(m));if(!t){$("div.tools>div.discovery").remove()}s.find(".tools .chart-icon").poshytip({className:"tip-twitter",showTimeout:100,alignTo:"target",offsetY:-28,offsetX:12,alignX:"left"});var l=$(g.currentPlugin.contanier.settingPanel);$(".dimAttrSettingPanel",s).append(l);c.autoScroll($("#"+k+" .panel"),{cursorcolor:"#5489A9"})}setTimeout(function(){g.view.resizeTempCharts(s)},100);s.data("option",{el:k,isInit:false,chartType:r,config:{plugins:g.currentPlugin.type,build:{},designPanel:{},dataPanel:{}}});return s},updateGridGraph:function(){var p=jQuery("#tableChartPanel");var l=p.get(0).scrollWidth;var m=p.get(0).scrollHeight;var o=p.data("scrollWidth")||p.width();var k=p.data("scrollHeight")||p.height();var n=p.find("#gridBg");if(l>o){l=l+20;n.width(l);p.data("scrollWidth",l)}if(m>k){m=m+20;n.height(m);p.data("scrollHeight",m)}},resizeTempCharts:function(p){var m=p.find(".iconfont.exp"),o=p.width(),k=p.height(),n=m.width(),l=m.height();m.css({transform:"scale("+Math.min((k/200),(o/200))+")",top:function(){return(k-l)/2},left:function(){return(o-n)/2}})},resizeContainer:function(k){g.control.getPluginByType(k.chartType).contanier.resize.reisze(k.el)},getLastBottom:function(l){var k=0;if(l){$("#tableChartPanel .container").not("#"+l.attr("id")).each(function(){var m=$(this).position().top+$(this).parent().scrollTop()+$(this).height()+20;if(k<m){k=m}})}else{$("#tableChartPanel .container").each(function(){var m=$(this).position().top+$(this).parent().scrollTop()+$(this).height()+20;if(k<m){k=m}})}return Math.round(k/20)*20+10},getLastTop:function(m){var k=[];var l=m?jQuery("#tableChartPanel .container").not("#"+m.attr("id")):jQuery("#tableChartPanel .container");l.each(function(){var n=$(this).position().top+$(this).parent().scrollTop()+20;k.push(n)});return Math.min.apply(null,k)},getFirstLeft:function(){var k=[];var l=jQuery("#tableChartPanel .container");l.each(function(){k.push($(this).position().left+$(this).parent().scrollLeft())});return Math.min.apply({},k)},getLastRight:function(m){var l=0;var k=m?jQuery("#tableChartPanel .container").not("#"+m.attr("id")):jQuery("#tableChartPanel .container");k.each(function(){var n=$(this).position().left+$(this).parent().scrollLeft()+$(this).width()+20;if(l<n){l=n}});return Math.round(l/20)*20+10},bindEvent:{togglePanel:function(){jQuery("#layout_body_title_panel  .closeFilter").on("click",function(){myLayout.center.children.layout1.center.children.layout1.toggle("north");jQuery(this).find("div:eq(0)").toggleClass("fa-caret-up").toggleClass("fa-caret-down")})},contanierTools:function(){$("#download").on("click",function(){if(report_config.smsCaptcha==1&&(report_config.mobileNum==""||report_config.mobileNum==null)){window.open(c.handleUrlParam("/platform/sysmanage/safety/bind-mobile-page"));return}$.dialog({title:"下载数据文件",lock:true,resize:true,width:700,height:318,padding:"0px 0px",content:'<iframe id="mainfrm" frameBorder="0" width="100%" border="0" height="100%" src="'+c.handleUrlParam(webpath+"/platform/download/to-download")+'"></iframe>',cancel:function(){return $("#mainfrm")[0].contentWindow.cancel()},ok:function(){var k=$("#mainfrm")[0].contentWindow.sure();if(k.flag){jQuery(".actGotop").hide();var l=$("#tableChartPanel .container");l.each(function(n,m){var p=$(m);var o=p.data("option");if(o.chartType=="table"){p.find("td[field]>div").each(function(){$(this).width($(this).width())})}});if(k.type=="pic"){g.view.downPic()}else{if(k.type=="ppt"){g.view.downPPT()}}}else{return false}}})});jQuery("#Email").bind("click",function(){g.view.getThumbURL(function(k){var l=$("<form></form>",{method:"post",action:c.handleUrlParam(webpath+"/platform/dataview/to-email"),target:"_blank",html:"<input name='reportId' value='"+h.main.reportId+"'/><input name='img' value='"+k+"'/>"});$("body").append(l);l.submit();$(l).remove()})});jQuery("#tableChartPanel").on("click",".container .chart,.container .panel.datagrid",function(){var k=jQuery(this);var l=k.parents(".container");var m=l.find(".dimAttrSettingPanel");if(m.is(":visible")){m.hide("slide")}});jQuery("#tableChartPanel").on("click",".chart-icon.openSelfDimAttr",function(){var l=jQuery(this).parents(".container");var k=l.data("option").chartType;var m=g.control.getPluginByType(k).contanier.renderSettingPanel(l);if(m.is(":hidden")){m.show("slide")}else{m.hide("slide")}});jQuery("#tableChartPanel").on("click",".chart-icon.discovery",function(){var k=_RSDFGHJJKK;var m=jQuery(this).parents(".container").data("option");var l=m.el;window.open(c.handleUrlParam("/platform/dataview/edit")+"?reportId="+k+"&chartId="+l)});jQuery("#tableChartPanel").on("click",".breadcrumbs>a",function(){var m=jQuery(this).parent(".breadcrumbs").find("a").index(this);var k=jQuery(this).parents(".container");var l=k.find(".chart")[0];jQuery(l).EBuilder("undrill",m)});jQuery("#tableChartPanel").on("click",".chainInfo .j_unchainChart",function(){var k=jQuery(this).parents(".container");var l=k.find(".chart")[0];jQuery(l).EBuilder("unchainChart")})}},showLoading:function(l){if(typeof(Spinner2)!=="undefined"){var k=jQuery("<div></div>",{"class":"bi-confirm loadingBg"});l.spin(a);l.append(k)}l.data("isLoading",true)},hideLoading:function(l){var k=l.find(".loadingBg");if(k.length==0){return}if(typeof(Spinner2)!=="undefined"){l.spin("close");k.remove()}l.data("isLoading",false)},showTip:function(m,l){m.titleShow=m.titleShow||true;var k='<div id="org.bi:bi-web:war:1.0.0-SNAPSHOT" failType="${failType}" class="bi-confirm ${className}">	<div class="confrim-text" style="letter-spacing: 1px;text-align:center">  {{if titleShow==true}} <span style="font-size: 26px;">提示 </span>{{/if}}<br/>{{html msg}}	</div>	<div class="btn-group">{{html button}}	</div></div>';$.tmpl(k,m).appendTo(l)},hideTip:function(k){jQuery("#"+k).remove()},downPic:function(){jQuery("body").append(jQuery("<div>",{"class":"screenClass screenCapture ",html:""}));setTimeout(function(){jQuery(".screenClass").removeClass("screenCapture").addClass("screen-img");setTimeout(function(){jQuery("#layout_body_panel .closeFilter,#filterPanel .search").hide();jQuery(".screenClass").append(jQuery("<div>",{"class":"load",html:'<img src="data:image/png;base64,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">'}));g.view.getThumbURL(function(k){jQuery("#layout_body_panel .closeFilter,#filterPanel .search").show();jQuery("#downPic,.screenClass").remove();var m=h.main.reportId;var o=h.main.reportName;var l=k;jQuery("<form>",{id:"downPic",method:"post",action:c.handleUrlParam("/platform/dataview/downImageFile"),target:"_self",html:"<input name='reportId' type='hidden' value='"+m+"'/><input name='fileName' type='hidden' value='"+o+"'/><input name='imgBaseStr' type='hidden' value='"+l+"'/>"}).appendTo("body");jQuery("#downPic").submit();var n=$("#tableChartPanel .container");n.each(function(q,p){var s=$(p);var r=s.data("option");if(r.chartType=="table"){s.find("td[field]>div").each(function(){$(this)[0].style.width=""})}})})},2000)},600)},getThumbURL:function(p){var o=jQuery("#tableChartPanel");jQuery("#thumb_canvas").remove();var m=[];jQuery("#tableChartPanel .container").each(function(){var q=$(this);m.push((q.position().top>0?q.position().top:q.parent().scrollTop()+q.position().top)+q.height()+10)});var n=Math.max.apply({},m)+10;var l=jQuery("#filterPanel").height()+jQuery("#layout_body_title_panel").height()+jQuery(".share-panel").height()+1;var k=jQuery("body").width();if(!(g.module.isHaveFilter&&jQuery("#filterPanel").css("display")!="none")){l=50}html2canvas(document.getElementById("tableChartPanel"),{proxy:webpath+"/ImageServlet",onrendered:function(q){var t=0;var r=l;var s=new Image();s.src=q.toDataURL("image/png");s.onload=function(){var w=k;var u=n+l;var y=document.createElement("canvas");y.setAttribute("id","thumb_canvas");y.style.display="none";y.width=w;y.height=u;document.body.appendChild(y);var x=document.getElementById("thumb_canvas");var v=x.getContext("2d");v.drawImage(s,t,r);jQuery(".screenClass").remove();if((g.module.isHaveFilter&&jQuery("#filterPanel").css("display")!="none")){html2canvas(document.body,{onrendered:function(z){var A=new Image();A.src=z.toDataURL("image/png");v.drawImage(A,t,0);setTimeout(function(){p(x.toDataURL("image/png"))},200)},width:k,height:l})}else{if(jQuery(".share-panel").length>0){html2canvas(document.body,{onrendered:function(z){var A=new Image();A.src=z.toDataURL("image/png");v.drawImage(A,t,0);setTimeout(function(){p(x.toDataURL("image/png"))},200)},width:k,height:l})}else{p(x.toDataURL("image/png"))}}}},width:k,height:n+l})},downPPT:function(){jQuery("body").append(jQuery("<div>",{"class":"screenClass screenCapture ",html:""}));setTimeout(function(){jQuery(".screenClass").removeClass("screenCapture").addClass("screen-img");setTimeout(function(){jQuery("#layout_body_panel .closeFilter,#filterPanel .search").hide();jQuery(".screenClass").append(jQuery("<div>",{"class":"load",html:'<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAADABAMAAABG93g1AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAwUExURQAAAFp2gk9xeFZxfFp2gVx4g0VacVp2gVh0f1p3gVt3glt3glp3glt3gll1gFp3geIglncAAAAQdFJOUwBRDBZq/gVFI4PP6Ji4N6ixDvWMAAAFf0lEQVRYw+2YUWgcRRiAJ7uyuUI9s001kdZ4FbGoEDYYCSqWNN22SakPQhckF8lFg7VS8dKWWmtsLxAfYitEEjDbHmILQbPXU4oeyG0OjSSSg4OU0qpcWXqJQSgG+1IlKVfj/Du3ud3b2TmlClYyDxc2/7c788/Mznw7CP0fy4bz7DivKBIT8ClKxCt2fbEI1M+549xou2QBQk9NyF27nhi0AJ8ougFhSv/KAjaJdZQ2nNA7LWBWXEcB1gQTYQLwokhLhRtNfE+ASpHSRlzu1fcQoE+sLY29DD93B9slALgeMQzXtqf4syPwG0wMQlfjJKG7648FVoA3kskW/GdK/wIGq8tM8tUeMWcDtFQVTlQ5i3gJ7YUk+R6RVESquKJp4zlUedXMjn9TQvysSCoqlEdjWmzMdi1A3DFgC7oW+6x42YTjB52JHk9qX6/kJeAGHCkdq13JcTtQ6+pL/tSirYq6AGU62u4RAn9vqvNPQHHcJDwExXrmAwaUP+wA5FnM1Iwb5+xt6DGBGm9AdADH3VU0OKrgyjXyryZr5yn38ruHihf1R1wEtzF/yZ5l6WCia8sZByD+5IwPLGeWh5xZOiZU40xmZsKWJ0zJGtvr58PxGxHkk81pyf0aQD5cSU3xjn35mSX8EjyV2YGEEJ72h83XwvZe7Mvn8f/QbnUHaqjGqwO8mvV2wBethl81GhZkOeQnD99iqwK9BD/d6nCAk+UAX7j3kdKu6FU/QgDgBaaaNhacqjYTYDN1iUIVaTVCAB99CRpQJxABcE8fdseFNnWoAOCerqUMN07SAvy0VYyLToYsgBPrKDOmfxuyANQ05zXvCoB3KQug/la0Wu6UcvSTMuuQucWz/EHXPf3h5HQRuL5ImUtXUgEL4BPt7nnFa7FmC1hLMxnhtPapBbyrdFKm/XvauAVcVl6gNPKuZCxMgApF+YY247Ox3wnwmhKkdsYG7TwBtit7qP5wTzIlAcAnlI9LFnTfLXhd/FpsEPeAhJMMl/jD/ngc/OG0dhYG60mls9Qf9seNc/imp/WLiAugxyFJpz/4bhrGWA758+ZAVWpVLn94OGtkL0nFVdPtDwNxI7vI9IfeuG3jpPrDg/GxMv7w3PS/6A9lt+beDJRpb3+YMYElb3+gAE5/WDCBkXL+ELptf+BQGX+4v4XtD2+lJ5j+MJ9WJ1n+0K+q0W0Mf9gUVaMfsPwhqqrD2B/EgIc/dOMGYL6xrQquKP7QnU7/jP8cku9DTQep/tBm+oMs5+DjxdMfuuStIU4Uvf1hXm5FAHj6gyxXEcDDHyplbEkm4OEPjfJORAC6P6D1cksB8PAHnKQF0P0BJ2kBdH/oO4AsgOUPBPAu1O9EZ0W1q9vyHVPe+aHMOmRu8Sx/0DRPfxgYMR1Ag51pYZry8JufByyAH32R4g9GttkC1gR1yuZ9yvjRAk4EOygz831jzAJ+g7MKtz/EjRwBKoNw2uFu5S3jOwK8HmyndsZR4wwBtuvPl8bMJWht/KoEHcUnEhfgWrKvk7DK+nGiXCwVwIchsEadTEXsn1FwbLLLuAiD9YzeAecFCeVC6YfYs9q34A+PKTjJilGFiErhUw4TEeRPmw/1G2Hkv6wQUbEWc/yxN7mS2iuIn8Jxh/D1L2dmbCP4C46fcX2QLtnObBTly5LREDbmb9iBDon5Ufx2Z44yFrZn8pF/2B+uqVBGvP3BjKvD3v5AgElvfyBVtP4H/OHQOqY/CPOwZTH8oU+WP2T5A47L1Qx/2IzjO0MMf8Dxrfik7JiXP3ThuHnqmPPwBwyAP8ziCN0f+PXQIjh1ZPrDXrzfMv0BTh2Z/gC2z/IHP8g8yx8a4D6WP8yKB5j+wJnPZfmDua2z/GHL3Ko/3E75ExuZN4SINoqJAAAAAElFTkSuQmCC">'}));g.view.getThumbURL(function(l){var m=$("#tableChartPanel .container");var k=[];jQuery("#layout_body_panel .closeFilter,#filterPanel .search").show();jQuery(".screenClass").remove();m.each(function(w,B){var A=$(B);jQuery("#pptCanvas").remove();var x=A.data("option");if(x.chartType=="table"){var y=document.createElement("canvas");y.setAttribute("id","pptCanvas");y.style.display="none";y.width=A.outerWidth();y.height=A.outerHeight(true);document.body.appendChild(y);var t=document.getElementById("pptCanvas");var q=t.getContext("2d");var s=new Image();var p=parseInt(A.css("top").replace("px",""));var z=jQuery(".filter-panel");var o=z.height();var u=z.css("min-height").replace("px","");if(o==0){p=p+50}else{p=p+130+(o-u)}var r=A.offset().left;s.onload=function(){q.drawImage(s,r,p,A.outerWidth(),A.outerHeight(true),0,0,A.outerWidth(),A.outerHeight(true));k.push(t.toDataURL("image/png"))};s.src=l}else{k.push($(".chart",A).EBuilder("getInstanceByDom").getDataURL({backgroundColor:A.css("backgroundColor")}))}});var n=setInterval(function(){q=$("#tableChartPanel .container");if(k.length!=0&&k.length==q.length){var o=k.join("&&");jQuery("#downPPT").remove();var p=h.main.reportId;var r=h.main.reportName;jQuery("<form>",{id:"downPPT",method:"post",action:c.handleUrlParam("/platform/dataview/download-ppt-file"),target:"_self",html:"<input name='reportId' type='hidden' value='"+p+"'/><input name='fileName' type='hidden' value='"+r+"'/><input name='pptStr' type='hidden' value='"+o.toString()+"'/>"}).appendTo("body");jQuery("#downPPT").submit();clearInterval(n);var q=$("#tableChartPanel .container");q.each(function(t,s){var w=$(s);var u=w.data("option");if(u.chartType=="table"){w.find("td[field]>div").each(function(){$(this)[0].style.width=""})}})}},500)})},2000)},600)},gotop:function(){var k=jQuery("#tableChartPanel");k.scroll(function(){if(k.scrollTop()>=100){jQuery(".actGotop").fadeIn(300);jQuery(".report-panel").addClass("suspension")}else{if(k.scrollTop()<90){jQuery(".actGotop").fadeOut(300);jQuery(".report-panel").removeClass("suspension")}}});jQuery(".actGotop").click(function(){k.animate({scrollTop:"0px"},800)})},unCopy:function(l){if(report_config.copyFlag==1){jQuery(document).bind("contextmenu",function(m){return false});jQuery(document).bind("copy",function(m){return false})}if(report_config.waterFlag==1&&l){var k=g.view.getLastBottom();jQuery("#tableChartPanel").append(jQuery("<div>",{id:"water",css:{position:"absolute",width:"100%",top:"0",height:k+"px",background:"url("+webpath+"/WaterImageServlet)",opacity:".3","z-index":"-1"}}))}}};return g.control});