define(["bace","view/box","qrcode","zclip"],function(e,c){var b={};b.control={init:function(f){a(f)}};b.view={};function a(h){var f='<div class="report-title">'+c.main.reportName+"</div>";var g=$("<div class='share-panel'>",{css:{width:"100%",height:"50px",background:"#FFF"},});g.append(f);$("body").prepend(g);$.ajax({url:e.handleUrlParam(webpath+"/platform/dataview/count-email"),async:false,data:{reportId:c.main.reportId},success:function(k){var l=k.emailCount||0;var j=k.downLoadCount||0;i(l,j)},error:function(){var k=0;var j=0;i(k,j)}});function i(p,o){var m;var n={shareDiv:'<div class="share-content " ><div id="share" class="share-text wechat"></div><div id="sinaBlog" class="share-text sina-blog"></div><div id="QQzone" class="share-text qq-zone"></div><div id="copyToClip" class="share-text copy-url"></div>',downloadEx:'<div id="downloadEx" class="operaDownBottonEx">下载</div>',EmailEx:'<div id="EmailEx" class="operaEmailBottonEx">邮件推送</div>',detail:'<br/><div class="detail">快给朋友分享吧！</div>',countDownLoad:'<div id="countDownLoad">'+o+"人已下载</div>",countEmail:'<div id="countEmail">'+p+"人已推送</div>",bubble:'</div><div id="bubble"><div class="qr-code "><div id="qrCode"></div></div><div class="detail">打开微信“扫一扫”，将本报表分享到朋友圈</div></div>'};var k={shareDiv:1,downloadEx:1,EmailEx:1,detail:1,countDownLoad:1,countEmail:1,bubble:1};var j=h.openSendEmail||false;var l=h.openDownload||false;if(!l){$.extend(k,{downloadEx:0,countDownLoad:0})}if(!j){$.extend(k,{EmailEx:0,countEmail:0})}m=($.map(n,function(s,r){if(!!k[r]){return s}})).join("");$("#shareAndDownload").html(m);$("#bubble").hide();jQuery("#qrCode").qrcode({text:reportUrl});var q=null;$("#share").bind("mouseover",function(){$("#bubble").show();$(".wechat").addClass("hover");clearTimeout(q);q=setTimeout(function(){$("#bubble").hide();$(".wechat").removeClass("hover")},10000)});$("#QQzone").on("click",function(){window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(reportUrl)+"&title="+c.main.reportName);return false});$("#sinaBlog").on("click",function(){window.open("http://service.weibo.com/share/share.php?appkey=&searchPic=false&style=simple&url="+encodeURIComponent(reportUrl)+"&title="+c.main.reportName);return false});$("#copyToClip").on("click",function(){prompt("请用Ctrl+C复制连接",reportUrl)});$("#copyToClip2").on("click",function(){if(window.clipboardData){$("#copyToClip").off("click");$("#copyToClip").on("click",function(){window.clipboardData.setData("Text",reportUrl)});window.clipboardData.setData("Text",reportUrl)}else{$(".zclip").remove();$("#copyToClip").zclip({copy:function(){return reportUrl}})}})}}function d(){var f='<div class="report-title">'+c.main.reportName+'</div><div class="share-area"><div class="share-text share">分享:</div><div id="share" class="share-text wechat cursor-pointer">微 信<span class="show-share"></span></div></div><div id="shareDiv" class="bubble"><div class="share-content"><div id="sinaBlog" class="share-text sina-blog">新浪微博</div><div id="QQzone" class="share-text qq-zone">QQ空间</div><div id="copyToClip" class="share-text copy-url"><div>复制地址</div></div><hr class="share-hr"/><div class="code-title">微信扫描二维码：</div><div class="qr-code"><div id="qrCode"></div></div></div><div class="bubble-arrow"></div><div class="bubble-arrow-inner"></div></div>';var h=$("<div class='share-panel'>",{css:{width:"100%",height:"50px",background:"#FFF"},});h.append(f);$("body").prepend(h);jQuery("#qrCode").qrcode({text:reportUrl});var g;$("#share").on("click",function(){var j=jQuery("#share").offset().top;var l=jQuery("#share").offset().left;var i=jQuery("#share").width();var k=jQuery("#share").height();$("#shareDiv").css({top:j+k+5,left:l+i-113});if("none"==jQuery("#shareDiv").css("display")){jQuery("#shareDiv").show();if(window.clipboardData){jQuery("#shareDiv").hide();$("#copyToClip").on("click",function(){window.clipboardData.setData("Text",reportUrl)})}else{$(".zclip").remove();$("#copyToClip").zclip({copy:function(){return reportUrl}})}}else{jQuery("#shareDiv").hide()}clearTimeout(g);g=setTimeout(function(){jQuery("#shareDiv").hide()},1500)});jQuery("#shareDiv").on("mousemove",function(){if(!g){return}clearTimeout(g);g=null}).on("mouseleave",function(){g=setTimeout(function(){jQuery("#shareDiv").hide()},1500)});$("#QQzone").on("click",function(){window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(reportUrl)+"&title="+c.main.reportName);return false});$("#sinaBlog").on("click",function(){window.open("http://service.weibo.com/share/share.php?appkey=&searchPic=false&style=simple&url="+encodeURIComponent(reportUrl)+"&title="+c.main.reportName);return false})}return b.control});