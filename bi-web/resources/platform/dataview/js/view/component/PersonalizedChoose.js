define(["bace","view/box","view/component/dateFormatUtil","view/component/CalcUtil","view/component/levelUtil","view/component/PersonalAttr"],function(d,c,f,e,g,b){var a={};a.control={show:function(h){if(!jQuery("#personalizeChoose")[0]){jQuery("body").append("<div id='personalizeChoose' style='display:none;position: relative'></div>")}jQuery("#personalizeChoose").load(d.handleUrlParam("/platform/dataview/format/personalize-choose"),function(){a.view.show();if(h=="0"){$(".derive-attr").show();$(".derive-dim").hide()}else{if(h=="1"){$(".derive-dim").show();$(".derive-attr").hide()}}a.view.bindEvent()})}};a.view={show:function(){$.dialog({id:"chooseDialog",title:"选择类型",padding:"0",width:"440px",height:"260px",lock:true,content:jQuery("#personalizeChoose")[0]})},bindEvent:function(){$(".calculate-attr").on("click",function(){$.dialog.closeAll();jQuery("#propertyPanel").hide();e.show(c.main.dataId)});$(".personalized-attr").on("click",function(){$.dialog.closeAll();jQuery("#propertyPanel").hide();b.show(c.main.dataId)});$(".date-format").on("click",function(){$.ajax({url:d.handleUrlParam("/platform/dataview/format/has-date-attr"),data:{dataId:c.main.dataId,dataType:c.main.dataType},success:function(h){if(h.dateAttrNum>0){$.dialog.closeAll();jQuery("#propertyPanel").hide();f.show()}else{$.dialog.alert("该数据源不存在日期指标，无法进行时间格式化")}},error:function(){$.dialog.alert("系统异常，请联系管理员")}})});$(".dim-band").on("click",function(){$.dialog.closeAll();jQuery("#propertyPanel").hide();g.show("","","","","","","1")})}};return a.control});