define(["sabace","addUser"],function(b,c){var a={};a.module={img:img,title:title,desc:desc,reportId:reportId};a.view={isEmail:function(e){var d=/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/;return d.test(e)}};a.control={init:function(){$("#theme").val(a.module.title);$("#content").val(a.module.title+"\n"+a.module.desc);$(".img>div").bind("click",function(){window.open(a.module.img)});$(".head>div").bind("click",function(){var h=$("#sendEmail").val();if(h==""){bi.dialog.show({type:bi.dialog.TYPE_WARNING,title:"警告",message:"请输入邮箱地址！"});return}var d=[];if(h!=""){d=h.split(",")}var g=true;for(var f=0;f<d.length;f++){if(!a.view.isEmail(d[f])){g=false}}if(!g){bi.dialog.show({type:bi.dialog.TYPE_WARNING,title:"警告",message:"邮箱地址格式不正确！"});return}else{var e=d.join(",");b.ajax({data:{theme:$("#theme").val(),emailAddress:e,img:a.module.img,content:$("#content").val(),reportId:a.module.reportId},url:b.handleUrlParam(webpath+"/platform/dataview/send-email"),success:function(i){if(i.flag==0){bi.dialog.show({title:"提示",message:"邮件发送成功!"})}},error:function(i){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:"错误",message:i.responseText})}})}});$("#selectUser").bind("click",function(){var d=b.handleUrlParam("/platform/myhome/add-user")+"?type=email";bi.dialog.show({title:"编辑用户",message:$('<div id="add-user-dialog"></div>').load(d),spinicon:"glyphicon glyphicon-refresh",cssClass:"add-user-dialog",closeByBackdrop:false,closeByKeyboard:false,onshown:function(){c.init()},buttons:[{label:"取消",cssClass:"btn-info",action:function(e){e.close()}},{label:"保存",cssClass:"btn-info",action:function(e){c.saveUsers();e.close()}}]})})}};return a.control});