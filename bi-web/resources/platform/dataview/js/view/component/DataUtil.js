define(["view/box","bace","view/attr"],function(a,b,c){var d={};d.module={};d.control={init:function(){d.control.findDataByName()},show:function(){if(!jQuery("#chooseDataPanel").length){jQuery("body").append("<div id='chooseDataPanel' style='display:none;position: relative'></div>");jQuery("#chooseDataPanel").load(b.handleUrlParam("/platform/dataview/chooseDataPage"),function(){d.control.init();d.view.bindEvent();d.view.show();b.autoScroll(jQuery("#chooseDataPanel .list"))})}else{d.view.show();d.control.findDataByName("")}},findDataByName:function(f){jQuery("#chooseDataPanel .data-loading").css({display:"inline-block"}).spin({lines:9,length:3,width:2,radius:4,corners:0,rotate:11,color:"#000",speed:1.2,trail:50,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000,top:"auto",left:"auto"});$.ajax({type:"POST",url:b.handleUrlParam("/platform/dataview/findData"),dataType:"json",data:{dataName:f||""},success:function(i){jQuery("#chooseDbs .list,#chooseFiles .list,#chooseLinks .list").html("");var j=i.importList;jQuery("#fileNum").text(j.length);var l=i.dbList;jQuery("#dbNum").text(l.length);var k=i.linkList;jQuery("#dbLinkNum").text(k.length);g(j);h(l);e(k);$("#chooseDataPanel .dataInfo").dotdotdot();jQuery("#chooseDataPanel .data-loading").hide().spin("close");if(a.main.dataId){jQuery("#chooseDataPanel").find("[data-id='"+a.main.dataId+"']").addClass("checked")}},error:function(){alert(JSON.stringify(arguments))}});function g(i){var j='<div data-id="${dataId}" data-name="${dataName}" class="data"><div class="choose-data file-icon"></div><div class="dataInfo">${dataName}</div><div class="state"><i class="fa fa-check"></i></div></div>';$.tmpl(j,i).appendTo("#chooseFiles .list")}function h(j){var i='<div data-id="${dataId}" data-name="${dataName}" class="data"><div class="choose-data {{if dataType == "2" && interfaceFlag == "0" }}db-icon{{/if}}{{if dataType == "2" && interfaceFlag == "1" }}dacp-icon{{/if}}{{if dataType == "4"}}openapi-icon{{/if}}{{if dataType == "5"}}connect-db-icon{{/if}}{{if dataType == "7"}}table-view-icon{{/if}}"></div><div class="dataInfo">${dataName}</div><div class="state"><i class="fa fa-check"></i></div></div>';$.tmpl(i,j).appendTo("#chooseDbs .list")}function e(i){var j='<div data-id="${dataId}" data-name="${dataName}" class="data" style="width: 103px;"><div class="choose-data link-icon"></div><div class="dataInfo">${dataName}</div><div class="state"><i class="fa fa-check"></i></div></div>';$.tmpl(j,i).appendTo("#chooseLinks .list")}},};d.view={show:function(){$.dialog({title:"选择数据可视化数据源",padding:"0",width:"1000px",height:"500px",lock:true,content:jQuery("#chooseDataPanel")[0],ok:function(){var g=jQuery("#chooseDataPanel .data.checked").attr("data-id");var e=jQuery("#chooseDataPanel .data.checked").attr("data-name");var f=jQuery("#chooseDataPanel .data.checked .choose-data").attr("class").replace("choose-data ","");var h={dataId:g};if(f=="file-icon"){h.type="1"}else{if(f=="db-icon"||f=="dacp-icon"){h.type="2"}else{if(f=="openapi-icon"){h.type="4"}else{if(f=="link-icon"){h.type="3"}else{if(f=="connect-db-icon"){h.type="5"}else{if(f=="table-view-icon"){h.type="7"}}}}}}$.ajax({type:"POST",url:b.handleUrlParam("/platform/resmanage/data/set-hit-count"),dataType:"json",data:h,success:function(i){},error:function(){alert(JSON.stringify(arguments))}});a.main.dataId=g;a.main.dataName=e;a.main.dataType=h.type;c.init();c.openAttrPanel("open");if(a.Property.close!=null){a.Property.close(true);a.Property.hideTip("error")}return true},okVal:"引用",cancelVal:"关闭",cancel:function(){return true}})},bindEvent:function(){jQuery("#chooseDataPanel").on("click",".data",function(){jQuery("#chooseDataPanel .data").removeClass("checked");jQuery(this).addClass("checked")});jQuery("#chooseDataPanel").on("click",".searchButon",function(){d.control.findDataByName(jQuery("#dataName").val())})}};return d.control});