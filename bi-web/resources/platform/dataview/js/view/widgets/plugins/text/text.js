define(["bace","view/box","lang","plugins","ui","adapter"],function(b,a){a.Widgets.plugins.text={type:"text",flag:false,init:function(){if(!a.Widgets.plugins.text.flag){c();a.Widgets.plugins.text.flag=true}},apply:function(e,f,d){var g=$("#"+e.el);if(!d){g.find(".chart").append("<div>"+e.config.build.textStr+"</div>");$("#tableChartPanel").off("mouseenter").off("mouseleave").off("click")}else{g.css("border","none");g.find("div.chart.text").append('<div class="text-editor"></div>').find("i").remove();a.Widgets.plugins.text.editorFormat(g.find("div.chart.text"));g.find(".text-editor p").replaceWith(e.config.build.textStr);g.data("option",e)}},contanier:{getTools:function(d){d=d||"main";switch(d){case"main":return'<div class="chart-icon move" title="按住我，拖动！"><i class="iconfont icon-move" ></i></div><div class="chart-icon removeSelfChart del" title="移除"><i class="iconfont icon-delete" ></i></div>';break;default:return[]}},resize:{start:function(){},reisze:function(d){a.Widgets.plugins.text.editorSizeChange(d)},stop:function(d){a.Widgets.plugins.text.editorSizeChange(d)}}},destory:function(d){var e=$("#"+d);e.remove()},editorFormat:function(g){var d=parseFloat(g.parentsUntil("#tableChartPanel").css("height"))-15;var e="texteditor_"+(new Date()).getTime();g.find(".text-editor").attr("id",e);var f=UM.getEditor(e,{toolbar:["undo redo bold italic underline strikethrough superscript subscript forecolor backcolor removeformat insertorderedlist insertunorderedlist selectall cleardoc paragraph fontfamily fontsize justifyleft justifycenter justifyright horizontal "],autoHeightEnabled:false,initialFrameHeight:d,initialFrameWidth:"100%",});$(".edui-body-container").css({width:"100%"});b.autoScroll($("#"+e))},editorSizeChange:function(e){var d=$("#"+e);var f=parseFloat(d.css("height"))-15+"px";d.find(".edui-container").css("height",f);d.find(".edui-editor-body").css("height",f);d.find(".edui-body-container").css("height",f)}};function c(){$("#tableChartPanel").on("click",".text",function(){if(!$(".text-editor",this)[0]){var e=$(this);e.parentsUntil("#tableChartPanel").css("background","#fff");e.parent().css("border","none");e.append('<div class="text-editor"></div>').find("i").remove();a.Widgets.plugins.text.editorFormat(e)}var d=$(this).parent().attr("id");$(this).parent().data("option",{chartChild:"",chartType:"text",config:{build:{dataParams:{dataId:"",chartType:"text"}}},el:d,isInit:true,mapType:""})});$("#tableChartPanel").on("mouseenter",".text,.edui-toolbar",function(){$(".edui-toolbar",this).css("display","block")});$("#tableChartPanel").on("mouseleave",".text,.edui-toolbar",function(){$(".edui-toolbar",this).css("display","none")})}});