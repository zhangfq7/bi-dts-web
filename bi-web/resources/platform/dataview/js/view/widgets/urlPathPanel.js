define(["bace","view/box","upload","validation"],function(c,b){var a={};a.module={reportUrlMenuInfo:[],urlGroupPosition:{},defaultPicture:"data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAAhACEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+AizsrzUbu2sNPtLm/v72eK1s7Kzgluru7up3WKC2traBHmnnmkZY4oYkeSR2VEUsQK/aT9lf/gljd36t4s/agtr3SI47m1k0T4baF4gsGubyKKWf7W/jPVtIW/jt7K7jFs1np3hzW4NTCSStqF/p08RsH+2f+CIXwB+Hfjr9mX4l/Ea40LTbL4nx/HLxD4Ns/HxsvtusWnhTTvAfww1mLw/GJZ4lj017/XdXupo7V7SW4ubmKS6muI7S3gT9JPFfgzX/AAZdpba3arGlwZvsV5DIs1pepAyiR4JFIZSu+MtDPHDOiujPEqupP8LeL30lcbHifiLw14Um8gx+RY2eX5nmVWry5tjp06VGvKWTODVLC4ZKVSNWrGVfHyjFTSy+Mb1/yHxXzrjbI8HB5Xl8sJkmJpwdbiLB1J4ivTnOcILDVOWFN5TJzah7apGrHEurTjhMVTqwrUz8hv2qv+CSfg7xX4au/Hn7MdvJ4Y8emCDU5/htf6zBD4I1+FNPuJ7uy8MTahbGfw34h1G9a3Fkmpa7F4QQ/wCitH4ftWa+h/AH4gfDzxt8KvF2teBPiH4a1Pwn4s8P3k1lqmj6pEqSxyQyvELi1uYXmstT0268szadq+mXN5pWqWrR3um3t1aTRTv/AHN+Ddb0XxXoOnah4Y1jSvEWn+WbL7fomo2eq2IvNOY2WoWpu7Gae3W4sbyGa0vITIJLa5ikgmVJUZR8Qf8ABVfwhoF9+w/8Wde1bR9K1LXPC9x8PL3w1ql5p9tcah4dvNT+KXgbRdTuNHvZUe4sJr/Sb680y8ltXhNzY3E1tNvikK1/rj4l8MeEmRcA8CZxDiKnkXG+ccIcK16PDGX0o5k8+xGMyzAxljcRg6VSnPI1WrVp162bYmvTwWIjh8RDDYTF49uMvwP6LPF/0heMc1z3KMZwpjOK/D3IMwzeGacd5/iquU1eGoYBVq9TAUszxdOs+KMTSpUI0KeR4XDV80w1fG4Wtj8wwGWfvaf8iFFFFfzuf20f2I/8G9PhnWvEX7H/AMSotJsZbgL+0z4yWScgpbRMPhX8G32y3DARRsRjAZhyy5wCDX9D19+zZ8PfGXhjV/C/xS0Wy8b6L4g0zU9G1jQL4ynRp9P1Wzn065VWiW0vlujaTym3voJrS60+eRZ7J4ru2gvB/m/fstftt/tNfsb+LdJ8T/Aj4q+KfDOm2Guv4g1X4dXGtazefCnxnez6W+iXX/Cb/DxdSt/DviN59JcWcWo3Vqut6U0FjqGh6rperaZpl/Z/21fsBf8ABbj9mX9tbU9B+Gvia0uvgH+0D4g1G907Rfhl4iv7zxN4d8WPbQahqEUng74lWvh7RdFuLqbTLFHl0PxTYeE9Zk1a4/sbw9beJxEmoXH+LP01fAXxuyHjTibxa4Tw1fOuC80xtfPsdmHCaxP+sHCcsPShKdXN8LSl/aFPAUaNCeL/ALbyqNTB4KnRryzWpl0Y4eeK/p3wSreF+LVPAZ/CnPiaco4fDYfiCOHqZRi1VtCEMuhUg8JPFym1TVDHXxNSdSmsDGo/aKnyPgX9mf4R/swWfif4U/A/w4fCHhTSvGvie6igkvbzWL3UL77WdNF5rep6pNc6hqk5stN060aea5W4W1sre3gmhjjVR8Sf8FVJzb/sI/G+1vQsM9x/wq9LeQEfZry4X4v+AJ5oLRmbeZo4YZZzbzLHM0Ec0sInitriWP1f/goR/wAFFvgr+yN47+IPhu7MvxC+MLeJdVvrH4YaJPcWLW1hqet675Gp+J/FbaZqGi+HbRP7PbdpwGo+KZFvtKvIfDr6PfHVbf8Akj/aN/al+Mn7UHjLUfFHxO8Xavf6W2r3+oeGfA8WoXS+DPBNpdyMtvp3hzQg6WFu9tYC30+41iS3fW9Yjto59Yv725LSn+z/AKPOWeKnEOH4f4oz3M8dUyDEYLKMxr43iWpicfjs5q/VsNWc8teIrLF8tXRvH1JrBSv+6jipwqU4/wBFfSS4u8CuGeEf9S+H8qy+rx1LJpZYsJwfDB5dgMg+s4V060uIp4XDywNTERnUqyeWU6c829pd4qrl9OrSrVPnWiiiv7XP82AooooAKKKKACiiigD/2Q==",backgroundPicture:""};a.view={};a.view={init:function(){var d='<div id="layout_body_url_panel"><div id="setUrlPath">设置</div><div id="urlPanel" class=" urlpaths_name_left"></div></div>';$("#layout_body_panel").append(d);if(b.main.urlMenuInfo&&(b.main.urlMenuInfo.length!=0)){a.view.refreshUrlGroup()}},show:function(){$.dialog({id:"urlSetDialog",title:"设置URL导航",padding:"0",width:"880px",height:"400px",lock:true,resize:false,content:jQuery("#urlSettingsPanel")[0],cancelVal:"取消",okVal:"保存",ok:function(){if(!a.view.valid()){return false}$.dialog.confirm("您确定保存该url设置吗？",function(){a.module.reportUrlMenuInfo=[];a.view.collect();b.main.urlMenuInfo=a.module.reportUrlMenuInfo;a.view.refreshUrlGroup();a.view.changeDialogCss()})},cancel:function(){a.view.changeDialogCss();return true}});for(var d in a.view.bindEvent){a.view.bindEvent[d]()}},changeDialogCss:function(){$(".aui_buttons").siblings().remove();$(".aui_footer").css("background","#f8f8f8");$("table.aui_border>tbody>tr:nth-child(2)>td.aui_e").css("background","#f8f8f8")},collect:function(){var f=$('.url-btn-group>div[class="active"]').attr("id").split("-")[2];var g={position:""};g.position=f;var e=0;var d=$(".url-name-define>div>input.url_name_input");$.map(d,function(i){var h={menuName:"",reportUrlInfo:[]};var j=$("."+$(i).attr("id")+">div.url_menus");$.map(j,function(l){var m={urlPathName:"",urlPathDetail:"",urlPathPicture:"",urlPathToken:""};var k=$(l).children().children();m.urlPathName=$(k[0]).val();m.urlPathDetail=$(k[1]).val();if(m.urlPathName&&m.urlPathDetail){m.urlPathDetail=(/^[a-zA-z]+:\/\/[^\s]*/).test(m.urlPathDetail)?m.urlPathDetail:"http://"+m.urlPathDetail;m.urlPathPicture=$(k[2]).attr("src");m.urlPathToken=k[3].checked?1:0;h.reportUrlInfo.push(m)}});if((h.reportUrlInfo.length==0)&&$(i).val()){h.menuName=$(i).val();a.module.reportUrlMenuInfo.push(h)}if(h.reportUrlInfo.length>0){h.menuName=($(i).val())||("url00"+(++e));a.module.reportUrlMenuInfo.push(h)}});a.module.reportUrlMenuInfo.push(g)},refreshUrlGroup:function(){var g=$("#urlPanel");var j;g.children().remove();var k=b.main.urlMenuInfo.length;var f=b.main.urlMenuInfo[k-1].position;var e="";var d=[];var h=0;$.map(b.main.urlMenuInfo,function(i){if(i.reportUrlInfo){if(i.reportUrlInfo.length!=0){e+='<div class="urlPaths"><div class="urlpaths_name urlnamedefine_'+(++h)+'"><b class="fa fa-bars url_fa"></b><a>'+i.menuName+'</a></div><ul class="urlmenus">';$.map(i.reportUrlInfo,function(l){e+='<li class="urlmenulist"><a href="'+l.urlPathDetail+'" target="_blank"><img class="urlpicture" src="'+(l.urlPathPicture||a.module.defaultPicture)+'">'+l.urlPathName+"</a></li>"});e+="</ul></div>"}else{e+='<div class="urlPaths"><div class="urlpaths_name urlnamedefine_'+(++h)+'"><b class="fa fa-bars url_fa"></b><a>'+i.menuName+"</a></div></div>"}}d.push(e);e=""});g.append(d.join(""));if(f==="middle"){j=100/(k-1);$("#urlPanel>div.urlPaths").css("width",j+"%")}else{if(f=="right"){g.removeClass("urlpaths_name_left").addClass("urlpaths_name_"+f);$("#urlPanel>div.urlPaths").css({"float":"right",borderRight:"none",borderLeft:"1px solid #ddd"})}}},refreshUrlDialog:function(){$(".url-name-define>div").remove();$("#urlcontent>div").remove();var e=b.main.urlMenuInfo[b.main.urlMenuInfo.length-1].position;if(e!="left"){$("#url-btn-left").removeClass("active");if(e=="middle"){$("#url-btn-middle").addClass("active")}else{if(e=="right"){$("#url-btn-right").addClass("active")}}}var d="";var g="";var f=0;$.map(b.main.urlMenuInfo,function(h){if(h.reportUrlInfo){d+='<div><input id="urlnamedefine_'+(++f)+'" class=" url_input url_name_input " type="text" value="'+h.menuName+'" maxlength="4"></div>';g+='<div class="urlnamedefine_'+f+'">';$.map(h.reportUrlInfo,function(i){g+='<div class="url_menus"><div class="url_path_name"><input class="url_input url_path_name_input" type="text" placeholder="请输入名称" value="'+i.urlPathName+'" maxlength="4"></div><div class="url_path_detail"><input class="url_input url_path_detail_input" type="text" placeholder="请输入URL链接" value="'+i.urlPathDetail+'"></div><div class="url_path_picture"><img class="pictureContainer" src="'+i.urlPathPicture+'"/>';if(i.urlPathPicture){g+='<div class="url_path_addPicture" style="background:transparent;"></div></div>'}else{g+='<div class="url_path_addPicture"></div></div>'}g+='<div class="url_path_token"><input type="checkbox" value="" '+(i.urlPathToken?"checked":" ")+'></div><div class="url_path_option"><a href="">删除</a></div></div>'});g+="</div>"}});$(".url-name-define").append(d).children().first().addClass("active");$("#urlcontent").append(g).children().first().addClass("active");$($(".url_name_input")[0]).addClass("validate[required,len[1,6]");$($(".url_path_name_input")[0]).addClass("validate[required,len[1,6]");$($(".url_path_detail_input")[0]).addClass("validate[required]")},bindEvent:function(){$(".url-btn-group").on("click","a",function(d){if(d&&d.preventDefault){d.preventDefault()}else{window.event.returnValue=false}$(d.target).parent().addClass("active").siblings().removeClass("active")});$("#addUrlMenus").click(function(){var g=$(".url_name_input");if($(".url_name_input").length<10){var f=$(g[g.length-1]).attr("id").split("_")[1];$(".url-name-define").append('<div><input id="urlnamedefine_'+(parseInt(f)+1)+'" class="url_input url_name_input " type="text" maxlength="4"></div>');var e="";for(var d=0;d<4;d++){e+='<div class="url_menus"><div class="url_path_name"><input class="url_input url_path_name_input" type="text" placeholder="请输入名称" maxlength="4"></div><div class="url_path_detail"><input class="url_input url_path_detail_input" type="text" placeholder="请输入URL链接"></div><div class="url_path_picture"><img class="pictureContainer" src="" alt=""><div class="url_path_addPicture"></div></div><div class="url_path_token"><input type="checkbox" value=""></div><div class="url_path_option"><a href="">删除</a></div></div>'}$("#urlcontent").append('<div class="urlnamedefine_'+(parseInt(f)+1)+'">'+e+"</div>");$(".url_path_addPicture").children().remove();a.view.pickuploader();$(".webuploader-pick").css({width:"33px",height:"33px",position:"absolute",top:"0px",left:"0px"}).next().css({width:"33px",height:"33px",position:"absolute",top:"0px",left:"0px"})}});$("#addUrlContent").click(function(){if($("div.active>.url_menus").length<8){$("#urlcontent>div.active").append('<div class="url_menus"><div class="url_path_name"><input class="url_input url_path_name_input" type="text" placeholder="请输入名称" maxlength="4"></div><div class="url_path_detail"><input class="url_input url_path_detail_input" type="text" placeholder="请输入URL链接"></div><div class="url_path_picture"><img class="pictureContainer" src="" alt=""><div class="url_path_addPicture"></div></div><div class="url_path_token"><input type="checkbox" value=""></div><div class="url_path_option"><a href="">删除</a></div></div>');$(".url_path_addPicture").children().remove();a.view.pickuploader();$(".webuploader-pick").css({width:"33px",height:"33px",position:"absolute",top:"0px",left:"0px"}).next().css({width:"33px",height:"33px",position:"absolute",top:"0px",left:"0px"})}});$(".url-name-define").on("click",".url_name_input",function(f){var d=$(f.target);d.parent().addClass("active").siblings().removeClass("active");$("."+d.attr("id")).addClass("active").siblings().removeClass("active")});$("#urlcontent").on("click",".url_path_option>a",function(d){if(d&&d.preventDefault){d.preventDefault()}else{window.event.returnValue=false}$(d.target).parent().parent().remove()});$(".urlSetting").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"bottomLeft",showOneMessage:true,})},valid:function(){var g=$(".urlSetting").validationEngine("validate");if(!g){return false}var l=$(".url_name_input");for(var e=0,k=[];e<l.length;e++){if($(l[e]).val()!=""||undefined||null){k.push($(l[e]).val())}}if(k==0){return false}if(k.length<6){if($("#url-btn-middle").hasClass("active")){$.dialog.alert("少于或等于5个URL导航不能平铺");return false}}var h=$(".url_path_name_input");var d=$(".url_path_detail_input");var j=[];var f=[];$.map(h,function(i){if($(i).val()){j.push($(i).val())}});$.map(d,function(i){if($(i).val()){f.push($(i).val())}});if((j.length==0)&&(f.length==0)){$.dialog.alert("请填写url名称与url链接！");return false}if(j.length!=f.length){$.dialog.alert("url名称与url链接必须填写");return false}else{return true}},pickuploader:function(){var d=WebUploader.create({swf:resPath+"/bace/js/webuploader/swf/Uploader.swf",server:c.handleUrlParam("/platform/dataview/image-handle"),pick:".url_path_addPicture",resize:false,duplicate:true,auto:true,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"}});d.on("uploadStart",function(f,e){});d.on("uploadSuccess",function(g,f){var e=document.getElementById("rt_"+g.source.ruid);e.parentNode.style.background="transparent";e.parentNode.previousElementSibling.src=f.retMessage;console.log(f.retMessage)});d.on("uploadError",function(f,e){$.dialog.alert("图片上传失败！")});d.on("error",function(e){if(e){$.dialog.alert("图片上传失败,请查看图片格式！")}})}};a.control={init:function(){if(!$("#layout_body_url_panel")[0]){a.view.init()}$("#urlPanel").on("click",".urlpaths_name>a",function(d){$(d.target).parent().siblings().toggleClass("active")});$("body").click(function(f){var d=$(f.target);if(!(d.parent().hasClass("urlpaths_name"))){$("#urlPanel ul.urlmenus.active").removeClass("active")}})},show:function(){if(!$("#urlSettingsPanel")[0]){jQuery("body").append("<div id='urlSettingsPanel' style='display:none;position: relative;'></div>")}jQuery("#urlSettingsPanel").load(c.handleUrlParam("/platform/dataview/url-setting"),function(){a.view.show();a.view.backgroundPicture=$(".url_path_addPicture").css("background");$("table.aui_border>tbody>tr:nth-child(2)>td.aui_e").css("background","#fff");$("table.aui_dialog>tbody>tr:nth-child(3)>td.aui_footer").css({background:"#fff",position:"relative"}).prepend('<div class="url_name"><p>注：少于或等于5个URL导航不能平铺</p></div>');if(b.main.urlMenuInfo&&(b.main.urlMenuInfo.length!=0)){a.view.refreshUrlDialog()}$(".url_path_addPicture").children().remove();a.view.pickuploader();$(".webuploader-pick").css({width:"33px",height:"33px",position:"absolute",top:"0px",left:"0px"}).next().css({width:"33px",height:"33px",position:"absolute",top:"0px",left:"0px"});c.autoScroll($(".url-name-define"));c.autoScroll($(".url_path_content"))})},};return a.control});