/*!
 *
 * @author zhump
EBuilder, According to the incoming data and configuration items, build ECharts.
Runing environment ECMAScript 5

By ECharts 3.1.6
   jQuery 1.4+
   underscore

Version 3.1
If you have questions, please email me at 695004175@qq.com
2016-07-18 添加注释 by shaojs
*/
(function(a){if(typeof define==="function"&&define.amd){var b=["echarts","underscore","colpick","view/widgets/property","cityMap"];if(!jQuery){b.push("jquery")}define(b,a)}else{if(typeof exports==="object"){a(require("echarts","underscore","colpick","view/widgets/property","cityMap","jquery"))}else{a(echarts,_,jQuery)}}})(function(f,l,h,i){if(!i){i=jQuery}var n={title:{itemGap:5,padding:[9,7]},legend:{padding:[8,10]},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},textStyle:{fontSize:12}},toolbox:{show:true,padding:[5,35],feature:{restore:{}}}};var p;var e={init:function(){var A=this;if(A.length>1){console.warn("注意：EBuilder只会加载jQuery选择器匹配到的第一个元素")}var E={type:[],yx:false,ajaxURL:"",dataParams:"",series:[],seriesAuto:true};E=i.extend(true,{},E,arguments[0]);var D=A.parents(".container");var y=D.data("option").config.build.theme;var u=arguments[1];var z=l.uniq(l.pluck(E.series,"type"));if(u===true){d(D);if(typeof(goal)!="undefined"&&goal!=""){data:E.dataParams.chartLinkJsonStr=JSON.stringify(goal.chartLinkData)}if(E.ajaxURL&&!E.data){i.ajax({type:"POST",url:E.ajaxURL,dataType:"json",data:E.dataParams,success:function(G){E.data=G;if(!G||G.length==0){o(A)}else{c(A);var F;require(["echarts",y],function(H){F=s(z,E,undefined,undefined,undefined,y)});return F}},error:function(){log(JSON.stringify(arguments));g(D)}})}}else{var q=f.getInstanceByDom(A[0]).getOption();var r=q.legend[0].data;var t;if(E.yx){t=q.xAxis?q.yAxis[0].data:[]}else{t=q.xAxis?q.xAxis[0].data:[]}var w=[];l.mapObject(q.series,function(F){w.push({name:F.name,data:F.data})});return s(z,E,r,t,w,y)}function s(T,V,H,K,M,P){var N=i.extend(true,{},B(T,V,H,K,M),V.option);if(V.xIsSwitch==1&&!!N.xAxis&&l.indexOf(T,"heatmap")<=-1){N.xAxis[0].axisLabel.formatter=function(W){return C(W)}}if(V.yIsSwitch==1&&!!N.yAxis&&l.indexOf(T,"heatmap")<=-1){N.yAxis[0].axisLabel.formatter=function(W){return C(W)}}if(N.yAxis&&N.yAxis[0].max==0){N.yAxis[0].max=null}if(V.yx){var U=N.xAxis;N.xAxis=N.yAxis;N.yAxis=U}var G=N.series;var L=V.series;var S=[];if(["gauge"].indexOf(V.type)>-1){N.series=G}else{if(V.seriesAuto){S=v(L,G.length)}else{var O=V.seriseIndex;l.each(O,function(W){S.push(L[W])})}if(S.type=="radar"){N.series=i.extend(true,{},G,S);N.series.name=l.pluck(G.data,"name").join("&")}else{N.series=l.toArray(i.extend(true,{},G,S))}}if(V.dataParams.chartType=="barMix"){N.series=x(N,V)}if(!!D.data("option").config.build.theme){P=D.data("option").config.build.theme}var J=f.init(A[0],P);function R(af,X){var ah=[];var ad=af.series[0].data;var X=X.features;var Z=ad.length;var ac=X.length;var Y=function(aj){return aj[2]/30};if(af.series[0].type=="effectScatter"){af.series[1]={name:af.series[0].name,type:"scatter",coordinateSystem:"geo",data:ad,symbolSize:Y,label:{normal:{formatter:"{b}",position:"right",show:false},emphasis:{show:true}},itemStyle:{normal:{color:"#ddb926"}}};for(var ae=0;ae<Z;ae++){for(var ab=0;ab<ac;ab++){var ai=[];if(ad[ae].name==X[ab].properties.name){var ag=parseInt(ad[ae].value);af.series[1].data[ae].value=[];af.series[1].data[ae].value.push(X[ab].properties.cp[0]);af.series[1].data[ae].value.push(X[ab].properties.cp[1]);af.series[1].data[ae].value.push(ag)}}}var W=[];var aa=af.series[0].data.sort(function(ak,aj){return aj.value[2]-ak.value[2]}).slice(0,5);af.series[0].data=aa}else{for(var ae=0;ae<Z;ae++){for(var ab=0;ab<ac;ab++){var ai=[];if(ad[ae].name==X[ab].properties.name){var ag=parseInt(ad[ae].value);af.series[0].data[ae].value=[];af.series[0].data[ae].value.push(X[ab].properties.cp[0]);af.series[0].data[ae].value.push(X[ab].properties.cp[1]);af.series[0].data[ae].value.push(ag)}}}}}function Q(){if(!D.data("option").config.build.theme){if(!!D.data("option").themeName&&!sessionStorage.themeName){P=D.data("option").themeName}else{if(!!D.data("option").themeName&&!!sessionStorage.themeName){P=sessionStorage.themeName;D.data("option").themeName=P}else{if(!D.data("option").themeName&&!!sessionStorage.themeName){P=sessionStorage.themeName;D.data("option").themeName=P}}}}if((!!D.data("option").colorTemp)==true){D.data("colorTemp",D.data("option").colorTemp);D.data("legendData",D.data("option").legendData)}else{var aa=[];switch(P){case"macarons":aa=["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"];break;case"roma":aa=["#E01F54","#001852","#f5e8c8","#b8d2c7","#c6b38e","#a4d8c2","#f3d999","#d3758f","#dcc392","#2e4783","#82b6e9","#ff6347","#a092f1","#0a915d","#eaf889","#6699FF","#ff6666","#3cb371","#d5b158","#38b6b6"];break;case"vintage":aa=["#d87c7c","#919e8b","#d7ab82","#6e7074","#61a0a8","#efa18d","#787464","#cc7e63","#724e58","#4b565b"];break;case"infographic":aa=["#C1232B","#27727B","#FCCE10","#E87C25","#B5C334","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"];break;case"shine":aa=["#c12e34","#e6b600","#0098d9","#2b821d","#005eaa","#339ca8","#cda819","#32a487"];break;case"dark":aa=["#dd6b66","#759aa0","#e69d87","#8dc1a9","#ea7e53","#eedd78","#73a373","#73b9bc","#7289ab","#91ca8c","#f49f42"];break;default:aa=["#c23531","#2f4554","#61a0a8","#d48265","#91c7ae","#749f83","#ca8622","#bda29a","#6e7074","#546570","#c4ccd3"]}i("[proptype=colorSet] .propContanier").empty();if(!!N.legend&&!!N.legend.data){var Z=[];var W=N.legend.data.length;var Y=0;var X=0;while(Y<W){if(X>=11){X=0}e.buildColor(N.legend.data[Y],aa[X]);Z.push(aa[X]);Y++;X++}D.data("colorTemp",Z);D.data("legendData",N.legend.data)}}if(!!D.data("colorTemp")){N.color=D.data("colorTemp")}J.setOption(N)}if(l.indexOf(T,"map")>-1){var I=N.series[0].mapType||"china";var F=I.replace("_","/");i.get(resPath+"/resources/platform/dataview/js/jquery/echarts/map/"+F+".json",function(W){f.registerMap(I,W);N.tooltip={trigger:"item",formatter:function(ab){var Z=ab.name+"<br/>";var aa=N.series;for(var Y=0;Y<aa.length;Y++){for(var X=0;X<aa[Y].data.length;X++){if(aa[Y].data[X].name==ab.name){Z+=aa[Y].name+" : "+aa[Y].data[X].value+aa[Y].dataUnit}}}return Z}};Q()})}else{if(l.indexOf(T,"heatmap1")>-1||l.indexOf(T,"effectScatter")>-1){var I=N.series[0].mapType||"china";var F=I.replace("_","/");i.get(resPath+"/resources/platform/dataview/js/jquery/echarts/map/"+F+".json",function(W){f.registerMap(I,W);R(N,W);if(l.indexOf(T,"heatmap1")>-1){N.series[0].type="heatmap"}else{N.tooltip={trigger:"item"};N.series[0].symbolSize=function(X){return X[2]/30}}Q()})}else{Q()}}if(u===true){g(D)}i(window).trigger("chart.rander.complete",[A[0],V]);return J}function C(G){var F=G+"";if(!isNaN(G)){if(G%1===0){if(G.toString().length<=6&&G.toString().length>4){F=G/1000+"K"}else{if(G.toString().length<=9&&G.toString().length>6){F=G/1000000+"M"}else{if(G.toString().length<=12&&G.toString().length>9){F=G/1000000000+"B"}}}}}return F}function x(I,H){var G=I.series||[];I.yAxis.push(I.yAxis[0]);var J=[];i.each(G,function(L,N){var K=i.extend(true,{},N);var M=i.extend(true,{},N);K.type="line";M.type="bar";K.yAxisIndex=1;J.push(K);J.push(M)});if(H.yx){var F=I.xAxis;I.xAxis=I.yAxis;I.yAxis=F}return J}function B(ai,Z,H,R,Q){var H=H;var R=R;var Q=Q||[];var U={};if(H===undefined&&l.indexOf(ai,"gauge")==-1){if(Z.data[0].group){var W=l.union(l.pluck(Z.data,"name"));var ah=l.union(l.pluck(Z.data,"group"));if(Z.data.length!=(W.length)*(ah.length)){Z.data=T(W,ah,Z.data)}var aj=l.groupBy(Z.data,"group");H=l.keys(aj);R=l.pluck(l.indexObj(aj,0),"name");l.mapObject(aj,function(al,ak){Q.push({name:ak,data:al})})}}function T(ap,ak,ao){var al=ak.length;var an=(ap.length)*(ak.length)-ao.length;var am=l.groupBy(ao,"name");l.each(ap,function(au,ar){var aq=au;var at=am[aq];if(!(at.length===al)){am[aq]=l.map(ak,function(aw,av){return l.find(at,function(ax){return ax.group===aw})||(an--,{name:aq,value:0,group:aw})})}return !!an});return l.flatten(l.values(am))}if(l.indexOf(ai,"gauge")>-1){var ad=[];if(Z.data){l.each(Z.data,function(ak){ad.push({data:ak})})}else{l.each(Q,function(ak){ad.push({data:ak.data})})}U.series=ad;U.tooltip={formatter:"{b}:{c} ",trigger:"item"}}if(l.indexOf(ai,"radar")>-1){U.legend={data:H};var P={};var G={};l.each(Q,function(ak){G[ak.name]=[];l.each(ak.data,function(am){var al=am.value;G[ak.name].push(al);if(P.hasOwnProperty(am.name)){if(parseInt(al)>parseInt(P[am.name])){P[am.name]=al}}else{P[am.name]=al}})});var K=[];l.each(P,function(ak,al){K.push({text:al,max:Math.ceil(parseInt(ak)+(parseInt(1+(ak+"").substr(1).replace(/\d/g,"0"))/3))})});U.radar=[{indicator:K}];var ag=Q[0];ag.data=[];l.map(G,function(al,ak){ag.data.push({name:ak,value:al})});U.series=ag;U.tooltip={trigger:"item"}}if(l.intersection(ai,["pie","funnel"]).length>0){U.tooltip={trigger:"item"};U.series=Q;U.legend={data:l.pluck(Q[0].data,"name")}}if(l.indexOf(ai,"map")>-1){var J=[];l.each(Q,function(ak){J.push(l.pluck(ak.data,"value"))});var M=l.union.apply({},J).filter(function(ak){return ak||0});if(M.length===1){M.push(1+parseFloat(M[0]))}U.visualMap={min:Math.min.apply({},M),max:Math.max.apply({},M),left:"left",top:"bottom",text:["高","低"],calculable:true};U.series=Q;U.legend={data:H,};if(l.uniq(ai).length>1){U.visualMap.seriesIndex=l.indexOf(ai,"map")}else{U.legend.selectedMode="single"}U.tooltip={trigger:"item"}}if(l.indexOf(ai,"treemap")>-1){U.tooltip={trigger:"item"};function L(al,an,ap){for(var ak in al){var am=ap?(ap+"."+ak):ak;if(ak.match(/^\$/)){}else{an.children=an.children||[];var ao={name:am,idx:"test"};an.children.push(ao);L(al[ak],ao,am)}}if(!an.children){an.value=al.$count||1;an.idx="test"}else{an.children.push({name:ap,value:al.$count,idx:"test"})}}var ae=[];var X=Z.data;var ad=[];var O=Z.series[0];O.data=X;ad.push(O);U.series=ad}if(l.indexOf(ai,"heatmap1")>-1){U.visualMap={inRange:{color:["#d94e5d","#eac736","#50a3ba"].reverse()},textStyle:{color:"#fff"}};U.backgroundColor="#404a59";U.geo={map:"china",label:{emphasis:{show:false}},roam:true,itemStyle:{normal:{areaColor:"#323c48",borderColor:"#111"},emphasis:{areaColor:"#2a333d"}}};U.series=Q}if(l.indexOf(ai,"effectScatter")>-1){U.backgroundColor="#404a59";U.geo={map:"china",label:{emphasis:{show:false}},roam:true,itemStyle:{normal:{areaColor:"#323c48",borderColor:"#111"},emphasis:{areaColor:"#2a333d"}}};U.series=Q}if(l.indexOf(ai,"scatter")>-1){var Y=Q[0].data[0],S=Y.name;U.tooltip={trigger:"axis",formatter:function(al){if(al.value.length>1){var ak=al.seriesName;l.each(S,function(an,am){ak+="<br/>"+S[am]+":"+al.value[am]});return ak}else{return al.seriesName+" :<br/>"+al.name+" : "+al.value+" "}},axisPointer:{show:true,type:"cross",lineStyle:{type:"dashed",width:1}}};U.legend={data:H};var F=Y.value;if(typeof(F[0])=="number"){U.xAxis=[{type:"value",boundaryGap:true,splitLine:{show:false}}]}else{var V={};l.each(Q[0].data,function(ak){V[ak.value[0]]=""});U.xAxis=[{type:"category",data:l.keys(V),boundaryGap:true,splitLine:{show:false}}]}U.yAxis=[{type:"value",max:null,splitLine:{show:false}}];U.grid={containLabel:true};l.each(Q,function(ak){ak.symbolSize=function(al){return al[2]||8}});U.series=Q}if(l.intersection(ai,["line","bar"]).length>0){U.legend={data:l.pluck(Q,"name")};var N=l.pluck(Q[0].data,"name");U.xAxis=[{type:"category",boundaryGap:true,splitLine:{show:false},data:N}];U.series=Q;if(l.indexOf(ai,"map")>-1){var I=[];l.each(Q[0].data,function(ak){if(ak.value){I.push(ak.name)}});U.xAxis[0].data=I;l.map(Q,function(ak){ak.data=ak.data.slice(0,I.length)});U.series=Q}U.yAxis=[{type:"value",splitLine:{show:false}}];U.grid={containLabel:true};if(l.indexOf(ai,"bar")>-1){U.tooltip={trigger:"item"}}if(ai.length==1&&ai[0]=="line"){U.xAxis[0].boundaryGap=false;U.tooltip={axisPointer:{type:"line"}}}}if(l.indexOf(ai,"heatmap")>-1){var N=l.pluck(Q[0].data,"xname");var af=l.pluck(Q[0].data,"yname");var ac=new Array();var ab=new Array();for(var aa=0;aa<N.length;aa++){if(ac.indexOf(N[aa])==-1){ac.push(N[aa])}}for(var aa=0;aa<af.length;aa++){if(ab.indexOf(af[aa])==-1){ab.push(af[aa])}}U.xAxis=[{type:"category",data:ac,splitArea:{show:true}}];U.yAxis=[{type:"category",data:ab,splitArea:{show:true}}];U.tooltip={};U.visualMap={min:0,max:1,calculable:true,realtime:false,orient:"horizontal",left:"center",bottom:"0%",inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]}};U.series=Q}return i.extend(true,{},n,U)}function v(K,P){var N=[];var I=K[0];var Q=I.type;if(Q=="pie"){var R=[];for(var O=P+1,L=O,M=0;L>0;L--,M++){R.push(parseInt(110/O)+parseInt(R[M-1]||1))}for(var J=0;J<P;J++){var F={type:"pie",name:I.name,radius:I.radius||"45%"};I.center=[R[J]-5+"%","50%"];N.push(i.extend(true,{},F,I))}}else{if(Q=="funnel"){var R=[];for(var O=P+1,L=O,M=0;L>0;L--,M++){R.push(parseInt(100/O)+parseInt(R[M-1]||1))}var G=[0,22,15,10,7][P.length>5?5:P]||5;for(var J=0;J<P;J++){var H={type:"funnel",name:I.name};I.left=R[J]-G+"%";I.width=40/P+"%";N.push(i.extend(true,{},H,I))}}else{if(Q=="gauge"){var R=[];for(var O=P+1,L=O,M=0;L>0;L--,M++){R.push(parseInt(110/O)+parseInt(R[M-1]||1))}for(var J=0;J<P;J++){var F={type:"gauge",name:I.name,radius:I.radius||"45%"};I.center=[R[J]-5+"%","55%"];N.push(i.extend(true,{},F,I))}}else{if(Q=="map"){I.left="center";I.top="middle";I.width="auto";for(var J=0;J<P;J++){N.push(i.extend(true,{},I))}}else{if(Q=="radar"){N=I}else{if(Q=="heatmap1"){for(var J=0;J<P;J++){N.push(i.extend(true,{},I))}}else{if(Q=="effectScatter"){for(var J=0;J<P;J++){N.push(i.extend(true,{},I))}}else{for(var J=0;J<P;J++){N.push(I)}}}}}}}}return N}},echartsColor:function(s,r){var q=i("#"+s+" [_echarts_instance_]");var t=f.getInstanceByDom(q[0]);t.setOption({color:r})},buildColor:function(r,s){var u={id:"title-textStyle-color",lable:r,type:"color",value:s,position:"bottom left-60"};function t(w){var v=w.type;if(v=="color"){return'<div class="chooseTool"><div class="choose-color"></div><input id="'+w.id+'" collect-special="color" data-position="'+w.position+'" data-format="rgb"  type="hidden" value="'+w.value+'" /><div class="chooseToolDown"><i class="fa fa-caret-down"></i></div></div>'}else{if(v=="select"){return'<select id="'+w.id+'" collect-special="select" style="width:'+w.width+'">'+w.selectHTML+"</select>"}else{if(v=="switchbutton"){return'<input id="'+w.id+'" '+(w.value?"checked":"")+'  collect-special="checkbox" type="checkbox" class="switchbutton" style="width: 48px;" />'}else{if(v=="input"){return'<input type="text" id="'+w.id+'" style="width:'+(w.width||"143px")+'" class="input" />'}else{if(v=="spaceInput"){return'<input class="spaceInput" data-max="'+w.max+'" data-max="'+w.min+'" collect-special="int" id="'+w.id+'" type="text"  style="width:'+w.width+'" value="'+(w.value||0)+'"/>'}else{if(v=="slider"){return'<div id="'+w.id+'"data-value="'+w.value+'" data-max="'+w.max+'" data-min="'+w.min+'" collect-special="slider"  class="slider" style="width:'+w.width+'"></div>'}else{if(v=="selectcolor"){return'<div class="chooseTool chooseAdd"><div class="indicator-color"><div  id="'+w.id+'"data-value="'+w.value+'" collect-special="selectcolor" class="colorContainer"><span></span><b></b></div><div class="chooseToolDown"><i class="fa fa-caret-down"></i></div></div><ul><li><span>红色</span><b></b></li><li><span>蓝绿色</span><b></b></li><li><span>蓝色</span><b></b></li><li><span>黄色</span><b></b></li><li><span>橘色</span><b></b></li><li><span>紫色</span><b></b></li><li><span>玫红色</span><b></b></li><li><span>绿色</span><b></b></li></ul></div>'}}}}}}}}function q(){var v=jQuery("#chart-property>.propPanel");i(".chooseTool",v).click(function(){i("input",this).minicolors("show")});i('.chooseTool input[collect-special="color"]',v).minicolors({opacity:false,change:function(y,w){var x;try{x=y?y:"transparent";if(w){x+=", "+w}}catch(z){}},colorSelectors:{"#777777":"#777777","#337ab7":"#337ab7","#5cb85c":"#5cb85c","#5bc0de":"#5bc0de","#f0ad4e":"#f0ad4e","#d9534f":"#d9534f"}})}i("[proptype=colorSet] .propContanier").append('<div class="items"><div class="label" style="width:60px;overflow: hidden;height:20px">'+r+':</div><div class="config">'+t(u)+"</div></div>");q()},getInstanceByDom:function(){return f.getInstanceByDom(i(this)[0])},getSeriesByName:function(){return l.findWhere(f.getInstanceByDom(i(this)[0]).getOption.series,{name:name})},setTheme:function(q){var r=i(this);require(["echarts",q],function(s){var t=r.parent("div");t.data("option").config.build=t.data("option").config.build||{};t.data("option").config.build.theme=q;t.find(".chainInfo").empty().hide();t.data("isLinked",false);t.data("drillSettingList",[]);t.find(".breadcrumbs").hide();var u=i.extend(true,{},t.data("option"));r.EBuilder(u.config.build,true)})},_on:function(s,u){if(!s||(typeof s)!="string"){log("无法绑定事件:无效的事件类型!");return false}if(!u||!i.isFunction(u)){log("无法绑定事件:无效的回调函数!");return false}var t=i(this);var r=f.getInstanceByDom(t[0]);if(!r){log("无法绑定事件:找不到echarts实例!");return}var q=Array.prototype.slice.call(arguments,2);r.on(s,function(w){var v=i.merge([w],q);u.apply(this,v)})},_off:function(r){if(!r||(typeof r)!="string"){log("无法解绑事件:无效的事件类型!");return false}var s=i(this);var q=f.getInstanceByDom(s[0]);if(!q){return}q.off(r)},drill:function(A,I){var D=i.extend(true,{},A);var x=i(this).parent("div");if(!!x.data("isLinked")){return}var y=i.extend(true,{},x.data("option"));var z=(l.find(D.data,{name:I.name}))&&(l.find(D.data,{name:I.name})).dimKey;D.data=null;var E=x.data("drillSettingList")||[];E.push(i.extend(true,{},D));x.data("drillSettingList",E);if(y.chartType=="map"){var w=(D.series[0].mapType||"china").split("_");w=w[w.length-1];var t=h[w];if(!t){return}var q=t[I.name];if(!q){return}var G=q.parent+"_"+q.name;D.series[0].mapType=G}var v=i.parseJSON(D.dataParams.dimAttrJsonStr);var u=v.dimData[0];if(!(u.attrClass=="0"||u.attrClass=="2"||u.attrClass=="3")){return}if(u.levelId){return}var C=y.config.dataPanel.dimData;if(C.length<=1){return}var B=l.findIndex(C,{attrId:u.attrId});var F=1,r=C[B+F];while(r&&r.isChecked){F++;r=C[B+F]}if(!r){return}var H=u.parentDimInfo||[];H.push({attrId:u.attrId,attrClass:u.attrClass,attrName:u.attrName,attrType:u.attrType,filterType:u.filterType,attrValue:z||I.name,breadcrumbsName:I.name});r.isdrill=true;r.parentDimInfo=H;v.dimData[0]=r;D.dataParams.dimAttrJsonStr=JSON.stringify(v);i(this).EBuilder(D,true);k(x,D,r)},undrill:function(t){var q=i(this).parent("div");var r=q.data("drillSettingList")||[];if(t===r.length){return}var s=r[t];r=r.slice(0,t);q.data("drillSettingList",r);i(this).EBuilder(s,true);k(q,s)},chainChart:function(q){if(!q){return}var r=j("/platform/dataview/get-chart-link");i.ajax({url:r,method:"POST",data:{linkJsonStr:JSON.stringify(q.queryChainParam)},dataType:"json",success:function(s){s=s.chartIds;if(s.length){i.each(s,function(u,y){var t=i("#"+y);var x=i.extend(true,{},t.data("option"));var w=x.config.build;var v=q.chartLinkData;w.dataParams.chartLinkJsonStr=JSON.stringify(v);t.data("drillSettingList",[]);t.find(".breadcrumbs").hide();t.data("isLinked",true);m(t,q.name);if(t.find(".chart:visible").length){t.find(".chart:visible").EBuilder(w,true)}else{i(window).trigger("table.chain",[w,x])}})}},error:function(s){console.log(s)}})},unchainChart:function(){var s=i(this);var q=s.parent("div");var r=i.extend(true,{},q.data("option"));q.find(".chainInfo").empty().hide();q.data("isLinked",false);s.EBuilder(r.config.build,true)}};i.fn.EBuilder=function(){var q=arguments[0];if(e[q]){q=e[q];arguments=Array.prototype.slice.call(arguments,1)}else{if(typeof(q)=="object"||!q){q=e.init}else{console.error("Method "+q+" does not exist on jQuery.EBuilder");return this}}return q.apply(this,arguments)};var a={lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:"#fff",speed:1,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000,};function d(r){if(typeof(Spinner2)!=="undefined"){var q=jQuery("<div></div>",{"class":"bi-confirm loadingBg"});r.spin(a);r.append(q)}r.data("isLoading",true)}function g(q){if(typeof(Spinner2)!=="undefined"){q.spin("close");q.find(".loadingBg").remove()}q.data("isLoading",false)}function c(q){var r=q.parents(".container");r.find(".chart").show();r.find(".noData").hide()}function o(q){var r=q.parents(".container");g(r);r.find(".chart").hide();if(r.find(".noData").length==0){q.after(jQuery("<div>",{"class":"noData",html:"无数据！"}))}else{r.find(".noData").show()}}function k(s,u,t){var v=s.find(".breadcrumbs");t=t||(i.parseJSON(u.dataParams.dimAttrJsonStr)).dimData[0];var r=t.parentDimInfo||[];var q=i.map(r,function(x,w){return"<a>"+x.breadcrumbsName+"</a>"});q.push("<a>"+t.attrName+"</a>");v.empty().append(i(q.join("<span class='gtgt_icon'></span>")));if(q.length<=1){v.hide()}else{v.show()}}function m(q,r){var s="<span class='chain_icon'></span>"+r+"<span class='cansole_icon j_unchainChart'></span>";q.find(".chainInfo").html(s).show()}function j(r){if(r.indexOf(webpath)!=0){r=webpath+r}var t=r.indexOf("funcId=");if(t>-1){var s="";var q=r.substring(t+7).indexOf("&");if(q>-1){s=t.substring(t+7,t+q+7);r=r.substring(0,t)+"/"+s.toLowerCase()+r.substring(t+q+8)}else{s=r.substring(t+7);r=r.substring(0,t)+"/"+s.toLowerCase()}}else{if(!b(funcId)){r=r+"/"+funcId.toLowerCase()}}return r}function b(q){return !!(q==null||q=="null"||q=="undefined"||q=="NaN"||q==""||q==undefined)}});