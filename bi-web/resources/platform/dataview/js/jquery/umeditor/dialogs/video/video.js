(function(){var b=UM.dom.domUtils;var c="video";UM.registerWidget(c,{tpl:'<link rel="stylesheet" type="text/css" href="<%=video_url%>video.css" /><div class="edui-video-wrapper"><div id="eduiVideoTab"><div id="eduiVideoTabHeads" class="edui-video-tabhead"><span tabSrc="video" class="edui-video-focus"><%=lang_tab_insertV%></span></div><div id="eduiVideoTabBodys" class="edui-video-tabbody"><div id="eduiVideoPanel" class="edui-video-panel"><table><tr><td><label for="eduiVideoUrl" class="edui-video-url"><%=lang_video_url%></label></td><td><input id="eduiVideoUrl" type="text"></td></tr></table><div id="eduiVideoPreview"></div><div id="eduiVideoInfo"><fieldset><legend><%=lang_video_size%></legend><table><tr><td><label for="eduiVideoWidth"><%=lang_videoW%></label></td><td><input class="edui-video-txt" id="eduiVideoWidth" type="text"/></td></tr><tr><td><label for="eduiVideoHeight"><%=lang_videoH%></label></td><td><input class="edui-video-txt" id="eduiVideoHeight" type="text"/></td></tr></table></fieldset><fieldset><legend><%=lang_alignment%></legend><div id="eduiVideoFloat"></div></fieldset></div></div></div></div></div>',initContent:function(d,h){var e=this,g=d.getLang(c),f=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/";e.lang=g;e.editor=d;e.$widget=h;e.root().html($.parseTmpl(e.tpl,$.extend({video_url:f},g["static"])));e.initController(g)},initEvent:function(){var e=this,d=$("#eduiVideoUrl",e.$widget)[0];if("oninput" in d){d.oninput=function(){e.createPreviewVideo(this.value)}}else{d.onpropertychange=function(){e.createPreviewVideo(this.value)}}},initController:function(g){var f=this,d=f.editor.selection.getRange().getClosedNode(),e;f.createAlignButton(["eduiVideoFloat"]);if(d&&d.className=="edui-faked-video"){$("#eduiVideoUrl",f.$widget)[0].value=e=d.getAttribute("_url");$("#eduiVideoWidth",f.$widget)[0].value=d.width;$("#eduiVideoHeight",f.$widget)[0].value=d.height;var i=b.getComputedStyle(d,"float"),h=b.getComputedStyle(d.parentNode,"text-align");f.updateAlignButton(h==="center"?"center":i)}f.createPreviewVideo(e)},createPreviewVideo:function(d){if(!d){return}var e=this,g=e.lang,f=e.convert_url(d);if(!e.endWith(f,[".swf",".flv",".wmv"])){$("#eduiVideoPreview",e.$widget).html(g.urlError);return}$("#eduiVideoPreview",e.$widget)[0].innerHTML='<embed type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+d+'" width="'+420+'" height="'+280+'" wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" ></embed>'},insertSingle:function(){var g=this,f=$("#eduiVideoWidth",g.$widget)[0],d=$("#eduiVideoHeight",g.$widget)[0],e=$("#eduiVideoUrl",g.$widget)[0].value,h=this.findFocus("eduiVideoFloat","name");if(!e){return false}if(!g.checkNum([f,d])){return false}this.editor.execCommand("insertvideo",{url:g.convert_url(e),width:f.value,height:d.value,align:h})},convert_url:function(d){if(!d){return""}var f=d.match(/youtu.be\/(\w+)$/)||d.match(/youtube\.com\/watch\?v=(\w+)/)||d.match(/youtube.com\/v\/(\w+)/),g=d.match(/youku\.com\/v_show\/id_(\w+)/),e=/player\.youku\.com/ig.test(d);if(e){d=d.replace(/\?f=.*/,"")}else{if(f){d="https://www.youtube.com/v/"+f[1]+"?version=3&feature=player_embedded"}else{if(g){d="http://player.youku.com/player.php/sid/"+g[1]+"/v.swf"}else{d=d.replace(/http:\/\/www\.tudou\.com\/programs\/view\/([\w\-]+)\/?/i,"http://www.tudou.com/v/$1").replace(/http:\/\/www\.youtube\.com\/watch\?v=([\w\-]+)/i,"http://www.youtube.com/v/$1").replace(/http:\/\/v\.youku\.com\/v_show\/id_([\w\-=]+)\.html/i,"http://player.youku.com/player.php/sid/$1").replace(/http:\/\/www\.56\.com\/u\d+\/v_([\w\-]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/www.56.com\/w\d+\/play_album\-aid\-\d+_vid\-([^.]+)\.html/i,"http://player.56.com/v_$1.swf").replace(/http:\/\/v\.ku6\.com\/.+\/([^.]+)\.html/i,"http://player.ku6.com/refer/$1/v.swf").replace(/\?f=.*/,"")}}}return d},checkNum:function a(d){var g=this;for(var f=0,e;e=d[f++];){var h=e.value;if(!g.isNumber(h)&&h){alert(g.lang.numError);e.value="";e.focus();return false}}return true},isNumber:function(d){return/(0|^[1-9]\d*$)/.test(d)},updateAlignButton:function(g){var f=$("#eduiVideoFloat",this.$widget)[0].children;for(var e=0,d;d=f[e++];){if(d.getAttribute("name")==g){if(d.className!="edui-video-focus"){d.className="edui-video-focus"}}else{if(d.className=="edui-video-focus"){d.className=""}}}},createAlignButton:function(d){var g=this.lang,m=UMEDITOR_CONFIG.UMEDITOR_HOME_URL+"dialogs/video/";for(var k=0,n;n=d[k++];){var f=$("#"+n,this.$widget)[0],l={none:g["default"],left:g.floatLeft,right:g.floatRight};for(var h in l){var e=document.createElement("div");e.setAttribute("name",h);if(h=="none"){e.className="edui-video-focus"}e.style.cssText="background:url("+m+"images/"+h+"_focus.jpg);";e.setAttribute("title",l[h]);f.appendChild(e)}this.switchSelect(n)}},switchSelect:function(g){var f=$("#"+g,this.$widget)[0].children;for(var e=0,d;d=f[e++];){$(d).on("click",function(){for(var i=0,h;h=f[i++];){h.className="";h.removeAttribute&&h.removeAttribute("class")}this.className="edui-video-focus"})}},findFocus:function(j,d){var g=$("#"+j,this.$widget)[0].children,h;for(var f=0,e;e=g[f++];){if(e.className=="edui-video-focus"){h=e.getAttribute(d);break}}return h},endWith:function(h,e){for(var g=0,d=e.length;g<d;g++){var f=e[g];if(h.length-f.length<0){return false}if(h.substring(h.length-f.length)==f){return true}}return false},width:610,height:498,buttons:{ok:{exec:function(d,e){$("#eduiVideoPreview",e).html("");d.getWidgetData(c).insertSingle()}},cancel:{exec:function(){$("#eduiVideoPreview").html("")}}}})})();