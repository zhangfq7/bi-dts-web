UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{};window.UM={plugins:{},commands:{},I18N:{},version:"1.2.2"};var dom=UM.dom={};var browser=UM.browser=function(){var d=navigator.userAgent.toLowerCase(),b=window.opera,c={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(d),opera:(!!b&&b.version),webkit:(d.indexOf(" applewebkit/")>-1),mac:(d.indexOf("macintosh")>-1),quirks:(document.compatMode=="BackCompat")};c.gecko=(navigator.product=="Gecko"&&!c.webkit&&!c.opera&&!c.ie);var a=0;if(c.ie){var g=d.match(/(?:msie\s([\w.]+))/);var f=d.match(/(?:trident.*rv:([\w.]+))/);if(g&&f&&g[1]&&f[1]){a=Math.max(g[1]*1,f[1]*1)}else{if(g&&g[1]){a=g[1]*1}else{if(f&&f[1]){a=f[1]*1}else{a=0}}}c.ie11Compat=document.documentMode==11;c.ie9Compat=document.documentMode==9;c.ie8=!!document.documentMode;c.ie8Compat=document.documentMode==8;c.ie7Compat=((a==7&&!document.documentMode)||document.documentMode==7);c.ie6Compat=(a<7||c.quirks);c.ie9above=a>8;c.ie9below=a<9}if(c.gecko){var e=d.match(/rv:([\d\.]+)/);if(e){e=e[1].split(".");a=e[0]*10000+(e[1]||0)*100+(e[2]||0)*1}}if(/chrome\/(\d+\.\d)/i.test(d)){c.chrome=+RegExp["\x241"]}if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(d)&&!/chrome/i.test(d)){c.safari=+(RegExp["\x241"]||RegExp["\x242"])}if(c.opera){a=parseFloat(b.version())}if(c.webkit){a=parseFloat(d.match(/ applewebkit\/(\d+)/)[1])}c.version=a;c.isCompatible=!c.mobile&&((c.ie&&a>=6)||(c.gecko&&a>=10801)||(c.opera&&a>=9.5)||(c.air&&a>=1)||(c.webkit&&a>=522)||false);return c}();var ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera;var utils=UM.utils={each:function(f,e,d){if(f==null){return}if(f.length===+f.length){for(var c=0,a=f.length;c<a;c++){if(e.call(d,f[c],c,f)===false){return false}}}else{for(var b in f){if(f.hasOwnProperty(b)){if(e.call(d,f[b],b,f)===false){return false}}}}},makeInstance:function(b){var a=new Function();a.prototype=b;b=new a;a.prototype=null;return b},extend:function(d,e,a){if(e){for(var c in e){if(!a||!d.hasOwnProperty(c)){d[c]=e[c]}}}return d},extend2:function(f){var c=arguments;for(var e=1;e<c.length;e++){var b=c[e];for(var d in b){if(!f.hasOwnProperty(d)){f[d]=b[d]}}}return f},inherits:function(d,b){var a=d.prototype,c=utils.makeInstance(b.prototype);utils.extend(c,a,true);d.prototype=c;return(c.constructor=d)},bind:function(b,a){return function(){return b.apply(a,arguments)}},defer:function(b,a,c){var d;return function(){if(c){clearTimeout(d)}d=setTimeout(b,a)}},indexOf:function(d,b,c){var a=-1;c=this.isNumber(c)?c:0;this.each(d,function(e,f){if(f>=c&&e===b){a=f;return false}});return a},removeItem:function(d,c){for(var b=0,a=d.length;b<a;b++){if(d[b]===c){d.splice(b,1);b--}}},trim:function(a){return a.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(c){if(!c){return{}}c=utils.isArray(c)?c:c.split(",");for(var b=0,a,d={};a=c[b++];){d[a.toUpperCase()]=d[a]=1}return d},unhtml:function(b,a){return b?b.replace(a||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(d,c){if(c){return d}else{return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[d]}}):""},html:function(a){return a?a.replace(/&((g|l|quo)t|amp|#39);/g,function(b){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[b]}):""},cssStyleToDomStyle:function(){var b=document.createElement("div").style,a={"float":b.cssFloat!=undefined?"cssFloat":b.styleFloat!=undefined?"styleFloat":"float"};return function(c){return a[c]||(a[c]=c.toLowerCase().replace(/-./g,function(d){return d.charAt(1).toUpperCase()}))}}(),loadFile:function(){var a=[];function b(h,g){try{for(var d=0,c;c=a[d++];){if(c.doc===h&&c.url==(g.src||g.href)){return c}}}catch(f){return null}}return function(i,h,e){var f=b(i,h);if(f){if(f.ready){e&&e()}else{f.funs.push(e)}return}a.push({doc:i,url:h.src||h.href,funs:[e]});if(!i.body){var d=[];for(var g in h){if(g=="tag"){continue}d.push(g+'="'+h[g]+'"')}i.write("<"+h.tag+" "+d.join(" ")+" ></"+h.tag+">");return}if(h.id&&i.getElementById(h.id)){return}var c=i.createElement(h.tag);delete h.tag;for(var g in h){c.setAttribute(g,h[g])}c.onload=c.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){f=b(i,h);if(f.funs.length>0){f.ready=1;for(var j;j=f.funs.pop();){j()}}c.onload=c.onreadystatechange=null}};c.onerror=function(){throw Error("The load "+(h.href||h.src)+" fails,check the url settings of file umeditor.config.js ")};i.getElementsByTagName("head")[0].appendChild(c)}}(),isEmptyObject:function(b){if(b==null){return true}if(this.isArray(b)||this.isString(b)){return b.length===0}for(var a in b){if(b.hasOwnProperty(a)){return false}}return true},fixColor:function(b,d){if(/color/i.test(b)&&/rgba?/.test(d)){var e=d.split(",");if(e.length>3){return""}d="#";for(var c=0,a;a=e[c++];){a=parseInt(a.replace(/[^\d]/gi,""),10).toString(16);d+=a.length==1?"0"+a:a}d=d.toUpperCase()}return d},clone:function(c,d){var b;d=d||{};for(var a in c){if(c.hasOwnProperty(a)){b=c[a];if(typeof b=="object"){d[a]=utils.isArray(b)?[]:{};utils.clone(c[a],d[a])}else{d[a]=b}}}return d},transUnitToPx:function(b){if(!/(pt|cm)/.test(b)){return b}var a;b.replace(/([\d.]+)(\w+)/,function(e,c,d){b=c;a=d});switch(a){case"cm":b=parseFloat(b)*25;break;case"pt":b=Math.round(parseFloat(b)*96/72)}return b+(b?"px":"")},cssRule:browser.ie&&browser.version!=11?function(d,e,f){var a,c;f=f||document;if(f.indexList){a=f.indexList}else{a=f.indexList={}}var b;if(!a[d]){if(e===undefined){return""}b=f.createStyleSheet("",c=f.styleSheets.length);a[d]=c}else{b=f.styleSheets[a[d]]}if(e===undefined){return b.cssText}b.cssText=e||""}:function(b,c,e){e=e||document;var a=e.getElementsByTagName("head")[0],d;if(!(d=e.getElementById(b))){if(c===undefined){return""}d=e.createElement("style");d.id=b;a.appendChild(d)}if(c===undefined){return d.innerHTML}if(c!==""){d.innerHTML=c}else{a.removeChild(d)}}};utils.each(["String","Function","Array","Number","RegExp","Object"],function(a){UM.utils["is"+a]=function(b){return Object.prototype.toString.apply(b)=="[object "+a+"]"}});var EventBase=UM.EventBase=function(){};EventBase.prototype={addListener:function(b,d){b=utils.trim(b).split(" ");for(var a=0,c;c=b[a++];){getListener(this,c,true).push(d)}},removeListener:function(b,d){b=utils.trim(b).split(" ");for(var a=0,c;c=b[a++];){utils.removeItem(getListener(this,c)||[],d)}},fireEvent:function(){var d=arguments[0];d=utils.trim(d).split(" ");for(var c=0,f;f=d[c++];){var e=getListener(this,f),g,b,a;if(e){a=e.length;while(a--){if(!e[a]){continue}b=e[a].apply(this,arguments);if(b===true){return b}if(b!==undefined){g=b}}}if(b=this["on"+f.toLowerCase()]){g=b.apply(this,arguments)}}return g}};function getListener(d,b,c){var a;b=b.toLowerCase();return((a=(d.__allListeners||c&&(d.__allListeners={})))&&(a[b]||c&&(a[b]=[])))}var dtd=dom.dtd=(function(){function z(B){for(var A in B){B[A.toUpperCase()]=B[A]}return B}var a=utils.extend2;var y=z({isindex:1,fieldset:1}),x=z({input:1,button:1,select:1,textarea:1,label:1}),w=a(z({a:1}),x),v=a({iframe:1},w),u=z({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),t=z({ins:1,del:1,script:1,style:1}),s=a(z({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),t),r=a(z({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),s),q=a(z({p:1}),r),p=a(z({iframe:1}),r,x),n=z({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),m=a(z({a:0}),p),k=z({tr:1}),j=z({"#":1}),i=a(z({param:1}),n),h=a(z({form:1}),y,v,u,q),g=z({li:1,ol:1,ul:1}),f=z({style:1,script:1}),e=z({base:1,link:1,meta:1,title:1}),d=a(e,f),c=z({head:1,body:1}),b=z({html:1});var l=z({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),o=z({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return z({$nonBodyContent:a(b,c,e),$block:l,$inline:m,$inlineWithA:a(z({a:1}),m),$body:a(z({script:1,style:1}),l),$cdata:z({script:1,style:1}),$empty:o,$nonChild:z({iframe:1,textarea:1}),$listItem:z({dd:1,dt:1,li:1}),$list:z({ul:1,ol:1,dl:1}),$isNotEmpty:z({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:z({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:z({p:1,div:1}),$tableContent:z({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:z({pre:1,script:1,style:1,textarea:1}),html:c,head:d,style:j,script:j,body:h,base:{},link:{},meta:{},title:j,col:{},tr:z({td:1,th:1}),img:{},embed:{},colgroup:z({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:h,td:h,br:{},th:h,center:h,kbd:m,button:a(q,u),basefont:{},h5:m,h4:m,samp:m,h6:m,ol:g,h1:m,h3:m,option:j,h2:m,form:a(y,v,u,q),select:z({optgroup:1,option:1}),font:m,ins:m,menu:g,abbr:m,label:m,table:z({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:m,tfoot:k,cite:m,li:h,input:{},iframe:h,strong:m,textarea:j,noframes:h,big:m,small:m,span:z({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:m,dt:m,sub:m,optgroup:z({option:1}),param:{},bdo:m,"var":m,div:h,object:i,sup:m,dd:h,strike:m,area:{},dir:g,map:a(z({area:1,form:1,p:1}),y,t,u),applet:i,dl:z({dt:1,dd:1}),del:m,isindex:{},fieldset:a(z({legend:1}),n),thead:k,ul:g,acronym:m,b:m,a:a(z({a:1}),p),blockquote:a(z({td:1,tr:1,tbody:1,li:1}),h),caption:m,i:m,u:m,tbody:k,s:m,address:a(v,q),tt:m,legend:m,q:m,pre:a(s,w),p:a(z({a:1}),m),em:m,dfn:m})})();function getDomNode(g,h,b,a,e,f){var d=a&&g[h],c;!d&&(d=g[b]);while(!d&&(c=(c||g).parentNode)){if(c.tagName=="BODY"||f&&!f(c)){return null}d=c[b]}if(d&&e&&!e(d)){return getDomNode(d,h,b,false,e)}return d}var attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]);var domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&browser.version=="6"?"\ufeff":"\u200B",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},breakParent:function(e,c){var b,g=e,f=e,a,d;do{g=g.parentNode;if(a){b=g.cloneNode(false);b.appendChild(a);a=b;b=g.cloneNode(false);b.appendChild(d);d=b}else{a=g.cloneNode(false);d=a.cloneNode(false)}while(b=f.previousSibling){a.insertBefore(b,a.firstChild)}while(b=f.nextSibling){d.appendChild(b)}f=g}while(c!==g);b=c.parentNode;b.insertBefore(a,c);b.insertBefore(d,c);b.insertBefore(e,d);domUtils.remove(c);return e},trimWhiteTextNode:function(b){function a(c){var d;while((d=b[c])&&d.nodeType==3&&domUtils.isWhitespace(d)){b.removeChild(d)}}a("firstChild");a("lastChild")},getPosition:function(f,d){if(f===d){return 0}var b,e=[f],c=[d];b=f;while(b=b.parentNode){if(b===d){return 10}e.push(b)}b=d;while(b=b.parentNode){if(b===f){return 20}c.push(b)}e.reverse();c.reverse();if(e[0]!==c[0]){return 1}var a=-1;while(a++,e[a]===c[a]){}f=e[a];d=c[a];while(f=f.nextSibling){if(f===d){return 4}}return 2},getNodeIndex:function(c,b){var d=c,a=0;while(d=d.previousSibling){if(b&&d.nodeType==3){if(d.nodeType!=d.nextSibling.nodeType){a++}continue}a++}return a},inDoc:function(a,b){return domUtils.getPosition(a,b)==10},findParent:function(b,c,a){if(b&&!domUtils.isBody(b)){b=a?b:b.parentNode;while(b){if(!c||c(b)||domUtils.isBody(b)){return c&&!c(b)&&domUtils.isBody(b)?null:b}b=b.parentNode}}return null},findParentByTagName:function(c,a,b,d){a=utils.listToMap(utils.isArray(a)?a:[a]);return domUtils.findParent(c,function(e){return a[e.tagName]&&!(d&&d(e))},b)},findParents:function(d,c,e,b){var a=c&&(e&&e(d)||!e)?[d]:[];while(d=domUtils.findParent(d,e)){a.push(d)}return b?a:a.reverse()},insertAfter:function(b,a){return b.parentNode.insertBefore(a,b.nextSibling)},remove:function(b,c){var a=b.parentNode,d;if(a){if(c&&b.hasChildNodes()){while(d=b.firstChild){a.insertBefore(d,b)}}a.removeChild(b)}return b},getNextDomNode:function(c,a,d,b){return getDomNode(c,"firstChild","nextSibling",a,d,b)},getPreDomNode:function(c,a,d,b){return getDomNode(c,"lastChild","previousSibling",a,d,b)},isBookmarkNode:function(a){return a.nodeType==1&&a.id&&/^_baidu_bookmark_/i.test(a.id)},getWindow:function(a){var b=a.ownerDocument||a;return b.defaultView||b.parentWindow},getCommonAncestor:function(f,d){if(f===d){return f}var e=[f],c=[d],b=f,a=-1;while(b=b.parentNode){if(b===d){return b}e.push(b)}b=d;while(b=b.parentNode){if(b===f){return b}c.push(b)}e.reverse();c.reverse();while(a++,e[a]===c[a]){}return a==0?null:e[a-1]},clearEmptySibling:function(d,b,c){function a(g,e){var f;while(g&&!domUtils.isBookmarkNode(g)&&(domUtils.isEmptyInlineElement(g)||!new RegExp("[^\t\n\r"+domUtils.fillChar+"]").test(g.nodeValue))){f=g[e];domUtils.remove(g);g=f}}!b&&a(d.nextSibling,"nextSibling");!c&&a(d.previousSibling,"previousSibling")},split:function(d,f){var e=d.ownerDocument;if(browser.ie&&f==d.nodeValue.length){var c=e.createTextNode("");return domUtils.insertAfter(d,c)}var a=d.splitText(f);if(browser.ie8){var b=e.createTextNode("");domUtils.insertAfter(a,b);domUtils.remove(b)}return a},isWhitespace:function(a){return !new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(a.nodeValue)},getXY:function(b){var a=0,c=0;while(b.offsetParent){c+=b.offsetTop;a+=b.offsetLeft;b=b.offsetParent}return{x:a,y:c}},isEmptyInlineElement:function(a){if(a.nodeType!=1||!dtd.$removeEmpty[a.tagName]){return 0}a=a.firstChild;while(a){if(domUtils.isBookmarkNode(a)){return 0}if(a.nodeType==1&&!domUtils.isEmptyInlineElement(a)||a.nodeType==3&&!domUtils.isWhitespace(a)){return 0}a=a.nextSibling}return 1},isBlockElm:function(a){return a.nodeType==1&&(dtd.$block[a.tagName]||styleBlock[domUtils.getComputedStyle(a,"display")])&&!dtd.$nonChild[a.tagName]},getElementsByTagName:function(e,a,b){if(b&&utils.isString(b)){var j=b;b=function(l){var i=false;$.each(utils.trim(j).replace(/[ ]{2,}/g," ").split(" "),function(n,m){if($(l).hasClass(m)){i=true;return false}});return i}}a=utils.trim(a).replace(/[ ]{2,}/g," ").split(" ");var g=[];for(var d=0,c;c=a[d++];){var h=e.getElementsByTagName(c);for(var f=0,k;k=h[f++];){if(!b||b(k)){g.push(k)}}}return g},unSelectable:ie&&browser.ie9below||browser.opera?function(c){c.onselectstart=function(){return false};c.onclick=c.onkeyup=c.onkeydown=function(){return false};c.unselectable="on";c.setAttribute("unselectable","on");for(var b=0,a;a=c.all[b++];){switch(a.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:a.unselectable="on";c.setAttribute("unselectable","on")}}}:function(a){a.style.MozUserSelect=a.style.webkitUserSelect=a.style.msUserSelect=a.style.KhtmlUserSelect="none"},removeAttributes:function(c,d){d=utils.isArray(d)?d:utils.trim(d).replace(/[ ]{2,}/g," ").split(" ");for(var b=0,a;a=d[b++];){a=attrFix[a]||a;switch(a){case"className":c[a]="";break;case"style":c.style.cssText="";!browser.ie&&c.removeAttributeNode(c.getAttributeNode("style"))}c.removeAttribute(a)}},createElement:function(c,a,b){return domUtils.setAttributes(c.createElement(a),b)},setAttributes:function(c,b){for(var a in b){if(b.hasOwnProperty(a)){var d=b[a];switch(a){case"class":c.className=d;break;case"style":c.style.cssText=c.style.cssText+";"+d;break;case"innerHTML":c[a]=d;break;case"value":c.value=d;break;default:c.setAttribute(attrFix[a]||a,d)}}}return c},getComputedStyle:function(b,a){return utils.transUnitToPx(utils.fixColor(a,$(b).css(a)))},preventDefault:function(a){a.preventDefault?a.preventDefault():(a.returnValue=false)},removeStyle:function(b,a){if(browser.ie){if(a=="color"){a="(^|;)"+a}b.style.cssText=b.style.cssText.replace(new RegExp(a+"[^:]*:[^;]+;?","ig"),"")}else{if(b.style.removeProperty){b.style.removeProperty(a)}else{b.style.removeAttribute(utils.cssStyleToDomStyle(a))}}if(!b.style.cssText){domUtils.removeAttributes(b,["style"])}},getStyle:function(b,a){var c=b.style[utils.cssStyleToDomStyle(a)];return utils.fixColor(a,c)},setStyle:function(b,a,c){b.style[utils.cssStyleToDomStyle(a)]=c;if(!utils.trim(b.style.cssText)){this.removeAttributes(b,"style")}},removeDirtyAttr:function(d){for(var c=0,b,a=d.getElementsByTagName("*");b=a[c++];){b.removeAttribute("_moz_dirty")}d.removeAttribute("_moz_dirty")},getChildCount:function(c,a){var b=0,d=c.firstChild;a=a||function(){return 1};while(d){if(a(d)){b++}d=d.nextSibling}return b},isEmptyNode:function(a){return !a.firstChild||domUtils.getChildCount(a,function(b){return !domUtils.isBr(b)&&!domUtils.isBookmarkNode(b)&&!domUtils.isWhitespace(b)})==0},isBr:function(a){return a.nodeType==1&&a.tagName=="BR"},isFillChar:function(a,b){return a.nodeType==3&&!a.nodeValue.replace(new RegExp((b?"^":"")+domUtils.fillChar),"").length},isEmptyBlock:function(b,a){if(b.nodeType!=1){return 0}a=a||new RegExp("[ \t\r\n"+domUtils.fillChar+"]","g");if(b[browser.ie?"innerText":"textContent"].replace(a,"").length>0){return 0}for(var c in dtd.$isNotEmpty){if(b.getElementsByTagName(c).length){return 0}}return 1},isCustomeNode:function(a){return a.nodeType==1&&a.getAttribute("_ue_custom_node_")},fillNode:function(c,b){var a=browser.ie?c.createTextNode(domUtils.fillChar):c.createElement("br");b.innerHTML="";b.appendChild(a)},isBoundaryNode:function(c,a){var b;while(!domUtils.isBody(c)){b=c;c=c.parentNode;if(b!==c[a]){return false}}return true},isFillChar:function(a,b){return a.nodeType==3&&!a.nodeValue.replace(new RegExp((b?"^":"")+domUtils.fillChar),"").length},isBody:function(a){return $(a).hasClass("edui-body-container")}};var fillCharReg=new RegExp(domUtils.fillChar,"g");(function(){var f=0,g=domUtils.fillChar,c;function b(k){k.collapsed=k.startContainer&&k.endContainer&&k.startContainer===k.endContainer&&k.startOffset==k.endOffset}function j(k){return !k.collapsed&&k.startContainer.nodeType==1&&k.startContainer===k.endContainer&&k.endOffset-k.startOffset==1}function a(l,m,n,k){if(m.nodeType==1&&(dtd.$empty[m.tagName]||dtd.$nonChild[m.tagName])){n=domUtils.getNodeIndex(m)+(l?0:1);m=m.parentNode}if(l){k.startContainer=m;k.startOffset=n;if(!k.endContainer){k.collapse(true)}}else{k.endContainer=m;k.endOffset=n;if(!k.startContainer){k.collapse(false)}}b(k);return k}var d=dom.Range=function(l,k){var m=this;m.startContainer=m.startOffset=m.endContainer=m.endOffset=null;m.document=l;m.collapsed=true;m.body=k};function e(n,k){try{if(c&&domUtils.inDoc(c,n)){if(!c.nodeValue.replace(fillCharReg,"").length){var l=c.parentNode;domUtils.remove(c);while(l&&domUtils.isEmptyInlineElement(l)&&(browser.safari?!(domUtils.getPosition(l,k)&domUtils.POSITION_CONTAINS):!l.contains(k))){c=l.parentNode;domUtils.remove(l);l=c}}else{c.nodeValue=c.nodeValue.replace(fillCharReg,"")}}}catch(m){}}function i(m,k){var l;m=m[k];while(m&&domUtils.isFillChar(m)){l=m[k];domUtils.remove(m);m=l}}function h(q,u){var o=q.startContainer,n=q.endContainer,w=q.startOffset,p=q.endOffset,C=q.document,k=C.createDocumentFragment(),r,t;if(o.nodeType==1){o=o.childNodes[w]||(r=o.appendChild(C.createTextNode("")))}if(n.nodeType==1){n=n.childNodes[p]||(t=n.appendChild(C.createTextNode("")))}if(o===n&&o.nodeType==3){k.appendChild(C.createTextNode(o.substringData(w,p-w)));if(u){o.deleteData(w,p-w);q.collapse(true)}return k}var s,y,A=k,z=domUtils.findParents(o,true),l=domUtils.findParents(n,true);for(var x=0;z[x]==l[x];){x++}for(var v=x,B;B=z[v];v++){s=B.nextSibling;if(B==o){if(!r){if(q.startContainer.nodeType==3){A.appendChild(C.createTextNode(o.nodeValue.slice(w)));if(u){o.deleteData(w,o.nodeValue.length-w)}}else{A.appendChild(!u?o.cloneNode(true):o)}}}else{y=B.cloneNode(false);A.appendChild(y)}while(s){if(s===n||s===l[v]){break}B=s.nextSibling;A.appendChild(!u?s.cloneNode(true):s);s=B}A=y}A=k;if(!z[x]){A.appendChild(z[x-1].cloneNode(false));A=A.firstChild}for(var v=x,m;m=l[v];v++){s=m.previousSibling;if(m==n){if(!t&&q.endContainer.nodeType==3){A.appendChild(C.createTextNode(n.substringData(0,p)));if(u){n.deleteData(0,p)}}}else{y=m.cloneNode(false);A.appendChild(y)}if(v!=x||!z[x]){while(s){if(s===o){break}m=s.previousSibling;A.insertBefore(!u?s.cloneNode(true):s,A.firstChild);s=m}}A=y}if(u){q.setStartBefore(!l[x]?l[x-1]:!z[x]?z[x-1]:l[x]).collapse(true)}r&&domUtils.remove(r);t&&domUtils.remove(t);return k}d.prototype={deleteContents:function(){var k;if(!this.collapsed){h(this,1)}if(browser.webkit){k=this.startContainer;if(k.nodeType==3&&!k.nodeValue.length){this.setStartBefore(k).collapse(true);domUtils.remove(k)}}return this},inFillChar:function(){var k=this.startContainer;if(this.collapsed&&k.nodeType==3&&k.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==k.nodeValue.length){return true}return false},setStart:function(k,l){return a(true,k,l,this)},setEnd:function(k,l){return a(false,k,l,this)},setStartAfter:function(k){return this.setStart(k.parentNode,domUtils.getNodeIndex(k)+1)},setStartBefore:function(k){return this.setStart(k.parentNode,domUtils.getNodeIndex(k))},setEndAfter:function(k){return this.setEnd(k.parentNode,domUtils.getNodeIndex(k)+1)},setEndBefore:function(k){return this.setEnd(k.parentNode,domUtils.getNodeIndex(k))},setStartAtFirst:function(k){return this.setStart(k,0)},setStartAtLast:function(k){return this.setStart(k,k.nodeType==3?k.nodeValue.length:k.childNodes.length)},setEndAtFirst:function(k){return this.setEnd(k,0)},setEndAtLast:function(k){return this.setEnd(k,k.nodeType==3?k.nodeValue.length:k.childNodes.length)},selectNode:function(k){return this.setStartBefore(k).setEndAfter(k)},selectNodeContents:function(k){return this.setStart(k,0).setEndAtLast(k)},cloneRange:function(){var k=this;return new d(k.document).setStart(k.startContainer,k.startOffset).setEnd(k.endContainer,k.endOffset)},collapse:function(k){var l=this;if(k){l.endContainer=l.startContainer;l.endOffset=l.startOffset}else{l.startContainer=l.endContainer;l.startOffset=l.endOffset}l.collapsed=true;return l},shrinkBoundary:function(m){var l=this,o,n=l.collapsed;function k(p){return p.nodeType==1&&!domUtils.isBookmarkNode(p)&&!dtd.$empty[p.tagName]&&!dtd.$nonChild[p.tagName]}while(l.startContainer.nodeType==1&&(o=l.startContainer.childNodes[l.startOffset])&&k(o)){l.setStart(o,0)}if(n){return l.collapse(true)}if(!m){while(l.endContainer.nodeType==1&&l.endOffset>0&&(o=l.endContainer.childNodes[l.endOffset-1])&&k(o)){l.setEnd(o,o.childNodes.length)}}return l},trimBoundary:function(l){this.txtToElmBoundary();var p=this.startContainer,o=this.startOffset,n=this.collapsed,k=this.endContainer;if(p.nodeType==3){if(o==0){this.setStartBefore(p)}else{if(o>=p.nodeValue.length){this.setStartAfter(p)}else{var m=domUtils.split(p,o);if(p===k){this.setEnd(m,this.endOffset-o)}else{if(p.parentNode===k){this.endOffset+=1}}this.setStartBefore(m)}}if(n){return this.collapse(true)}}if(!l){o=this.endOffset;k=this.endContainer;if(k.nodeType==3){if(o==0){this.setEndBefore(k)}else{o<k.nodeValue.length&&domUtils.split(k,o);this.setEndAfter(k)}}}return this},txtToElmBoundary:function(k){function l(n,p){var m=n[p+"Container"],o=n[p+"Offset"];if(m.nodeType==3){if(!o){n["set"+p.replace(/(\w)/,function(q){return q.toUpperCase()})+"Before"](m)}else{if(o>=m.nodeValue.length){n["set"+p.replace(/(\w)/,function(q){return q.toUpperCase()})+"After"](m)}}}}if(k||!this.collapsed){l(this,"start");l(this,"end")}return this},insertNode:function(m){var o=m,l=1;if(m.nodeType==11){o=m.firstChild;l=m.childNodes.length}this.trimBoundary(true);var p=this.startContainer,n=this.startOffset;var k=p.childNodes[n];if(k){p.insertBefore(m,k)}else{p.appendChild(m)}if(o.parentNode===this.endContainer){this.endOffset=this.endOffset+l}return this.setStartBefore(o)},setCursor:function(l,k){return this.collapse(!l).select(k)},createBookmark:function(m,n){var k,l=this.document.createElement("span");l.style.cssText="display:none;line-height:0px;";l.appendChild(this.document.createTextNode("\u200D"));l.id="_baidu_bookmark_start_"+(n?"":f++);if(!this.collapsed){k=l.cloneNode(true);k.id="_baidu_bookmark_end_"+(n?"":f++)}this.insertNode(l);if(k){this.collapse().insertNode(k).setEndBefore(k)}this.setStartAfter(l);return{start:m?l.id:l,end:k?m?k.id:k:null,id:m}},moveToBookmark:function(l){var m=l.id?this.document.getElementById(l.start):l.start,k=l.end&&l.id?this.document.getElementById(l.end):l.end;this.setStartBefore(m);domUtils.remove(m);if(k){this.setEndBefore(k);domUtils.remove(k)}else{this.collapse(true)}return this},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setStartAfter(this.startContainer)}while(!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setEndBefore(this.endContainer)}}return this},getClosedNode:function(){var l;if(!this.collapsed){var k=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(j(k)){var m=k.startContainer.childNodes[k.startOffset];if(m&&m.nodeType==1&&(dtd.$empty[m.tagName]||dtd.$nonChild[m.tagName])){l=m}}}return l},select:browser.ie?function(l,u){var q;if(!this.collapsed){this.shrinkBoundary()}var m=this.getClosedNode();if(m&&!u){try{q=this.document.body.createControlRange();q.addElement(m);q.select()}catch(r){}return this}var s=this.createBookmark(),k=s.start,n;q=this.document.body.createTextRange();q.moveToElementText(k);q.moveStart("character",1);if(!this.collapsed){var p=this.document.body.createTextRange();n=s.end;p.moveToElementText(n);q.setEndPoint("EndToEnd",p)}else{if(!l&&this.startContainer.nodeType!=3){var t=this.document.createTextNode(g),o=this.document.createElement("span");o.appendChild(this.document.createTextNode(g));k.parentNode.insertBefore(o,k);k.parentNode.insertBefore(t,k);e(this.document,t);c=t;i(o,"previousSibling");i(k,"nextSibling");q.moveStart("character",-1);q.collapse(true)}}this.moveToBookmark(s);o&&domUtils.remove(o);try{q.select()}catch(r){}return this}:function(k){function l(t){function s(v,w,u){if(v.nodeType==3&&v.nodeValue.length<w){t[u+"Offset"]=v.nodeValue.length}}s(t.startContainer,t.startOffset,"start");s(t.endContainer,t.endOffset,"end")}var p=domUtils.getWindow(this.document),o=p.getSelection(),n;browser.gecko?this.body.focus():p.focus();if(o){o.removeAllRanges();if(this.collapsed&&!k){var r=this.startContainer,q=r;if(r.nodeType==1){q=r.childNodes[this.startOffset]}if(!(r.nodeType==3&&this.startOffset)&&(q?(!q.previousSibling||q.previousSibling.nodeType!=3):(!r.lastChild||r.lastChild.nodeType!=3))){n=this.document.createTextNode(g);this.insertNode(n);e(this.document,n);i(n,"previousSibling");i(n,"nextSibling");c=n;this.setStart(n,browser.webkit?1:0).collapse(true)}}var m=this.document.createRange();if(this.collapsed&&browser.opera&&this.startContainer.nodeType==1){var q=this.startContainer.childNodes[this.startOffset];if(!q){q=this.startContainer.lastChild;if(q&&domUtils.isBr(q)){this.setStartBefore(q).collapse(true)}}else{while(q&&domUtils.isBlockElm(q)){if(q.nodeType==1&&q.childNodes[0]){q=q.childNodes[0]}else{break}}q&&this.setStartBefore(q).collapse(true)}}l(this);m.setStart(this.startContainer,this.startOffset);m.setEnd(this.endContainer,this.endOffset);o.addRange(m)}return this},createAddress:function(n,m){var o={},l=this;function k(p){var r=p?l.startContainer:l.endContainer;var w=domUtils.findParents(r,true,function(y){return !domUtils.isBody(y)}),v=[];for(var t=0,x;x=w[t++];){v.push(domUtils.getNodeIndex(x,m))}var q=0;if(m){if(r.nodeType==3){var s=r.previousSibling;while(s&&s.nodeType==3){q+=s.nodeValue.replace(fillCharReg,"").length;s=s.previousSibling}q+=(p?l.startOffset:l.endOffset)}else{r=r.childNodes[p?l.startOffset:l.endOffset];if(r){q=domUtils.getNodeIndex(r,m)}else{r=p?l.startContainer:l.endContainer;var u=r.firstChild;while(u){if(domUtils.isFillChar(u)){u=u.nextSibling;continue}q++;if(u.nodeType==3){while(u&&u.nodeType==3){u=u.nextSibling}}else{u=u.nextSibling}}}}}else{q=p?domUtils.isFillChar(r)?0:l.startOffset:l.endOffset}if(q<0){q=0}v.push(q);return v}o.startAddress=k(true);if(!n){o.endAddress=l.collapsed?[].concat(o.startAddress):k()}return o},moveToAddress:function(n,l){var k=this;function m(r,q){var u=k.body,o,v;for(var t=0,s,p=r.length;t<p;t++){s=r[t];o=u;u=u.childNodes[s];if(!u){v=s;break}}if(q){if(u){k.setStartBefore(u)}else{k.setStart(o,v)}}else{if(u){k.setEndBefore(u)}else{k.setEnd(o,v)}}}m(n.startAddress,true);!l&&n.endAddress&&m(n.endAddress);return k},equals:function(k){for(var l in this){if(this.hasOwnProperty(l)){if(this[l]!==k[l]){return false}}}return true},scrollIntoView:function(){var l=$('<span style="padding:0;margin:0;display:block;border:0">&nbsp;</span>');this.cloneRange().insertNode(l.get(0));var m=$(window).scrollTop(),k=$(window).height(),n=l.offset().top;if(n<m-k||n>m+k){if(n>m+k){window.scrollTo(0,n-k+l.height())}else{window.scrollTo(0,m-n)}}l.remove()},getOffset:function(){var k=this.createBookmark();var l=$(k.start).css("display","inline-block").offset();this.moveToBookmark(k);return l}}})();(function(){function d(p,g){var h=domUtils.getNodeIndex;p=p.duplicate();p.collapse(g);var t=p.parentElement();if(!t.hasChildNodes()){return{container:t,offset:0}}var s=t.children,j,l=p.duplicate(),u=0,o=s.length-1,q=-1,f;while(u<=o){q=Math.floor((u+o)/2);j=s[q];l.moveToElementText(j);var n=l.compareEndPoints("StartToStart",p);if(n>0){o=q-1}else{if(n<0){u=q+1}else{return{container:t,offset:h(j)}}}}if(q==-1){l.moveToElementText(t);l.setEndPoint("StartToStart",p);f=l.text.replace(/(\r\n|\r)/g,"\n").length;s=t.childNodes;if(!f){j=s[s.length-1];return{container:j,offset:j.nodeValue.length}}var m=s.length;while(f>0){f-=s[--m].nodeValue.length}return{container:s[m],offset:-f}}l.collapse(n>0);l.setEndPoint(n>0?"StartToStart":"EndToStart",p);f=l.text.replace(/(\r\n|\r)/g,"\n").length;if(!f){return dtd.$empty[j.tagName]||dtd.$nonChild[j.tagName]?{container:t,offset:h(j)+(n>0?0:1)}:{container:j,offset:n>0?0:j.childNodes.length}}while(f>0){try{var k=j;j=j[n>0?"previousSibling":"nextSibling"];f-=j.nodeValue.length}catch(r){return{container:t,offset:h(k)}}}return{container:j,offset:n>0?-f:j.nodeValue.length+f}}function c(g,f){if(g.item){f.selectNode(g.item(0))}else{var e=d(g,true);f.setStart(e.container,e.offset);if(g.compareEndPoints("StartToEnd",g)!=0){e=d(g,false);f.setEnd(e.container,e.offset)}}return f}function b(i,f){var h;try{h=i.getNative(f).createRange()}catch(j){return null}var g=h.item?h.item(0):h.parentElement();if((g.ownerDocument||g)===i.document){return h}return null}var a=dom.Selection=function(g,e){var f=this;f.document=g;f.body=e;if(browser.ie9below){$(e).on("beforedeactivate",function(){f._bakIERange=f.getIERange()}).on("activate",function(){try{var h=b(f);if((!h||!f.rangeInBody(h))&&f._bakIERange){f._bakIERange.select()}}catch(i){}f._bakIERange=null})}};a.prototype={hasNativeRange:function(){var e;if(!browser.ie||browser.ie9above){var f=this.getNative();if(!f.rangeCount){return false}e=f.getRangeAt(0)}else{e=b(this)}return this.rangeInBody(e)},getNative:function(f){var h=this.document;try{return !h?null:browser.ie9below||f?h.selection:domUtils.getWindow(h).getSelection()}catch(g){return null}},getIERange:function(e){var f=b(this,e);if(!f||!this.rangeInBody(f,e)){if(this._bakIERange){return this._bakIERange}}return f},rangeInBody:function(e,f){var g=browser.ie9below||f?e.item?e.item():e.parentElement():e.startContainer;return g===this.body||domUtils.inDoc(g,this.body)},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath){return this._cachedStartElementPath}var e=this.getStart();if(e){return domUtils.findParents(e,true,null,true)}return[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange()},getRange:function(){var i=this;function h(e){var o=i.body.firstChild,n=e.collapsed;while(o&&o.firstChild){e.setStart(o,0);o=o.firstChild}if(!e.startContainer){e.setStart(i.body,0)}if(n){e.collapse(true)}}if(i._cachedRange!=null){return this._cachedRange}var g=new dom.Range(i.document,i.body);if(browser.ie9below){var k=i.getIERange();if(k&&this.rangeInBody(k)){try{c(k,g)}catch(l){h(g)}}else{h(g)}}else{var j=i.getNative();if(j&&j.rangeCount&&i.rangeInBody(j.getRangeAt(0))){var f=j.getRangeAt(0);var m=j.getRangeAt(j.rangeCount-1);g.setStart(f.startContainer,f.startOffset).setEnd(m.endContainer,m.endOffset);if(g.collapsed&&domUtils.isBody(g.startContainer)&&!g.startOffset){h(g)}}else{if(this._bakRange&&(this._bakRange.startContainer===this.body||domUtils.inDoc(this._bakRange.startContainer,this.body))){return this._bakRange}h(g)}}return this._bakRange=g},getStart:function(){if(this._cachedStartElement){return this._cachedStartElement}var e=browser.ie9below?this.getIERange():this.getRange(),h,i,f,g;if(browser.ie9below){if(!e){return this.document.body.firstChild}if(e.item){return e.item(0)}h=e.duplicate();h.text.length>0&&h.moveStart("character",1);h.collapse(1);i=h.parentElement();g=f=e.parentElement();while(f=f.parentNode){if(f==i){i=g;break}}}else{i=e.startContainer;if(i.nodeType==1&&i.hasChildNodes()){i=i.childNodes[Math.min(i.childNodes.length-1,e.startOffset)]}if(i.nodeType==3){return i.parentNode}}return i},getText:function(){var e,f;if(this.isFocus()&&(e=this.getNative())){f=browser.ie9below?e.createRange():e.getRangeAt(0);return browser.ie9below?f.text:f.toString()}return""}}})();(function(){var d=0,b;function f(m,l){var g;if(l.textarea){if(utils.isString(l.textarea)){for(var j=0,k,h=domUtils.getElementsByTagName(m,"textarea");k=h[j++];){if(k.id=="umeditor_textarea_"+l.options.textarea){g=k;break}}}else{g=l.textarea}}if(!g){m.appendChild(g=domUtils.createElement(document,"textarea",{name:l.options.textarea,id:"umeditor_textarea_"+l.options.textarea,style:"display:none"}));l.textarea=g}g.value=l.hasContents()?(l.options.allHtmlEnabled?l.getAllHtml():l.getContent(null,null,true)):""}function c(g){for(var h in UM.plugins){if(g.options.excludePlugins.indexOf(h)==-1){UM.plugins[h].call(g);g.plugins[h]=1}}g.langIsReady=true;g.fireEvent("langReady")}function e(g){for(var h in g){return h}}var a=UM.Editor=function(g){var h=this;h.uid=d++;EventBase.call(h);h.commands={};h.options=utils.extend(utils.clone(g||{}),UMEDITOR_CONFIG,true);h.shortcutkeys={};h.inputRules=[];h.outputRules=[];h.setOpt({isShow:true,initialContent:"",initialStyle:"",autoClearinitialContent:false,textarea:"editorValue",focus:false,focusInEnd:true,autoClearEmptyNode:true,fullscreen:false,readonly:false,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:h.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:h.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:false,autoSyncData:true,autoHeightEnabled:true,excludePlugins:""});h.plugins={};if(!utils.isEmptyObject(UM.I18N)){h.options.lang=e(UM.I18N);c(h)}else{utils.loadFile(document,{src:h.options.langPath+h.options.lang+"/"+h.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){c(h)})}};a.prototype={ready:function(g){var h=this;if(g){h.isReady?g.apply(h):h.addListener("ready",g)}},setOpt:function(g,i){var h={};if(utils.isString(g)){h[g]=i}else{h=g}utils.extend(this.options,h,true)},getOpt:function(g){return this.options[g]||""},destroy:function(){var i=this;i.fireEvent("destroy");var h=i.container.parentNode;if(h===document.body){h=i.container}var g=i.textarea;if(!g){g=document.createElement("textarea");h.parentNode.insertBefore(g,h)}else{g.style.display=""}g.style.width=i.body.offsetWidth+"px";g.style.height=i.body.offsetHeight+"px";g.value=i.getContent();g.id=i.key;if(h.contains(g)){$(g).insertBefore(h)}h.innerHTML="";domUtils.remove(h);UM.clearCache(i.id);for(var j in i){if(i.hasOwnProperty(j)){delete this[j]}}},initialCont:function(h){if(h){h.getAttribute("name")&&(this.options.textarea=h.getAttribute("name"));if(h&&/script|textarea/ig.test(h.tagName)){var g=document.createElement("div");h.parentNode.insertBefore(g,h);this.options.initialContent=UM.htmlparser(h.value||h.innerHTML||this.options.initialContent).toHtml();h.className&&(g.className=h.className);h.style.cssText&&(g.style.cssText=h.style.cssText);if(/textarea/i.test(h.tagName)){this.textarea=h;this.textarea.style.display="none"}else{h.parentNode.removeChild(h);h.id&&(g.id=h.id)}h=g;h.innerHTML=""}return h}else{return null}},render:function(h){var k=this,i=k.options,j=function(l){return parseInt($(h).css(l))};if(utils.isString(h)){h=document.getElementById(h)}if(h){this.id=h.getAttribute("id");UM.setEditor(this);utils.cssRule("edui-style-body",k.options.initialStyle,document);h=this.initialCont(h);h.className+=" edui-body-container";if(i.initialFrameWidth){i.minFrameWidth=i.initialFrameWidth}else{i.minFrameWidth=i.initialFrameWidth=$(h).width()||UM.defaultWidth}if(i.initialFrameHeight){i.minFrameHeight=i.initialFrameHeight}else{i.initialFrameHeight=i.minFrameHeight=$(h).height()||UM.defaultHeight}h.style.width=/%$/.test(i.initialFrameWidth)?"100%":i.initialFrameWidth-j("padding-left")-j("padding-right")+"px";var g=/%$/.test(i.initialFrameHeight)?"100%":(i.initialFrameHeight-j("padding-top")-j("padding-bottom"));if(this.options.autoHeightEnabled){h.style.minHeight=g+"px";h.style.height="";if(browser.ie&&browser.version<=6){h.style.height=g;h.style.setExpression("height","this.scrollHeight <= "+g+' ? "'+g+'px" : "auto"')}}else{$(h).height(g)}h.style.zIndex=i.zIndex;this._setup(h)}},_setup:function(g){var k=this,h=k.options;g.contentEditable=true;document.body.spellcheck=false;k.document=document;k.window=document.defaultView||document.parentWindow;k.body=g;k.$body=$(g);k.selection=new dom.Selection(document,k.body);k._isEnabled=false;var l;if(browser.gecko&&(l=this.selection.getNative())){l.removeAllRanges()}this._initEvents();for(var j=g.parentNode;j&&!domUtils.isBody(j);j=j.parentNode){if(j.tagName=="FORM"){k.form=j;if(k.options.autoSyncData){$(g).on("blur",function(){f(j,k)})}else{$(j).on("submit",function(){f(this,k)})}break}}if(h.initialContent){if(h.autoClearinitialContent){var i=k.execCommand;k.execCommand=function(){k.fireEvent("firstBeforeExecCommand");return i.apply(k,arguments)};this._setDefaultContent(h.initialContent)}else{this.setContent(h.initialContent,false,true)}}if(domUtils.isEmptyNode(k.body)){k.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"}if(h.focus){setTimeout(function(){k.focus(k.options.focusInEnd);!k.options.autoClearinitialContent&&k._selectionChange()},0)}if(!k.container){k.container=g.parentNode}k._bindshortcutKeys();k.isReady=1;k.fireEvent("ready");h.onready&&h.onready.call(k);if(!browser.ie||browser.ie9above){$(k.body).on("blur focus",function(n){var m=k.selection.getNative();if(n.type=="blur"){if(m.rangeCount>0){k._bakRange=m.getRangeAt(0)}}else{try{k._bakRange&&m.addRange(k._bakRange)}catch(n){}k._bakRange=null}})}!h.isShow&&k.setHide();h.readonly&&k.setDisabled()},sync:function(i){var h=this,g=i?document.getElementById(i):domUtils.findParent(h.body.parentNode,function(j){return j.tagName=="FORM"},true);g&&f(g,h)},setHeight:function(g,h){!h&&(this.options.initialFrameHeight=g);if(this.options.autoHeightEnabled){$(this.body).css({"min-height":g+"px"});if(browser.ie&&browser.version<=6&&this.container){this.container.style.height=g;this.container.style.setExpression("height","this.scrollHeight <= "+g+' ? "'+g+'px" : "auto"')}}else{$(this.body).height(g)}this.fireEvent("resize")},setWidth:function(g){this.$container&&this.$container.width(g);$(this.body).width(g-$(this.body).css("padding-left").replace("px","")*1-$(this.body).css("padding-right").replace("px","")*1);this.fireEvent("resize")},addshortcutkey:function(h,g){var i={};if(g){i[h]=g}else{i=h}utils.extend(this.shortcutkeys,i)},_bindshortcutKeys:function(){var h=this,g=this.shortcutkeys;h.addListener("keydown",function(o,n){var q=n.keyCode||n.which;for(var l in g){var m=g[l].split(",");for(var r=0,j;j=m[r++];){j=j.split(":");var p=j[0],k=j[1];if(/^(ctrl)(\+shift)?\+(\d+)$/.test(p.toLowerCase())||/^(\d+)$/.test(p)){if(((RegExp.$1=="ctrl"?(n.ctrlKey||n.metaKey):0)&&(RegExp.$2!=""?n[RegExp.$2.slice(1)+"Key"]:1)&&q==RegExp.$3)||q==RegExp.$1){if(h.queryCommandState(l,k)!=-1){h.execCommand(l,k)}domUtils.preventDefault(n)}}}}})},getContent:function(m,k,h,j,i){var l=this;if(m&&utils.isFunction(m)){k=m;m=""}if(k?!k():!this.hasContents()){return""}l.fireEvent("beforegetcontent");var g=UM.htmlparser(l.body.innerHTML,j);l.filterOutputRule(g);l.fireEvent("aftergetcontent",g);return g.toHtml(i)},getAllHtml:function(){var i=this,h=[],g="";i.fireEvent("getAllHtml",h);if(browser.ie&&browser.version>8){var j="";utils.each(i.document.styleSheets,function(k){j+=(k.href?'<link rel="stylesheet" type="text/css" href="'+k.href+'" />':"<style>"+k.cssText+"</style>")});utils.each(i.document.getElementsByTagName("script"),function(k){j+=k.outerHTML})}return"<html><head>"+(i.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+i.options.charset+'"/>':"")+(j||i.document.getElementsByTagName("head")[0].innerHTML)+h.join("\n")+"</head><body "+(ie&&browser.version<9?'class="view"':"")+">"+i.getContent(null,null,true)+"</body></html>"},getPlainTxt:function(){var h=new RegExp(domUtils.fillChar,"g"),g=this.body.innerHTML.replace(/[\n\r]/g,"");g=g.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(j,i,k){return dtd.$block[k]?"\n":i?i:""});return g.replace(h,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var g=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(g,"").replace(/\u00a0/g," ")},setContent:function(k,n,j){var o=this;o.fireEvent("beforesetcontent",k);var q=UM.htmlparser(k);o.filterInputRule(q);k=q.toHtml();o.body.innerHTML=(n?o.body.innerHTML:"")+k;function m(p){return p.tagName=="DIV"&&p.getAttribute("cdata_tag")}if(o.options.enterTag=="p"){var h=this.body.firstChild,i;if(!h||h.nodeType==1&&(dtd.$cdata[h.tagName]||m(h)||domUtils.isCustomeNode(h))&&h===this.body.lastChild){this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML}else{var g=o.document.createElement("p");while(h){while(h&&(h.nodeType==3||h.nodeType==1&&dtd.p[h.tagName]&&!dtd.$cdata[h.tagName])){i=h.nextSibling;g.appendChild(h);h=i}if(g.firstChild){if(!h){o.body.appendChild(g);break}else{h.parentNode.insertBefore(g,h);g=o.document.createElement("p")}}h=h.nextSibling}}}o.fireEvent("aftersetcontent");o.fireEvent("contentchange");!j&&o._selectionChange();o._bakRange=o._bakIERange=o._bakNativeRange=null;var l;if(browser.gecko&&(l=this.selection.getNative())){l.removeAllRanges()}if(o.options.autoSyncData){o.form&&f(o.form,o)}},focus:function(j){try{var h=this,g=h.selection.getRange();if(j){g.setStartAtLast(h.body.lastChild).setCursor(false,true)}else{g.select(true)}this.fireEvent("focus")}catch(i){}},blur:function(){var g=this.selection.getNative();g.empty?g.empty():g.removeAllRanges();this.fireEvent("blur")},isFocus:function(){if(this.fireEvent("isfocus")===true){return true}return this.selection.isFocus()},_initEvents:function(){var h=this,g=h.body,i=function(){h._proxyDomEvent.apply(h,arguments)};$(g).on("click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart",i).on("focus blur",i).on("mouseup keydown",function(j){if(j.type=="keydown"&&(j.ctrlKey||j.metaKey||j.shiftKey||j.altKey)){return}if(j.button==2){return}h._selectionChange(250,j)})},_proxyDomEvent:function(g){return this.fireEvent(g.type.replace(/^on/,""),g)},_selectionChange:function(j,g){var m=this;var l=false;var k,i;if(browser.ie&&browser.version<9&&g&&g.type=="mouseup"){var h=this.selection.getRange();if(!h.collapsed){l=true;k=g.clientX;i=g.clientY}}clearTimeout(b);b=setTimeout(function(){if(!m.selection.getNative()){return}var o;if(l&&m.selection.getNative().type=="None"){o=m.document.body.createTextRange();try{o.moveToPoint(k,i)}catch(n){o=null}}var p;if(o){p=m.selection.getIERange;m.selection.getIERange=function(){return o}}m.selection.cache();if(p){m.selection.getIERange=p}if(m.selection._cachedRange&&m.selection._cachedStartElement){m.fireEvent("beforeselectionchange");m.fireEvent("selectionchange",!!g);m.fireEvent("afterselectionchange");m.selection.clear()}},j||50)},_callCmdFn:function(k,h){h=Array.prototype.slice.call(h,0);var g=h.shift().toLowerCase(),j,i;j=this.commands[g]||UM.commands[g];i=j&&j[k];if((!j||!i)&&k=="queryCommandState"){return 0}else{if(i){return i.apply(this,[g].concat(h))}}},execCommand:function(h){if(!this.isFocus()){var k=this.selection._bakRange;if(k){k.select()}else{this.focus(true)}}h=h.toLowerCase();var i=this,g,j=i.commands[h]||UM.commands[h];if(!j||!j.execCommand){return null}if(!j.notNeedUndo&&!i.__hasEnterExecCommand){i.__hasEnterExecCommand=true;if(i.queryCommandState.apply(i,arguments)!=-1){i.fireEvent("saveScene");i.fireEvent("beforeexeccommand",h);g=this._callCmdFn("execCommand",arguments);(!j.ignoreContentChange&&!i._ignoreContentChange)&&i.fireEvent("contentchange");i.fireEvent("afterexeccommand",h);i.fireEvent("saveScene")}i.__hasEnterExecCommand=false}else{g=this._callCmdFn("execCommand",arguments);(!i.__hasEnterExecCommand&&!j.ignoreContentChange&&!i._ignoreContentChange)&&i.fireEvent("contentchange")}(!i.__hasEnterExecCommand&&!j.ignoreContentChange&&!i._ignoreContentChange)&&i._selectionChange();return g},queryCommandState:function(g){try{return this._callCmdFn("queryCommandState",arguments)}catch(h){return 0}},queryCommandValue:function(g){try{return this._callCmdFn("queryCommandValue",arguments)}catch(h){return null}},hasContents:function(h){if(h){for(var k=0,j;j=h[k++];){if(this.body.getElementsByTagName(j).length>0){return true}}}if(!domUtils.isEmptyBlock(this.body)){return true}h=["div"];for(k=0;j=h[k++];){var g=domUtils.getElementsByTagName(this.body,j);for(var m=0,l;l=g[m++];){if(domUtils.isCustomeNode(l)){return true}}}return false},reset:function(){this.fireEvent("reset")},isEnabled:function(){return this._isEnabled!=true},setEnabled:function(){var h=this,g;h.body.contentEditable=true;if(h.lastBk){g=h.selection.getRange();try{g.moveToBookmark(h.lastBk);delete h.lastBk}catch(i){g.setStartAtFirst(h.body).collapse(true)}g.select(true)}if(h.bkqueryCommandState){h.queryCommandState=h.bkqueryCommandState;delete h.bkqueryCommandState}if(h._bkproxyDomEvent){h._proxyDomEvent=h._bkproxyDomEvent;delete h._bkproxyDomEvent}h.fireEvent("setEnabled")},enable:function(){return this.setEnabled()},setDisabled:function(g,i){var h=this;h.body.contentEditable=false;h._except=g?utils.isArray(g)?g:[g]:[];if(!h.lastBk){h.lastBk=h.selection.getRange().createBookmark(true)}if(!h.bkqueryCommandState){h.bkqueryCommandState=h.queryCommandState;h.queryCommandState=function(j){if(utils.indexOf(h._except,j)!=-1){return h.bkqueryCommandState.apply(h,arguments)}return -1}}if(!i&&!h._bkproxyDomEvent){h._bkproxyDomEvent=h._proxyDomEvent;h._proxyDomEvent=function(){return false}}h.fireEvent("selectionchange");h.fireEvent("setDisabled",h._except)},disable:function(g){return this.setDisabled(g)},_setDefaultContent:function(){function g(){var h=this;if(h.document.getElementById("initContent")){h.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>";h.removeListener("firstBeforeExecCommand focus",g);setTimeout(function(){h.focus();h._selectionChange()},0)}}return function(h){var i=this;i.body.innerHTML='<p id="initContent">'+h+"</p>";i.addListener("firstBeforeExecCommand focus",g)}}(),setShow:function(){var h=this,g=h.selection.getRange();if(h.container.style.display=="none"){try{g.moveToBookmark(h.lastBk);delete h.lastBk}catch(i){g.setStartAtFirst(h.body).collapse(true)}setTimeout(function(){g.select(true)},100);h.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var g=this;if(!g.lastBk){g.lastBk=g.selection.getRange().createBookmark(true)}g.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(j){var k=UM.I18N[this.options.lang];if(!k){throw Error("not import language file")}j=(j||"").split(".");for(var h=0,g;g=j[h++];){k=k[g];if(!k){break}}return k},getContentLength:function(h,g){var l=this.getContent(false,false,true).length;if(h){g=(g||[]).concat(["hr","img","iframe"]);l=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var k=0,j;j=g[k++];){l+=this.body.getElementsByTagName(j).length}}return l},addInputRule:function(g,h){g.ignoreUndo=h;this.inputRules.push(g)},filterInputRule:function(h,g){for(var k=0,j;j=this.inputRules[k++];){if(g&&j.ignoreUndo){continue}j.call(this,h)}},addOutputRule:function(g,h){g.ignoreUndo=h;this.outputRules.push(g)},filterOutputRule:function(h,g){for(var k=0,j;j=this.outputRules[k++];){if(g&&j.ignoreUndo){continue}j.call(this,h)}}};utils.inherits(a,EventBase)})();var filterWord=UM.filterWord=function(){function c(d){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/ig.test(d)}function a(d){d=d.replace(/[\d.]+\w+/g,function(e){return utils.transUnitToPx(e)});return d}function b(d){return d.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(j){if(browser.opera){return""}try{if(/Bitmap/i.test(j)){return""}var g=j.match(/width:([ \d.]*p[tx])/i)[1],f=j.match(/height:([ \d.]*p[tx])/i)[1],i=j.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+a(g)+'" height="'+a(f)+'" src="'+i+'" />'}catch(h){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(h,e,f,g){return e=="class"&&g=="MsoListParagraph"?h:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(f,e,g){return g.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(l,q,j,f){var g=[],p=f.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g);for(var k=0,o;o=p[k];k++){var e,m,h=o.split(":");if(h.length==2){e=h[0].toLowerCase();m=h[1].toLowerCase();if(/^(background)\w*/.test(e)&&m.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(e)&&/^0\w+$/.test(m)){continue}switch(e){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":if(!/<table/.test(q)){g[k]=e.replace(/^mso-|-alt$/g,"")+":"+a(m)}continue;case"horiz-align":g[k]="text-align:"+m;continue;case"vert-align":g[k]="vertical-align:"+m;continue;case"font-color":case"mso-foreground":g[k]="color:"+m;continue;case"mso-background":case"mso-highlight":g[k]="background:"+m;continue;case"mso-default-height":g[k]="min-height:"+a(m);continue;case"mso-default-width":g[k]="min-width:"+a(m);continue;case"mso-padding-between-alt":g[k]="border-collapse:separate;border-spacing:"+a(m);continue;case"text-line-through":if((m=="single")||(m=="double")){g[k]="text-decoration:line-through"}continue;case"mso-zero-height":if(m=="yes"){g[k]="display:none"}continue;case"margin":if(!/[1-9]/.test(m)){continue}}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(e)||/text\-indent|padding|margin/.test(e)&&/\-[\d.]+/.test(m)){continue}g[k]=e+":"+h[1]}}return q+(g.length?' style="'+g.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(e){return utils.transUnitToPx(e)})}return function(d){return(c(d)?b(d):d)}}();(function(){var e=UM.uNode=function(o){this.type=o.type;this.data=o.data;this.tagName=o.tagName;this.parentNode=o.parentNode;this.attrs=o.attrs||{};this.children=o.children};var g={href:1,src:1,_src:1,_href:1,cdata_data:1};var j={style:1,script:1};var k="    ",i="\n";function c(o,q,p){o.push(i);return q+(p?1:-1)}function n(o,q){for(var p=0;p<q;p++){o.push(k)}}e.createElement=function(o){if(/[<>]/.test(o)){return UM.htmlparser(o).children[0]}else{return new e({type:"element",children:[],tagName:o})}};e.createText=function(p,o){return new UM.uNode({type:"text",data:o?p:utils.unhtml(p||"")})};function l(s,o,r,t){switch(s.type){case"root":for(var q=0,p;p=s.children[q++];){if(r&&p.type=="element"&&!dtd.$inlineWithA[p.tagName]&&q>1){c(o,t,true);n(o,t)}l(p,o,r,t)}break;case"text":f(s,o);break;case"element":h(s,o,r,t);break;case"comment":m(s,o,r)}return o}function f(p,o){if(p.parentNode.tagName=="pre"){o.push(p.data)}else{o.push(j[p.parentNode.tagName]?utils.html(p.data):p.data.replace(/[ ]{2}/g," &nbsp;"))}}function h(o,q,u,r){var s="";if(o.attrs){s=[];var v=o.attrs;for(var t in v){s.push(t+(v[t]!==undefined?'="'+(g[t]?utils.html(v[t]).replace(/["]/g,function(x){return"&quot;"}):utils.unhtml(v[t]))+'"':""))}s=s.join(" ")}q.push("<"+o.tagName+(s?" "+s:"")+(dtd.$empty[o.tagName]?"/":"")+">");if(u&&!dtd.$inlineWithA[o.tagName]&&o.tagName!="pre"){if(o.children&&o.children.length){r=c(q,r,true);n(q,r)}}if(o.children&&o.children.length){for(var p=0,w;w=o.children[p++];){if(u&&w.type=="element"&&!dtd.$inlineWithA[w.tagName]&&p>1){c(q,r);n(q,r)}l(w,q,u,r)}}if(!dtd.$empty[o.tagName]){if(u&&!dtd.$inlineWithA[o.tagName]&&o.tagName!="pre"){if(o.children&&o.children.length){r=c(q,r);n(q,r)}}q.push("</"+o.tagName+">")}}function m(p,o){o.push("<!--"+p.data+"-->")}function d(o,s){var r;if(o.type=="element"&&o.getAttr("id")==s){return o}if(o.children&&o.children.length){for(var q=0,p;p=o.children[q++];){if(r=d(p,s)){return r}}}}function b(s,r,o){if(s.type=="element"&&s.tagName==r){o.push(s)}if(s.children&&s.children.length){for(var q=0,p;p=s.children[q++];){b(p,r,o)}}}function a(o,r){if(o.children&&o.children.length){for(var q=0,p;p=o.children[q];){a(p,r);if(p.parentNode){if(p.children&&p.children.length){r(p)}if(p.parentNode){q++}}}}else{r(o)}}e.prototype={toHtml:function(p){var o=[];l(this,o,p,0);return o.join("")},innerHTML:function(p){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(utils.isString(p)){if(this.children){for(var r=0,q;q=this.children[r++];){q.parentNode=null}}this.children=[];var o=UM.htmlparser(p);for(var r=0,q;q=o.children[r++];){this.children.push(q);q.parentNode=this}return this}else{var o=new UM.uNode({type:"root",children:this.children});return o.toHtml()}},innerText:function(o,p){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(o){if(this.children){for(var r=0,q;q=this.children[r++];){q.parentNode=null}}this.children=[];this.appendChild(e.createText(o,p));return this}else{return this.toHtml().replace(/<[^>]+>/g,"")}},getData:function(){if(this.type=="element"){return""}return this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){var q=this.parentNode;for(var p=0,o;o=q.children[p];p++){if(o===this){return p==0?null:q.children[p-1]}}},nextSibling:function(){var q=this.parentNode;for(var p=0,o;o=q.children[p++];){if(o===this){return q.children[p]}}},replaceChild:function(r,q){if(this.children){if(r.parentNode){r.parentNode.removeChild(r)}for(var p=0,o;o=this.children[p];p++){if(o===q){this.children.splice(p,1,r);q.parentNode=null;r.parentNode=this;return r}}}},appendChild:function(q){if(this.type=="root"||(this.type=="element"&&!dtd.$empty[this.tagName])){if(!this.children){this.children=[]}if(q.parentNode){q.parentNode.removeChild(q)}for(var p=0,o;o=this.children[p];p++){if(o===q){this.children.splice(p,1);break}}this.children.push(q);q.parentNode=this;return q}},insertBefore:function(r,q){if(this.children){if(r.parentNode){r.parentNode.removeChild(r)}for(var p=0,o;o=this.children[p];p++){if(o===q){this.children.splice(p,0,r);r.parentNode=this;return r}}}},insertAfter:function(r,q){if(this.children){if(r.parentNode){r.parentNode.removeChild(r)}for(var p=0,o;o=this.children[p];p++){if(o===q){this.children.splice(p+1,0,r);r.parentNode=this;return r}}}},removeChild:function(s,t){if(this.children){for(var r=0,q;q=this.children[r];r++){if(q===s){this.children.splice(r,1);q.parentNode=null;if(t&&q.children&&q.children.length){for(var p=0,o;o=q.children[p];p++){this.children.splice(r+p,0,o);o.parentNode=this}}return q}}}},getAttr:function(o){return this.attrs&&this.attrs[o.toLowerCase()]},setAttr:function(q,p){if(!q){delete this.attrs;return}if(!this.attrs){this.attrs={}}if(utils.isObject(q)){for(var o in q){if(!q[o]){delete this.attrs[o]}else{this.attrs[o.toLowerCase()]=q[o]}}}else{if(!p){delete this.attrs[q]}else{this.attrs[q.toLowerCase()]=p}}},hasAttr:function(p){var o=this.getAttr(p);return(o!==null)&&(o!==undefined)},getIndex:function(){var q=this.parentNode;for(var p=0,o;o=q.children[p];p++){if(o===this){return p}}return -1},getNodeById:function(r){var q;if(this.children&&this.children.length){for(var p=0,o;o=this.children[p++];){if(q=d(o,r)){return q}}}},getNodesByTagName:function(p){p=utils.trim(p).replace(/[ ]{2,}/g," ").split(" ");var o=[],q=this;utils.each(p,function(t){if(q.children&&q.children.length){for(var s=0,r;r=q.children[s++];){b(r,t,o)}}});return o},getStyle:function(p){var r=this.getAttr("style");if(!r){return""}var q=new RegExp("(^|;)\\s*"+p+":([^;]+)","i");var o=r.match(q);if(o&&o[0]){return o[2]}return""},setStyle:function(q,r){function p(t,v){var u=new RegExp("(^|;)\\s*"+t+":([^;]+;?)","gi");s=s.replace(u,"$1");if(v){s=t+":"+utils.unhtml(v)+";"+s}}var s=this.getAttr("style");if(!s){s=""}if(utils.isObject(q)){for(var o in q){p(o,q[o])}}else{p(q,r)}this.setAttr("style",utils.trim(s))},hasClass:function(p){if(this.hasAttr("class")){var q=this.getAttr("class").split(/\s+/),o=false;$.each(q,function(r,s){if(s===p){o=true}});return o}else{return false}},addClass:function(q){var p=null,o=false;if(this.hasAttr("class")){p=this.getAttr("class");p=p.split(/\s+/);p.forEach(function(r){if(r===q){o=true;return}});!o&&p.push(q);this.setAttr("class",p.join(" "))}else{this.setAttr("class",q)}},removeClass:function(p){if(this.hasAttr("class")){var o=this.getAttr("class");o=o.replace(new RegExp("\\b"+p+"\\b","g"),"");this.setAttr("class",utils.trim(o).replace(/[ ]{2,}/g," "))}},traversal:function(o){if(this.children&&this.children.length){a(this,o)}return this}}})();var htmlparser=UM.htmlparser=function(c,q){var k=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,p=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g;var j={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};c=c.replace(new RegExp(domUtils.fillChar,"g"),"");if(!q){c=c.replace(new RegExp("[\\r\\t\\n"+(q?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(q?"":" ")+"]*","g"),function(u,e){if(e&&j[e.toLowerCase()]){return u.replace(/(^[\n\r]+)|([\n\r]+$)/g,"")}return u.replace(new RegExp("^[\\r\\n"+(q?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(q?"":" ")+"]+$"),"")})}var s={href:1,src:1};var d=UM.uNode,m={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},n={ol:"li",ul:"li"};function l(u,v){if(n[u.tagName]){var e=d.createElement(n[u.tagName]);u.appendChild(e);e.appendChild(d.createText(v));u=e}else{u.appendChild(d.createText(v))}}function f(y,u,z){var e;if(e=m[u]){var v=y,B;while(v.type!="root"){if(utils.isArray(e)?utils.indexOf(e,v.tagName)!=-1:e==v.tagName){y=v;B=true;break}v=v.parentNode}if(!B){y=f(y,utils.isArray(e)?e[0]:e)}}var x=new d({parentNode:y,type:"element",tagName:u.toLowerCase(),children:dtd.$empty[u]?null:[]});if(z){var A={},w;while(w=p.exec(z)){A[w[1].toLowerCase()]=s[w[1].toLowerCase()]?(w[2]||w[3]||w[4]):utils.unhtml(w[2]||w[3]||w[4])}x.attrs=A}y.children.push(x);return dtd.$empty[u]?y:x}function b(e,u){e.children.push(new d({type:"comment",data:u,parentNode:e}))}var h,a=0,i=0;var o=new d({type:"root",children:[]});var t=o;while(h=k.exec(c)){a=h.index;try{if(a>i){l(t,c.slice(i,a))}if(h[3]){if(dtd.$cdata[t.tagName]){l(t,h[0])}else{t=f(t,h[3].toLowerCase(),h[4])}}else{if(h[1]){if(t.type!="root"){if(dtd.$cdata[t.tagName]&&!dtd.$cdata[h[1]]){l(t,h[0])}else{var g=t;while(t.type=="element"&&t.tagName!=h[1].toLowerCase()){t=t.parentNode;if(t.type=="root"){t=g;throw"break"}}t=t.parentNode}}}else{if(h[2]){b(t,h[2])}}}}catch(r){}i=k.lastIndex}if(i<c.length){l(t,c.slice(i))}return o};var filterNode=UM.filterNode=function(){function a(e,m){switch(e.type){case"text":break;case"element":var c;if(c=m[e.tagName]){if(c==="-"){e.parentNode.removeChild(e)}else{if(utils.isFunction(c)){var h=e.parentNode,j=e.getIndex();c(e);if(e.parentNode){if(e.children){for(var f=0,n;n=e.children[f];){a(n,m);if(n.parentNode){f++}}}}else{for(var f=j,n;n=h.children[f];){a(n,m);if(n.parentNode){f++}}}}else{var l=c["$"];if(l&&e.attrs){var d={},b;for(var k in l){b=e.getAttr(k);if(k=="style"&&utils.isArray(l[k])){var g=[];utils.each(l[k],function(i){var o;if(o=e.getStyle(i)){g.push(i+":"+o)}});b=g.join(";")}if(b){d[k]=b}}e.attrs=d}if(e.children){for(var f=0,n;n=e.children[f];){a(n,m);if(n.parentNode){f++}}}}}}else{if(dtd.$cdata[e.tagName]){e.parentNode.removeChild(e)}else{var h=e.parentNode,j=e.getIndex();e.parentNode.removeChild(e,true);for(var f=j,n;n=h.children[f];){a(n,m);if(n.parentNode){f++}}}}break;case"comment":e.parentNode.removeChild(e)}}return function(b,f){if(utils.isEmptyObject(f)){return b}var e;if(e=f["-"]){utils.each(e.split(" "),function(g){f[g]="-"})}for(var d=0,c;c=b.children[d];){a(c,f);if(c.parentNode){d++}}return b}}();(function(){var b={},d={},c=[],h=null,f={},g={},a={},e=null;utils.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(i,j){utils.each(i.split(/\s+/),function(k){b[k]=j})},setEditor:function(i){!d[i.id]&&(d[i.id]=i)},registerWidget:function(j,k,i){f[j]=$.extend2(k,{$root:"",_preventDefault:false,root:function(l){return this.$root||(this.$root=l)},preventDefault:function(){this._preventDefault=true},clear:false});if(i){g[j]=i}},getWidgetData:function(i){return f[i]},setWidgetBody:function(i,l,j){if(!j._widgetData){utils.extend(j,{_widgetData:{},getWidgetData:function(m){return this._widgetData[m]},getWidgetCallback:function(n){var m=this;return function(){return g[n].apply(m,[m,l].concat(Array.prototype.slice.call(arguments,0)))}}})}var k=f[i];if(!k){return null}k=j._widgetData[i];if(!k){k=f[i];k=j._widgetData[i]=$.type(k)=="function"?k:utils.clone(k)}k.root(l.edui().getBodyContainer());k.initContent(j,l);if(!k._preventDefault){k.initEvent(j,l)}k.width&&l.width(k.width)},setActiveWidget:function(i){h=i},getEditor:function(k,i){var j=d[k]||(d[k]=this.createEditor(k,i));e=e?Math.max(j.getOpt("zIndex"),e):j.getOpt("zIndex");return j},setTopEditor:function(i){$.each(d,function(j,k){if(i==k){i.$container&&i.$container.css("zIndex",e+1)}else{k.$container&&k.$container.css("zIndex",k.getOpt("zIndex"))}})},clearCache:function(i){if(d[i]){delete d[i]}},delEditor:function(j){var i;if(i=d[j]){i.destroy()}},ready:function(i){c.push(i)},createEditor:function(m,j){var l=new UM.Editor(j);var i=this;l.langIsReady?$.proxy(k,i)():l.addListener("langReady",$.proxy(k,i));function k(){var o=this.createUI("#"+m,l);l.key=m;l.ready(function(){$.each(c,function(p,q){$.proxy(q,l)()})});var n=l.options;if(n.initialFrameWidth){n.minFrameWidth=n.initialFrameWidth}else{n.minFrameWidth=n.initialFrameWidth=l.$body.width()||UM.defaultWidth}o.css({width:n.initialFrameWidth,zIndex:l.getOpt("zIndex")});UM.browser.ie&&UM.browser.version===6&&document.execCommand("BackgroundImageCache",false,true);l.render(m);$.eduitooltip&&$.eduitooltip("attachTo",$("[data-original-title]",o)).css("z-index",l.getOpt("zIndex")+1);o.find("a").click(function(p){p.preventDefault()});l.fireEvent("afteruiready")}return l},createUI:function(m,k){var j=$(m),l=$('<div class="edui-container"><div class="edui-editor-body"></div></div>').insertBefore(j);k.$container=l;k.container=l[0];k.$body=j;if(browser.ie&&browser.ie9above){var i=$('<span style="padding:0;margin:0;height:0;width:0"></span>');i.insertAfter(l)}$.each(b,function(q,o){var p=o.call(k,q);if(p){a[q]=p}});l.find(".edui-editor-body").append(j).before(this.createToolbar(k.options,k));l.find(".edui-toolbar").append($('<div class="edui-dialog-container"></div>'));return l},createToolbar:function(j,k){var i=$.eduitoolbar(),m=i.edui();if(j.toolbar&&j.toolbar.length){var l=[];$.each(j.toolbar,function(n,o){$.each(o.split(/\s+/),function(q,p){if(p=="|"){$.eduiseparator&&l.push($.eduiseparator())}else{var r=a[p];if(p=="fullscreen"){r&&l.unshift(r)}else{r&&l.push(r)}}});l.length&&m.appendToBtnmenu(l)})}else{i.find(".edui-btn-toolbar").remove()}return i}})})();UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(a){var c=this;var b=$.eduibutton({icon:a,click:function(){c.execCommand(a)},title:this.getLang("labelMap")[a]||""});this.addListener("selectionchange",function(){var d=this.queryCommandState(a);b.edui().disabled(d==-1).active(d==1)});return b});(function(){var c={},f=["width","height","position","top","left","margin","padding","overflowX","overflowY"],a={},d={},e={},g={};UM.registerUI("fullscreen",function(h){var i=this,j=$.eduibutton({icon:"fullscreen",title:(i.options.labelMap&&i.options.labelMap[h])||i.getLang("labelMap."+h),click:function(){i.execCommand(h);UM.setTopEditor(i)}});i.addListener("selectionchange",function(){var k=this.queryCommandState(h);j.edui().disabled(k==-1).active(k==1)});i.addListener("ready",function(){i.options.fullscreen&&b.getInstance(i).toggle()});return j});UM.commands.fullscreen={execCommand:function(h){b.getInstance(this).toggle()},queryCommandState:function(h){return this._edui_fullscreen_status},notNeedUndo:1};function b(h){var i=this;if(!h){throw new Error("invalid params, notfound editor")}i.editor=h;g[h.uid]=this;h.addListener("destroy",function(){delete g[h.uid];i.editor=null})}b.prototype={toggle:function(){var i=this.editor,h=this.isFullState();i.fireEvent("beforefullscreenchange",!h);this.update(!h);!h?this.enlarge():this.revert();i.fireEvent("afterfullscreenchange",!h);if(i.body.contentEditable==="true"){i.fireEvent("fullscreenchanged",!h)}i.fireEvent("selectionchange")},enlarge:function(){this.saveSataus();this.setDocumentStatus();this.resize()},revert:function(){var i=this.editor.options,h=/%$/.test(i.initialFrameHeight)?"100%":(i.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width"));$.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+h+' ? "'+h+'px" : "auto"');this.revertContainerStatus();this.revertContentAreaStatus();this.revertDocumentStatus()},update:function(h){this.editor._edui_fullscreen_status=h},resize:function(){var j=null,p=0,i=0,h=0,l=0,m=this.editor,n=this,k=null,o=null;if(!this.isFullState()){return}j=$(window);i=j.width();p=j.height();o=this.getEditorHolder();h=parseInt(domUtils.getComputedStyle(o,"border-width"),10)||0;h+=parseInt(domUtils.getComputedStyle(m.container,"border-width"),10)||0;l+=parseInt(domUtils.getComputedStyle(o,"padding-left"),10)+parseInt(domUtils.getComputedStyle(o,"padding-right"),10)||0;$.IE6&&o.style.setExpression("height",null);k=this.getBound();$(m.container).css({width:i+"px",height:p+"px",position:!$.IE6?"fixed":"absolute",top:k.top,left:k.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"});$(o).css({width:i-2*h-l+"px",height:p-2*h-(m.options.withoutToolbar?0:$(".edui-toolbar",m.container).outerHeight())-$(".edui-bottombar",m.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"})},saveSataus:function(){var m=this.editor.container.style,l=null,j={};for(var k=0,h=f.length;k<h;k++){l=f[k];j[l]=m[l]}c[this.editor.uid]=j;this.saveContentAreaStatus();this.saveDocumentStatus()},saveContentAreaStatus:function(){var h=$(this.getEditorHolder());a[this.editor.uid]={width:h.css("width"),overflowX:h.css("overflowX"),overflowY:h.css("overflowY"),height:h.css("height")}},saveDocumentStatus:function(){var h=$(this.getEditorDocumentBody());d[this.editor.uid]={overflowX:h.css("overflowX"),overflowY:h.css("overflowY")};e[this.editor.uid]={overflowX:$(this.getEditorDocumentElement()).css("overflowX"),overflowY:$(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){$(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var h=this.getEditorHolder(),i=this.getContentAreaStatus();if(this.supportMin()){delete i.height;h.style.height=null}$(h).css(i)},revertDocumentStatus:function(){var h=this.getDocumentStatus();$(this.getEditorDocumentBody()).css("overflowX",h.body.overflowX);$(this.getEditorDocumentElement()).css("overflowY",h.html.overflowY)},setDocumentStatus:function(){$(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"});$(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return !!this.editor._edui_fullscreen_status},getEditorStatus:function(){return c[this.editor.uid]},getContentAreaStatus:function(){return a[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:d[this.editor.uid],html:e[this.editor.uid]}},supportMin:function(){var h=null;if(!this._support){h=document.createElement("div");this._support="minWidth" in h.style;h=null}return this._support},getBound:function(){var i={html:true,body:true},h={top:0,left:0},j=null;if(!$.IE6){return h}j=this.editor.container.offsetParent;if(j&&!i[j.nodeName.toLowerCase()]){i=j.getBoundingClientRect();h.top=-i.top;h.left=-i.left}return h},getStyleValue:function(h){return parseInt(domUtils.getComputedStyle(this.getEditorHolder(),h))}};$.extend(b,{listen:function(){var h=null;if(b._hasFullscreenListener){return}b._hasFullscreenListener=true;$(window).on("resize",function(){if(h!==null){window.clearTimeout(h);h=null}h=window.setTimeout(function(){for(var i in g){g[i].resize()}h=null},50)})},getInstance:function(h){if(!g[h.uid]){new b(h)}return g[h.uid]}});b.listen()})();UM.registerUI("link image video map formula",function(b){var e=this,a,f,c={title:(e.options.labelMap&&e.options.labelMap[b])||e.getLang("labelMap."+b),url:e.options.UMEDITOR_HOME_URL+"dialogs/"+b+"/"+b+".js"};var d=$.eduibutton({icon:b,title:this.getLang("labelMap")[b]||""});utils.loadFile(document,{src:c.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var i=UM.getWidgetData(b);if(!i){return}if(i.buttons){var g=i.buttons.ok;if(g){c.oklabel=g.label||e.getLang("ok");if(g.exec){c.okFn=function(){return $.proxy(g.exec,null,e,f)()}}}var h=i.buttons.cancel;if(h){c.cancellabel=h.label||e.getLang("cancel");if(h.exec){c.cancelFn=function(){return $.proxy(h.exec,null,e,f)()}}}}i.width&&(c.width=i.width);i.height&&(c.height=i.height);f=$.eduimodal(c);f.attr("id","edui-dialog-"+b).addClass("edui-dialog-"+b).find(".edui-modal-body").addClass("edui-dialog-"+b+"-body");f.edui().on("beforehide",function(){var j=e.selection.getRange();if(j.equals(a)){j.select()}}).on("beforeshow",function(){var k=this.root(),j=null,l=null;a=e.selection.getRange();if(!k.parent()[0]){e.$container.find(".edui-dialog-container").append(k)}if($.IE6){j={width:$(window).width(),height:$(window).height()};l=k.parents(".edui-toolbar")[0].getBoundingClientRect();k.css({position:"absolute",margin:0,left:(j.width-k.width())/2-l.left,top:100-l.top})}UM.setWidgetBody(b,f,e);UM.setTopEditor(e)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",e.getOpt("zIndex")+1).appendTo(e.$container.find(".edui-dialog-container"));f.css("zIndex",e.getOpt("zIndex")+2)}).on("beforeok",function(){try{a.select()}catch(j){}}).attachTo(d)});e.addListener("selectionchange",function(){var g=this.queryCommandState(b);d.edui().disabled(g==-1).active(g==1)});return d});UM.registerUI("emotion formula",function(b){var d=this,a=d.options.UMEDITOR_HOME_URL+"dialogs/"+b+"/"+b+".js";var c=$.eduibutton({icon:b,title:this.getLang("labelMap")[b]||""});utils.loadFile(document,{src:a,tag:"script",type:"text/javascript",defer:"defer"},function(){var e={url:a};var f=UM.getWidgetData(b);f.width&&(e.width=f.width);f.height&&(e.height=f.height);$.eduipopup(e).css("zIndex",d.options.zIndex+1).addClass("edui-popup-"+b).edui().on("beforeshow",function(){var g=this.root();if(!g.parent().length){d.$container.find(".edui-dialog-container").append(g)}UM.setWidgetBody(b,g,d);UM.setTopEditor(d)}).attachTo(c,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8});d.addListener("selectionchange",function(){var g=this.queryCommandState(b);c.edui().disabled(g==-1).active(g==1)})});return c});UM.registerUI("imagescale",function(){var a=this,b;a.setOpt("imageScaleEnabled",true);if(browser.webkit&&a.getOpt("imageScaleEnabled")){a.addListener("click",function(h,j){var f=a.selection.getRange(),d=f.getClosedNode(),i=j.target;if(d&&d.tagName=="IMG"&&i==d){if(!b){b=$.eduiscale({"$wrap":a.$container}).css("zIndex",a.options.zIndex);a.$container.append(b);var g=function(){b.edui().hide()},c=function(m){var l=m.target||m.srcElement;if(l&&l.className.indexOf("edui-scale")==-1){g(m)}},k;b.edui().on("aftershow",function(){$(document).bind("keydown",g);$(document).bind("mousedown",c);a.selection.getNative().removeAllRanges()}).on("afterhide",function(){$(document).unbind("keydown",g);$(document).unbind("mousedown",c);var e=b.edui().getScaleTarget();if(e.parentNode){a.selection.getRange().selectNode(e).select()}}).on("mousedown",function(m){a.selection.getNative().removeAllRanges();var l=m.target||m.srcElement;if(l&&l.className.indexOf("edui-scale-hand")==-1){k=setTimeout(function(){b.edui().hide()},200)}}).on("mouseup",function(m){var l=m.target||m.srcElement;if(l&&l.className.indexOf("edui-scale-hand")==-1){clearTimeout(k)}})}b.edui().show($(d))}else{if(b&&b.css("display")!="none"){b.edui().hide()}}});a.addListener("click",function(d,f){if(f.target.tagName=="IMG"){var c=new dom.Range(a.document,a.body);c.selectNode(f.target).select()}})}});UM.registerUI("autofloat",function(){var c=this,d=c.getLang();c.setOpt({autoFloatEnabled:true,topOffset:0});var a=c.options.autoFloatEnabled!==false,b=c.options.topOffset;if(!a){return}c.ready(function(){var h=browser.ie&&browser.version<=6,j=browser.quirks;function k(){if(!UM.ui){alert(d.autofloatMsg);return 0}return 1}function n(){var s=document.body.style;s.backgroundImage='url("about:blank")';s.backgroundAttachment="fixed"}var o,l=document.createElement("div"),m,f,r=function(s){var w;try{w=s.getBoundingClientRect()}catch(v){w={left:0,top:0,height:0,width:0}}var t={left:Math.round(w.left),top:Math.round(w.top),height:Math.round(w.bottom-w.top),width:Math.round(w.right-w.left)};var u;while((u=s.ownerDocument)!==document&&(s=domUtils.getWindow(u).frameElement)){w=s.getBoundingClientRect();t.left+=w.left;t.top+=w.top}t.bottom=t.top+t.height;t.right=t.left+t.width;return t};var i=false;function q(){if(i){return}var t=domUtils.getXY(m),s=domUtils.getComputedStyle(m,"position"),u=domUtils.getComputedStyle(m,"left");m.style.width=m.offsetWidth+"px";m.style.zIndex=c.options.zIndex*1+1;m.parentNode.insertBefore(l,m);if(h||(j&&browser.ie)){if(m.style.position!="absolute"){m.style.position="absolute"}m.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-f+b+"px"}else{if(m.style.position!="fixed"){m.style.position="fixed";m.style.top=b+"px";((s=="absolute"||s=="relative")&&parseFloat(u))&&(m.style.left=t.x+"px")}}}function g(){if(l.parentNode){l.parentNode.removeChild(l)}m.style.cssText=o}function p(){var s=r(c.container);var t=c.options.toolbarTopOffset||0;if(s.top<0&&s.bottom-m.offsetHeight>t){q()}else{g()}}var e=utils.defer(function(){p()},browser.ie?200:100,true);c.addListener("destroy",function(){$(window).off("scroll resize",p);c.removeListener("keydown",e)});if(k(c)){m=$(".edui-toolbar",c.container)[0];c.addListener("afteruiready",function(){setTimeout(function(){f=$(m).offset().top},100)});o=m.style.cssText;l.style.height=m.offsetHeight+"px";if(h){n()}$(window).on("scroll resize",p);c.addListener("keydown",e);c.addListener("resize",function(){g();l.style.height=m.offsetHeight+"px";p()});c.addListener("beforefullscreenchange",function(u,s){if(s){g();i=s}});c.addListener("fullscreenchanged",function(u,s){if(!s){p()}i=s});c.addListener("sourcemodechanged",function(u,s){setTimeout(function(){p()},0)});c.addListener("clearDoc",function(){setTimeout(function(){p()},0)})}})});UM.registerUI("source",function(a){var c=this;c.addListener("fullscreenchanged",function(){c.$container.find("textarea").width(c.$body.width()-10).height(c.$body.height())});var b=$.eduibutton({icon:a,click:function(){c.execCommand(a);UM.setTopEditor(c)},title:this.getLang("labelMap")[a]||""});this.addListener("selectionchange",function(){var d=this.queryCommandState(a);b.edui().disabled(d==-1).active(d==1)});return b});UM.registerUI("paragraph fontfamily fontsize",function(a){var h=this,i=(h.options.labelMap&&h.options.labelMap[a])||h.getLang("labelMap."+a),j={label:i,title:i,comboboxName:a,items:h.options[a]||[],itemStyles:[],value:[],autowidthitem:[]},g=null,f=null;if(j.items.length==0){return null}switch(a){case"paragraph":j=e(j);break;case"fontfamily":j=c(j);break;case"fontsize":j=b(j);break}g=$.eduibuttoncombobox(j).css("zIndex",h.getOpt("zIndex")+1);f=g.edui();f.on("comboboxselect",function(k,l){h.execCommand(a,l.value)}).on("beforeshow",function(){if(g.parent().length===0){g.appendTo(h.$container.find(".edui-dialog-container"))}UM.setTopEditor(h)});this.addListener("selectionchange",function(k){var m=this.queryCommandState(a),l=this.queryCommandValue(a);f.button().edui().disabled(m==-1).active(m==1);if(l){l=l.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/);f.selectItemByLabel(l)}});return f.button().addClass("edui-combobox");function d(n,l){var k=$("<span>").html(n).css({display:"inline",position:"absolute",top:-10000000,left:-100000}).appendTo(document.body),m=k.width();k.remove();k=null;if(m<50){return n}else{n=n.slice(0,l?-4:-1);if(!n.length){return"..."}return d(n+"...",true)}}function e(l){var k=[];for(var m in l.items){l.value.push(m);k.push(m);l.autowidthitem.push(d(m))}l.items=k;l.autoRecord=false;return l}function c(n){var m=null,l=[];for(var o=0,k=n.items.length;o<k;o++){m=n.items[o].val;l.push(m.split(/\s*,\s*/)[0]);n.itemStyles.push("font-family: "+m);n.value.push(m);n.autowidthitem.push(d(l[o]))}n.items=l;return n}function b(n){var m=null,l=[];n.itemStyles=[];n.value=[];for(var o=0,k=n.items.length;o<k;o++){m=n.items[o];l.push(m);n.itemStyles.push("font-size: "+m+"px")}n.value=n.items;n.items=l;n.autoRecord=false;return n}});UM.registerUI("forecolor backcolor",function(b){function a(){return domUtils.getComputedStyle(f[0],"background-color")}var e=this,c=null,f=null,d=null;this.addListener("selectionchange",function(){var g=this.queryCommandState(b);d.edui().disabled(g==-1).active(g==1)});d=$.eduicolorsplitbutton({icon:b,caret:true,name:b,title:e.getLang("labelMap")[b],click:function(){e.execCommand(b,a())}});f=d.edui().colorLabel();c=$.eduicolorpicker({name:b,lang_clearColor:e.getLang("clearColor")||"",lang_themeColor:e.getLang("themeColor")||"",lang_standardColor:e.getLang("standardColor")||""}).on("pickcolor",function(g,h){window.setTimeout(function(){f.css("backgroundColor",h);e.execCommand(b,h)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",e.getOpt("zIndex")+1);d.edui().on("arrowclick",function(){if(!c.parent().length){e.$container.find(".edui-dialog-container").append(c)}c.edui().show(d,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8});UM.setTopEditor(e)}).register("click",d,function(){c.edui().hide()});return d});UM.commands.inserthtml={execCommand:function(b,h,o){var u=this,j,k;if(!h){return}if(u.fireEvent("beforeinserthtml",h)===true){return}j=u.selection.getRange();k=j.document.createElement("div");k.style.display="inline";if(!o){var q=UM.htmlparser(h);if(u.options.filterRules){UM.filterNode(q,u.options.filterRules)}u.filterInputRule(q);h=q.toHtml()}k.innerHTML=utils.trim(h);if(!j.collapsed){var t=j.startContainer;if(domUtils.isFillChar(t)){j.setStartBefore(t)}t=j.endContainer;if(domUtils.isFillChar(t)){j.setEndAfter(t)}j.txtToElmBoundary();if(j.endContainer&&j.endContainer.nodeType==1){t=j.endContainer.childNodes[j.endOffset];if(t&&domUtils.isBr(t)){j.setEndAfter(t)}}if(j.startOffset==0){t=j.startContainer;if(domUtils.isBoundaryNode(t,"firstChild")){t=j.endContainer;if(j.endOffset==(t.nodeType==3?t.nodeValue.length:t.childNodes.length)&&domUtils.isBoundaryNode(t,"lastChild")){u.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";j.setStart(u.body.firstChild,0).collapse(true)}}}!j.collapsed&&j.deleteContents();if(j.startContainer.nodeType==1){var f=j.startContainer.childNodes[j.startOffset],l;if(f&&domUtils.isBlockElm(f)&&(l=f.previousSibling)&&domUtils.isBlockElm(l)){j.setEnd(l,l.childNodes.length).collapse();while(f.firstChild){l.appendChild(f.firstChild)}domUtils.remove(f)}}}var f,g,l,s,d=0,a;if(j.inFillChar()){f=j.startContainer;if(domUtils.isFillChar(f)){j.setStartBefore(f).collapse(true);domUtils.remove(f)}else{if(domUtils.isFillChar(f,true)){f.nodeValue=f.nodeValue.replace(fillCharReg,"");j.startOffset--;j.collapsed&&j.collapse(true)}}}while(f=k.firstChild){if(d){var m=u.document.createElement("p");while(f&&(f.nodeType==3||!dtd.$block[f.tagName])){a=f.nextSibling;m.appendChild(f);f=a}if(m.firstChild){f=m}}j.insertNode(f);a=f.nextSibling;if(!d&&f.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(f)){g=domUtils.findParent(f,function(e){return domUtils.isBlockElm(e)});if(g&&g.tagName.toLowerCase()!="body"&&!(dtd[g.tagName][f.nodeName]&&f.parentNode===g)){if(!dtd[g.tagName][f.nodeName]){l=g}else{s=f.parentNode;while(s!==g){l=s;s=s.parentNode}}domUtils.breakParent(f,l||s);var l=f.previousSibling;domUtils.trimWhiteTextNode(l);if(!l.childNodes.length){domUtils.remove(l)}if(!browser.ie&&(n=f.nextSibling)&&domUtils.isBlockElm(n)&&n.lastChild&&!domUtils.isBr(n.lastChild)){n.appendChild(u.document.createElement("br"))}d=1}}var n=f.nextSibling;if(!k.firstChild&&n&&domUtils.isBlockElm(n)){j.setStart(n,0).collapse(true);break}j.setEndAfter(f).collapse()}f=j.startContainer;if(a&&domUtils.isBr(a)){domUtils.remove(a)}if(domUtils.isBlockElm(f)&&domUtils.isEmptyNode(f)){if(a=f.nextSibling){domUtils.remove(f);if(a.nodeType==1&&dtd.$block[a.tagName]){j.setStart(a,0).collapse(true).shrinkBoundary()}}else{try{f.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(r){j.setStartBefore(f);domUtils.remove(f)}}}try{if(browser.ie9below&&j.startContainer.nodeType==1&&!j.startContainer.childNodes[j.startOffset]){var c=j.startContainer,l=c.childNodes[j.startOffset-1];if(l&&l.nodeType==1&&dtd.$empty[l.tagName]){var i=this.document.createTextNode(domUtils.fillChar);j.insertNode(i).setStart(i,0).collapse(true)}}setTimeout(function(){j.select(true)})}catch(r){}setTimeout(function(){j=u.selection.getRange();j.scrollIntoView();u.fireEvent("afterinserthtml")},200)}};UM.commands.insertimage={execCommand:function(f,d){d=utils.isArray(d)?d:[d];if(!d.length){return}var e=this;var c=[],g="",b;b=d[0];if(d.length==1){g='<img src="'+b.src+'" '+(b._src?' _src="'+b._src+'" ':"")+(b.width?'width="'+b.width+'" ':"")+(b.height?' height="'+b.height+'" ':"")+(b.floatStyle=="left"||b.floatStyle=="right"?' style="float:'+b.floatStyle+';"':"")+(b.title&&b.title!=""?' title="'+b.title+'"':"")+(b.border&&b.border!="0"?' border="'+b.border+'"':"")+(b.alt&&b.alt!=""?' alt="'+b.alt+'"':"")+(b.hspace&&b.hspace!="0"?' hspace = "'+b.hspace+'"':"")+(b.vspace&&b.vspace!="0"?' vspace = "'+b.vspace+'"':"")+"/>";if(b.floatStyle=="center"){g='<p style="text-align: center">'+g+"</p>"}c.push(g)}else{for(var a=0;b=d[a++];){g="<p "+(b.floatStyle=="center"?'style="text-align: center" ':"")+'><img src="'+b.src+'" '+(b.width?'width="'+b.width+'" ':"")+(b._src?' _src="'+b._src+'" ':"")+(b.height?' height="'+b.height+'" ':"")+' style="'+(b.floatStyle&&b.floatStyle!="center"?"float:"+b.floatStyle+";":"")+(b.border||"")+'" '+(b.title?' title="'+b.title+'"':"")+" /></p>";c.push(g)}}e.execCommand("insertHtml",c.join(""),true)}};UM.plugins.justify=function(){var a=this;$.each("justifyleft justifyright justifycenter justifyfull".split(" "),function(c,b){a.commands[b]={execCommand:function(d){return this.document.execCommand(d)},queryCommandValue:function(d){var e=this.document.queryCommandValue(d);return e===true||e==="true"?d.replace(/justify/,""):""},queryCommandState:function(d){return this.document.queryCommandState(d)?1:0}}})};UM.plugins.font=function(){var c=this,e={forecolor:"forecolor",backcolor:"backcolor",fontsize:"fontsize",fontfamily:"fontname"},a={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},b={forecolor:"color",fontsize:"size",fontfamily:"face"};c.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],fontsize:[10,12,16,18,24,32,48]});c.addOutputRule(function(f){utils.each(f.getNodesByTagName("font"),function(g){if(g.tagName=="font"){var j=[];for(var h in g.attrs){switch(h){case"size":var i=g.attrs[h];$.each({"10":"1","12":"2","16":"3","18":"4","24":"5","32":"6","48":"7"},function(m,l){if(l==i){i=m;return false}});j.push("font-size:"+i+"px");break;case"color":j.push("color:"+g.attrs[h]);break;case"face":j.push("font-family:"+g.attrs[h]);break;case"style":j.push(g.attrs[h])}}g.attrs={style:j.join(";")}}g.tagName="span";if(g.parentNode.tagName=="span"&&g.parentNode.children.length==1){$.each(g.attrs,function(m,l){g.parentNode.attrs[m]=m=="style"?g.parentNode.attrs[m]+l:l});g.parentNode.removeChild(g,true)}})});for(var d in e){(function(f){c.commands[f]={execCommand:function(i,m){if(m=="transparent"){return}var h=this.selection.getRange();if(h.collapsed){var k=$("<span></span>").css(a[i],m)[0];h.insertNode(k).setStart(k,0).setCursor()}else{if(i=="fontsize"){m={"10":"1","12":"2","16":"3","18":"4","24":"5","32":"6","48":"7"}[(m+"").replace(/px/,"")]}this.document.execCommand(e[i],false,m);if(browser.gecko){$.each(this.$body.find("a"),function(p,n){var q=n.parentNode;if(q.lastChild===q.firstChild&&/FONT|SPAN/.test(q.tagName)){var o=q.cloneNode(false);o.innerHTML=n.innerHTML;$(n).html("").append(o).insertBefore(q);$(q).remove()}})}if(!browser.ie){var l=this.selection.getNative().getRangeAt(0);var j=l.commonAncestorContainer;var h=this.selection.getRange(),g=h.createBookmark(true);$(j).find("a").each(function(p,r){var q=r.parentNode;if(q.nodeName=="FONT"){var o=q.cloneNode(false);o.innerHTML=r.innerHTML;$(r).html("").append(o)}});h.moveToBookmark(g).select()}return true}},queryCommandValue:function(g){var i=c.selection.getStart();var h=$(i).css(a[g]);if(h===undefined){h=$(i).attr(b[g])}return h?utils.fixColor(g,h).replace(/px/,""):""},queryCommandState:function(g){return this.queryCommandValue(g)}}})(d)}};UM.plugins.link=function(){var a=this;a.setOpt("autourldetectinie",false);if(browser.ie&&this.options.autourldetectinie===false){this.addListener("keyup",function(e,c){var d=this,g=c.keyCode;if(g==13||g==32){var b=d.selection.getRange();var h=b.startContainer;if(g==13){if(h.nodeName=="P"){var f=h.previousSibling;if(f&&f.nodeType==1){var f=f.lastChild;if(f&&f.nodeName=="A"&&!f.getAttribute("_href")){domUtils.remove(f,true)}}}}else{if(g==32){if(h.nodeType==3&&/^\s$/.test(h.nodeValue)){h=h.previousSibling;if(h&&h.nodeName=="A"&&!h.getAttribute("_href")){domUtils.remove(h,true)}}}}}})}this.addOutputRule(function(b){$.each(b.getNodesByTagName("a"),function(e,d){var c=utils.html(d.getAttr("_href"));if(!/^(ftp|https?|\/|file)/.test(c)){c="http://"+c}d.setAttr("href",c);d.setAttr("_href");if(d.getAttr("title")==""){d.setAttr("title")}})});this.addInputRule(function(b){$.each(b.getNodesByTagName("a"),function(d,c){c.setAttr("_href",utils.html(c.getAttr("href")))})});a.commands.link={execCommand:function(c,d){var e=this;var b=e.selection.getRange();if(b.collapsed){var f=b.startContainer;if(f=domUtils.findParentByTagName(f,"a",true)){$(f).attr(d);b.selectNode(f).select()}else{b.insertNode($("<a>"+d.href+"</a>").attr(d)[0]).select()}}else{e.document.execCommand("createlink",false,"_umeditor_link");utils.each(domUtils.getElementsByTagName(e.body,"a",function(g){return g.getAttribute("href")=="_umeditor_link"}),function(g){if($(g).text()=="_umeditor_link"){$(g).text(d.href)}domUtils.setAttributes(g,d);b.selectNode(g).select()})}},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var c=this.selection.getStartElementPath();var b;$.each(c,function(d,e){if(e.nodeName=="A"){b=e;return false}});return b}};a.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}};UM.commands.print={execCommand:function(){var b=this,e="editor_print_"+ +new Date();$('<iframe src="" id="'+e+'" name="'+e+'" frameborder="0"></iframe>').attr("id",e).css({width:"0px",height:"0px",overflow:"hidden","float":"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(b.$container.find(".edui-dialog-container"));var a=window.open("",e,""),c=a.document;c.open();c.write("<html><head></head><body><div>"+this.getContent(null,null,true)+"</div><script>setTimeout(function(){window.print();setTimeout(function(){window.parent.$('#"+e+"').remove();},100);},200);<\/script></body></html>");c.close()},notNeedUndo:1};UM.plugins.paragraph=function(){var a=this;a.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""});a.commands.paragraph={execCommand:function(b,c){return this.document.execCommand("formatBlock",false,"<"+c+">")},queryCommandValue:function(){try{var c=this.document.queryCommandValue("formatBlock")}catch(b){}return c}}};UM.plugins.horizontal=function(){var a=this;a.commands.horizontal={execCommand:function(){this.document.execCommand("insertHorizontalRule");var b=a.selection.getRange().txtToElmBoundary(true),g=b.startContainer;if(domUtils.isBody(b.startContainer)){var e=b.startContainer.childNodes[b.startOffset];if(!e){e=$("<p></p>").appendTo(b.startContainer).html(browser.ie?"&nbsp;":"<br/>")[0]}b.setStart(e,0).setCursor()}else{while(dtd.$inline[g.tagName]&&g.lastChild===g.firstChild){var d=g.parentNode;d.appendChild(g.firstChild);d.removeChild(g);g=d}while(dtd.$inline[g.tagName]){g=g.parentNode}if(g.childNodes.length==1&&g.lastChild.nodeName=="HR"){var c=g.lastChild;$(c).insertBefore(g);b.setStart(g,0).setCursor()}else{c=$("hr",g)[0];domUtils.breakParent(c,g);var f=c.previousSibling;if(f&&domUtils.isEmptyBlock(f)){$(f).remove()}b.setStart(c.nextSibling,0).setCursor()}}}}};UM.commands.cleardoc={execCommand:function(){var b=this,a=b.selection.getRange();b.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>";a.setStart(b.body.firstChild,0).setCursor(false,true);setTimeout(function(){b.fireEvent("clearDoc")},0)}};UM.plugins.undo=function(){var d;var m=this,p=m.options.maxUndoCount||20,l=m.options.maxInputCount||20,g=new RegExp(domUtils.fillChar+"|</hr>","gi");var i={ol:1,ul:1,table:1,tbody:1,tr:1,body:1};var e=m.options.autoClearEmptyNode;function j(t,s){if(t.length!=s.length){return 0}for(var r=0,q=t.length;r<q;r++){if(t[r]!=s[r]){return 0}}return 1}function n(r,q){if(r.collapsed!=q.collapsed){return 0}if(!j(r.startAddress,q.startAddress)||!j(r.endAddress,q.endAddress)){return 0}return 1}function b(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content){this.index--;if(this.index==0){return this.restore(0)}}this.restore(--this.index)}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content){this.index++;if(this.index==this.list.length-1){return this.restore(this.index)}}this.restore(++this.index)}};this.restore=function(){var t=this.editor;var v=this.list[this.index];var r=UM.htmlparser(v.content.replace(g,""));t.options.autoClearEmptyNode=false;t.filterInputRule(r,true);t.options.autoClearEmptyNode=e;t.body.innerHTML=r.toHtml();t.fireEvent("afterscencerestore");if(browser.ie){utils.each(domUtils.getElementsByTagName(t.document,"td th caption p"),function(w){if(domUtils.isEmptyNode(w)){domUtils.fillNode(t.document,w)}})}try{var q=new dom.Range(t.document,t.body).moveToAddress(v.address);if(browser.ie&&q.collapsed&&q.startContainer.nodeType==1){var s=q.startContainer.childNodes[q.startOffset];if(!s||s.nodeType==1&&dtd.$empty[s]){q.insertNode(t.document.createTextNode(" ")).collapse(true)}}q.select(i[q.startContainer.nodeName.toLowerCase()])}catch(u){}this.update();this.clearKey();t.fireEvent("reset",true)};this.getScene=function(){var t=this.editor;var s=t.selection.getRange(),u=s.createAddress(false,true);t.fireEvent("beforegetscene");var r=UM.htmlparser(t.body.innerHTML,true);t.options.autoClearEmptyNode=false;t.filterOutputRule(r,true);t.options.autoClearEmptyNode=e;var q=r.toHtml();browser.ie&&(q=q.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">"));t.fireEvent("aftergetscene");return{address:u,content:q}};this.save=function(t,q){clearTimeout(d);var s=this.getScene(q),r=this.list[this.index];if(r&&r.content==s.content&&(t?1:n(r.address,s.address))){return}this.list=this.list.slice(0,this.index+1);this.list.push(s);if(this.list.length>p){this.list.shift()}this.index=this.list.length-1;this.clearKey();this.update()};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1]};this.reset=function(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.clearKey()};this.clearKey=function(){h=0;a=null}}m.undoManger=new b();m.undoManger.editor=m;function k(){this.undoManger.save()}m.addListener("saveScene",function(){var q=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,q)});m.addListener("beforeexeccommand",k);m.addListener("afterexeccommand",k);m.addListener("reset",function(r,q){if(!q){this.undoManger.reset()}});m.commands.redo=m.commands.undo={execCommand:function(q){this.undoManger[q]()},queryCommandState:function(q){return this.undoManger["has"+(q.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var o={16:1,17:1,18:1,37:1,38:1,39:1,40:1},h=0,a;var c=false;m.addListener("ready",function(){$(this.body).on("compositionstart",function(){c=true}).on("compositionend",function(){c=false})});m.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});var f=true;m.addListener("keydown",function(r,q){var t=this;var u=q.keyCode||q.which;if(!o[u]&&!q.ctrlKey&&!q.metaKey&&!q.shiftKey&&!q.altKey){if(c){return}if(!t.selection.getRange().collapsed){t.undoManger.save(false,true);f=false;return}if(t.undoManger.list.length==0){t.undoManger.save(true)}clearTimeout(d);function s(v){if(v.selection.getRange().collapsed){v.fireEvent("contentchange")}v.undoManger.save(false,true);v.fireEvent("selectionchange")}d=setTimeout(function(){if(c){var v=setInterval(function(){if(!c){s(t);clearInterval(v)}},300);return}s(t)},200);a=u;h++;if(h>=l){s(t)}}});m.addListener("keyup",function(r,q){var s=q.keyCode||q.which;if(!o[s]&&!q.ctrlKey&&!q.metaKey&&!q.shiftKey&&!q.altKey){if(c){return}if(!f){this.undoManger.save(false,true);f=true}}})};UM.plugins.paste=function(){function b(h){var f=this.document;if(f.getElementById("baidu_pastebin")){return}var e=this.selection.getRange(),d=e.createBookmark(),g=f.createElement("div");g.id="baidu_pastebin";browser.webkit&&g.appendChild(f.createTextNode(domUtils.fillChar+domUtils.fillChar));this.body.appendChild(g);d.start.style.display="";g.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+$(d.start).position().top+"px";e.selectNodeContents(g).select(true);setTimeout(function(){if(browser.webkit){for(var j=0,k=f.querySelectorAll("#baidu_pastebin"),m;m=k[j++];){if(domUtils.isEmptyNode(m)){domUtils.remove(m)}else{g=m;break}}}try{g.parentNode.removeChild(g)}catch(l){}e.moveToBookmark(d).select(true);h(g)},0)}var c=this;function a(d){var j;if(d.firstChild){var e=domUtils.getElementsByTagName(d,"span");for(var h=0,f;f=e[h++];){if(f.id=="_baidu_cut_start"||f.id=="_baidu_cut_end"){domUtils.remove(f)}}if(browser.webkit){var n=d.querySelectorAll("div br");for(var h=0,g;g=n[h++];){var o=g.parentNode;if(o.tagName=="DIV"&&o.childNodes.length==1){o.innerHTML="<p><br/></p>";domUtils.remove(o)}}var p=d.querySelectorAll("#baidu_pastebin");for(var h=0,m;m=p[h++];){var u=c.document.createElement("p");m.parentNode.insertBefore(u,m);while(m.firstChild){u.appendChild(m.firstChild)}domUtils.remove(m)}var l=d.querySelectorAll("meta");for(var h=0,t;t=l[h++];){domUtils.remove(t)}var n=d.querySelectorAll("br");for(h=0;t=n[h++];){if(/^apple-/i.test(t.className)){domUtils.remove(t)}}}if(browser.gecko){var s=d.querySelectorAll("[_moz_dirty]");for(h=0;t=s[h++];){t.removeAttribute("_moz_dirty")}}if(!browser.ie){var k=d.querySelectorAll("span.Apple-style-span");for(var h=0,t;t=k[h++];){domUtils.remove(t,true)}}j=d.innerHTML;j=UM.filterWord(j);var q=UM.htmlparser(j);if(c.options.filterRules){UM.filterNode(q,c.options.filterRules)}c.filterInputRule(q);if(browser.webkit){var r=q.lastChild();if(r&&r.type=="element"&&r.tagName=="br"){q.removeChild(r)}utils.each(c.body.querySelectorAll("div"),function(i){if(domUtils.isEmptyBlock(i)){domUtils.remove(i)}})}j={html:q.toHtml()};c.fireEvent("beforepaste",j,q);if(!j.html){return}c.execCommand("insertHtml",j.html,true);c.fireEvent("afterpaste",j)}}c.addListener("ready",function(){$(c.body).on("cut",function(){var d=c.selection.getRange();if(!d.collapsed&&c.undoManger){c.undoManger.save()}}).on(browser.ie||browser.opera?"keydown":"paste",function(d){if((browser.ie||browser.opera)&&((!d.ctrlKey&&!d.metaKey)||d.keyCode!="86")){return}b.call(c,function(e){a(e)})})})};UM.plugins.list=function(){var a=this;a.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}});this.addInputRule(function(b){utils.each(b.getNodesByTagName("li"),function(c){if(c.children.length==0){c.parentNode.removeChild(c)}})});a.commands.insertorderedlist=a.commands.insertunorderedlist={execCommand:function(d){this.document.execCommand(d);var c=this.selection.getRange(),b=c.createBookmark(true);this.$body.find("ol,ul").each(function(e,g){var f=g.parentNode;if(f.tagName=="P"&&f.lastChild===f.firstChild){$(g).children().each(function(i,h){var k=f.cloneNode(false);$(k).append(h.innerHTML);$(h).html("").append(k)});$(g).insertBefore(f);$(f).remove()}if(dtd.$inline[f.tagName]){if(f.tagName=="SPAN"){$(g).children().each(function(i,h){var j=f.cloneNode(false);if(h.firstChild.nodeName!="P"){while(h.firstChild){j.appendChild(h.firstChild)}$("<p></p>").appendTo(h).append(j)}else{while(h.firstChild){j.appendChild(h.firstChild)}$(h.firstChild).append(j)}})}domUtils.remove(f,true)}});c.moveToBookmark(b).select();return true},queryCommandState:function(b){return this.document.queryCommandState(b)}}};(function(){var a={textarea:function(d,c){var b=c.ownerDocument.createElement("textarea");b.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0";if(browser.ie&&browser.version<8){b.style.width=c.offsetWidth+"px";b.style.height=c.offsetHeight+"px";c.onresize=function(){b.style.width=c.offsetWidth+"px";b.style.height=c.offsetHeight+"px"}}c.appendChild(b);return{container:b,setContent:function(e){b.value=e},getContent:function(){return b.value},select:function(){var e;if(browser.ie){e=b.createTextRange();e.collapse(true);e.select()}else{b.setSelectionRange(0,0);b.focus()}},dispose:function(){c.removeChild(b);c.onresize=null;b=null;c=null}}}};UM.plugins.source=function(){var g=this;var b=this.options;var f=false;var i;b.sourceEditor="textarea";g.setOpt({sourceEditorFirst:false});function c(k){return a.textarea(g,k)}var j;var h=g.getContent,e;g.commands.source={execCommand:function(){f=!f;if(f){e=g.selection.getRange().createAddress(false,true);g.undoManger&&g.undoManger.save(true);if(browser.gecko){g.body.contentEditable=false}g.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;";g.fireEvent("beforegetcontent");var l=UM.htmlparser(g.body.innerHTML);g.filterOutputRule(l);l.traversal(function(q){if(q.type=="element"){switch(q.tagName){case"td":case"th":case"caption":if(q.children&&q.children.length==1){if(q.firstChild().tagName=="br"){q.removeChild(q.firstChild())}}break;case"pre":q.innerText(q.innerText().replace(/&nbsp;/g," "))}}});g.fireEvent("aftergetcontent");var n=l.toHtml(true);i=c(g.body.parentNode);i.setContent(n);var m=function(q){return parseInt($(g.body).css(q))};$(i.container).width($(g.body).width()+m("padding-left")+m("padding-right")).height($(g.body).height());setTimeout(function(){i.select()});g.getContent=function(){return i.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>"}}else{g.$body.css({position:"",left:"",top:""});var k=i.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";k=k.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(r,q){if(q&&!dtd.$inlineWithA[q.toLowerCase()]){return r.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,"")}return r.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")});g.setContent(k);i.dispose();i=null;g.getContent=h;var p=g.body.firstChild;if(!p){g.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"}g.undoManger&&g.undoManger.save(true);if(browser.gecko){g.body.contentEditable=true}try{g.selection.getRange().moveToAddress(e).select()}catch(o){}}this.fireEvent("sourcemodechanged",f)},queryCommandState:function(){return f|0},notNeedUndo:1};var d=g.queryCommandState;g.queryCommandState=function(k){k=k.toLowerCase();if(f){return k in {source:1,fullscreen:1}?d.apply(this,arguments):-1}return d.apply(this,arguments)}}})();UM.plugins.enterkey=function(){var b,c=this,a=c.options.enterTag;c.addListener("keyup",function(l,m){var n=m.keyCode||m.which;if(n==13){var k=c.selection.getRange(),g=k.startContainer,d;if(!browser.ie){if(/h\d/i.test(b)){if(browser.gecko){var j=domUtils.findParentByTagName(g,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],true);if(!j){c.document.execCommand("formatBlock",false,"<p>");d=1}}else{if(g.nodeType==1){var i=c.document.createTextNode(""),e;k.insertNode(i);e=domUtils.findParentByTagName(i,"div",true);if(e){var f=c.document.createElement("p");while(e.firstChild){f.appendChild(e.firstChild)}e.parentNode.insertBefore(f,e);domUtils.remove(e);k.setStartBefore(i).setCursor();d=1}domUtils.remove(i)}}if(c.undoManger&&d){c.undoManger.save()}}browser.opera&&k.select()}else{c.fireEvent("saveScene",true,true)}}});c.addListener("keydown",function(h,f){var i=f.keyCode||f.which;if(i==13){if(c.fireEvent("beforeenterkeydown")){domUtils.preventDefault(f);return}c.fireEvent("saveScene",true,true);b="";var g=c.selection.getRange();if(!g.collapsed){var k=g.startContainer,e=g.endContainer,d=domUtils.findParentByTagName(k,"td",true),j=domUtils.findParentByTagName(e,"td",true);if(d&&j&&d!==j||!d&&j||d&&!j){f.preventDefault?f.preventDefault():(f.returnValue=false);return}}if(a=="p"){if(!browser.ie){k=domUtils.findParentByTagName(g.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],true);if(!k&&!browser.opera){c.document.execCommand("formatBlock",false,"<p>");if(browser.gecko){g=c.selection.getRange();k=domUtils.findParentByTagName(g.startContainer,"p",true);k&&domUtils.removeDirtyAttr(k)}}else{b=k.tagName;k.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(k)}}}}});browser.ie&&c.addListener("setDisabled",function(){$(c.body).find("p").each(function(d,e){if(domUtils.isEmptyBlock(e)){e.innerHTML="&nbsp;"}})})};UM.commands.preview={execCommand:function(){var a=window.open("","_blank",""),e=a.document,g=this.getContent(null,null,true),b=this.getOpt("UMEDITOR_HOME_URL"),f=g.indexOf("mathquill-embedded-latex")!=-1?'<link rel="stylesheet" href="'+b+'third-party/mathquill/mathquill.css"/><script src="'+b+'third-party/jquery.min.js"><\/script><script src="'+b+'third-party/mathquill/mathquill.min.js"><\/script>':"";e.open();e.write("<html><head>"+f+"</head><body><div>"+g+"</div></body></html>");e.close()},notNeedUndo:1};UM.plugins.basestyle=function(){var b=["bold","underline","superscript","subscript","italic","strikethrough"],a=this;a.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"});a.addOutputRule(function(c){$.each(c.getNodesByTagName("b i u strike s"),function(d,e){switch(e.tagName){case"b":e.tagName="strong";break;case"i":e.tagName="em";break;case"u":e.tagName="span";e.setStyle("text-decoration","underline");break;case"s":case"strike":e.tagName="span";e.setStyle("text-decoration","line-through")}})});$.each(b,function(c,d){a.commands[d]={execCommand:function(f){var e=this.selection.getRange();if(e.collapsed&&this.queryCommandState(f)!=1){var g=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[f]);e.insertNode(g).setStart(g,0).setCursor(false);return true}else{return this.document.execCommand(f)}},queryCommandState:function(f){if(browser.gecko){return this.document.queryCommandState(f)}var g=this.selection.getStartElementPath(),e=false;$.each(g,function(h,j){switch(f){case"bold":if(j.nodeName=="STRONG"||j.nodeName=="B"){e=1;return false}break;case"underline":if(j.nodeName=="U"||j.nodeName=="SPAN"&&$(j).css("text-decoration")=="underline"){e=1;return false}break;case"superscript":if(j.nodeName=="SUP"){e=1;return false}break;case"subscript":if(j.nodeName=="SUB"){e=1;return false}break;case"italic":if(j.nodeName=="EM"||j.nodeName=="I"){e=1;return false}break;case"strikethrough":if(j.nodeName=="S"||j.nodeName=="STRIKE"||j.nodeName=="SPAN"&&$(j).css("text-decoration")=="line-through"){e=1;return false}break}});return e}}})};UM.plugins.video=function(){var c=this,d;function b(f,h,e,j,i,g){return !g?"<img "+(j?'id="'+j+'"':"")+' width="'+h+'" height="'+e+'" _url="'+f+'" class="edui-faked-video" src="'+c.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+c.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(i?"float:"+i+";":"")+'" />':'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+f+'" width="'+h+'" height="'+e+'"'+(i?' style="float:'+i+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >'}function a(e,f){utils.each(e.getNodesByTagName(f?"img":"embed"),function(h){if(h.getAttr("class")=="edui-faked-video"){var g=b(f?h.getAttr("_url"):h.getAttr("src"),h.getAttr("width"),h.getAttr("height"),null,h.getStyle("float")||"",f);h.parentNode.replaceChild(UM.uNode.createElement(g),h)}})}c.addOutputRule(function(e){a(e,true)});c.addInputRule(function(e){a(e)});c.commands.insertvideo={execCommand:function(h,k){k=utils.isArray(k)?k:[k];var g=[],l="tmpVedio";for(var f=0,j,e=k.length;f<e;f++){j=k[f];g.push(b(j.url,j.width||420,j.height||280,l+f,j.align,false))}c.execCommand("inserthtml",g.join(""),true)},queryCommandState:function(){var f=c.selection.getRange().getClosedNode(),e=f&&(f.className=="edui-faked-video");return e?1:0}}};UM.plugins.selectall=function(){var a=this;a.commands.selectall={execCommand:function(){var d=this,b=d.body,c=d.selection.getRange();c.selectNodeContents(b);if(domUtils.isEmptyBlock(b)){if(browser.opera&&b.firstChild&&b.firstChild.nodeType==1){c.setStartAtFirst(b.firstChild)}c.collapse(true)}c.select(true)},notNeedUndo:1};a.addshortcutkey({selectAll:"ctrl+65"})};UM.plugins.removeformat=function(){var a=this;a.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"});a.commands.removeformat={execCommand:function(m,o,b,k,l){var g=new RegExp("^(?:"+(o||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),f=b?[]:(k||this.options.removeFormatAttributes).split(","),h=new dom.Range(this.document),i,e,j,c=function(p){return p.nodeType==1};function d(s){if(s.nodeType==3||s.tagName.toLowerCase()!="span"){return 0}if(browser.ie){var q=s.attributes;if(q.length){for(var r=0,p=q.length;r<p;r++){if(q[r].specified){return 0}}return 1}}return !s.attributes.length}function n(v){var p=v.createBookmark();if(v.collapsed){v.enlarge(true)}if(!l){var q=domUtils.findParentByTagName(v.startContainer,"a",true);if(q){v.setStartBefore(q)}q=domUtils.findParentByTagName(v.endContainer,"a",true);if(q){v.setEndAfter(q)}}i=v.createBookmark();r=i.start;while((j=r.parentNode)&&!domUtils.isBlockElm(j)){domUtils.breakParent(r,j);domUtils.clearEmptySibling(r)}if(i.end){r=i.end;while((j=r.parentNode)&&!domUtils.isBlockElm(j)){domUtils.breakParent(r,j);domUtils.clearEmptySibling(r)}var w=domUtils.getNextDomNode(i.start,false,c),u;while(w){if(w==i.end){break}u=domUtils.getNextDomNode(w,true,c);if(!dtd.$empty[w.tagName.toLowerCase()]&&!domUtils.isBookmarkNode(w)){if(g.test(w.tagName)){if(b){domUtils.removeStyle(w,b);if(d(w)&&b!="text-decoration"){domUtils.remove(w,true)}}else{domUtils.remove(w,true)}}else{if(!dtd.$tableContent[w.tagName]&&!dtd.$list[w.tagName]){domUtils.removeAttributes(w,f);if(d(w)){domUtils.remove(w,true)}}}}w=u}}var x=i.start.parentNode;if(domUtils.isBlockElm(x)&&!dtd.$tableContent[x.tagName]&&!dtd.$list[x.tagName]){domUtils.removeAttributes(x,f)}x=i.end.parentNode;if(i.end&&domUtils.isBlockElm(x)&&!dtd.$tableContent[x.tagName]&&!dtd.$list[x.tagName]){domUtils.removeAttributes(x,f)}v.moveToBookmark(i).moveToBookmark(p);var r=v.startContainer,t,s=v.collapsed;while(r.nodeType==1&&domUtils.isEmptyNode(r)&&dtd.$removeEmpty[r.tagName]){t=r.parentNode;v.setStartBefore(r);if(v.startContainer===v.endContainer){v.endOffset--}domUtils.remove(r);r=t}if(!s){r=v.endContainer;while(r.nodeType==1&&domUtils.isEmptyNode(r)&&dtd.$removeEmpty[r.tagName]){t=r.parentNode;v.setEndBefore(r);domUtils.remove(r);r=t}}}h=this.selection.getRange();if(!h.collapsed){n(h);h.select()}}}};UM.plugins.keystrokes=function(){var a=this;var b=true;a.addListener("keydown",function(j,l){var m=l.keyCode||l.which,c=a.selection.getRange();if(!c.collapsed&&!(l.ctrlKey||l.shiftKey||l.altKey||l.metaKey)&&(m>=65&&m<=90||m>=48&&m<=57||m>=96&&m<=111||{13:1,8:1,46:1}[m])){var f=c.startContainer;if(domUtils.isFillChar(f)){c.setStartBefore(f)}f=c.endContainer;if(domUtils.isFillChar(f)){c.setEndAfter(f)}c.txtToElmBoundary();if(c.endContainer&&c.endContainer.nodeType==1){f=c.endContainer.childNodes[c.endOffset];if(f&&domUtils.isBr(f)){c.setEndAfter(f)}}if(c.startOffset==0){f=c.startContainer;if(domUtils.isBoundaryNode(f,"firstChild")){f=c.endContainer;if(c.endOffset==(f.nodeType==3?f.nodeValue.length:f.childNodes.length)&&domUtils.isBoundaryNode(f,"lastChild")){a.fireEvent("saveScene");a.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";c.setStart(a.body.firstChild,0).setCursor(false,true);a._selectionChange();return}}}}if(m==8){c=a.selection.getRange();b=c.collapsed;if(a.fireEvent("delkeydown",l)){return}var d,h;if(c.collapsed&&c.inFillChar()){d=c.startContainer;if(domUtils.isFillChar(d)){c.setStartBefore(d).shrinkBoundary(true).collapse(true);domUtils.remove(d)}else{d.nodeValue=d.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"");c.startOffset--;c.collapse(true).select(true)}}if(d=c.getClosedNode()){a.fireEvent("saveScene");c.setStartBefore(d);domUtils.remove(d);c.setCursor();a.fireEvent("saveScene");domUtils.preventDefault(l);return}if(!browser.ie){d=domUtils.findParentByTagName(c.startContainer,"table",true);h=domUtils.findParentByTagName(c.endContainer,"table",true);if(d&&!h||!d&&h||d!==h){l.preventDefault();return}}d=c.startContainer;if(c.collapsed&&d.nodeType==1){var e=d.childNodes[c.startOffset-1];if(e&&e.nodeType==1&&e.tagName=="BR"){a.fireEvent("saveScene");c.setStartBefore(e).collapse(true);domUtils.remove(e);c.select();a.fireEvent("saveScene")}}if(browser.chrome){if(c.collapsed){while(c.startOffset==0&&!domUtils.isEmptyBlock(c.startContainer)){c.setStartBefore(c.startContainer)}var g=c.startContainer.childNodes[c.startOffset-1];if(g&&g.nodeName=="BR"){c.setStartBefore(g);a.fireEvent("saveScene");$(g).remove();c.setCursor();a.fireEvent("saveScene")}}}}if(browser.gecko&&m==46){var i=a.selection.getRange();if(i.collapsed){d=i.startContainer;if(domUtils.isEmptyBlock(d)){var k=d.parentNode;while(domUtils.getChildCount(k)==1&&!domUtils.isBody(k)){d=k;k=k.parentNode}if(d===k.lastChild){l.preventDefault()}return}}}});a.addListener("keyup",function(h,j){var l=j.keyCode||j.which,c,g=this;if(l==8){if(g.fireEvent("delkeyup")){return}c=g.selection.getRange();if(c.collapsed){var d,k=["h1","h2","h3","h4","h5","h6"];if(d=domUtils.findParentByTagName(c.startContainer,k,true)){if(domUtils.isEmptyBlock(d)){var e=d.previousSibling;if(e&&e.nodeName!="TABLE"){domUtils.remove(d);c.setStartAtLast(e).setCursor(false,true);return}else{var f=d.nextSibling;if(f&&f.nodeName!="TABLE"){domUtils.remove(d);c.setStartAtFirst(f).setCursor(false,true);return}}}}if(domUtils.isBody(c.startContainer)){var d=domUtils.createElement(g.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});c.insertNode(d).setStart(d,0).setCursor(false,true)}}if(!b&&(c.startContainer.nodeType==3||c.startContainer.nodeType==1&&domUtils.isEmptyBlock(c.startContainer))){if(browser.ie){var i=c.document.createElement("span");c.insertNode(i).setStartBefore(i).collapse(true);c.select();domUtils.remove(i)}else{c.select()}}}})};UM.plugins.autosave=function(){var e=this,c=new Date(),a=20,f=null;e.setOpt("saveInterval",500);var b=UM.LocalStorage=(function(){var i=window.localStorage||g()||null,h="localStorage";return{saveLocalData:function(j,k){if(i&&k){i.setItem(j,k);return true}return false},getLocalData:function(j){if(i){return i.getItem(j)}return null},removeItem:function(j){i&&i.removeItem(j)}};function g(){var j=document.createElement("div");j.style.display="none";if(!j.addBehavior){return null}j.addBehavior("#default#userdata");return{getItem:function(l){var k=null;try{document.body.appendChild(j);j.load(h);k=j.getAttribute(l);document.body.removeChild(j)}catch(m){}return k},setItem:function(k,l){document.body.appendChild(j);j.setAttribute(k,l);j.save(h);document.body.removeChild(j)},removeItem:function(k){document.body.appendChild(j);j.removeAttribute(k);j.save(h);document.body.removeChild(j)}}}})();function d(h){var g=null;if(new Date()-c<a){return}if(!h.hasContents()){f&&b.removeItem(f);return}c=new Date();h._saveFlag=null;g=e.body.innerHTML;if(h.fireEvent("beforeautosave",{content:g})===false){return}b.saveLocalData(f,g);h.fireEvent("afterautosave",{content:g})}e.addListener("ready",function(){var g="-drafts-data",h=null;if(e.key){h=e.key+g}else{h=(e.container.parentNode.id||"ue-common")+g}f=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+h});e.addListener("contentchange",function(){if(!f){return}if(e._saveFlag){window.clearTimeout(e._saveFlag)}if(e.options.saveInterval>0){e._saveFlag=window.setTimeout(function(){d(e)},e.options.saveInterval)}else{d(e)}});e.commands.clearlocaldata={execCommand:function(h,g){if(f&&b.getLocalData(f)){b.removeItem(f)}},notNeedUndo:true,ignoreContentChange:true};e.commands.getlocaldata={execCommand:function(h,g){return f?b.getLocalData(f)||"":""},notNeedUndo:true,ignoreContentChange:true};e.commands.drafts={execCommand:function(h,g){if(f){e.body.innerHTML=b.getLocalData(f)||"<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>";e.focus(true)}},queryCommandState:function(){return f?(b.getLocalData(f)===null?-1:0):-1},notNeedUndo:true,ignoreContentChange:true}};UM.plugins.autoupload=function(){var me=this;me.setOpt("pasteImageEnabled",true);me.setOpt("dropFileEnabled",true);var sendAndInsertImage=function(file,editor){var fd=new FormData();fd.append(editor.options.imageFieldName||"upfile",file,file.name||("blob."+file.type.substr("image/".length)));fd.append("type","ajax");var xhr=new XMLHttpRequest();xhr.open("post",me.options.imageUrl,true);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.addEventListener("load",function(e){try{var json=eval("("+e.target.response+")"),link=json.url,picLink=me.options.imagePath+link;editor.execCommand("insertimage",{src:picLink,_src:picLink})}catch(er){}});xhr.send(fd)};function getPasteImage(e){return e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length==1&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null}function getDropImage(e){return e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null}me.addListener("ready",function(){if(window.FormData&&window.FileReader){var autoUploadHandler=function(e){var hasImg=false,items;items=e.type=="paste"?getPasteImage(e.originalEvent):getDropImage(e.originalEvent);if(items){var len=items.length,file;while(len--){file=items[len];if(file.getAsFile){file=file.getAsFile()}if(file&&file.size>0&&/image\/\w+/i.test(file.type)){sendAndInsertImage(file,me);hasImg=true}}if(hasImg){return false}}};me.getOpt("pasteImageEnabled")&&me.$body.on("paste",autoUploadHandler);me.getOpt("dropFileEnabled")&&me.$body.on("drop",autoUploadHandler);me.$body.on("dragover",function(e){if(e.originalEvent.dataTransfer.types[0]=="Files"){return false}})}})};UM.plugins.formula=function(){var b=this;function a(){return b.$body.find("iframe.edui-formula-active")[0]||null}function c(){var d=a();d&&d.contentWindow.formula.blur()}b.addInputRule(function(d){$.each(d.getNodesByTagName("span"),function(e,f){if(f.hasClass("mathquill-embedded-latex")){var h,g="";while(h=f.firstChild()){g+=h.data;f.removeChild(h)}f.tagName="iframe";f.setAttr({frameborder:"0",src:b.getOpt("UMEDITOR_HOME_URL")+"dialogs/formula/formula.html","data-latex":utils.unhtml(g)})}})});b.addOutputRule(function(d){$.each(d.getNodesByTagName("iframe"),function(e,f){if(f.hasClass("mathquill-embedded-latex")){f.tagName="span";f.appendChild(UM.uNode.createText(f.getAttr("data-latex")));f.setAttr({frameborder:"",src:"","data-latex":""})}})});b.addListener("click",function(){c()});b.addListener("afterexeccommand",function(d,e){if(e!="formula"){c()}});b.commands.formula={execCommand:function(f,e){var d=a();if(d){d.contentWindow.formula.insertLatex(e)}else{b.execCommand("inserthtml",'<span class="mathquill-embedded-latex">'+e+"</span>");browser.ie&&browser.ie9below&&setTimeout(function(){var g=b.selection.getRange(),h=g.startContainer;if(h.nodeType==1&&!h.childNodes[g.startOffset]){g.insertNode(b.document.createTextNode(" "));g.setCursor()}},100)}},queryCommandState:function(d){return 0},queryCommandValue:function(e){var d=a();return d&&d.contentWindow.formula.getLatex()}}};(function(g){g.parseTmpl=function h(l,k){var i="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+l.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(m,n){return"',"+n.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(m,n){return"');"+n.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";var j=new Function("obj",i);return k?j(k):j};g.extend2=function(p,q){var m=arguments,r=g.type(m[m.length-1])=="boolean"?m[m.length-1]:false,l=g.type(m[m.length-1])=="boolean"?m.length-1:m.length;for(var o=1;o<l;o++){var j=m[o];for(var n in j){if(!r||!p.hasOwnProperty(n)){p[n]=j[n]}}}return p};g.IE6=!!window.ActiveXObject&&parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1])==6;var e=[];var b=function(){};var a="edui";b.prototype={on:function(j,i){this.root().on(j,g.proxy(i,this));return this},off:function(j,i){this.root().off(j,g.proxy(i,this));return this},trigger:function(i,j){return this.root().trigger(i,j)===false?false:this},root:function(i){return this._$el||(this._$el=i)},destroy:function(){},data:function(i,j){if(j!==undefined){this.root().data(a+i,j);return this}else{return this.root().data(a+i)}},register:function(i,j,k){e.push({evtname:i,"$els":g.isArray(j)?j:[j],handler:g.proxy(k,j)})}};g.fn.edui=function(i){return i?this.data("eduiwidget",i):this.data("eduiwidget")};function d(m,j,l){m.prototype=g.extend2(g.extend({},j),(UM.ui[l]||b).prototype,true);m.prototype.supper=(UM.ui[l]||b).prototype;if(UM.ui[l]&&UM.ui[l].prototype.defaultOpt){var i=UM.ui[l].prototype.defaultOpt,k=m.prototype.defaultOpt;m.prototype.defaultOpt=g.extend({},i,k||{})}return m}var c=1;function f(j,i){g[a+i]=j;g.fn[a+i]=function(m){var k,l=Array.prototype.slice.call(arguments,1);this.each(function(n,o){var q=g(o);var p=q.edui();if(!p){j(!m||!g.isPlainObject(m)?{}:m,q);q.edui(p)}if(g.type(m)=="string"){if(m=="this"){k=p}else{k=p[m].apply(p,l);if(k!==p&&k!==undefined){return false}k=null}}});return k!==null?k:this}}UM.ui={define:function(j,i,l){var k=UM.ui[j]=d(function(m,n){var q=function(){};g.extend(q.prototype,k.prototype,{guid:j+c++,widgetName:j});var p=new q;if(g.type(m)=="string"){p.init&&p.init({});p.root().edui(p);p.root().find("a").click(function(r){r.preventDefault()});return p.root()[a+j].apply(p.root(),arguments)}else{n&&p.root(n);p.init&&p.init(!m||g.isPlainObject(m)?g.extend2(m||{},p.defaultOpt||{},true):m);try{p.root().find("a").click(function(r){r.preventDefault()})}catch(o){}return p.root().edui(p)}},i,l);f(k,j)}};g(function(){g(document).on("click mouseup mousedown dblclick mouseover",function(i){g.each(e,function(j,k){if(k.evtname==i.type){g.each(k.$els,function(m,l){if(l[0]!==i.target&&!g.contains(l[0],i.target)){k.handler(i)}})}})})})})(jQuery);UM.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> <% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%></span><%}%><%if(caret && text){%><span class="edui-button-spacing"></span><%}%><% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:false,texttype:false,click:function(){}},init:function(a){var b=this;b.root($($.parseTmpl(b.tpl,a))).click(function(c){b.wrapclick(a.click,c)});b.root().hover(function(){if(!b.root().hasClass("edui-disabled")){b.root().toggleClass("edui-hover")}});return b},wrapclick:function(b,a){if(!this.disabled()){this.root().trigger("wrapclick");$.proxy(b,this,a)()}return this},label:function(a){if(a===undefined){return this.root().find(".edui-button-label").text()}else{this.root().find(".edui-button-label").text(a);return this}},disabled:function(a){if(a===undefined){return this.root().hasClass("edui-disabled")}this.root().toggleClass("edui-disabled",a);if(this.root().hasClass("edui-disabled")){this.root().removeClass("edui-hover")}return this},active:function(a){if(a===undefined){return this.root().hasClass("edui-active")}this.root().toggleClass("edui-active",a);return this},mergeWith:function(b){var a=this;a.data("$mergeObj",b);b.edui().data("$mergeObj",a.root());if(!$.contains(document.body,b[0])){b.appendTo(a.root())}a.on("click",function(){a.wrapclick(function(){b.edui().show()})}).register("click",a.root(),function(c){b.hide()})}});(function(){UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var a=this.root($(this.tpl));this.data("$btnToolbar",a.find(".edui-btn-toolbar"))},appendToBtnmenu:function(b){var a=this.data("$btnToolbar");b=$.isArray(b)?b:[b];$.each(b,function(d,c){a.append(c)})}})})();UM.ui.define("menu",{show:function(e,b,a,c,d){a=a||"position";if(this.trigger("beforeshow")===false){return}else{this.root().css($.extend({display:"block"},e?{top:e[a]().top+(b=="right"?0:e.outerHeight())-(c||0),left:e[a]().left+(b=="right"?e.outerWidth():0)-(d||0)}:{}));this.trigger("aftershow")}},hide:function(b){var a;if(this.trigger("beforehide")===false){return}else{if(a=this.root().data("parentmenu")){if(a.data("parentmenu")||b){a.edui().hide()}}this.root().css("display","none");this.trigger("afterhide")}},attachTo:function(b){var a=this;if(!b.data("$mergeObj")){b.data("$mergeObj",a.root());b.on("wrapclick",function(c){a.show()});a.register("click",b,function(c){a.hide()});a.data("$mergeObj",b)}}});UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" ><%for(var i=0,ci;ci=data[i++];){%><%if(ci.divider){%><li class="edui-divider"></li><%}else{%><li <%if(ci.active||ci.disabled){%>class="<%= ci.active|| \'\' %> <%=ci.disabled||\'\' %>" <%}%> data-value="<%= ci.value%>"><a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"></i></em><%= ci.label%></a></li><%}%><%}%></ul>',defaultOpt:{data:[],click:function(){}},init:function(b){var c=this;var a={click:1,mouseover:1,mouseout:1};this.root($($.parseTmpl(this.tmpl,b))).on("click",'li[class!="edui-disabled edui-divider edui-dropdown-submenu"]',function(d){$.proxy(b.click,c,d,$(this).data("value"),$(this))()}).find("li").each(function(d,e){var g=$(this);if(!g.hasClass("edui-disabled edui-divider edui-dropdown-submenu")){var f=b.data[d];$.each(a,function(h){f[h]&&g[h](function(i){$.proxy(f[h],e)(i,f,c.root)})})}})},disabled:function(a){$("li[class!=edui-divider]",this.root()).each(function(){var b=$(this);if(a===true){b.addClass("edui-disabled")}else{if($.isFunction(a)){b.toggleClass("edui-disabled",a(li))}else{b.removeClass("edui-disabled")}}})},val:function(b){var a;$('li[class!="edui-divider edui-disabled edui-dropdown-submenu"]',this.root()).each(function(){var c=$(this);if(b===undefined){if(c.find("em.edui-dropmenu-checked").length){a=c.data("value");return false}}else{c.find("em").toggleClass("edui-dropmenu-checked",c.data("value")==b)}});if(b===undefined){return a}},addSubmenu:function(d,e,c){c=c||0;var b=$("li[class!=edui-divider]",this.root());var a=$('<li class="edui-dropdown-submenu"><a tabindex="-1" href="#">'+d+"</a></li>").append(e);if(c>=0&&c<b.length){a.insertBefore(b[c])}else{if(c<0){a.insertBefore(b[0])}else{if(c>=b.length){a.appendTo(b)}}}}},"menu");UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(a){var b=this;b.root($($.parseTmpl(b.tpl,a)));b.root().find(".edui-btn:first").click(function(c){if(!b.disabled()){$.proxy(a.click,b)()}});b.root().find(".edui-dropdown-toggle").click(function(){if(!b.disabled()){b.trigger("arrowclick")}});b.root().hover(function(){if(!b.root().hasClass("edui-disabled")){b.root().toggleClass("edui-hover")}});return b},wrapclick:function(b,a){if(!this.disabled()){$.proxy(b,this,a)()}return this},disabled:function(a){if(a===undefined){return this.root().hasClass("edui-disabled")}this.root().toggleClass("edui-disabled",a).find(".edui-btn").toggleClass("edui-disabled",a);return this},active:function(a){if(a===undefined){return this.root().hasClass("edui-active")}this.root().toggleClass("edui-active",a).find(".edui-btn:first").toggleClass("edui-active",a);return this},mergeWith:function(b){var a=this;a.data("$mergeObj",b);b.edui().data("$mergeObj",a.root());if(!$.contains(document.body,b[0])){b.appendTo(a.root())}a.root().delegate(".edui-dropdown-toggle","click",function(){a.wrapclick(function(){b.edui().show()})});a.register("click",a.root().find(".edui-dropdown-toggle"),function(c){b.hide()})}});UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>></div><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{color:""},init:function(a){var b=this;b.supper.init.call(b,a)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton");UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>><div class="edui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%></div><div class="edui-popup-caret"></div></div>',defaultOpt:{stopprop:false,subtpl:"",width:"",height:""},init:function(a){this.root($($.parseTmpl(this.tpl,a)));return this},mergeTpl:function(a){return $.parseTmpl(this.tpl,{subtpl:a})},show:function(c,b){if(!b){b={}}var a=b.fnname||"position";if(this.trigger("beforeshow")===false){return}else{this.root().css($.extend({display:"block"},c?{top:c[a]().top+(b.dir=="right"?0:c.outerHeight())-(b.offsetTop||0),left:c[a]().left+(b.dir=="right"?c.outerWidth():0)-(b.offsetLeft||0),position:"absolute"}:{}));this.root().find(".edui-popup-caret").css({top:b.caretTop||0,left:b.caretLeft||0,position:"absolute"}).addClass(b.caretDir||"up")}this.trigger("aftershow")},hide:function(){this.root().css("display","none");this.trigger("afterhide")},attachTo:function(c,b){var a=this;if(!c.data("$mergeObj")){c.data("$mergeObj",a.root());c.on("wrapclick",function(d){a.show(c,b)});a.register("click",c,function(d){a.hide()});a.data("$mergeObj",c)}},getBodyContainer:function(){return this.root().find(".edui-popup-body")}});UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"></span><span class="edui-scale-hand1"></span><span class="edui-scale-hand2"></span><span class="edui-scale-hand3"></span><span class="edui-scale-hand4"></span><span class="edui-scale-hand5"></span><span class="edui-scale-hand6"></span><span class="edui-scale-hand7"></span></div>',defaultOpt:{$doc:$(document),$wrap:$(document)},init:function(a){if(a.$doc){this.defaultOpt.$doc=a.$doc}if(a.$wrap){this.defaultOpt.$wrap=a.$wrap}this.root($($.parseTmpl(this.tpl,a)));this.initStyle();this.startPos=this.prePos={x:0,y:0};this.dragId=-1;return this},initStyle:function(){utils.cssRule("edui-style-scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(d){var c=this,f=c.defaultOpt.$doc;switch(d.type){case"mousedown":var b=d.target||d.srcElement,b;if(b.className.indexOf("edui-scale-hand")!=-1){c.dragId=b.className.slice(-1);c.startPos.x=c.prePos.x=d.clientX;c.startPos.y=c.prePos.y=d.clientY;f.bind("mousemove",$.proxy(c._eventHandler,c))}break;case"mousemove":if(c.dragId!=-1){c.updateContainerStyle(c.dragId,{x:d.clientX-c.prePos.x,y:d.clientY-c.prePos.y});c.prePos.x=d.clientX;c.prePos.y=d.clientY;c.updateTargetElement()}break;case"mouseup":if(c.dragId!=-1){c.dragId=-1;c.updateTargetElement();var a=c.data("$scaleTarget");if(a.parent()){c.attachTo(c.data("$scaleTarget"))}}f.unbind("mousemove",$.proxy(c._eventHandler,c));break;default:break}},updateTargetElement:function(){var b=this,c=b.root(),a=b.data("$scaleTarget");a.css({width:c.width(),height:c.height()});b.attachTo(a)},updateContainerStyle:function(b,f){var e=this,a=e.root(),c,d=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];if(d[b][0]!=0){c=parseInt(a.offset().left)+f.x;a.css("left",e._validScaledProp("left",c))}if(d[b][1]!=0){c=parseInt(a.offset().top)+f.y;a.css("top",e._validScaledProp("top",c))}if(d[b][2]!=0){c=a.width()+d[b][2]*f.x;a.css("width",e._validScaledProp("width",c))}if(d[b][3]!=0){c=a.height()+d[b][3]*f.y;a.css("height",e._validScaledProp("height",c))}},_validScaledProp:function(e,c){var d=this.root(),a=this.defaultOpt.$doc,b=function(h,g,f){return(h+g)>f?f-g:c};c=isNaN(c)?0:c;switch(e){case"left":return c<0?0:b(c,d.width(),a.width());case"top":return c<0?0:b(c,d.height(),a.height());case"width":return c<=0?1:b(c,d.offset().left,a.width());case"height":return c<=0?1:b(c,d.offset().top,a.height())}},show:function(b){var a=this;if(b){a.attachTo(b)}a.root().bind("mousedown",$.proxy(a._eventHandler,a));a.defaultOpt.$doc.bind("mouseup",$.proxy(a._eventHandler,a));a.root().show();a.trigger("aftershow")},hide:function(){var a=this;a.root().unbind("mousedown",$.proxy(a._eventHandler,a));a.defaultOpt.$doc.unbind("mouseup",$.proxy(a._eventHandler,a));a.root().hide();a.trigger("afterhide")},attachTo:function(f){var d=this,c=f.offset(),e=d.root(),a=d.defaultOpt.$wrap,b=a.offset();d.data("$scaleTarget",f);d.root().css({position:"absolute",width:f.width(),height:f.height(),left:c.left-b.left-parseInt(a.css("border-left-width"))-parseInt(e.css("border-left-width")),top:c.top-b.top-parseInt(a.css("border-top-width"))-parseInt(e.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}});UM.ui.define("colorpicker",{tpl:function(c){var d=("ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,").split(",");var b='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>" ><table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+c.lang_themeColor+'</td> </tr><tr class="edui-colorpicker-firstrow" >';for(var a=0;a<d.length;a++){if(a&&a%10===0){b+="</tr>"+(a==60?'<tr><td colspan="10">'+c.lang_standardColor+"</td></tr>":"")+"<tr"+(a==60?' class="edui-colorpicker-firstrow"':"")+">"}b+=a<70?'<td><a unselectable="on" onmousedown="return false" title="'+d[a]+'" class="edui-colorpicker-colorcell" data-color="#'+d[a]+'" style="background-color:#'+d[a]+";border:solid #ccc;"+(a<10||a>=60?"border-width:1px;":a>=10&&a<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':""}b+="</tr></table></div>";return b},init:function(a){var b=this;b.root($($.parseTmpl(b.supper.mergeTpl(b.tpl(a)),a)));b.root().on("click",function(c){b.trigger("pickcolor",$(c.target).data("color"))})}},"popup");(function(){var c="combobox",e="edui-combobox-item",a="edui-combobox-item-hover",d="edui-combobox-checked-icon",b="edui-combobox-item-label";UM.ui.define(c,(function(){return{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu"><%if(autoRecord) {%><%for( var i=0, len = recordStack.length; i<len; i++ ) {%><%var index = recordStack[i];%><li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%></label></li><%}%><%if( i ) {%><li class="edui-combobox-item-separator"></li><%}%><%}%><%for( var i=0, label; label = items[i]; i++ ) {%><li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%></label></li><%}%></ul>',defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:true,recordCount:5},init:function(f){var g=this;$.extend(g._optionAdaptation(f),g._createItemMapping(f.recordStack,f.items),{itemClassName:e,iconClass:d,labelClassName:b});this._transStack(f);g.root($($.parseTmpl(g.tpl,f)));this.data("options",f).initEvent()},initEvent:function(){var f=this;f.initSelectItem();this.initItemActive()},initSelectItem:function(){var g=this,f="."+b;g.root().delegate("."+e,"click",function(){var i=$(this),h=i.attr("data-item-index");g.trigger("comboboxselect",{index:h,label:i.find(f).text(),value:g.data("options").value[h]}).select(h);g.hide();return false})},initItemActive:function(){var f={mouseenter:"addClass",mouseleave:"removeClass"};if($.IE6){this.root().delegate("."+e,"mouseenter mouseleave",function(g){$(this)[f[g.type]](a)}).one("afterhide",function(){})}},select:function(g){var h=this.data("options").itemCount,f=this.data("options").autowidthitem;if(f&&!f.length){f=this.data("options").items}if(h==0){return null}if(g<0){g=h+g%h}else{if(g>=h){g=h-1}}this.trigger("changebefore",f[g]);this._update(g);this.trigger("changeafter",f[g]);return null},selectItemByLabel:function(g){var h=this.data("options").itemMapping,i=this,f=null;!$.isArray(g)&&(g=[g]);$.each(g,function(j,k){f=h[k];if(f!==undefined){i.select(f);return false}})},_transStack:function(g){var f=[],i=-1,h=-1;$.each(g.recordStack,function(j,k){i=g.itemMapping[k];if($.isNumeric(i)){f.push(i);if(k==g.selected){h=i}}});g.recordStack=f;g.selected=h;f=null},_optionAdaptation:function(g){if(!("itemStyles" in g)){g.itemStyles=[];for(var h=0,f=g.items.length;h<f;h++){g.itemStyles.push("")}}g.autowidthitem=g.autowidthitem||g.items;g.itemCount=g.items.length;return g},_createItemMapping:function(i,h){var g={},f={recordStack:[],mapping:{}};$.each(h,function(j,k){g[k]=j});f.itemMapping=g;$.each(i,function(j,k){if(g[k]!==undefined){f.recordStack.push(g[k]);f.mapping[k]=g[k]}});return f},_update:function(h){var g=this.data("options"),f=[],i=null;$.each(g.recordStack,function(j,k){if(k!=h){f.push(k)}});f.unshift(h);if(f.length>g.recordCount){f.length=g.recordCount}g.recordStack=f;g.selected=h;i=$($.parseTmpl(this.tpl,g));this.root().html(i.html());i=null;f=null}}})(),"menu")})();(function(){var a="buttoncombobox";UM.ui.define(a,(function(){return{defaultOpt:{label:"",title:""},init:function(b){var c=this;var d=$.eduibutton({caret:true,name:b.comboboxName,title:b.title,text:b.label,click:function(){c.show(this.root())}});c.supper.init.call(c,b);c.on("changebefore",function(g,f){d.eduibutton("label",f)});c.data("button",d);c.attachTo(d)},button:function(){return this.data("button")}}})(),"combobox")})();UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"></div><h3 class="edui-title"><%=title%></h3></div><div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%><%if(height){%>height:<%=height%>px;<%}%>"> </div><% if(cancellabel || oklabel) {%><div class="edui-modal-footer"><div class="edui-modal-tip"></div><%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%></div><%}%><%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%></div><%}%></div><%}%></div>',defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:true,keyboard:true},init:function(a){var b=this;b.root($($.parseTmpl(b.tpl,a||{})));b.data("options",a);if(a.okFn){b.on("ok",$.proxy(a.okFn,b))}if(a.cancelFn){b.on("beforehide",$.proxy(a.cancelFn,b))}b.root().delegate('[data-hide="modal"]',"click",$.proxy(b.hide,b)).delegate('[data-ok="modal"]',"click",$.proxy(b.ok,b));$('[data-hide="modal"],[data-ok="modal"]',b.root()).hover(function(){$(this).toggleClass("edui-hover")})},toggle:function(){var a=this;return a[!a.data("isShown")?"show":"hide"]()},show:function(){var a=this;a.trigger("beforeshow");if(a.data("isShown")){return}a.data("isShown",true);a.escape();a.backdrop(function(){a.autoCenter();a.root().show().focus().trigger("aftershow")})},showTip:function(a){$(".edui-modal-tip",this.root()).html(a).fadeIn()},hideTip:function(a){$(".edui-modal-tip",this.root()).fadeOut(function(){$(this).html("")})},autoCenter:function(){!$.IE6&&this.root().css("margin-left",-(this.root().width()/2))},hide:function(){var a=this;a.trigger("beforehide");if(!a.data("isShown")){return}a.data("isShown",false);a.escape();a.hideModal()},escape:function(){var a=this;if(a.data("isShown")&&a.data("options").keyboard){a.root().on("keyup",function(b){b.which==27&&a.hide()})}else{if(!a.data("isShown")){a.root().off("keyup")}}},hideModal:function(){var a=this;a.root().hide();a.backdrop(function(){a.removeBackdrop();a.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(b){var a=this;if(a.data("isShown")&&a.data("options").backdrop){a.$backdrop=$('<div class="edui-modal-backdrop" />').click(a.data("options").backdrop=="static"?$.proxy(a.root()[0].focus,a.root()[0]):$.proxy(a.hide,a))}a.trigger("afterbackdrop");b&&b()},attachTo:function(b){var a=this;if(!b.data("$mergeObj")){b.data("$mergeObj",a.root());b.on("click",function(){a.toggle(b)});a.data("$mergeObj",b)}},ok:function(){var a=this;a.trigger("beforeok");if(a.trigger("ok",a)===false){return}a.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}});UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(a){var b=this;b.root($($.parseTmpl(b.tpl,a||{})))},content:function(b){var a=this,c=$(b.currentTarget).attr("data-original-title");a.root().find(".edui-tooltip-inner")["text"](c)},position:function(b){var a=this,c=$(b.currentTarget);a.root().css($.extend({display:"block"},c?{top:c.outerHeight(),left:((c.outerWidth()-a.root().outerWidth())/2)}:{}))},show:function(b){if($(b.currentTarget).hasClass("edui-disabled")){return}var a=this;a.content(b);a.root().appendTo($(b.currentTarget));a.position(b);a.root().css("display","block")},hide:function(){var a=this;a.root().css("display","none")},attachTo:function(c){var b=this;function a(e){var d=this;if(!$.contains(document.body,d.root()[0])){d.root().appendTo(e)}d.data("tooltip",d.root());e.each(function(){if($(this).attr("data-original-title")){$(this).on("mouseenter",$.proxy(d.show,d)).on("mouseleave click",$.proxy(d.hide,d))}})}if($.type(c)==="undefined"){$("[data-original-title]").each(function(d,e){a.call(b,$(e))})}else{if(!c.data("tooltip")){a.call(b,c)}}}});UM.ui.define("tab",{init:function(a){var c=this,b=a.selector;if($.type(b)){c.root($(b,a.context));c.data("context",a.context);$(b,c.data("context")).on("click",function(d){c.show(d)})}},show:function(i){var h=this,c=$(i.target),d=c.closest("ul"),b,g,a,i;b=c.attr("data-context");b=b&&b.replace(/.*(?=#[^\s]*$)/,"");var f=c.parent("li");if(!f.length||f.hasClass("edui-active")){return}g=d.find(".edui-active:last a")[0];i=$.Event("beforeshow",{target:c[0],relatedTarget:g});h.trigger(i);if(i.isDefaultPrevented()){return}a=$(b,h.data("context"));h.activate(c.parent("li"),d);h.activate(a,a.parent(),function(){h.trigger({type:"aftershow",relatedTarget:g})})},activate:function(c,b,d){if(c===undefined){return $(".edui-tab-item.edui-active",this.root()).index()}var a=b.find("> .edui-active");a.removeClass("edui-active");c.addClass("edui-active");d&&d()}});UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(a){var b=this;b.root($($.parseTmpl(b.tpl,a)));return b}});