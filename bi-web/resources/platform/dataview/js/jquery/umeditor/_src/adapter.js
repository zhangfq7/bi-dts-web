(function(){var b={},d={},c=[],h=null,f={},g={},a={},e=null;utils.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(i,j){utils.each(i.split(/\s+/),function(k){b[k]=j})},setEditor:function(i){!d[i.id]&&(d[i.id]=i)},registerWidget:function(j,k,i){f[j]=$.extend2(k,{$root:"",_preventDefault:false,root:function(l){return this.$root||(this.$root=l)},preventDefault:function(){this._preventDefault=true},clear:false});if(i){g[j]=i}},getWidgetData:function(i){return f[i]},setWidgetBody:function(i,l,j){if(!j._widgetData){utils.extend(j,{_widgetData:{},getWidgetData:function(m){return this._widgetData[m]},getWidgetCallback:function(n){var m=this;return function(){return g[n].apply(m,[m,l].concat(Array.prototype.slice.call(arguments,0)))}}})}var k=f[i];if(!k){return null}k=j._widgetData[i];if(!k){k=f[i];k=j._widgetData[i]=$.type(k)=="function"?k:utils.clone(k)}k.root(l.edui().getBodyContainer());k.initContent(j,l);if(!k._preventDefault){k.initEvent(j,l)}k.width&&l.width(k.width)},setActiveWidget:function(i){h=i},getEditor:function(k,i){var j=d[k]||(d[k]=this.createEditor(k,i));e=e?Math.max(j.getOpt("zIndex"),e):j.getOpt("zIndex");return j},setTopEditor:function(i){$.each(d,function(j,k){if(i==k){i.$container&&i.$container.css("zIndex",e+1)}else{k.$container&&k.$container.css("zIndex",k.getOpt("zIndex"))}})},clearCache:function(i){if(d[i]){delete d[i]}},delEditor:function(j){var i;if(i=d[j]){i.destroy()}},ready:function(i){c.push(i)},createEditor:function(m,j){var l=new UM.Editor(j);var i=this;l.langIsReady?$.proxy(k,i)():l.addListener("langReady",$.proxy(k,i));function k(){var o=this.createUI("#"+m,l);l.key=m;l.ready(function(){$.each(c,function(p,q){$.proxy(q,l)()})});var n=l.options;if(n.initialFrameWidth){n.minFrameWidth=n.initialFrameWidth}else{n.minFrameWidth=n.initialFrameWidth=l.$body.width()||UM.defaultWidth}o.css({width:n.initialFrameWidth,zIndex:l.getOpt("zIndex")});UM.browser.ie&&UM.browser.version===6&&document.execCommand("BackgroundImageCache",false,true);l.render(m);$.eduitooltip&&$.eduitooltip("attachTo",$("[data-original-title]",o)).css("z-index",l.getOpt("zIndex")+1);o.find("a").click(function(p){p.preventDefault()});l.fireEvent("afteruiready")}return l},createUI:function(m,k){var j=$(m),l=$('<div class="edui-container"><div class="edui-editor-body"></div></div>').insertBefore(j);k.$container=l;k.container=l[0];k.$body=j;if(browser.ie&&browser.ie9above){var i=$('<span style="padding:0;margin:0;height:0;width:0"></span>');i.insertAfter(l)}$.each(b,function(q,o){var p=o.call(k,q);if(p){a[q]=p}});l.find(".edui-editor-body").append(j).before(this.createToolbar(k.options,k));l.find(".edui-toolbar").append($('<div class="edui-dialog-container"></div>'));return l},createToolbar:function(j,k){var i=$.eduitoolbar(),m=i.edui();if(j.toolbar&&j.toolbar.length){var l=[];$.each(j.toolbar,function(n,o){$.each(o.split(/\s+/),function(q,p){if(p=="|"){$.eduiseparator&&l.push($.eduiseparator())}else{var r=a[p];if(p=="fullscreen"){r&&l.unshift(r)}else{r&&l.push(r)}}});l.length&&m.appendToBtnmenu(l)})}else{i.find(".edui-btn-toolbar").remove()}return i}})})();UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(a){var c=this;var b=$.eduibutton({icon:a,click:function(){c.execCommand(a)},title:this.getLang("labelMap")[a]||""});this.addListener("selectionchange",function(){var d=this.queryCommandState(a);b.edui().disabled(d==-1).active(d==1)});return b});(function(){var c={},f=["width","height","position","top","left","margin","padding","overflowX","overflowY"],a={},d={},e={},g={};UM.registerUI("fullscreen",function(h){var i=this,j=$.eduibutton({icon:"fullscreen",title:(i.options.labelMap&&i.options.labelMap[h])||i.getLang("labelMap."+h),click:function(){i.execCommand(h);UM.setTopEditor(i)}});i.addListener("selectionchange",function(){var k=this.queryCommandState(h);j.edui().disabled(k==-1).active(k==1)});i.addListener("ready",function(){i.options.fullscreen&&b.getInstance(i).toggle()});return j});UM.commands.fullscreen={execCommand:function(h){b.getInstance(this).toggle()},queryCommandState:function(h){return this._edui_fullscreen_status},notNeedUndo:1};function b(h){var i=this;if(!h){throw new Error("invalid params, notfound editor")}i.editor=h;g[h.uid]=this;h.addListener("destroy",function(){delete g[h.uid];i.editor=null})}b.prototype={toggle:function(){var i=this.editor,h=this.isFullState();i.fireEvent("beforefullscreenchange",!h);this.update(!h);!h?this.enlarge():this.revert();i.fireEvent("afterfullscreenchange",!h);if(i.body.contentEditable==="true"){i.fireEvent("fullscreenchanged",!h)}i.fireEvent("selectionchange")},enlarge:function(){this.saveSataus();this.setDocumentStatus();this.resize()},revert:function(){var i=this.editor.options,h=/%$/.test(i.initialFrameHeight)?"100%":(i.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width"));$.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+h+' ? "'+h+'px" : "auto"');this.revertContainerStatus();this.revertContentAreaStatus();this.revertDocumentStatus()},update:function(h){this.editor._edui_fullscreen_status=h},resize:function(){var j=null,p=0,i=0,h=0,l=0,m=this.editor,n=this,k=null,o=null;if(!this.isFullState()){return}j=$(window);i=j.width();p=j.height();o=this.getEditorHolder();h=parseInt(domUtils.getComputedStyle(o,"border-width"),10)||0;h+=parseInt(domUtils.getComputedStyle(m.container,"border-width"),10)||0;l+=parseInt(domUtils.getComputedStyle(o,"padding-left"),10)+parseInt(domUtils.getComputedStyle(o,"padding-right"),10)||0;$.IE6&&o.style.setExpression("height",null);k=this.getBound();$(m.container).css({width:i+"px",height:p+"px",position:!$.IE6?"fixed":"absolute",top:k.top,left:k.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"});$(o).css({width:i-2*h-l+"px",height:p-2*h-(m.options.withoutToolbar?0:$(".edui-toolbar",m.container).outerHeight())-$(".edui-bottombar",m.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"})},saveSataus:function(){var m=this.editor.container.style,l=null,j={};for(var k=0,h=f.length;k<h;k++){l=f[k];j[l]=m[l]}c[this.editor.uid]=j;this.saveContentAreaStatus();this.saveDocumentStatus()},saveContentAreaStatus:function(){var h=$(this.getEditorHolder());a[this.editor.uid]={width:h.css("width"),overflowX:h.css("overflowX"),overflowY:h.css("overflowY"),height:h.css("height")}},saveDocumentStatus:function(){var h=$(this.getEditorDocumentBody());d[this.editor.uid]={overflowX:h.css("overflowX"),overflowY:h.css("overflowY")};e[this.editor.uid]={overflowX:$(this.getEditorDocumentElement()).css("overflowX"),overflowY:$(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){$(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var h=this.getEditorHolder(),i=this.getContentAreaStatus();if(this.supportMin()){delete i.height;h.style.height=null}$(h).css(i)},revertDocumentStatus:function(){var h=this.getDocumentStatus();$(this.getEditorDocumentBody()).css("overflowX",h.body.overflowX);$(this.getEditorDocumentElement()).css("overflowY",h.html.overflowY)},setDocumentStatus:function(){$(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"});$(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return !!this.editor._edui_fullscreen_status},getEditorStatus:function(){return c[this.editor.uid]},getContentAreaStatus:function(){return a[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:d[this.editor.uid],html:e[this.editor.uid]}},supportMin:function(){var h=null;if(!this._support){h=document.createElement("div");this._support="minWidth" in h.style;h=null}return this._support},getBound:function(){var i={html:true,body:true},h={top:0,left:0},j=null;if(!$.IE6){return h}j=this.editor.container.offsetParent;if(j&&!i[j.nodeName.toLowerCase()]){i=j.getBoundingClientRect();h.top=-i.top;h.left=-i.left}return h},getStyleValue:function(h){return parseInt(domUtils.getComputedStyle(this.getEditorHolder(),h))}};$.extend(b,{listen:function(){var h=null;if(b._hasFullscreenListener){return}b._hasFullscreenListener=true;$(window).on("resize",function(){if(h!==null){window.clearTimeout(h);h=null}h=window.setTimeout(function(){for(var i in g){g[i].resize()}h=null},50)})},getInstance:function(h){if(!g[h.uid]){new b(h)}return g[h.uid]}});b.listen()})();UM.registerUI("link image video map formula",function(b){var e=this,a,f,c={title:(e.options.labelMap&&e.options.labelMap[b])||e.getLang("labelMap."+b),url:e.options.UMEDITOR_HOME_URL+"dialogs/"+b+"/"+b+".js"};var d=$.eduibutton({icon:b,title:this.getLang("labelMap")[b]||""});utils.loadFile(document,{src:c.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var i=UM.getWidgetData(b);if(!i){return}if(i.buttons){var g=i.buttons.ok;if(g){c.oklabel=g.label||e.getLang("ok");if(g.exec){c.okFn=function(){return $.proxy(g.exec,null,e,f)()}}}var h=i.buttons.cancel;if(h){c.cancellabel=h.label||e.getLang("cancel");if(h.exec){c.cancelFn=function(){return $.proxy(h.exec,null,e,f)()}}}}i.width&&(c.width=i.width);i.height&&(c.height=i.height);f=$.eduimodal(c);f.attr("id","edui-dialog-"+b).addClass("edui-dialog-"+b).find(".edui-modal-body").addClass("edui-dialog-"+b+"-body");f.edui().on("beforehide",function(){var j=e.selection.getRange();if(j.equals(a)){j.select()}}).on("beforeshow",function(){var k=this.root(),j=null,l=null;a=e.selection.getRange();if(!k.parent()[0]){e.$container.find(".edui-dialog-container").append(k)}if($.IE6){j={width:$(window).width(),height:$(window).height()};l=k.parents(".edui-toolbar")[0].getBoundingClientRect();k.css({position:"absolute",margin:0,left:(j.width-k.width())/2-l.left,top:100-l.top})}UM.setWidgetBody(b,f,e);UM.setTopEditor(e)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",e.getOpt("zIndex")+1).appendTo(e.$container.find(".edui-dialog-container"));f.css("zIndex",e.getOpt("zIndex")+2)}).on("beforeok",function(){try{a.select()}catch(j){}}).attachTo(d)});e.addListener("selectionchange",function(){var g=this.queryCommandState(b);d.edui().disabled(g==-1).active(g==1)});return d});UM.registerUI("emotion formula",function(b){var d=this,a=d.options.UMEDITOR_HOME_URL+"dialogs/"+b+"/"+b+".js";var c=$.eduibutton({icon:b,title:this.getLang("labelMap")[b]||""});utils.loadFile(document,{src:a,tag:"script",type:"text/javascript",defer:"defer"},function(){var e={url:a};var f=UM.getWidgetData(b);f.width&&(e.width=f.width);f.height&&(e.height=f.height);$.eduipopup(e).css("zIndex",d.options.zIndex+1).addClass("edui-popup-"+b).edui().on("beforeshow",function(){var g=this.root();if(!g.parent().length){d.$container.find(".edui-dialog-container").append(g)}UM.setWidgetBody(b,g,d);UM.setTopEditor(d)}).attachTo(c,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8});d.addListener("selectionchange",function(){var g=this.queryCommandState(b);c.edui().disabled(g==-1).active(g==1)})});return c});UM.registerUI("imagescale",function(){var a=this,b;a.setOpt("imageScaleEnabled",true);if(browser.webkit&&a.getOpt("imageScaleEnabled")){a.addListener("click",function(h,j){var f=a.selection.getRange(),d=f.getClosedNode(),i=j.target;if(d&&d.tagName=="IMG"&&i==d){if(!b){b=$.eduiscale({"$wrap":a.$container}).css("zIndex",a.options.zIndex);a.$container.append(b);var g=function(){b.edui().hide()},c=function(m){var l=m.target||m.srcElement;if(l&&l.className.indexOf("edui-scale")==-1){g(m)}},k;b.edui().on("aftershow",function(){$(document).bind("keydown",g);$(document).bind("mousedown",c);a.selection.getNative().removeAllRanges()}).on("afterhide",function(){$(document).unbind("keydown",g);$(document).unbind("mousedown",c);var e=b.edui().getScaleTarget();if(e.parentNode){a.selection.getRange().selectNode(e).select()}}).on("mousedown",function(m){a.selection.getNative().removeAllRanges();var l=m.target||m.srcElement;if(l&&l.className.indexOf("edui-scale-hand")==-1){k=setTimeout(function(){b.edui().hide()},200)}}).on("mouseup",function(m){var l=m.target||m.srcElement;if(l&&l.className.indexOf("edui-scale-hand")==-1){clearTimeout(k)}})}b.edui().show($(d))}else{if(b&&b.css("display")!="none"){b.edui().hide()}}});a.addListener("click",function(d,f){if(f.target.tagName=="IMG"){var c=new dom.Range(a.document,a.body);c.selectNode(f.target).select()}})}});UM.registerUI("autofloat",function(){var c=this,d=c.getLang();c.setOpt({autoFloatEnabled:true,topOffset:0});var a=c.options.autoFloatEnabled!==false,b=c.options.topOffset;if(!a){return}c.ready(function(){var h=browser.ie&&browser.version<=6,j=browser.quirks;function k(){if(!UM.ui){alert(d.autofloatMsg);return 0}return 1}function n(){var s=document.body.style;s.backgroundImage='url("about:blank")';s.backgroundAttachment="fixed"}var o,l=document.createElement("div"),m,f,r=function(s){var w;try{w=s.getBoundingClientRect()}catch(v){w={left:0,top:0,height:0,width:0}}var t={left:Math.round(w.left),top:Math.round(w.top),height:Math.round(w.bottom-w.top),width:Math.round(w.right-w.left)};var u;while((u=s.ownerDocument)!==document&&(s=domUtils.getWindow(u).frameElement)){w=s.getBoundingClientRect();t.left+=w.left;t.top+=w.top}t.bottom=t.top+t.height;t.right=t.left+t.width;return t};var i=false;function q(){if(i){return}var t=domUtils.getXY(m),s=domUtils.getComputedStyle(m,"position"),u=domUtils.getComputedStyle(m,"left");m.style.width=m.offsetWidth+"px";m.style.zIndex=c.options.zIndex*1+1;m.parentNode.insertBefore(l,m);if(h||(j&&browser.ie)){if(m.style.position!="absolute"){m.style.position="absolute"}m.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-f+b+"px"}else{if(m.style.position!="fixed"){m.style.position="fixed";m.style.top=b+"px";((s=="absolute"||s=="relative")&&parseFloat(u))&&(m.style.left=t.x+"px")}}}function g(){if(l.parentNode){l.parentNode.removeChild(l)}m.style.cssText=o}function p(){var s=r(c.container);var t=c.options.toolbarTopOffset||0;if(s.top<0&&s.bottom-m.offsetHeight>t){q()}else{g()}}var e=utils.defer(function(){p()},browser.ie?200:100,true);c.addListener("destroy",function(){$(window).off("scroll resize",p);c.removeListener("keydown",e)});if(k(c)){m=$(".edui-toolbar",c.container)[0];c.addListener("afteruiready",function(){setTimeout(function(){f=$(m).offset().top},100)});o=m.style.cssText;l.style.height=m.offsetHeight+"px";if(h){n()}$(window).on("scroll resize",p);c.addListener("keydown",e);c.addListener("resize",function(){g();l.style.height=m.offsetHeight+"px";p()});c.addListener("beforefullscreenchange",function(u,s){if(s){g();i=s}});c.addListener("fullscreenchanged",function(u,s){if(!s){p()}i=s});c.addListener("sourcemodechanged",function(u,s){setTimeout(function(){p()},0)});c.addListener("clearDoc",function(){setTimeout(function(){p()},0)})}})});UM.registerUI("source",function(a){var c=this;c.addListener("fullscreenchanged",function(){c.$container.find("textarea").width(c.$body.width()-10).height(c.$body.height())});var b=$.eduibutton({icon:a,click:function(){c.execCommand(a);UM.setTopEditor(c)},title:this.getLang("labelMap")[a]||""});this.addListener("selectionchange",function(){var d=this.queryCommandState(a);b.edui().disabled(d==-1).active(d==1)});return b});UM.registerUI("paragraph fontfamily fontsize",function(a){var h=this,i=(h.options.labelMap&&h.options.labelMap[a])||h.getLang("labelMap."+a),j={label:i,title:i,comboboxName:a,items:h.options[a]||[],itemStyles:[],value:[],autowidthitem:[]},g=null,f=null;if(j.items.length==0){return null}switch(a){case"paragraph":j=e(j);break;case"fontfamily":j=c(j);break;case"fontsize":j=b(j);break}g=$.eduibuttoncombobox(j).css("zIndex",h.getOpt("zIndex")+1);f=g.edui();f.on("comboboxselect",function(k,l){h.execCommand(a,l.value)}).on("beforeshow",function(){if(g.parent().length===0){g.appendTo(h.$container.find(".edui-dialog-container"))}UM.setTopEditor(h)});this.addListener("selectionchange",function(k){var m=this.queryCommandState(a),l=this.queryCommandValue(a);f.button().edui().disabled(m==-1).active(m==1);if(l){l=l.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/);f.selectItemByLabel(l)}});return f.button().addClass("edui-combobox");function d(n,l){var k=$("<span>").html(n).css({display:"inline",position:"absolute",top:-10000000,left:-100000}).appendTo(document.body),m=k.width();k.remove();k=null;if(m<50){return n}else{n=n.slice(0,l?-4:-1);if(!n.length){return"..."}return d(n+"...",true)}}function e(l){var k=[];for(var m in l.items){l.value.push(m);k.push(m);l.autowidthitem.push(d(m))}l.items=k;l.autoRecord=false;return l}function c(n){var m=null,l=[];for(var o=0,k=n.items.length;o<k;o++){m=n.items[o].val;l.push(m.split(/\s*,\s*/)[0]);n.itemStyles.push("font-family: "+m);n.value.push(m);n.autowidthitem.push(d(l[o]))}n.items=l;return n}function b(n){var m=null,l=[];n.itemStyles=[];n.value=[];for(var o=0,k=n.items.length;o<k;o++){m=n.items[o];l.push(m);n.itemStyles.push("font-size: "+m+"px")}n.value=n.items;n.items=l;n.autoRecord=false;return n}});UM.registerUI("forecolor backcolor",function(b){function a(){return domUtils.getComputedStyle(f[0],"background-color")}var e=this,c=null,f=null,d=null;this.addListener("selectionchange",function(){var g=this.queryCommandState(b);d.edui().disabled(g==-1).active(g==1)});d=$.eduicolorsplitbutton({icon:b,caret:true,name:b,title:e.getLang("labelMap")[b],click:function(){e.execCommand(b,a())}});f=d.edui().colorLabel();c=$.eduicolorpicker({name:b,lang_clearColor:e.getLang("clearColor")||"",lang_themeColor:e.getLang("themeColor")||"",lang_standardColor:e.getLang("standardColor")||""}).on("pickcolor",function(g,h){window.setTimeout(function(){f.css("backgroundColor",h);e.execCommand(b,h)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",e.getOpt("zIndex")+1);d.edui().on("arrowclick",function(){if(!c.parent().length){e.$container.find(".edui-dialog-container").append(c)}c.edui().show(d,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8});UM.setTopEditor(e)}).register("click",d,function(){c.edui().hide()});return d});