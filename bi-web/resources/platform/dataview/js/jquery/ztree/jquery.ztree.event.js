/*!
 * 
 * @author zhump
zTree input extend,Choice provide nicescroll 
By jQuery 1.4+

Version 1.0.0
If you have questions, please email me at 695004175@qq.com
*/
(function(){var b={lines:13,length:7,width:4,radius:10,corners:1,rotate:0,color:"#fff",speed:1,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000,};var a={init:function(){var i=this;var o={check:{enable:true,},view:{},data:{simpleData:{enable:true}},zIndex:999999,async:{otherParam:{searchText:""}},callback:{beforeClick:g,onCheck:m,onExpand:h,onAsyncSuccess:h}};var l="z"+new Date().getTime(),f="m"+l;o=$.extend(true,{},o,arguments[0]);if(o.async.label){$(this).data("code",o.async.code.split(",")).val(o.async.label)}o.treeId=l;i.prop("readonly",true);var e=jQuery("<div></div>",{id:f,"class":"treeMenu",css:{display:"none",position:"absolute","z-index":o.zIndex,}}).append(jQuery("<div></div>",{"class":"treefilterPanel no-select",html:"<div class='group'><input class='filterInput' placeholder='请输入搜索内容' /></div><button class='filterButton no-select ladda-button' data-spinner-color='#66afe9' data-style='slide-left'><span class='ladda-label'>查询</span></button>"})).append(jQuery("<ul></ul>",{id:l,"class":"ztree no-select ",css:{"margin-top":0,width:"180px",height:"250px",}})).append(jQuery("<div></div>",{"class":"treeToolPanel no-select",zTreeId:l,html:"<div class='checkAllNodes'>全选</div><div class='removeAllNodes'>清空</div><div class='closeTreeMenu'>关闭</div>"})).append(jQuery("<div></div>",{"class":"treeNoResultPanel",style:"display:none",html:"没有查询到相关维度信息！"})).append(jQuery("<div></div>",{"class":"ztree-loading",css:{position:"absolute",bottom:0,right:0,left:0,top:0,background:"rgba(135, 206, 250, .3)","z-index":99999999,display:"none"}})).appendTo("body");jQuery("#"+f).find(".filterButton").on("click keypress",function(q){p()});jQuery("#"+f).find(".filterInput").on("click keypress",function(q){if(q.keyCode=="13"){p()}});function p(){jQuery("#"+f).find(".ztree-loading").show(1,function(){var r=jQuery(this);var q=$.fn.zTree.getZTreeObj(l);q.setting.async.otherParam.searchText=jQuery("#"+f+" .filterInput").val();if(typeof(Spinner2)!="undefined"){r.spin(b)}q.reAsyncChildNodes(null,"refresh",false,function(){if(typeof(Spinner2)!="undefined"){r.spin("close").hide()}else{r.hide()}if($("#"+l+" >li").length==0){e.find(".treeNoResultPanel").show();$("#"+l).hide()}else{e.find(".treeNoResultPanel").hide();$("#"+l).show()}})})}e.find(".checkAllNodes").on("click",function(){if(!e.find(".treeNoResultPanel").is(":hidden")){return}var r=$.fn.zTree.getZTreeObj($(this).parent().attr("zTreeId"));r.checkAllNodes(true);nodes=r.getCheckedNodes(true),v="",value=[];for(var s=0,q=nodes.length;s<q;s++){v+=nodes[s].name+",";value.push(nodes[s].id)}if(v.length>0){v=v.substring(0,v.length-1)}i.val(v).data("code",value).focus()});e.find(".removeAllNodes").on("click",function(){var q=$.fn.zTree.getZTreeObj($(this).parent().attr("zTreeId"));q.checkAllNodes(false);i.val("");i.removeData("code")});e.find(".closeTreeMenu").on("click",function(){k()});$.fn.zTree.init($("#"+l),o,o.zNodes);jQuery(i).on("focus",function(){setTimeout(function(){n()},0)});function n(){var q=i.offset();$("#"+f).css({left:q.left+"px",top:q.top+i.outerHeight()+10+"px"}).fadeIn();$("body").on("mousedown scroll",c);if($.nicescroll){j($("#"+f+" .ztree"))}}function d(){e.find(".filterInput").val("");var u=i.data("code")||[];var q=$.fn.zTree.getZTreeObj(l);for(var r=0,t=u.length;r<t;r++){var s=q.getNodeByParam("code",u[r],null);if(s){q.checkNode(s,true,null,true)}}}function h(t,w,u){var x=i.data("code")||[];if(typeof(x)==="string"){x=x.split(",")}var q=$.fn.zTree.getZTreeObj(l);if(u){node=u.children}else{node=q.getNodes()}for(var r in node){var s=node[r].id;if($.inArray(s,x)>-1){q.checkNode(node[r],true,null,true)}}}function k(){$("#"+f).fadeOut("fast");$("body").off("mousedown scroll",c)}function c(q){if(!(q.target.id==i.attr("id")||q.target.id==f||$(q.target).parents("#"+f).length>0)){k()}}function g(s,r){var q=$.fn.zTree.getZTreeObj(s);q.checkNode(r,!r.checked,null,true);return false}function m(w,u,z){if(jQuery("#"+f).find(".ztree-loading:visible").length>0){return}var A=i.val().split(",");var r=i.data("code")||[];var y=$.fn.zTree.getZTreeObj(u),q=y.getCheckedNodes(true),C=[],B=[];for(var t=0,s=q.length;t<s;t++){B.push(q[t].id);C.push(q[t].name)}$.merge(C,A);$.merge(B,r);$.unique(C);$.unique(B);if(!z.checked){C.splice($.inArray(z.name,C),1);B.splice($.inArray(z.id,B),1)}var x=C.join(",");if(x.substring(x.length,x.length-1)==","){x=x.substring(0,x.length-1)}i.val(x).data("code",B)}function j(s,q){if(s.getNiceScroll().length==0){var r=$.extend(true,{},{cursorcolor:"#D4D4D4",cursorborder:"none",preservenativescrolling:false},q);s.niceScroll(r)}else{setTimeout(function(){s.getNiceScroll().resize()},100)}}this.data("treeId",l);return this},getCheckCode:function(){var c=$(this);return c.data("code")},setCheckCode:function(c,d){$(this).data("code",d.split(",")).val(c)},destroy:function(){var d=$(this);var c=d.data("treeId");if(c){jQuery("#m"+c).remove();$.fn.zTree.destroy(c)}}};$.fn.bzTree=function(){var c=arguments[0];if(a[c]){c=a[c];arguments=Array.prototype.slice.call(arguments,1)}else{if(typeof(c)=="object"||!c){c=a.init}else{console.error("Method "+c+" does not exist on jQuery.bzTree");return this}}return c.apply(this,arguments)}})(jQuery);