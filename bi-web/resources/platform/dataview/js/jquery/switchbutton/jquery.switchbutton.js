(function(b,a){b.widget("switchbutton.switchbutton",{options:{classes:"",duration:50,dragThreshold:5,autoResize:true,labels:true,checkedLabel:"ON",uncheckedLabel:"OFF",disabledClass:"ui-switchbutton-disabled ui-state-disabled",template:'<div class="ui-switchbutton ui-switchbutton-default ${classes} {{if !labels}}ui-switchbutton-no-labels{{/if}}" tabindex=0><label class="ui-switchbutton-disabled"><span>{{if labels}}${uncheckedLabel}{{/if}}</span></label><label class="ui-switchbutton-enabled"><span>{{if labels}}${checkedLabel}{{/if}}</span></label><div class="ui-switchbutton-handle"></div></div>'},_create:function(){if(!this.element.is(":checkbox")){return}this._wrapCheckboxInContainer();this._attachEvents();this._globalEvents();this._disableTextSelection();if(this.element.prop("checked")){this.$container.toggleClass("ui-state-active",this.element.prop("checked"))}if(this.options.autoResize){this._autoResize()}this._initialPosition()},_wrapCheckboxInContainer:function(){this.$container=b.tmpl(this.options.template,this.options);this.element.after(this.$container);this.element.remove();this.$container.append(this.element);this.$disabledLabel=this.$container.children(".ui-switchbutton-disabled");this.$disabledSpan=this.$disabledLabel.children("span");this.$enabledLabel=this.$container.children(".ui-switchbutton-enabled");this.$enabledSpan=this.$enabledLabel.children("span");this.$handle=this.$container.children(".ui-switchbutton-handle")},_attachEvents:function(){var c=this;this.$container.bind("keydown",function(e){if(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey){return}if(e.keyCode==32||e.keyCode==37||e.keyCode==39){e.preventDefault()}if(c.element.prop("disabled")){return}var d=c.element.prop("checked");if(e.keyCode==32||(e.keyCode==37&&d)||(e.keyCode==39&&!d)){var f=jQuery.Event("willChange");c.element.trigger(f);if(f.isDefaultPrevented()){return}d=!d;c.element.prop("checked",d);c.$container.toggleClass("ui-state-active",d);c.element.change();c.element.trigger("didChange")}}).bind("mousedown touchstart",function(e){e.preventDefault();if(c.element.prop("disabled")){return}b(this).focus();var d=e.pageX||e.originalEvent.changedTouches[0].pageX;b[a].currentlyClicking=c.$handle;b[a].dragStartPosition=d;b[a].handleLeftOffset=parseInt(c.$handle.css("left"),10)||0;b[a].dragStartedOn=c.element}).bind("iPhoneDrag",function(e,d){e.preventDefault();if(c.element.prop("disabled")){return}if(c.element!=b[a].dragStartedOn){return}var f=(d+b[a].handleLeftOffset-b[a].dragStartPosition)/c.rightSide;if(f<0){f=0}if(f>1){f=1}c.$handle.css({left:f*c.rightSide});c.$enabledLabel.css({width:f*c.rightSide});c.$disabledSpan.css({"margin-right":-f*c.rightSide});c.$enabledSpan.css({"margin-left":-(1-f)*c.rightSide})}).bind("iPhoneDragEnd",function(f,d){if(c.element.prop("disabled")){return}var h=jQuery.Event("willChange");c.element.trigger(h);if(h.isDefaultPrevented()){e=c.element.prop("checked")}else{var e;if(b[a].dragging){var g=(d-b[a].dragStartPosition)/c.rightSide;e=(g<0)?Math.abs(g)<0.5:g>=0.5}else{e=!c.element.prop("checked")}}b[a].currentlyClicking=null;b[a].dragging=null;c.element.prop("checked",e);c.$container.toggleClass("ui-state-active",e);c.element.change();c.element.trigger("didChange")});this.element.change(function(){c.refresh();var d=c.element.prop("checked")?c.rightSide:0;c.$handle.animate({left:d},c.options.duration);c.$enabledLabel.animate({width:d},c.options.duration);c.$disabledSpan.animate({"margin-right":-d},c.options.duration);c.$enabledSpan.animate({"margin-left":d-c.rightSide},c.options.duration)})},_globalEvents:function(){if(b[a].initComplete){return}var c=this.options;b(document).bind("mousemove touchmove",function(e){if(!b[a].currentlyClicking){return}e.preventDefault();var d=e.pageX||e.originalEvent.changedTouches[0].pageX;if(!b[a].dragging&&(Math.abs(b[a].dragStartPosition-d)>c.dragThreshold)){b[a].dragging=true}b(e.target).trigger("iPhoneDrag",[d])}).bind("mouseup touchend",function(e){if(!b[a].currentlyClicking){return}e.preventDefault();var d=e.pageX||e.originalEvent.changedTouches[0].pageX;b(b[a].currentlyClicking).trigger("iPhoneDragEnd",[d])})},_disableTextSelection:function(){b([this.$handle,this.$disabledLabel,this.$enabledLabel,this.$container]).attr("unselectable","on")},_autoResize:function(){var c=this.$container.find(":checkbox").width()/2;var d=c||this.$enabledLabel.width(),e=c||this.$disabledLabel.width(),g=this.$disabledSpan.innerWidth()-this.$disabledSpan.width();handleMargins=this.$handle.outerWidth()-this.$handle.innerWidth();var f=handleWidth=(d>e)?d:e;this.$handle.css({width:handleWidth-12});handleWidth=this.$handle.width();f+=handleWidth+6;spanWidth=f-handleWidth-g-handleMargins;this.$container.css({width:f});this.$container.find("span").width(spanWidth)},_initialPosition:function(){this.$disabledLabel.css({width:this.$container.width()-5});this.rightSide=this.$container.width()-this.$handle.outerWidth();if(this.element.prop("checked")){this.$handle.css({left:this.rightSide});this.$enabledLabel.css({width:this.rightSide});this.$disabledSpan.css({"margin-right":-this.rightSide})}else{this.$enabledLabel.css({width:0});this.$enabledSpan.css({"margin-left":-this.rightSide})}this.refresh()},enable:function(){this.element.prop("disabled",false);this.refresh();return this._setOption("disabled",false)},disable:function(){this.element.prop("disabled",true);this.refresh();return this._setOption("disabled",true)},widget:function(){return this.$container},refresh:function(){if(this.element.prop("disabled")){this.$container.addClass(this.options.disabledClass);return false}else{this.$container.removeClass(this.options.disabledClass)}}})})(jQuery,"switchbutton");