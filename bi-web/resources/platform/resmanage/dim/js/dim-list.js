define(["sabace","dimList/message"],function(b,e){jQuery(function(){jQuery("#selCreateType").chosen({disable_search:true});f();c()});function f(){jQuery("#dimGrid").jqGrid({url:b.handleUrlParam("/platform/resmanage/dim/query-dim-list"),styleUI:"Bootstrap",autowidth:true,postData:{},height:"auto",mtype:"post",regional:"cn",datatype:"json",viewrecords:true,rownumbers:true,colModel:[{label:b.getMessage("dim.label.dimName"),name:"dimName",index:"dimName",hlign:"center",width:130},{label:b.getMessage("dim.label.createType"),name:"createType",index:"createType",hlign:"center",width:80,formatter:function(g,h,i){if(g=="1"){return b.getMessage("dim.label.createType.text")}else{if(g=="2"){return b.getMessage("dim.label.createType.import")}else{if(g=="3"){return b.getMessage("dim.label.createType.sql")}else{return""}}}}},{label:b.getMessage("dim.label.parentDimName"),name:"parentDimName",index:"parentDimName",hlign:"center",width:180},{label:b.getMessage("dim.label.count"),name:"dimRecordNum",index:"dimRecordNum",hlign:"center",align:"right",width:60},{label:b.getMessage("dim.label.desc"),name:"dimDesc",index:"dimDesc",hlign:"center",width:150},{label:b.getMessage("dim.label.createTime"),name:"createTime",index:"createTime",hlign:"center",width:80},{label:b.getMessage("dim.label.opt"),name:"dimId",index:"dimId",align:"center",hlign:"center",width:80,formatter:function(g,h,j){if("1"==j.operFlag){var i=j.dimId;return"<a href='javascript:void(0)' class='dim-edit' dimId='"+i+"'>"+b.getMessage("dim.buttom.opt.update")+"</a> /  <a href='javascript:void(0)' class='dim-del' dimId='"+i+"'>"+b.getMessage("dim.buttom.opt.delete")+"</a> "}else{return""}}}],pager:"#dimGridPager",rowNum:10,rowList:[10,20,30],jsonReader:{records:"total",total:"totalPages"},afterInsertRow:function(h,g){jQuery(this).jqGrid("setCell",rowid,"operate","<a>"+b.getMessage("dim.label.opt")+"</a>")}})}function c(){jQuery("#search-btn").on("click",function(){d()});jQuery("#add-btn").on("click",function(){window.open(b.handleUrlParam("/platform/resmanage/dim/dim-page"))});jQuery(".dim-list").on("click",".dim-edit",function(){var g=jQuery(this).attr("dimId");window.open(b.handleUrlParam("/platform/resmanage/dim/dim-page")+"?dimId="+g)});jQuery(".dim-list").on("click",".dim-del",function(){var g=jQuery(this).attr("dimId");a(g)})}function a(h){var g={dimId:h};bi.dialog.confirm({title:b.getMessage("dim.title.confirm"),message:b.getMessage("dim.message.delete.confirm"),callback:function(i){if(i){b.ajax({type:"post",cache:false,dataType:"json",url:b.handleUrlParam("/platform/resmanage/dim/del-dim-info"),data:g,loading:{title:b.getMessage("dim.title.tips"),text:b.getMessage("dim.message.delete.doing")},success:function(m){if("succeed"==m.result){bi.dialog.show({title:b.getMessage("dim.title.succeed"),message:b.getMessage("dim.message.delete.succeed"),onhidden:function(){d()}})}else{if("disable"==m.result){var k=m.dataList;var n="";for(var j=0;j<k.length;j++){var l=k[j];n+="【"+l.dataName+"】";if(j>1){n+="...";break}if(j<k.length-1){n+=","}}bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("dim.title.error"),message:b.getMessage("dim.message.delete.disable",n)})}else{bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("dim.title.error"),message:b.getMessage("dim.message.delete.error")})}}},error:function(j){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("dim.title.error"),message:b.getMessage("dim.message.delete.error")})}})}}})}function d(){var g={};g.dimName=$("#selDimName").val();g.createType=$("#selCreateType").val();g.dimDesc=$("#selDimDesc").val();jQuery("#dimGrid").jqGrid("setGridParam",{postData:g}).trigger("reloadGrid")}$(window).resize(function(){$("#dimGrid").setGridWidth($(".dim-list").width()-5)});return{searchTable:d}});