define(["sabace"],function(g){function k(){h();$("#dimId").chosen({disable_search:false});jQuery("#dimId").on("change",a);jQuery("#toRightDim").on("click",c);jQuery("#toLeftDim").on("click",d)}function j(){var n="";jQuery.each(jQuery("#selectDimValueGrid").jqGrid("getRowData"),function(p,o){if(p==0){n+=o.dimCodeAttr}else{n+=","+o.dimCodeAttr}});var l={};var m=jQuery("#dimId").val();l.dimId=m;l.modifyFlag="0";l.dimValueCodes=n;jQuery("#unSelectDimValueGrid").jqGrid("setGridParam",{url:g.handleUrlParam("/platform/resmanage/authority/dim-value-list"),postData:l}).trigger("reloadGrid")}function d(){var m=jQuery("#selectDimValueGrid").jqGrid("getGridParam","selarrrow");var l=jQuery(m).length;if(l==0){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("authority.title.tips"),message:g.getMessage("authority.message.dim.select")});return}else{for(i=0;i<l;i++){jQuery("#selectDimValueGrid").jqGrid("delRowData",m[0])}j()}}function c(){var m=jQuery("#unSelectDimValueGrid").jqGrid("getGridParam","selarrrow");var l=jQuery(m).length;if(l==0){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("authority.title.tips"),message:g.getMessage("authority.message.dim.unselect")});return}else{var p=jQuery("#selectDimValueGrid").jqGrid("getDataIDs");var n=1;if(p.length>0){n=p.length+1}else{jQuery(".div-right .ui-jqgrid-bdiv>div").show();jQuery(".div-right .ui-jqgrid-bdiv .noResult").hide()}for(i=0;i<l;i++){var o=jQuery("#unSelectDimValueGrid").jqGrid("getRowData",m[i]);jQuery("#selectDimValueGrid").jqGrid("addRowData",n+i,o)}j()}}function h(){var l=jQuery("#modifyFlag").val();e(l);if("1"!=l){f()}}function f(o){var l={};var n=jQuery("#dimId").val();var m=jQuery("#userID").val();l.dimId=n;l.userId=m;l.modifyFlag=o;$("#selectDimValueGrid").jqGrid({url:g.handleUrlParam("/platform/resmanage/authority/selected-dim-value-list"),styleUI:"Bootstrap",postData:l,autowidth:true,datatype:"json",height:"auto",mtype:"post",regional:"cn",viewrecords:true,forceFit:true,caption:g.getMessage("authority.label.dim.select"),rownumbers:true,multiselect:true,width:430,height:204,rowNum:10000,colModel:[{label:g.getMessage("authority.label.dim.code"),name:"dimCodeAttr",width:200,align:"left",hlign:"center",sortable:false},{label:g.getMessage("authority.label.dim.name"),name:"dimCodeName",width:200,align:"left",hlign:"center",sortable:false}],rownumbers:true,loadComplete:function(){if("1"==o){j()}}})}function e(n){var l={};var m=jQuery("#dimId").val();l.dimId=m;l.modifyFlag=n;$("#unSelectDimValueGrid").jqGrid({url:g.handleUrlParam("/platform/resmanage/authority/dim-value-list"),styleUI:"Bootstrap",autowidth:true,postData:l,height:"auto",mtype:"post",regional:"cn",datatype:"json",viewrecords:true,forceFit:true,caption:g.getMessage("authority.label.dim.unselect"),multiselect:true,colModel:[{label:g.getMessage("authority.label.dim.code"),name:"dimCodeAttr",width:200,align:"left",hlign:"center",sortable:false},{label:g.getMessage("authority.label.dim.name"),name:"dimCodeName",width:200,align:"left",hlign:"center",sortable:false}],width:430,height:170,rowNum:5,rowList:[5],pager:"#unSelectDimValueGridPager",jsonReader:{records:"total",total:"totalPages"},loadComplete:function(){if("1"==n){f(n)}}})}function b(m){var o=jQuery("#userID").val();var l=jQuery("#dimId").val();var p="";jQuery.each(jQuery("#selectDimValueGrid").jqGrid("getRowData"),function(r,q){if(r==0){p+=q.dimCodeAttr}else{p+=","+q.dimCodeAttr}});var n={};n.dimId=l;n.userIds=o;n.dimValueCodes=p;bi.dialog.confirm({title:g.getMessage("authority.title.confirm"),message:g.getMessage("authority.message.save.confirm"),callback:function(q){if(q){g.ajax({data:n,url:g.handleUrlParam("/platform/resmanage/authority/save-user-dim"),success:function(s){var r=s.saveFlag;if("0"==r){bi.dialog.show({title:g.getMessage("authority.title.save.success"),message:g.getMessage("authority.message.save.success"),buttons:[{label:g.getMessage("authority.button.confirm"),cssClass:"btn-info",action:function(t){jQuery("#search").trigger("click");t.close();m.close()}}]})}else{bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("authority.title.save.failure"),message:g.getMessage("authority.message.save.failure")})}},error:function(r){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("authority.title.save.failure"),message:r.responseText||g.getMessage("authority.message.save.failure")})}})}}})}function a(){var l={};var m=jQuery("#dimId").val();l.dimId=m;l.dimValueCodes="";jQuery("#unSelectDimValueGrid").jqGrid("setGridParam",{url:g.handleUrlParam("/platform/resmanage/authority/dim-value-list"),postData:l}).trigger("reloadGrid");jQuery("#selectDimValueGrid").jqGrid("setGridParam").trigger("reloadGrid")}return{init:k,saveUserDimConfig:b}});