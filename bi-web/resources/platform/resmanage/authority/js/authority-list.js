define(["sabace","batchConfig","authorityEdit"],function(f,c,h){var e={};jQuery(function(){i();jQuery("#search").on("click",l);jQuery("#batchConfigBtn").on("click",b);jQuery("#authorityListPanel").on("click",".addDim",function(){g(this)});jQuery("#authorityListPanel").on("click",".editAuthority",function(){a(this)});jQuery("#authorityListPanel").on("click",".deleteAuthority",function(){k(this)})});function k(o){var n=$(o).attr("userId");var m=$(o).attr("dimId");bi.dialog.confirm({title:f.getMessage("authority.title.tips"),message:f.getMessage("authority.message.delete.confirm"),callback:function(p){if(p){f.ajax({type:"post",cache:false,dataType:"json",url:f.handleUrlParam("/platform/resmanage/authority/user-dim-delete"),data:{userIds:n,dimId:m},loading:{title:f.getMessage("authority.title.tips"),text:f.getMessage("authority.message.delete.loading")},success:function(q){bi.dialog.show({title:f.getMessage("authority.title.delete.success"),message:f.getMessage("authority.message.delete.success"),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:f.getMessage("authority.button.confirm"),cssClass:"btn-info",action:function(r){jQuery("#search").trigger("click");r.close()}}]})},error:function(q){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:f.getMessage("authority.title.delete.failure"),message:q.responseText||f.getMessage("authority.message.delete.failure")})}})}}})}function a(r){var o=$(r).attr("userId");var p=$(r).attr("userName");var n=$(r).attr("dimId");var q=$(r).attr("dimName");var m=f.handleUrlParam("/platform/resmanage/authority/dim-edit")+"?userId="+o+"&userName="+encodeURI(encodeURI(p))+"&dimId="+n+"&dimName="+encodeURI(encodeURI(q));bi.dialog.show({title:f.getMessage("authority.title.authority"),message:$('<div id="user-dim-config"></div>').load(m),spinicon:"glyphicon glyphicon-refresh",cssClass:"dim-user-dialog",closeByBackdrop:false,closeByKeyboard:false,onshown:function(){h.init()},buttons:[{label:f.getMessage("authority.button.cancel"),cssClass:"btn-default",action:function(s){s.close()}},{label:f.getMessage("authority.button.save"),cssClass:"btn-info",action:function(s){h.saveUserDimConfig(s)}}]})}function g(p){var n=$(p).attr("userId");var o=$(p).attr("userName");var m=f.handleUrlParam("/platform/resmanage/authority/dim-edit")+"?userId="+n+"&userName="+encodeURI(encodeURI(o));bi.dialog.show({title:f.getMessage("authority.title.authority"),message:$('<div id="user-dim-config"></div>').load(m),spinicon:"glyphicon glyphicon-refresh",cssClass:"dim-user-dialog",closeByBackdrop:false,closeByKeyboard:false,onshown:function(){h.init()},buttons:[{label:f.getMessage("authority.button.cancel"),cssClass:"btn-default",action:function(q){q.close()}},{label:f.getMessage("authority.button.save"),cssClass:"btn-info",action:function(q){h.saveUserDimConfig(q)}}]})}function b(){var m=f.handleUrlParam("/platform/resmanage/authority/batch-add");bi.dialog.show({title:f.getMessage("authority.title.authority"),message:$('<div id="user-dim-config"></div>').load(m),spinicon:"glyphicon glyphicon-refresh",cssClass:"dim-user-dialog",closeByBackdrop:false,closeByKeyboard:false,onshown:function(){c.init()},buttons:[{label:f.getMessage("authority.button.cancel"),cssClass:"btn-default",action:function(n){n.close()}},{label:f.getMessage("authority.button.save"),cssClass:"btn-info",action:function(n){c.saveUserDimConfig(n)}}]})}function l(){var m={};var n=jQuery("#userName").val();var o=jQuery("#dimName").val();m.userName=n;m.dimName=o;jQuery("#authorityListGrid").jqGrid("setGridParam",{postData:m}).trigger("reloadGrid")}function i(){var m={};$("#authorityListGrid").jqGrid({url:f.handleUrlParam("/platform/resmanage/authority/authority-list"),styleUI:"Bootstrap",rownumbers:true,autowidth:true,postData:m,height:"auto",mtype:"post",regional:"cn",datatype:"json",viewrecords:true,forceFit:true,colModel:[{label:f.getMessage("authority.label.user.code"),name:"userId",width:80,hlign:"center",sortable:false,cellattr:function(q,o,p,n,r){return"id='userId"+q+"'"}},{label:f.getMessage("authority.label.user.name"),name:"userName",width:100,align:"left",hlign:"center",sortable:false,cellattr:function(q,o,p,n,r){return"id='userName"+q+"'"}},{label:f.getMessage("authority.label.dimId"),name:"dimId",width:80,align:"left",hlign:"center",sortable:false},{label:f.getMessage("authority.label.dimName"),name:"dimName",width:150,align:"left",hlign:"center",sortable:false},{label:f.getMessage("authority.label.dimValues"),name:"dimValueNames",width:230,align:"left",hlign:"center",sortable:false},{label:f.getMessage("authority.label.opt"),name:"opt",width:100,align:"center",hlign:"center",sortable:false,formatter:function(n,o,t){var q=t.userId;var r=t.userName;var p=t.dimId;var s=t.dimName;return"<a href='javascript:void(0)' class='editAuthority' userId='"+q+"' userName='"+r+"' dimId='"+p+"' dimName='"+s+"'>"+f.getMessage("authority.label.modify")+"</a> / <a href='javascript:void(0)' class='deleteAuthority' userId='"+q+"' dimId='"+p+"'>"+f.getMessage("authority.label.delete")+"</a>"}},{label:f.getMessage("authority.label.opt"),name:"operate",width:100,align:"center",hlign:"center",sortable:false,formatter:function(n,o,t){var q=t.userId;var r=t.userName;var p=t.dimId;var s=t.dimName;return"<a href='javascript:void(0)' class='addDim' userId='"+q+"' userName='"+r+"'>"+f.getMessage("authority.label.add")+"</a> "},cellattr:function(q,o,p,n,r){return"id='operate"+q+"'"}}],rowNum:10,rowList:[10,20,30],pager:"#authorityListGridPager",jsonReader:{records:"total",total:"totalPages"},gridComplete:function(){var n="authorityListGrid";d(n,"userId")},afterInsertRow:function(o,n){jQuery(this).jqGrid("setCell",rowid,"operate","<a>"+f.getMessage("authority.label.opt")+"</a>")}})}function d(m,t){var p=$("#"+m+"").getDataIDs();var r=p.length;for(var o=0;o<r;o++){var s=$("#"+m+"").jqGrid("getRowData",p[o]);var q=1;for(j=o+1;j<=r;j++){var n=$("#"+m+"").jqGrid("getRowData",p[j]);if(s[t]==n[t]){q++;$("#"+m+"").setCell(p[j],"userId","",{display:"none"});$("#"+m+"").setCell(p[j],"userName","",{display:"none"});$("#"+m+"").setCell(p[j],"operate","",{display:"none"})}else{q=1;break}$("#userId"+p[o]+"").attr("rowspan",q);$("#userId"+p[o]+"").css("vertical-align","middle");$("#userName"+p[o]+"").attr("rowspan",q);$("#userName"+p[o]+"").css("vertical-align","middle");$("#operate"+p[o]+"").attr("rowspan",q);$("#operate"+p[o]+"").css("vertical-align","middle")}}}});