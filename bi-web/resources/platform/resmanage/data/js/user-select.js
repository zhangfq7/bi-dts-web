define(["sabace"],function(h){var f={};var g={};f.view={init:function(){if(g.type=="1"){g.postData={dbId:g.dataId};g.ajaxData={dbId:g.dataId};g.rightUserUrl="/platform/resmanage/db/query-right-user";g.userUrl="/platform/resmanage/db/query-unright-user";g.saveUrl="/platform/resmanage/db/save-user-right"}else{if(g.type=="2"){g.postData={dataId:g.dataId};g.ajaxData={dataId:g.dataId};g.rightUserUrl="/platform/resmanage/data/query-right-user";g.userUrl="/platform/resmanage/data/query-unright-user";g.saveUrl="/platform/resmanage/data/save-user-right"}else{if(g.type=="3"){g.postData={tplId:g.dataId};g.ajaxData={tplId:g.dataId};g.rightUserUrl="/platform/myreport/tpl/query-right-user";g.userUrl="/platform/myreport/tpl/query-unright-user";g.saveUrl="/platform/myreport/tpl/save-user-right"}}}d();a()},saveUserSelect:function(){bi.dialog.confirm({title:h.getMessage("data.user.title.selectSave"),message:h.getMessage("data.user.message.confirmSave"),callback:function(k){if(k){e()}}})}};function d(){jQuery("#rightListGrid").jqGrid({url:h.handleUrlParam(g.rightUserUrl),postData:g.postData,styleUI:"Bootstrap",datatype:"json",mtype:"post",caption:h.getMessage("data.user.caption.power"),colModel:[{label:h.getMessage("data.user.label.userID"),name:"userID",align:"left",hlign:"center",hidden:true},{label:h.getMessage("data.user.label.userName"),name:"userName",align:"left",hlign:"center"},{label:h.getMessage("data.user.label.depName"),name:"depName",align:"left",hlign:"center",width:153}],multiselect:true,autowidth:true,shrinkToFit:false,rowNum:10000,width:380,height:294,rownumbers:true,regional:"cn",loadComplete:function(){b()}})}function a(){jQuery("#userSearchForm .searchButton").on("click",function(){var k=jQuery("#userSearchForm #userName").val();g.postData.userName=k;jQuery("#leftListGrid").jqGrid("setGridParam",{postData:g.postData}).trigger("reloadGrid");return false});jQuery("#right-arrow").on("click",function(){var l=jQuery("#leftListGrid").jqGrid("getGridParam","selarrrow");var k=jQuery(l).length;if(k==0){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:h.getMessage("data.db.title.tips"),message:h.getMessage("data.user.message.selectNotPower")});return}else{var o=jQuery("#rightListGrid").jqGrid("getDataIDs");var m=1;if(o.length>0){m=o.length+1}else{jQuery(".div-right .ui-jqgrid-bdiv>div").show();jQuery(".div-right .ui-jqgrid-bdiv .noResult").hide()}for(i=0;i<k;i++){var n=jQuery("#leftListGrid").jqGrid("getRowData",l[i]);jQuery("#rightListGrid").jqGrid("addRowData",m+i,n)}j()}});jQuery("#left-arrow").on("click",function(){var l=jQuery("#rightListGrid").jqGrid("getGridParam","selarrrow");var k=jQuery(l).length;if(k==0){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:h.getMessage("data.db.title.tips"),message:h.getMessage("data.user.message.selectPower")});return}else{for(i=0;i<k;i++){jQuery("#rightListGrid").jqGrid("delRowData",l[0])}j()}})}function b(){var k="";jQuery.each(jQuery("#rightListGrid").jqGrid("getRowData"),function(m,l){if(m==0){k+=l.userID}else{k+=","+l.userID}});g.postData.userIds=k;jQuery("#leftListGrid").jqGrid({url:h.handleUrlParam(g.userUrl),mtype:"post",postData:g.postData,styleUI:"Bootstrap",datatype:"json",caption:h.getMessage("data.user.caption.notPower"),colModel:[{label:h.getMessage("data.user.label.userID"),name:"userID",align:"left",hlign:"center",hidden:true},{label:h.getMessage("data.user.label.userName"),name:"userName",align:"left",hlign:"center"},{label:h.getMessage("data.user.label.depName"),name:"depName",align:"left",hlign:"center",width:153}],viewrecords:true,multiselect:true,autowidth:true,shrinkToFit:false,rowNum:10,width:380,height:260,rownumbers:true,pager:"#leftListGridPager",jsonReader:{records:"total",total:"totalPages"},regional:"cn"})}function j(){var l="";jQuery.each(jQuery("#rightListGrid").jqGrid("getRowData"),function(n,m){if(n==0){l+=m.userID}else{l+=","+m.userID}});var k=jQuery("#userSearchForm #userName").val();g.postData.userName=k;g.postData.userIds=l;jQuery("#leftListGrid").jqGrid("setGridParam",{postData:g.postData}).trigger("reloadGrid");return false}function e(){var k="";jQuery.each(jQuery("#rightListGrid").jqGrid("getRowData"),function(m,l){if(m==0){k+=l.userID}else{k+=","+l.userID}});g.ajaxData.userIds=k;h.ajax({url:h.handleUrlParam(g.saveUrl),data:g.ajaxData,loading:{title:h.getMessage("data.db.title.execute"),text:h.getMessage("data.user.loading.submit")},success:function(l){if(l.resFlag=="success"){c()}},error:function(l){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:h.getMessage("data.db.title.tips"),message:l.responseText||h.getMessage("data.user.message.setFailed")})}})}function c(){bi.dialog.show({type:bi.dialog.TYPE_INFO,title:h.getMessage("data.db.title.tips"),message:h.getMessage("data.user.message.setSuccess"),closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:h.getMessage("data.user.label.sure"),cssClass:"btn-success",action:function(k){window.parent.bi.dialog.closeAll()}}]})}f.control={init:function(l,k){g.type=l;g.dataId=k;f.view.init()},saveUserSelect:function(){f.view.saveUserSelect()}};return f.control});