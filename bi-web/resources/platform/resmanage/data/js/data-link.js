define(["sabace","plumb","dataLinkChoose","dataLinkFilter","dataDimensionFilter"],function(x,H,y,v,N){var S=false;var t=false;var Y={};var af={};var J;var U=false;var aa;var w=50;var I=50;var ab=[];jQuery(function(){if("add"==linkModifyFlag){A(MdataId,true)}else{f(MdataId);U=true}jQuery('[name="followOrigin"]').iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"});q();e();p();d();ae();i();ad();K();F();jQuery("#statemachine-demo").niceScroll();jQuery("#con-container").niceScroll();jQuery(".mess-content").niceScroll();o();jQuery("#validateForm").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"bottomLeft",showOneMessage:true});jQuery("#validateForm2").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"bottomLeft",showOneMessage:true});j();jQuery(".chosen-select").chosen();n()});function n(){x.ajax({url:x.handleUrlParam("/platform/resmanage/data/query-classify-list"),success:function(ah){z(ah.classifyList)},error:function(ah){}})}function z(aj){var an=aj.length;var ai=null;var am=null;var ah=null;var al="<option selected></option>";al+='<option value="">无</option>';if(an>0){for(var ak=0;ak<an;ak++){ai=aj[ak];ah=ai.classifyId;am=ai.classifyName;al+='<option value="'+ah+'">'+am+"</option>"}}jQuery("#classifySel").append(al);jQuery("#classifySel").trigger("chosen:updated")}function j(){jQuery("#step1 #step-title-label-first").on("click",function(){if(jQuery(this).prev().hasClass("active-notFinished")){return}else{if(!jQuery("#plumbContent2").hasClass("dis-none")){jQuery("#plumbContent2").addClass("dis-none")}if(!jQuery("#plumbContent3").hasClass("dis-none")){jQuery("#plumbContent3").addClass("dis-none")}if(jQuery("#plumbContent").hasClass("dis-none")){jQuery("#plumbContent").removeClass("dis-none")}if(jQuery("#step1").hasClass("step-tab-unselect")){jQuery("#step1").removeClass("step-tab-unselect");jQuery("#step1").addClass("step-tab-select")}if(jQuery("#step2").hasClass("step-tab-select")){jQuery("#step2").removeClass("step-tab-select");jQuery("#step2").addClass("step-tab-unselect")}if(jQuery("#step3").hasClass("step-tab-select")){jQuery("#step3").removeClass("step-tab-select");jQuery("#step3").addClass("step-tab-unselect")}jQuery("#dataResultGrid").jqGrid("clearGridData");$.jgrid.gridDestroy("#dataResultGrid");jQuery(".complete-content .r-grid").append('<table id="dataResultGrid"></table>')}});jQuery("#step2 #step-title-label-second").on("click",function(){if(jQuery(this).prev().hasClass("active-notFinished")){return}else{if(!O()){if(!jQuery("#plumbContent").hasClass("dis-none")){jQuery("#plumbContent").addClass("dis-none")}if(!jQuery("#plumbContent3").hasClass("dis-none")){jQuery("#plumbContent3").addClass("dis-none")}if(jQuery("#plumbContent2").hasClass("dis-none")){jQuery("#plumbContent2").removeClass("dis-none")}if(jQuery("#step2").hasClass("step-tab-unselect")){jQuery("#step2").removeClass("step-tab-unselect");jQuery("#step2").addClass("step-tab-select")}if(jQuery("#step1").hasClass("step-tab-select")){jQuery("#step1").removeClass("step-tab-select");jQuery("#step1").addClass("step-tab-unselect")}if(jQuery("#step3").hasClass("step-tab-select")){jQuery("#step3").removeClass("step-tab-select");jQuery("#step3").addClass("step-tab-unselect")}jQuery("#dataResultGrid").jqGrid("clearGridData");$.jgrid.gridDestroy("#dataResultGrid");jQuery(".complete-content .r-grid").append('<table id="dataResultGrid"></table>')}}});jQuery("#step3 #step-title-label-third").on("click",function(){if(jQuery(this).prev().hasClass("active-notFinished")){return}else{if(!O()){if(L().length>0){if(!jQuery("#plumbContent2").hasClass("dis-none")){jQuery("#plumbContent2").addClass("dis-none")}if(!jQuery("#plumbContent").hasClass("dis-none")){jQuery("#plumbContent").addClass("dis-none")}if(jQuery("#plumbContent3").hasClass("dis-none")){jQuery("#plumbContent3").removeClass("dis-none")}if(jQuery("#step3").hasClass("step-tab-unselect")){jQuery("#step3").removeClass("step-tab-unselect");jQuery("#step3").addClass("step-tab-select")}if(jQuery("#step1").hasClass("step-tab-select")){jQuery("#step1").removeClass("step-tab-select");jQuery("#step1").addClass("step-tab-unselect")}if(jQuery("#step2").hasClass("step-tab-select")){jQuery("#step2").removeClass("step-tab-select");jQuery("#step2").addClass("step-tab-unselect")}V();C()}else{bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.dataLink.label.chooseOneR")})}}}})}function c(){jQuery("#allAttrId").on("click",function(){if(jQuery("#allAttrId").is(":checked")){jQuery('input[name="attrId"]').each(function(){jQuery(this).prop("checked",true)})}else{$('input[name="attrId"]').each(function(){jQuery(this).prop("checked",false)})}});jQuery('input[name="attrId"]').on("click",function(){if(jQuery(this).is(":checked")){var ai=jQuery('input[name="attrId"]').length;var ah=jQuery('input[name="attrId"]:checked').length;if(ai===ah){jQuery("#allAttrId").prop("checked",true)}}else{jQuery("#allAttrId").prop("checked",false)}})}function f(ah){var ai={dataId:ah};x.ajax({url:x.handleUrlParam("/platform/resmanage/datalink/query-datalink-info"),data:ai,loading:{spin:true},success:function(ak){Y=ak.dataLinkObj;t=ak.reportFlag;for(var aj=0;aj<Y.nodeDataArray.length;aj++){T(Y.nodeDataArray[aj].nodeDataId,Y.nodeDataArray[aj].nodeLeft,Y.nodeDataArray[aj].nodeTop,Y)}ac();Z();b();W();if(t){bi.dialog.confirm({title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.import.message.linkbyreport"),callback:function(al){if(!al){window.close()}}})}},error:function(aj){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:aj.responseText||x.getMessage("data.dataLink.error.queryLinkError")})}})}function W(){if(!S){jQuery("#twoStep,#thirdStep").removeClass("active-notFinished")}}function b(){jQuery("#dataName").val(Y.dataName);jQuery("input[name='followOrigin'][value="+Y.followOrigin+"]").attr("checked",true);jQuery("#dataDescText").text(Y.dataDesc);jQuery("#classifySel").val(Y.classifyId);jQuery("#classifySel").trigger("chosen:updated");ab=[];for(var ah=0;ah<Y.checkedArr.length;ah++){ab.push(Y.checkedArr[ah].attrId)}O();var ai=L();af.checkedArr=ai}function Z(){var ak=Y.linkWhereObjArray;if(ak.length>0){X()}for(var aj=0;aj<ak.length;aj++){var al=ak[aj].filterType;log(al);var ai=ak[aj].isExclude;if("2"==al||"1"==al||"4"==al||"6"==al||"7"==al){ak[aj].trueText=ak[aj].whereText}else{if("3"==al||"9"==al){if("0"==ai){ak[aj].trueText=x.getMessage("data.dataLink.label.Contains")+ak[aj].whereValue}else{ak[aj].trueText=x.getMessage("data.dataLink.label.Exclude")+ak[aj].whereValue}}else{if("8"==al){if("0"==ak[aj].whereValue){ak[aj].trueText=x.getMessage("data.dataLink.label.IsNotEmpty")}else{ak[aj].trueText=x.getMessage("data.dataLink.label.IsEmpty")}}}}var ah=jQuery("#"+ak[aj].dataId).children("#"+ak[aj].attrId).find(".pen-filter");jQuery(ah).after('<div class="up-no-icon-temp pen-icon-style-temp"></div>');k(ak[aj],ak[aj].attrId,ak[aj].attrName,ak[aj].dataId)}}function T(ah,al,ak,aj){var ai={nodeDataId:ah,isModify:"yes",dataId:aj.dataId};x.ajax({url:x.handleUrlParam("/platform/resmanage/datalink/main-data-node"),data:ai,async:false,success:function(am){am.linkNodeBean.nodeLeft=al;am.linkNodeBean.nodeTop=ak;l(am.linkNodeBean,true,"no");if("1"==am.delFlag){jQuery("#"+am.linkNodeBean.nodeDataId).children(".firstdiv-own").addClass("back-white")}if(x.IsEmpty(aa)){R()}else{r(am.linkNodeBean.nodeDataId)}},error:function(am){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:am.responseText||x.getMessage("data.dataLink.error.queryLinkNodeError")})}})}function ac(){var ai=Y.nodeDataLinkArray;for(var ah=0;ah<ai.length;ah++){J=ai[ah].linkType;aa.connect({source:ai[ah].leftAttrId,target:ai[ah].rightAttrId})}}function i(){jQuery("#addNode,#addNodeLabel").on("click",function(){var aj=jQuery(".statemachine-demo .mydiv");var ah=new Array;for(var ai=0;ai<aj.length;ai++){ah.push(jQuery(aj[ai]).attr("id"))}m(ah)});jQuery("#clearNode,#clearNodeLabel").on("click",function(){bi.dialog.confirm({title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.dataLink.label.clearAllNode"),callback:function(ah){if(ah){B()}}})})}function m(ah){var ai=x.handleUrlParam("/platform/resmanage/datalink/data-link-choose");bi.dialog.show({title:x.getMessage("data.dataLink.label.addDataNode"),message:jQuery('<div width="955px" height="450px" id="daChooseIframe"></div>').load(ai),cssClass:"data-choose-dialog",closable:true,closeByBackdrop:false,closeByKeyboard:false,onshown:function(){y.setNodeIdArray(ah);y.init()},buttons:[{label:x.getMessage("data.dataLink.label.Sure"),cssClass:"btn-info",action:function(aj){x.ajax({url:x.handleUrlParam("/platform/resmanage/datalink/query-link-data"),success:function(an){var al=y.getCheckedNode();var ao=an.dataLinkNum;var am=jQuery(".statemachine-demo .mydiv");if(ao>=am.length+al.length){for(var ak=0;ak<al.length;ak++){A(al[ak].dataId,false)}}else{bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.import.message.linkoverbycom")})}aj.close()},error:function(ak){aj.close();bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:ak.responseText||x.getMessage("data.import.message.linkoverbycom")})}})}},{label:x.getMessage("data.dataLink.label.Cancel"),action:function(aj){aj.close()}}]})}function A(ah,aj){var ai={nodeDataId:ah,isModify:"no"};x.ajax({url:x.handleUrlParam("/platform/resmanage/datalink/main-data-node"),data:ai,loading:{title:x.getMessage("data.dataLink.label.workingTitle"),text:x.getMessage("data.dataLink.label.workingLoading")},success:function(ak){if(aj){l(ak.linkNodeBean,true,"yes");R()}else{l(ak.linkNodeBean,false,"yes");r(ah)}},error:function(ak){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:ak.responseText||x.getMessage("data.dataLink.error.queryLinkNodeError")})}})}function K(){jQuery("#statemachine-demo").on("click",".del-icon",function(){var ah=jQuery(this);bi.dialog.confirm({title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.dataLink.label.clearNode"),callback:function(ai){if(ai){var am=[];var ap=ah.parent().parent().find(".divline");for(var al=0;al<ap.length;al++){am.push(jQuery(ap[al]).attr("id"))}var ao=aa.getConnections();for(var al=0;al<ao.length;al++){for(var aj=0;aj<am.length;aj++){if(am[aj]==ao[al].sourceId||am[aj]==ao[al].targetId){aa.detach(ao[al])}}}ah.parent().parent().remove();var ak=jQuery(".statemachine-demo .mydiv");if(ak.length==0){jQuery("#addNode").click()}var an=jQuery(".con-box #"+ah.parent().parent().attr("id"));for(var al=0;al<an.length;al++){if(jQuery(an[al]).parent().prev(".con-and").length==0){jQuery(an[al]).parent().next(".con-and").remove()}else{jQuery(an[al]).parent().prev(".con-and").remove()}jQuery(an[al]).parent().remove()}}}})})}function ad(){jQuery("#statemachine-demo").on("click",".pen-filter",function(){var ai=jQuery(this).children("#pen-icon-id").val();var ao=jQuery(this).children("#pen-isUsed").val();if(0==ao){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.dataLink.label.reChooseAttr")});return}var al=jQuery(this).children("#pen-icon-name").val();var ah=jQuery(this).children("#pen-filterType").val();var aj=jQuery(this).children("#pen-attrType").val();var ar=jQuery(this).children("#pen-fieldName").val();var aq=jQuery(this).children("#pen-dimId").val();var ak=jQuery(this).parent().parent().parent().attr("id");var an=M(this);var ap={};if("modify"==an){var at=jQuery(".con-box .con-box-in #filterParamId");for(var am=0;am<at.length;am++){if(ai==jQuery(at[am]).val()){ap.whereText=jQuery(at[am]).parent().next(".con-box-content").children(".font-div-date").children("#whereText").val();ap.whereValue=jQuery(at[am]).parent().next(".con-box-content").children(".font-div-date").children("#whereValue").val();ap.isExclude=jQuery(at[am]).parent().next(".con-box-content").children(".font-div-date").children("#isExclude").val();ap.filterType=jQuery(at[am]).parent().next(".con-box-content").children(".font-div-date").children("#filterType").val()}}}ap.dimId=aq;if("1"==ah){g(ai,al,ar,this,an,ap,ak)}else{if("4"==ah){E(ai,al,ar,this,an,ap,ak,"1")}else{if("6"==ah){E(ai,al,ar,this,an,ap,ak,"2")}else{if("7"==ah){E(ai,al,ar,this,an,ap,ak,"3")}else{if("1"==aj){E(ai,al,ar,this,an,ap,ak,"8")}else{if("2"==aj){E(ai,al,ar,this,an,ap,ak,"2")}else{E(ai,al,ar,this,an,ap,ak,"9")}}}}}}})}function g(ai,al,ao,am,ak,an,ah){var aj=x.handleUrlParam("/platform/resmanage/datalink/data-dimension-filter");if("modify"==ak){N.setModifyObj(an)}bi.dialog.show({title:x.getMessage("data.dataLink.label.Cselection"),message:jQuery('<div width="761px" height="360px" id="daFilter"></div>').load(aj),cssClass:"data-dim-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,onshown:function(){N.setDimId(an.dimId);if("modify"==ak){N.init(ak)}else{N.init()}},buttons:[{label:x.getMessage("data.dataLink.label.Sure"),cssClass:"btn-info",action:function(ar){var au=N.getDimCode();if(!x.IsEmpty(au.whereValue)){if("modify"==ak){var at=jQuery(".con-box .con-box-in #filterParamId");for(var aq=0;aq<at.length;aq++){if(ai==jQuery(at[aq]).val()){ag(at[aq],au)}}}else{k(au,ai,al,ah);jQuery(am).after('<div class="up-no-icon-temp pen-icon-style-temp"></div>')}X()}else{if("modify"==ak){log(ah);var ap=jQuery("#con-container .con-box #"+ah+" #filterParamId");for(var aq=0;aq<ap.length;aq++){if(ai==jQuery(ap[aq]).val()){jQuery(ap[aq]).nextAll(".del-icon").trigger("click")}}}}ar.close()}}]})}function E(ah,al,ap,am,an,ao,ak,aj){if("modify"==an){v.setModifyObj(ao)}var ai=x.handleUrlParam("/platform/resmanage/datalink/data-link-filter");bi.dialog.show({title:x.getMessage("data.dataLink.label.Cselection"),message:jQuery('<div width="761px" height="238px" id="daFilter"></div>').load(ai),cssClass:"data-filter-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,onshown:function(){if("modify"==an){v.init(aj,an)}else{v.init(aj)}},buttons:[{label:x.getMessage("data.dataLink.label.Sure"),cssClass:"btn-info",action:function(ar){var au=v.getSelectQuery();if(!au){return false}else{if("modify"==an){var at=jQuery(".con-box .con-box-in #filterParamId");for(var aq=0;aq<at.length;aq++){if(ah==jQuery(at[aq]).val()){ag(at[aq],au)}}}else{k(au,ah,al,ak);jQuery(am).after('<div class="up-no-icon-temp pen-icon-style-temp"></div>')}X();ar.close()}}}]});jQuery(".chosen-select").chosen()}function M(ai){var ah=jQuery(ai).next(".up-no-icon-temp");if(ah.length>0){return"modify"}else{return"add"}}function k(an,ai,ak,ah){var am=jQuery(".con-box");if(am.length>0){var al='<div class="con-and"><label>并且</label></div>';jQuery("#con-container").append(al)}var ao="";ao+='<div class="con-box"';if(am.length>0){ao+=' style="margin-left:10px">'}else{ao+=">"}ao+='<div class="con-box-in" id="'+ah+'" >';var aj=ak;if(ak.length>4){ak=ak.substr(0,4)+".."}ao+='<div class="del-icon del-icon-style-filter" title="'+x.getMessage("data.dataLink.label.delete")+'"></div>';ao+="<label title="+aj+">"+ak+"</label>";ao+='<input type="hidden" id="filterParamId" value="'+ai+'"/>';ao+='<input type="hidden" id="filterParamName" value="'+ak+'"/>';ao+='<input type="hidden" id="dataId" value="'+ah+'"/>';ao+="</div>";ao+='<div class="con-box-content">';ao+='<div class="nbsp-icon nbsp-icon-style"></div>';ao+='<div class="font-div">'+x.getMessage("data.dataLink.label.conditionValue")+"</div>";ao+='<div class="font-div font-div-date textOverflow" title="'+an.trueText+'">'+an.trueText;ao+='<input type="hidden" id="whereText" value="'+an.whereText+'"/>';ao+='<input type="hidden" id="whereValue" value="'+an.whereValue+'"/>';ao+='<input type="hidden" id="filterType" value="'+an.filterType+'"/>';ao+='<input type="hidden" id="isExclude" value="'+an.isExclude+'"/>';ao+="</div>";ao+="</div>";ao+="</div>";jQuery("#con-container").append(ao)}function F(){jQuery("#con-container").on("click",".del-icon-style-filter",function(){var ah=jQuery(this);bi.dialog.confirm({title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.dataLink.label.clearNodeFilter"),callback:function(ai){if(ai){var aj=ah.nextAll("#filterParamId").val();jQuery("#"+aj).children(".paramdiv").children(".pen-icon-style-temp").remove();if(ah.parent().parent().prev(".con-and").length==0){ah.parent().parent().next(".con-and").remove()}else{ah.parent().parent().prev(".con-and").remove()}ah.parent().parent().remove()}}})})}function ag(aj,ai){jQuery(aj).parent().next(".con-box-content").children(".font-div-date").text(ai.trueText);jQuery(aj).parent().next(".con-box-content").children(".font-div-date").prop("title",ai.trueText);var ah='<input type="hidden" id="whereText" value="'+ai.whereText+'"/>';ah+='<input type="hidden" id="whereValue" value="'+ai.whereValue+'"/>';ah+='<input type="hidden" id="filterType" value="'+ai.filterType+'"/>';ah+='<input type="hidden" id="isExclude" value="'+ai.isExclude+'"/>';jQuery(aj).parent().next(".con-box-content").children(".font-div-date").append(ah)}function X(){if(jQuery("#plumblabel").hasClass("plumblabelTemp")){jQuery("#plumblabel").removeClass("plumblabelTemp");jQuery("#plumblabel").addClass("plumblabel")}if(jQuery("#statemachine-demo").hasClass("dpanelTemp")){jQuery("#statemachine-demo").removeClass("dpanelTemp");jQuery("#statemachine-demo").addClass("dpanel")}if(jQuery("#conditionlabel").hasClass("conditionlabelTemp")){jQuery("#conditionlabel").removeClass("conditionlabelTemp");jQuery("#conditionlabel").addClass("conditionlabel")}if(jQuery(".containerDiv").hasClass("dis-none")){jQuery(".containerDiv").removeClass("dis-none")}if(jQuery("#updown").hasClass("upshow-icon")){jQuery("#updown").removeClass("upshow-icon");jQuery("#updown").removeClass("upshow-icon-style");jQuery("#updown").addClass("down-icon");jQuery("#updown").addClass("down-icon-style")}}function B(){aa.detachEveryConnection();var ak=jQuery(".statemachine-demo .mydiv");var ah=new Array;for(var aj=0;aj<ak.length;aj++){ah.push(jQuery(ak[aj]).attr("id"))}for(var aj=0;aj<ah.length;aj++){if(MdataId==ah[aj]){}jQuery("#"+ah[aj]).remove();var al=jQuery(".con-box #"+ah[aj]);for(var ai=0;ai<al.length;ai++){if(jQuery(al[ai]).parent().prev(".con-and").length==0){jQuery(al[ai]).parent().next(".con-and").remove()}else{jQuery(al[ai]).parent().prev(".con-and").remove()}jQuery(al[ai]).parent().remove()}}jQuery("#addNode").click()}function r(ai){aa.draggable(jsPlumb.getSelector(".statemachine-demo #"+ai));var ah=jsPlumb.getSelector("#"+ai+" .ziduan");aa.makeSource(ah,{filter:".paramdiv,.textOverflow",dropOptions:{hoverClass:"dragHover"},connector:["StateMachine",{curviness:20}],connectorStyle:{strokeStyle:"#5c96bc",lineWidth:2,outlineColor:"transparent",outlineWidth:4},anchor:"Continuous"});aa.makeTarget(ah,{filter:".paramdiv,.textOverflow",dropOptions:{hoverClass:"dragHover"},anchor:"Continuous"})}function l(al,ai,ak){var ah="";if("yes"==ak){ah+='<div class="mydiv w" id="'+al.nodeDataId+'" style="top:'+I+"px;left:"+w+'px">';I+=10;w+=10}else{ah+='<div class="mydiv w" id="'+al.nodeDataId+'" style="top:'+al.nodeTop+"px;left:"+al.nodeLeft+'px">'}ah+='<div class="firstdiv-own chooseDiv">';ah+='<div class="del-icon del-icon-style"></div>';ah+='<div class="file-icon file-icon-style"></div>';ah+='<div title="'+al.nodeDataName+'" class="tb-title">'+al.nodeDataName+"</div>";ah+='<div style="clear:both;"></div>';ah+="</div>";var am="";for(var aj=0;aj<al.linkSelectBeanList.length;aj++){if("1"==al.linkSelectBeanList[aj].isUsed){am+='<div class="divline ziduan" id="'+al.linkSelectBeanList[aj].attrId+'">'}else{am+='<div style="color:red" class="divline ziduan" id="'+al.linkSelectBeanList[aj].attrId+'">'}am+='<div class="paramdiv" style="width:100%"><div style="width:70%;float:left" title="'+al.linkSelectBeanList[aj].attrName+'" class="textOverflow">'+al.linkSelectBeanList[aj].attrName;am+='</div><div class="pen-icon pen-icon-style pen-filter">';am+='<input type="hidden" id="pen-icon-id" value="'+al.linkSelectBeanList[aj].attrId+'"/>';am+='<input type="hidden" id="pen-icon-name" value="'+al.linkSelectBeanList[aj].attrName+'"/>';am+='<input type="hidden" id="pen-filterType" value="'+al.linkSelectBeanList[aj].filterType+'"/>';am+='<input type="hidden" id="pen-attrType" value="'+al.linkSelectBeanList[aj].attrType+'"/>';am+='<input type="hidden" id="pen-fieldName" value="'+al.linkSelectBeanList[aj].fieldName+'"/>';am+='<input type="hidden" id="pen-dimId" value="'+al.linkSelectBeanList[aj].dimId+'"/>';am+='<input type="hidden" id="pen-isUsed" value="'+al.linkSelectBeanList[aj].isUsed+'"/>';am+='<input type="hidden" id="pen-column-type" value="'+al.linkSelectBeanList[aj].columnType+'"/>';am+="</div>";am+="</div>";am+="</div>"}ah+=am;ah+="</div>";jQuery("#statemachine-demo").append(ah)}function ae(){jQuery("#updown").on("click",function(){jQuery("#plumblabel").toggleClass("plumblabel");jQuery("#plumblabel").toggleClass("plumblabelTemp");jQuery("#statemachine-demo").toggleClass("dpanel");jQuery("#statemachine-demo").toggleClass("dpanelTemp");jQuery("#conditionlabel").toggleClass("conditionlabel");jQuery("#conditionlabel").toggleClass("conditionlabelTemp");jQuery(".containerDiv").toggleClass("dis-none");jQuery(this).toggleClass("down-icon");jQuery(this).toggleClass("down-icon-style");jQuery(this).toggleClass("upshow-icon");jQuery(this).toggleClass("upshow-icon-style")})}function R(){jsPlumb.ready(function(){aa=jsPlumb.getInstance({Endpoint:["Dot",{radius:0.1}],HoverPaintStyle:{strokeStyle:"#1e8151",lineWidth:2},ConnectionOverlays:[["Arrow",{location:1,id:"arrow",length:14,foldback:0.8}],["Label",{label:"",id:"label",cssClass:"aLabel"}]],Container:"statemachine-demo"});var ah=jsPlumb.getSelector(".statemachine-demo .w");var ai=jsPlumb.getSelector(".statemachine-demo .w .ziduan");aa.draggable(ah);aa.bind("click",function(aj){aa.detach(aj)});aa.bind("connection",function(am){var at=aa.getConnections();var ar=0;for(var aq=0;aq<at.length;aq++){if(at[aq].sourceId==am.connection.sourceId&&at[aq].targetId==am.connection.targetId){ar+=1}if(at[aq].sourceId==am.connection.targetId&&at[aq].targetId==am.connection.sourceId){ar+=1}}if(ar==2){aa.detach(am);return}var ap=jQuery("#"+am.connection.targetId).parent().attr("id");var al=jQuery("#"+am.connection.sourceId).parent().attr("id");if(ap==al){aa.detach(am);return}if(am.connection.targetId==am.connection.sourceId){aa.detach(am);return}var ak=jQuery("#"+am.connection.targetId).find("#pen-column-type").val();var an=jQuery("#"+am.connection.sourceId).find("#pen-column-type").val();if(ak.startWith("text")||an.startWith("text")){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.import.message.fieldintext")});aa.detach(am);return}var aj="";aj+='<div id="chooseMessage" class="hide" >';aj+='<div class="form-group">';aj+='<label class="radioLabel radio">';aj+='<input type="radio" data-toggle="radio" value="leftjoin" name="relRadio" id="optionsRadios3" data-radiocheck-toggle="radio" checked="">';aj+='<span style="margin-left:5px">'+x.getMessage("data.dataLink.label.leftjoinTemp")+"</span>";aj+="</label>";aj+='<label class="radioLabel radio">';aj+='<input type="radio" data-toggle="radio" value="equals" name="relRadio" id="optionsRadios4" data-radiocheck-toggle="radio" required>';aj+='<span style="margin-left:5px">'+x.getMessage("data.dataLink.label.equalTemp")+"</span>";aj+="</label>";aj+="</div>";aj+="</div>";if("add"==linkModifyFlag){bi.dialog.show({title:x.getMessage("data.dataLink.label.chooseLink"),message:aj,cssClass:"data-message-dialog",nl2br:false,closable:false,closeByBackdrop:false,closeByKeyboard:false,onshown:function(){jQuery('[name="relRadio"]').iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"});jQuery("#chooseMessage").removeClass("hide")},buttons:[{label:x.getMessage("data.dataLink.label.Sure"),cssClass:"btn-info",action:function(au){if("leftjoin"==jQuery('input[name="relRadio"]:checked').val()){am.connection.getOverlay("label").setLabel(x.getMessage("data.dataLink.label.leftjoinTemp"));var av={lineWidth:3,strokeStyle:"#ffa500",dashstyle:"2 4"};am.connection.setPaintStyle(av)}else{am.connection.getOverlay("label").setLabel(x.getMessage("data.dataLink.label.equalTemp"))}if(am.connection.targetId==am.connection.sourceId){aa.detach(am)}P(at,am);au.close()}}]})}else{if("1"==J){J="";am.connection.getOverlay("label").setLabel(x.getMessage("data.dataLink.label.equalTemp"))}else{if("2"==J){am.connection.getOverlay("label").setLabel(x.getMessage("data.dataLink.label.leftjoinTemp"));var ao={lineWidth:3,strokeStyle:"#ffa500",dashstyle:"2 4"};J="";am.connection.setPaintStyle(ao)}else{bi.dialog.show({title:x.getMessage("data.dataLink.label.chooseLink"),message:aj,cssClass:"data-message-dialog",nl2br:false,closable:false,closeByBackdrop:false,closeByKeyboard:false,onshown:function(){jQuery('[name="relRadio"]').iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"});jQuery("#chooseMessage").removeClass("hide")},buttons:[{label:x.getMessage("data.dataLink.label.Sure"),cssClass:"btn-info",action:function(au){if("leftjoin"==jQuery('input[name="relRadio"]:checked').val()){am.connection.getOverlay("label").setLabel(x.getMessage("data.dataLink.label.leftjoinTemp"));var av={lineWidth:3,strokeStyle:"#ffa500",dashstyle:"2 4"};am.connection.setPaintStyle(av)}else{am.connection.getOverlay("label").setLabel(x.getMessage("data.dataLink.label.equalTemp"))}if(am.connection.targetId==am.connection.sourceId){aa.detach(am)}P(at,am);au.close()}}]})}}}});aa.makeSource(ai,{filter:".paramdiv,.textOverflow",dropOptions:{hoverClass:"dragHover"},connector:["StateMachine",{curviness:20}],connectorStyle:{strokeStyle:"#5c96bc",lineWidth:2,outlineColor:"transparent",outlineWidth:4},anchor:"Continuous"});aa.makeTarget(ai,{filter:".paramdiv,.textOverflow",dropOptions:{hoverClass:"dragHover"},anchor:"Continuous"});jsPlumb.fire("jsPlumbDemoLoaded",aa)})}function P(ai,an){var ak=0;var aj=null;var am=null;var al=null;var ao=null;for(var ah=0;ah<ai.length;ah++){aj=jQuery("#"+ai[ah].sourceId).parent().attr("id");am=jQuery("#"+an.connection.sourceId).parent().attr("id");al=jQuery("#"+ai[ah].targetId).parent().attr("id");ao=jQuery("#"+an.connection.targetId).parent().attr("id");if(aj==am&&al==ao){if(ai[ah]._jsPlumb.overlays.label.label!=an.connection._jsPlumb.overlays.label.label){ak+=1}}if(aj==ao&&al==am){if(ai[ah]._jsPlumb.overlays.label!=an.connection._jsPlumb.overlays.label.label){ak+=1}}}if(ak>0){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:"两个数据之间只能存在同种连接关系，所有的连接关系都为左连接或都为等于！"});aa.detach(an);return}}function q(){jQuery("#nextbth1").on("click",function(){if(!G()){bi.dialog.confirm({title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.dataLink.label.linkError")});return}var ah=O();if(!ah){jQuery("#plumbContent").addClass("dis-none");if(jQuery("#step1").hasClass("step-tab-select")){jQuery("#step1").removeClass("step-tab-select");jQuery("#step1").addClass("step-tab-unselect")}if(jQuery("#step2").hasClass("step-tab-unselect")){jQuery("#step2").removeClass("step-tab-unselect");jQuery("#step2").addClass("step-tab-select")}if(jQuery("#plumbContent2").hasClass("dis-none")){jQuery("#plumbContent2").removeClass("dis-none")}jQuery("#step2 .step-title-num").removeClass("active-notFinished")}})}function O(){var ao=false;S=false;var aA=jQuery(".statemachine-demo .mydiv");if(aA.length<2){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.import.message.seltwoentities")});S=true;return S}var am=new Array;var ak;var az;var al;for(var ay=0;ay<aA.length;ay++){ak={};ak.nodeTop=jQuery(aA[ay]).css("top").substring(0,jQuery(aA[ay]).css("top").length-2);ak.nodeLeft=jQuery(aA[ay]).css("left").substring(0,jQuery(aA[ay]).css("left").length-2);ak.nodeDataId=jQuery(aA[ay]).attr("Id");ak.nodeDataName=jQuery(aA[ay]).children(".chooseDiv").children(".tb-title").text();var an=jQuery(aA[ay]).children(".divline");az=new Array;for(var ax=0;ax<an.length;ax++){al={};al.attrId=jQuery(an[ax]).attr("id");al.attrName=jQuery(an[ax]).children(".paramdiv").text();al.fieldName=jQuery(an[ax]).children(".paramdiv").children(".pen-filter").children("#pen-fieldName").val();al.filterType=jQuery(an[ax]).children(".paramdiv").children(".pen-filter").children("#pen-filterType").val();al.dimId=jQuery(an[ax]).children(".paramdiv").children(".pen-filter").children("#pen-dimId").val();if("1"==jQuery("#"+al.attrId).find("#pen-isUsed").val()){az.push(al)}}ak.dataNodeArray=az;am.push(ak);if(jQuery(aA[ay]).children(".firstdiv-own").hasClass("back-white")){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:'数据源"'+jQuery(aA[ay]).children(".firstdiv-own").children(".tb-title").text()+'"被删除，请重新选择！'});ao=true;break}}if(ao){return true}var av=new Array;var aj;var aB=aa.getConnections();var au=false;for(var ay=0;ay<aB.length;ay++){aj={};var aw=aB[ay].sourceId;aj.leftDataId=jQuery("#"+aw).parent().attr("id");aj.leftFieldName=jQuery("#"+aw).children().children().children("#pen-fieldName").val();aj.leftAttrId=aw;aj.leftAttrType=jQuery("#"+aw).find("#pen-attrType").val();var at=jQuery("#"+aw).find("#pen-isUsed").val();if(x.getMessage("data.dataLink.label.equalTemp")==aB[ay]._jsPlumb.overlays.label.label){aj.linkType="1"}else{aj.linkType="2"}var ap=aB[ay].targetId;aj.rightDataId=jQuery("#"+ap).parent().attr("id");aj.rightFieldName=jQuery("#"+ap).children().children().children("#pen-fieldName").val();aj.rightAttrId=ap;aj.rightAttrType=jQuery("#"+ap).find("#pen-attrType").val();var ai=jQuery("#"+ap).find("#pen-isUsed").val();if("0"==at||"0"==ai){au=true;break}av.push(aj)}if(au){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.dataLink.label.reChooseAttr")});S=true;return S}var aq;var ah=new Array;var ar=jQuery("#con-container .con-box");for(var ay=0;ay<ar.length;ay++){aq={};aq.attrId=jQuery(ar[ay]).children(".con-box-in").children("#filterParamId").val();aq.attrName=jQuery(ar[ay]).children(".con-box-in").children("#filterParamName").val();aq.whereText=jQuery(ar[ay]).children(".con-box-content").children(".font-div-date").children("#whereText").val();aq.whereValue=jQuery(ar[ay]).children(".con-box-content").children(".font-div-date").children("#whereValue").val();aq.filterType=jQuery(ar[ay]).children(".con-box-content").children(".font-div-date").children("#filterType").val();aq.isExclude=jQuery(ar[ay]).children(".con-box-content").children(".font-div-date").children("#isExclude").val();aq.fieldName=jQuery(ar[ay]).children(".con-box-content").children(".font-div-date").children("#fieldName").val();aq.dataId=jQuery(ar[ay]).children(".con-box-in").children("#dataId").val();aq.orderId=ay+1;ah.push(aq)}af.linkWhereObjArray=ah;af.nodeDataArray=am;af.nodeDataLinkArray=av;D(af.nodeDataArray,af.nodeDataLinkArray);return S}function D(aj,ar){var aq;var am=1;for(var al=0;al<aj.length;al++){var ah=aj[al].dataNodeArray;var ao=true;var ap=null;for(var ak=0;ak<ah.length;ak++){aq+='<tr class="zdDiv">';aq+='<td class="t-width tbackg td-align-center">'+am+"</td>";if(ao){aq+='<td class="t-width1 td-align-left"';aq+='rowspan="'+ah.length+'"';aq+='><div class="t-width1 textOverflow">'+aj[al].nodeDataName+"</div></td>";ao=false}aq+='<td class="t-width2 t-attrname td-align-left"><div id="spanDiv" class="t-width2 textOverflow">'+ah[ak].attrName+'</div><input type="hidden" id="attrNameInput" class="validate[required],sp,len[1,100]" ><div class="pen-icon pen-icon-click"></div><div style="clear: both;"></div></td>';aq+='<td class="t-width3 td-align-center">';aq+='<input type="hidden" name="fieldName" id="fieldName" value="'+ah[ak].fieldName+'"/>';aq+='<input type="hidden" name="filterType" id="filterType" value="'+ah[ak].filterType+'"/>';aq+='<input type="hidden" name="dimId" id="dimId" value="'+ah[ak].dimId+'"/>';ap=false;if(ab.length>0){if(ab.indexOf(ah[ak].attrId)>-1){ap=true}}if(ap){aq+='<input type="checkbox" name="attrId" checked="checked" id="attrId" value="'+ah[ak].attrId+'" />'}else{aq+='<input type="checkbox" name="attrId" id="attrId" value="'+ah[ak].attrId+'" />'}aq+='<input type="hidden" name="nodeDataId" id="nodeDataId" value="'+aj[al].nodeDataId+'" />';aq+="</td></tr>";am++}}jQuery("#dtable tbody tr").remove(".zdDiv");jQuery("#headTr").after(aq);if(U==true){U=false;var an=Y.checkedArr;var ai=jQuery('input[name="attrId"]');for(var al=0;al<an.length;al++){for(var ak=0;ak<ai.length;ak++){if(an[al].attrId==jQuery(ai[ak]).val()){jQuery(ai[ak]).attr("checked","checked")}}}}c()}function o(){jQuery("#dtable").on("click",".pen-icon-click",function(){var ah=$(this).parent().children("#spanDiv").html();jQuery(this).prevAll("#spanDiv").addClass("dis-none");jQuery(this).prev("#attrNameInput").val(ah);jQuery(this).prev("#attrNameInput").attr("type","text");jQuery(this).prev("#attrNameInput").focus();jQuery(this).addClass("dis-none")});jQuery("#dtable").on("blur","#attrNameInput",function(){var ah=$(".data-concat-grid").validationEngine("validate");if(!ah){return false}var ai=jQuery(this).val();jQuery(this).attr("type","hidden");jQuery(this).prevAll("#spanDiv").html(ai);jQuery(this).next(".pen-icon").removeClass("dis-none");jQuery(this).prevAll("#spanDiv").removeClass("dis-none")})}function e(){jQuery("#lastbth1").on("click",function(){ab=[];jQuery('input[name="attrId"]:checked').each(function(){ab.push(jQuery(this).val())});jQuery("#plumbContent2").addClass("dis-none");if(jQuery("#step2").hasClass("step-tab-select")){jQuery("#step2").removeClass("step-tab-select");jQuery("#step2").addClass("step-tab-unselect")}if(jQuery("#step1").hasClass("step-tab-unselect")){jQuery("#step1").removeClass("step-tab-unselect");jQuery("#step1").addClass("step-tab-select")}if(jQuery("#plumbContent").hasClass("dis-none")){jQuery("#plumbContent").removeClass("dis-none")}jQuery("#allAttrId").prop("checked",false)})}function L(){var aj=new Array;var ai;var ah=1;ab=[];jQuery('input[name="attrId"]:checked').each(function(){ab.push(jQuery(this).val());ai={};ai.attrId=jQuery(this).val();ai.dataId=jQuery(this).next("#nodeDataId").val();ai.fieldName=jQuery(this).prevAll("#fieldName").val();ai.dimId=jQuery(this).prevAll("#dimId").val();ai.filterType=jQuery(this).prevAll("#filterType").val();ai.attrName=jQuery(this).parent().prev(".t-attrname").children("#spanDiv").html();ai.orderId=ah++;aj.push(ai)});return aj}function p(){jQuery("#nextbth2").on("click",function(){var ah=L();if(ah.length==0){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.dataLink.label.chooseOneR")})}else{jQuery("#plumbContent2").addClass("dis-none");if(jQuery("#step2").hasClass("step-tab-select")){jQuery("#step2").removeClass("step-tab-select");jQuery("#step2").addClass("step-tab-unselect")}if(jQuery("#step3").hasClass("step-tab-unselect")){jQuery("#step3").removeClass("step-tab-unselect");jQuery("#step3").addClass("step-tab-select")}if(jQuery("#plumbContent3").hasClass("dis-none")){jQuery("#plumbContent3").removeClass("dis-none")}jQuery("#step3 .step-title-num").removeClass("active-notFinished");af.checkedArr=ah;V();C()}})}function C(){jQuery("#completeBtn").on("click",function(){var ai=$("#validateForm").validationEngine("validate");var ah=$("#validateForm2").validationEngine("validate");if(!ai){return false}if(!ah){return false}bi.dialog.confirm({title:x.getMessage("data.dataLink.label.prompt"),message:"确定保存数据连接吗？",callback:function(aj){if(aj){af.dataId=Y.dataId;af.dataName=jQuery("#dataName").val();af.followOrigin=jQuery('input[name="followOrigin"]:checked').val();af.dataDesc=jQuery("#dataDescText").val();af.saveFlag=linkModifyFlag;af.classifyId=jQuery("#classifySel").val();var al=JSON.stringify(af);if("modify"==linkModifyFlag){var ak=x.handleUrlParam("/platform/resmanage/data/query-data-state");x.ajax({url:ak,data:{dataId:Y.dataId,dataType:"3"},success:function(am){if("2"==am.dataType){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:x.getMessage("data.import.message.datalinkisworking")})}else{u(al)}},error:function(am){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:am.responseText||x.getMessage("data.import.message.sysAbnormal")})}})}else{u(al)}}}})})}function u(ah){x.ajax({url:x.handleUrlParam("/platform/resmanage/datalink/save-data-link"),data:{dataStr:ah},loading:{title:x.getMessage("data.dataLink.label.prompt"),text:x.getMessage("data.dataLink.label.workingLoading")},success:function(ai){bi.dialog.confirm({title:x.getMessage("data.dataLink.label.prompt"),message:"保存成功，是否确定退出！",callback:function(aj){if(aj){if(jQuery.isFunction(window.opener.reloadDataList)){window.opener.reloadDataList()}window.close()}}})},error:function(ai){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:x.getMessage("data.dataLink.label.prompt"),message:ai.responseText||x.getMessage("data.dataLink.error.saveLinkError")})}})}function d(){jQuery("#lastbth2").on("click",function(){jQuery("#dataResultGrid").jqGrid("clearGridData");$.jgrid.gridDestroy("#dataResultGrid");jQuery(".complete-content .r-grid").append('<table id="dataResultGrid"></table>');jQuery("#plumbContent3").addClass("dis-none");if(jQuery("#step3").hasClass("step-tab-select")){jQuery("#step3").removeClass("step-tab-select");jQuery("#step3").addClass("step-tab-unselect")}if(jQuery("#step2").hasClass("step-tab-unselect")){jQuery("#step2").removeClass("step-tab-unselect");jQuery("#step2").addClass("step-tab-select")}if(jQuery("#plumbContent2").hasClass("dis-none")){jQuery("#plumbContent2").removeClass("dis-none")}})}function V(){var al=JSON.stringify(af);var ap=new Array;var ao;var am=af.checkedArr;var ak=am.length;var aj=jQuery(".r-grid").width()-45;var ai=180;if(ak*ai<aj){ai=Math.floor(aj/ak)}for(var an=0;an<am.length;an++){ao={};ao.label=am[an].attrName;ao.name=am[an].attrId;ao.align="left";ao.hlign="left";ao.width=ai;ap.push(ao)}var ah={hidden:true,name:"jqGridError"};ap.push(ah);jQuery("#dataResultGrid").jqGrid({url:x.handleUrlParam("/platform/resmanage/datalink/preview-link-result"),datatype:"json",styleUI:"Bootstrap",postData:{dataId:al},mtype:"POST",colModel:ap,rowNum:10,jsonReader:{records:"total",total:"totalPages"},shrinkToFit:false,autowidth:true,height:230,regional:"cn",loadComplete:function(){var ar=jQuery(this);var aq=ar.jqGrid("getRowData");if(aq.length==1){var at=aq[0];if("true"==at.jqGridError){ar.find("#1").remove();jQuery(".r-grid").find(".ui-jqgrid-bdiv").append('<div class="noResult" style="font-size:12px;height:28px;line-height:35px;text-align:center;">数据连接设置错误，请重新设置！</div>');jQuery(".r-grid").find(".ui-jqgrid-bdiv").find(".noResult").prev().hide()}}}});Q()}function Q(){jQuery("#dataResultGrid").setGridWidth(jQuery(".r-grid").width()-5)}$(window).resize(function(){Q()});function G(){var aq=[];var ak=new Array;var ao=aa.getConnections();var ai=jQuery(".statemachine-demo .mydiv");if(ai.length>1&&ao.length==0){return false}var ar=new Array;var ah;var ap;for(var al=0;al<ao.length;al++){if(x.getMessage("data.dataLink.label.leftjoin")==ao[al]._jsPlumb.overlays.label.label){ah={sourceId:ao[al].sourceId,targetId:ao[al].targetId};ar.push(ah)}ap={sourceId:ao[al].sourceId,targetId:ao[al].targetId};aq.push(ap);ak.push(jQuery("#"+ao[al].sourceId).parent().attr("id"));ak.push(jQuery("#"+ao[al].targetId).parent().attr("id"))}for(var al=0;al<ar.length;al++){var an=ar[al].targetId;var am=ar[al].sourceId;for(var aj=al+1;aj<ar.length;aj++){if(an==ar[aj].sourceId&&am==ar[aj].targetId){return false}}}ak=a(ak);for(var al=0;al<ai.length;al++){if(ak.length>0){if(-1==ak.indexOf(jQuery(ai[al]).attr("id"))){return false}}}if(h(aq,ai)){return true}else{return false}return true}function a(ai){var ah=[],al={};for(var aj=0,ak;(ak=ai[aj])!=null;aj++){if(!al[ak]){ah.push(ak);al[ak]=true}}return ah}function s(am){var aq=[];var ao=[];var ap;var an;for(var al=0,ah,ai;(ah=am[al])!=null;al++){ap=false;an=false;ai={};ai.targetNode=ah.sourceNode;ai.sourceNode=ah.targetNode;for(var ak=0;ak<aq.length;ak++){var aj=aq[ak];if(aj.targetNode==ah.targetNode&&aj.sourceNode==ah.sourceNode){ap=true;break}}if(!ap){aq.push(ah);ao.push(ah);aq.push(ai)}}return ao}function h(ak,al){var am=false;var ai=new Array;var ah;var an=[];for(var aj=0;aj<al.length;aj++){an.push(jQuery(al[aj]).attr("id"))}for(var aj=0;aj<ak.length;aj++){ah={};ah.targetNode=jQuery("#"+ak[aj].targetId).parent().attr("id");ah.sourceNode=jQuery("#"+ak[aj].sourceId).parent().attr("id");ai.push(ah)}if(s(ai).length>=al.length-1){am=true}return am}});