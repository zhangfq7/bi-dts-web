define(["sabace","caliber/message"],function(b,c){var a={};caliberList.view={caliberDateList:function(){var d={};$("#caliberDateList").jqGrid({url:b.handleUrlParam("/platform/resmanage/caliber/query-caliber-date"),styleUI:"Bootstrap",datatype:"json",postData:d,mtype:"post",forceFit:true,gridComplete:function(){jQuery("input[type=checkbox]").on("click",caliberList.view.selectRow)},onSelectRow:function(e){var f=jQuery("tr[id="+e+"]>td>input").prop("checked");jQuery("input[type=checkbox]").prop("checked",false);jQuery("tr[id="+e+"]>td>input").prop("checked",!f);if(f){$("#caliberDateList").trigger("reloadGrid")}var g=$("#caliberDateList").jqGrid("getRowData",e);if("false"==g.optFlag){jQuery("#edit").addClass("disabled");jQuery("#delete").addClass("disabled")}else{jQuery("#edit").removeClass("disabled");jQuery("#delete").removeClass("disabled")}},beforeSelectRow:function(e){},colModel:[{name:"",index:"caliberId",formatter:"checkbox",formatoptions:{disabled:false},width:20},{name:"caliberId",index:"caliberId",sorttype:"int",key:true,hidden:true},{label:b.getMessage("caliber.caliberlist.label.caliberName"),name:"caliberName",width:100,align:"left",hlign:"center",sortable:false},{label:b.getMessage("caliber.caliberlist.label.caliberDesc"),name:"caliberDesc",width:200,align:"left",hlign:"center",sortable:false},{label:b.getMessage("caliber.caliberlist.label.adminId"),name:"adminId",width:100,align:"left",hlign:"center",sortable:false},{label:b.getMessage("caliber.caliberlist.label.adminTime"),name:"adminTime",width:100,align:"left",hlign:"center",sortable:false},{name:"optFlag",hidden:true}],sortorder:"asc",forceFit:true,viewrecords:true,autowidth:true,sortname:"caliberId",scrollrows:true,columnsResize:true,height:"auto",rowNum:10,rowList:[10,20,30],pager:"#caliberListGridPager",jsonReader:{records:"total",total:"totalPages"},afterInsertRow:function(f,e){jQuery(this).jqGrid("setCell",rowid,"operate","<a>操作</a>")},regional:"cn"})},selectRow:function(){var d=jQuery(this).prop("checked");jQuery("input[type=checkbox]").prop("checked",false);jQuery(this).prop("checked",!d);jQuery("#caliberDateList").jqGrid("setSelection",jQuery(this).parent().next().text())},caliberDateDel:function(){if(jQuery("#delete").hasClass("disabled")){return}var g=$("#caliberDateList").jqGrid("getGridParam","selrow");var e=$("#caliberDateList").jqGrid("getRowData",g);var d=e.caliberId;var f=jQuery("#"+g).find("input[type='checkbox']").prop("checked");if(b.IsEmpty(g)||!f){bi.dialog.show({type:"type-warning",title:b.getMessage("caliber.caliberlist.msg.prompt"),message:b.getMessage("caliber.caliberlist.msg.empty"),});return}else{bi.dialog.confirm({title:b.getMessage("caliber.caliberlist.msg.prompt"),message:b.getMessage("caliber.caliberlist.msg.confirm.delete"),callback:function(h){if(h){b.ajax({type:"post",cache:false,dataType:"json",data:{caliberId:d},url:b.handleUrlParam("/platform/resmanage/caliber/del-caliber-date"),success:function(i){jQuery("#caliberDateList").trigger("reloadGrid");bi.dialog.show({title:b.getMessage("caliber.caliberlist.msg.prompt"),message:i.responseText||b.getMessage("caliber.caliberlist.msg.delsuccess")})},error:function(i){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("caliber.caliberlist.msg.prompt"),message:i.responseText||b.getMessage("caliber.caliberlist.msg.del.exception")})}})}}})}},caliberDateEdit:function(){if(jQuery("#edit").hasClass("disabled")){return}jQuery("#caliberName").attr("value","");jQuery("#caliberDesc").attr("value","");var j=$("#caliberDateList").jqGrid("getGridParam","selrow");var g=$("#caliberDateList").jqGrid("getRowData",j);var d=g.caliberName;var f=g.caliberId;var i=g.caliberDesc;var h=jQuery("#"+j).find("input[type='checkbox']").prop("checked");if(b.IsEmpty(j)||!h){bi.dialog.show({type:"type-warning",title:b.getMessage("caliber.caliberlist.msg.prompt"),message:b.getMessage("caliber.caliberlist.msg.empty"),});return}jQuery("#caliberName").attr("value",d);jQuery("#caliberDesc").html(i);var e=bi.dialog.show({title:b.getMessage("caliber.caliberlist.label.editCaliber"),message:jQuery("#add-page").outerHTML(),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,cssClass:"caliber-add-dialog",buttons:[{label:b.getMessage("caliber.caliberlist.button.cancel"),action:function(k){k.close()}},{label:b.getMessage("caliber.caliberlist.button.save"),cssClass:"btn-info",action:function(k){var l=e.getModalBody().find("#add-page").validationEngine("validate");if(!l){return false}bi.dialog.confirm({title:b.getMessage("caliber.caliberlist.title.confirm"),message:b.getMessage("caliber.caliberlist.msg.saveConfirm"),callback:function(n){if(!n){return}var o=e.getModalBody().find("#caliberName").val();var p=e.getModalBody().find("#caliberDesc").val();var m={caliberId:f,caliberName:o,caliberDesc:p,};b.ajax({loading:{title:b.getMessage("caliber.caliberlist.label.tip"),text:b.getMessage("caliber.caliberlist.label.pleaseWait")},url:b.handleUrlParam("/platform/resmanage/caliber/add-edit-caliber-date"),data:m,success:function(r){var q=r.result;if("0"==q){var s=r.nameExist;if("1"==s){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("caliber.caliberlist.label.tip"),message:b.getMessage("caliber.caliberlist.msq.CaliberExist")})}}else{jQuery("#caliberDateList").trigger("reloadGrid");e.close();bi.dialog.show({title:b.getMessage("caliber.caliberlist.label.tip"),message:b.getMessage("caliber.caliberlist.msq.saveSuccess")})}},error:function(q){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("caliber.caliberlist.label.tip"),message:q.responseText||b.getMessage("caliber.caliberlist.msg.save.exception")})}})}})}}]});e.getModalBody().find("#add-page").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"topRight",showOneMessage:true})},caliberDateAdd:function(){jQuery("#caliberName").attr("value","");jQuery("#caliberDesc").html("");var d=bi.dialog.show({title:b.getMessage("caliber.caliberlist.title.caliberAdd"),message:jQuery("#add-page").outerHTML(),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:b.getMessage("caliber.caliberlist.button.cancel"),action:function(e){e.close()}},{label:b.getMessage("caliber.caliberlist.button.save"),cssClass:"btn-info",action:function(e){var f=d.getModalBody().find("#add-page").validationEngine("validate");if(!f){return false}bi.dialog.confirm({title:b.getMessage("caliber.caliberlist.title.confirm"),message:b.getMessage("caliber.caliberlist.msg.saveConfirm"),callback:function(h){if(!h){return}var i=d.getModalBody().find("#caliberName").val();var j=d.getModalBody().find("#caliberDesc").val();var g={caliberName:i,caliberDesc:j};b.ajax({data:g,loading:{title:b.getMessage("caliber.caliberlist.label.tip"),text:b.getMessage("caliber.caliberlist.label.pleaseWait")},url:b.handleUrlParam("/platform/resmanage/caliber/add-edit-caliber-date"),success:function(l){var k=l.result;if("0"==k){var m=l.nameExist;if("1"==m){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("caliber.caliberlist.label.tip"),message:"当前口径名称已存在，请修改后重试！"})}}else{jQuery("#caliberDateList").trigger("reloadGrid");d.close();bi.dialog.show({title:b.getMessage("caliber.caliberlist.label.tip"),message:"口径信息保存成功"})}},error:function(k){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:b.getMessage("caliber.caliberlist.label.tip"),message:k.responseText||b.getMessage("caliber.caliberlist.msg.save.exception")})}})}})}}]});d.getModalBody().find("#add-page").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"topRight",showOneMessage:true})}};caliberList.controller={init:function(){jQuery("#search").on("click",function(){var e=$("#listCaliberName").val();var f=$("#listCaliberDesc").val();var d={};d.caliberName=e;d.caliberDesc=f;jQuery("#caliberDateList").jqGrid("setGridParam",{postData:d}).trigger("reloadGrid")});caliberList.view.caliberDateList();$("#add").on("click",function(){caliberList.view.caliberDateAdd()});$("#edit").on("click",function(){caliberList.view.caliberDateEdit()});$("#delete").on("click",function(){caliberList.view.caliberDateDel()});jQuery(window).resize(function(){$("#caliberDateList").setGridWidth($("#caliberListPanel").width()-20)})}};return caliberList.controller});