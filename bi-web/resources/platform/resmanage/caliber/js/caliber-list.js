define(["sabace","caliber/message"],function(c,d){var a={};var b;jQuery(function(){jQuery("body").on("change","#caliberProjectId",function(){b=$(this).val();console.log(b)})});caliberList.view={caliberDateList:function(){var e={};$("#caliberDateList").jqGrid({url:c.handleUrlParam("/platform/resmanage/caliber/query-caliber-date"),styleUI:"Bootstrap",datatype:"json",postData:e,mtype:"post",forceFit:true,gridComplete:function(){jQuery("input[type=checkbox]").on("click",caliberList.view.selectRow)},onSelectRow:function(f){var g=jQuery("tr[id="+f+"]>td>input").prop("checked");jQuery("input[type=checkbox]").prop("checked",false);jQuery("tr[id="+f+"]>td>input").prop("checked",!g);if(g){$("#caliberDateList").trigger("reloadGrid")}var h=$("#caliberDateList").jqGrid("getRowData",f);if("false"==h.optFlag){jQuery("#edit").addClass("disabled");jQuery("#delete").addClass("disabled")}else{jQuery("#edit").removeClass("disabled");jQuery("#delete").removeClass("disabled")}},beforeSelectRow:function(f){},colModel:[{name:"",index:"caliberId",formatter:"checkbox",formatoptions:{disabled:false},width:20},{name:"caliberId",index:"caliberId",sorttype:"int",key:true,hidden:true},{label:c.getMessage("caliber.caliberlist.label.caliberName"),name:"caliberName",width:100,align:"left",hlign:"center",sortable:false},{label:c.getMessage("caliber.caliberlist.label.caliberDesc"),name:"caliberDesc",width:200,align:"left",hlign:"center",sortable:false},{label:c.getMessage("caliber.caliberlist.label.adminId"),name:"adminId",width:100,align:"left",hlign:"center",sortable:false},{label:c.getMessage("caliber.caliberlist.label.adminTime"),name:"adminTime",width:100,align:"left",hlign:"center",sortable:false},{name:"optFlag",hidden:true},{name:"proId",hidden:true}],sortorder:"asc",forceFit:true,viewrecords:true,autowidth:true,sortname:"caliberId",scrollrows:true,columnsResize:true,height:"auto",rowNum:10,rowList:[10,20,30],pager:"#caliberListGridPager",jsonReader:{records:"total",total:"totalPages"},afterInsertRow:function(g,f){jQuery(this).jqGrid("setCell",rowid,"operate","<a>操作</a>")},regional:"cn"})},selectRow:function(){var e=jQuery(this).prop("checked");jQuery("input[type=checkbox]").prop("checked",false);jQuery(this).prop("checked",!e);jQuery("#caliberDateList").jqGrid("setSelection",jQuery(this).parent().next().text())},caliberDateDel:function(){if(jQuery("#delete").hasClass("disabled")){return}var h=$("#caliberDateList").jqGrid("getGridParam","selrow");var f=$("#caliberDateList").jqGrid("getRowData",h);var e=f.caliberId;var g=jQuery("#"+h).find("input[type='checkbox']").prop("checked");if(c.IsEmpty(h)||!g){bi.dialog.show({type:"type-warning",title:c.getMessage("caliber.caliberlist.msg.prompt"),message:c.getMessage("caliber.caliberlist.msg.empty"),});return}else{bi.dialog.confirm({title:c.getMessage("caliber.caliberlist.msg.prompt"),message:c.getMessage("caliber.caliberlist.msg.confirm.delete"),callback:function(i){if(i){c.ajax({type:"post",cache:false,dataType:"json",data:{caliberId:e},url:c.handleUrlParam("/platform/resmanage/caliber/del-caliber-date"),success:function(j){jQuery("#caliberDateList").trigger("reloadGrid");bi.dialog.show({title:c.getMessage("caliber.caliberlist.msg.prompt"),message:j.responseText||c.getMessage("caliber.caliberlist.msg.delsuccess")})},error:function(j){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("caliber.caliberlist.msg.prompt"),message:j.responseText||c.getMessage("caliber.caliberlist.msg.del.exception")})}})}}})}},caliberDateEdit:function(){if(jQuery("#edit").hasClass("disabled")){return}jQuery("#caliberName").attr("value","");jQuery("#caliberDesc").attr("value","");var l=$("#caliberDateList").jqGrid("getGridParam","selrow");var h=$("#caliberDateList").jqGrid("getRowData",l);var e=h.caliberName;var g=h.caliberId;var k=h.caliberDesc;var j=h.proId;var i=jQuery("#"+l).find("input[type='checkbox']").prop("checked");if(c.IsEmpty(l)||!i){bi.dialog.show({type:"type-warning",title:c.getMessage("caliber.caliberlist.msg.prompt"),message:c.getMessage("caliber.caliberlist.msg.empty"),});return}jQuery("#caliberName").attr("value",e);jQuery("#caliberDesc").html(k);jQuery("#caliberProjectId").find("option[value="+j+"]").attr("selected",true);var f=bi.dialog.show({title:c.getMessage("caliber.caliberlist.label.editCaliber"),message:jQuery("#add-page").outerHTML(),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,cssClass:"caliber-add-dialog",buttons:[{label:c.getMessage("caliber.caliberlist.button.cancel"),action:function(m){m.close()}},{label:c.getMessage("caliber.caliberlist.button.save"),cssClass:"btn-info",action:function(m){if(b==""||null==b){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("caliber.caliberlist.label.tip"),message:c.getMessage("caliber.msg.chooseProjectName")});return false}var n=f.getModalBody().find("#add-page").validationEngine("validate");if(!n){return false}bi.dialog.confirm({title:c.getMessage("caliber.caliberlist.title.confirm"),message:c.getMessage("caliber.caliberlist.msg.saveConfirm"),callback:function(p){if(!p){return}var q=f.getModalBody().find("#caliberName").val();var r=f.getModalBody().find("#caliberDesc").val();var o={caliberId:g,caliberName:q,caliberDesc:r,proId:b};c.ajax({loading:{title:c.getMessage("caliber.caliberlist.label.tip"),text:c.getMessage("caliber.caliberlist.label.pleaseWait")},url:c.handleUrlParam("/platform/resmanage/caliber/add-edit-caliber-date"),data:o,success:function(t){var s=t.result;if("0"==s){var u=t.nameExist;if("1"==u){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("caliber.caliberlist.label.tip"),message:c.getMessage("caliber.caliberlist.msq.CaliberExist")})}}else{jQuery("#caliberDateList").trigger("reloadGrid");f.close();bi.dialog.show({title:c.getMessage("caliber.caliberlist.label.tip"),message:c.getMessage("caliber.caliberlist.msq.saveSuccess")})}},error:function(s){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("caliber.caliberlist.label.tip"),message:s.responseText||c.getMessage("caliber.caliberlist.msg.save.exception")})}})}})}}]});f.getModalBody().find("#add-page").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"topRight",showOneMessage:true})},caliberDateAdd:function(){jQuery("#caliberName").attr("value","");jQuery("#caliberDesc").html("");var e=bi.dialog.show({title:c.getMessage("caliber.caliberlist.title.caliberAdd"),message:jQuery("#add-page").outerHTML(),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:c.getMessage("caliber.caliberlist.button.cancel"),action:function(f){f.close()}},{label:c.getMessage("caliber.caliberlist.button.save"),cssClass:"btn-info",action:function(f){if(b==""||null==b){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("caliber.caliberlist.label.tip"),message:c.getMessage("caliber.msg.chooseProjectName")});return false}var g=e.getModalBody().find("#add-page").validationEngine("validate");if(!g){return false}bi.dialog.confirm({title:c.getMessage("caliber.caliberlist.title.confirm"),message:c.getMessage("caliber.caliberlist.msg.saveConfirm"),callback:function(i){if(!i){return}var j=e.getModalBody().find("#caliberName").val();var k=e.getModalBody().find("#caliberDesc").val();var h={caliberName:j,caliberDesc:k,proId:b};c.ajax({data:h,loading:{title:c.getMessage("caliber.caliberlist.label.tip"),text:c.getMessage("caliber.caliberlist.label.pleaseWait")},url:c.handleUrlParam("/platform/resmanage/caliber/add-edit-caliber-date"),success:function(m){var l=m.result;if("0"==l){var n=m.nameExist;if("1"==n){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("caliber.caliberlist.label.tip"),message:"当前口径名称已存在，请修改后重试！"})}}else{jQuery("#caliberDateList").trigger("reloadGrid");e.close();bi.dialog.show({title:c.getMessage("caliber.caliberlist.label.tip"),message:"口径信息保存成功"})}},error:function(l){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:c.getMessage("caliber.caliberlist.label.tip"),message:l.responseText||c.getMessage("caliber.caliberlist.msg.save.exception")})}})}})}}]});e.getModalBody().find("#add-page").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"topRight",showOneMessage:true})}};caliberList.controller={init:function(){jQuery("#search").on("click",function(){var f=$("#listCaliberName").val();var g=$("#listCaliberDesc").val();var e={};e.caliberName=f;e.caliberDesc=g;jQuery("#caliberDateList").jqGrid("setGridParam",{postData:e}).trigger("reloadGrid")});caliberList.view.caliberDateList();$("#add").on("click",function(){caliberList.view.caliberDateAdd()});$("#edit").on("click",function(){caliberList.view.caliberDateEdit()});$("#delete").on("click",function(){caliberList.view.caliberDateDel()});jQuery(window).resize(function(){$("#caliberDateList").setGridWidth($("#caliberListPanel").width()-20)})}};return caliberList.controller});