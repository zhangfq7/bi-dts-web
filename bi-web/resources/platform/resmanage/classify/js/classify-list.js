define(["sabace","classify/order"],function(g,h){jQuery(function(){a();jQuery("#add").on("click",b);jQuery("#search").on("click",c);jQuery("#order").bind("click",j);jQuery("#claasifyListPanel").on("click",".classifyEdit",function(){d(this)});jQuery("#claasifyListPanel").on("click",".classifyDelete",function(){i(this)})});function a(){var k={};$("#claasifyListGrid").jqGrid({url:g.handleUrlParam("/platform/resmanage/classify/classify-list"),styleUI:"Bootstrap",autowidth:true,postData:k,height:"auto",mtype:"post",regional:"cn",datatype:"json",viewrecords:true,forceFit:true,colModel:[{label:"排序编码",name:"orderId",width:80,align:"center",hlign:"center",sortable:false},{label:"业务分类编码",name:"classifyId",width:200,align:"left",hlign:"center",sortable:false,hidden:true},{label:"业务分类名称",name:"classifyName",width:200,align:"left",hlign:"center",sortable:false},{label:"业务分类描述",name:"classifyDesc",width:230,align:"left",hlign:"center",sortable:false},{label:"创建人",name:"createId",width:100,align:"left",hlign:"center",sortable:false},{label:"更新时间",name:"adminTime",width:150,align:"left",hlign:"center",sortable:false},{label:"操作",name:"operate",width:150,align:"center",hlign:"center",sortable:false,formatter:function(m,n,q){var l=q.classifyId;var p=q.classifyName;var o=q.classifyDesc;return"<a href='javascript:void(0)' class='classifyEdit' classifyId='"+l+"' classifyName='"+p+"' classifyDesc='"+o+"'>"+g.getMessage("classify.label.modify")+"</a> / <a href='javascript:void(0)' class='classifyDelete' classifyId='"+l+"'>"+g.getMessage("classify.label.delete")+"</a> "}}],rowNum:10,rowList:[10,20,30],pager:"#claasifyListGridPager",jsonReader:{records:"total",total:"totalPages"},afterInsertRow:function(m,l){jQuery(this).jqGrid("setCell",rowid,"operate","<a>"+g.getMessage("order.label.operation")+"</a>")}})}function b(){jQuery("#classifyName").attr("value","");jQuery("#description").html("");var k=bi.dialog.show({title:"新增业务分类",message:jQuery("#add-page").outerHTML(),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:"取消",action:function(l){l.close()}},{label:"保存",cssClass:"btn-info",action:function(l){var m=k.getModalBody().find("#add-page").validationEngine("validate");if(!m){return false}bi.dialog.confirm({title:"确认",message:"您确定要保存业务分类信息吗？",callback:function(o){if(!o){return}var q=k.getModalBody().find("#classifyName").val();var p=k.getModalBody().find("#description").val();var n={classifyName:q,classifyDesc:p};g.ajax({data:n,loading:{title:g.getMessage("classify.label.tip"),text:g.getMessage("classify.label.pleaseWait")},url:g.handleUrlParam("/platform/resmanage/classify/save-classify"),success:function(s){var r=s.saveFlag;if("0"==r){var t=s.nameExist;if("1"==t){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:"当前企业下已经存在该业务分类名称，请修改后重试！"})}}else{jQuery("#claasifyListGrid").trigger("reloadGrid");k.close();bi.dialog.show({title:g.getMessage("classify.label.tip"),message:"业务分类信息保存成功"})}},error:function(r){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:r.responseText||g.getMessage("group.msg.save.exception")})}})}})}}]});k.getModalBody().find("#add-page").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"topRight",showOneMessage:true})}function d(n){var k=jQuery(n).attr("classifyId");var o=jQuery(n).attr("classifyName");var m=jQuery(n).attr("classifyDesc");jQuery("#classifyName").attr("value",o);jQuery("#description").html(m);var l=bi.dialog.show({title:"修改业务分类",message:jQuery("#add-page").outerHTML(),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:"取消",action:function(p){p.close()}},{label:"保存",cssClass:"btn-info",action:function(p){var q=l.getModalBody().find("#add-page").validationEngine("validate");if(!q){return false}bi.dialog.confirm({title:"确认",message:"您确定要保存业务分类信息吗？",callback:function(s){if(!s){return}var u=l.getModalBody().find("#classifyName").val();var t=l.getModalBody().find("#description").val();var r={classifyId:k,classifyName:u,classifyDesc:t};g.ajax({data:r,loading:{title:g.getMessage("classify.label.tip"),text:g.getMessage("classify.label.pleaseWait")},url:g.handleUrlParam("/platform/resmanage/classify/save-classify"),success:function(w){var v=w.saveFlag;if("0"==v){var x=w.nameExist;if("1"==x){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:"当前企业下已经存在该业务分类名称，请修改后重试！"})}}else{jQuery("#claasifyListGrid").trigger("reloadGrid");l.close();bi.dialog.show({title:g.getMessage("classify.label.tip"),message:"业务分类信息修改成功"})}},error:function(v){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:v.responseText||g.getMessage("group.msg.save.exception")})}})}})}}]})}function i(l){var k=jQuery(l).attr("classifyId");bi.dialog.confirm({title:"提示",message:"删除业务分类信息，相关数据的业务分类信息会被置为空，确认要删除吗？",callback:function(m){if(m){g.ajax({type:"post",cache:false,dataType:"json",url:g.handleUrlParam("/platform/resmanage/classify/delete-classify/"),data:{classifyId:k},loading:{title:"提示",text:"正在删除信息，请稍候……"},success:function(n){bi.dialog.show({title:"提示",message:"删除成功！",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:"确定",cssClass:"btn-info",action:function(o){jQuery("#claasifyListGrid").trigger("reloadGrid");o.close()}}]})},error:function(n){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:"删除失败",message:n.responseText||"删除失败"})}})}}})}function c(){var k={};k.classifyName=jQuery("#className").val();k.classifyDesc=jQuery("#classDesc").val();k.createId=jQuery("#createName").val();jQuery("#claasifyListGrid").jqGrid("setGridParam",{postData:k}).trigger("reloadGrid")}var f;function j(){var k=g.handleUrlParam("/platform/resmanage/classify/classify-order");f=new bi.dialog.show({title:"业务分类排序",message:jQuery('<div id="classify-order-dialog"></div>').load(k),cssClass:"classify-order-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,onshown:function(){h.init()},buttons:[{label:"取消",cssClass:"btn-default",action:function(l){l.close()}},{label:"确定",cssClass:"btn-info",action:function(l){h.saveOrder()}}]})}function e(){f.close()}window.closeOrderDialog=e});