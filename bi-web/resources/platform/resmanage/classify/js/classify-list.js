define(["sabace","classify/order"],function(g,i){var h;jQuery(function(){a();jQuery("#add").on("click",b);jQuery("#search").on("click",c);jQuery("#order").bind("click",k);jQuery("#claasifyListPanel").on("click",".classifyEdit",function(){d(this)});jQuery("#claasifyListPanel").on("click",".classifyDelete",function(){j(this)});jQuery("body").on("change","#classifyProjectId",function(){h=$(this).val();console.log(h)})});function a(){var l={};$("#claasifyListGrid").jqGrid({url:g.handleUrlParam("/platform/resmanage/classify/classify-list"),styleUI:"Bootstrap",autowidth:true,postData:l,height:"auto",mtype:"post",regional:"cn",datatype:"json",viewrecords:true,forceFit:true,colModel:[{label:"排序编码",name:"orderId",width:80,align:"center",hlign:"center",sortable:false},{label:"业务分类编码",name:"classifyId",width:200,align:"left",hlign:"center",sortable:false,hidden:true},{label:"业务分类名称",name:"classifyName",width:200,align:"left",hlign:"center",sortable:false},{label:"业务分类描述",name:"classifyDesc",width:230,align:"left",hlign:"center",sortable:false},{label:"创建人",name:"createId",width:100,align:"left",hlign:"center",sortable:false},{label:"更新时间",name:"adminTime",width:150,align:"left",hlign:"center",sortable:false},{name:"proId",hidden:true},{label:"操作",name:"operate",width:150,align:"center",hlign:"center",sortable:false,formatter:function(n,o,s){var m=s.classifyId;var r=s.classifyName;var p=s.classifyDesc;var q=s.proId;return"<a href='javascript:void(0)' class='classifyEdit' classifyId='"+m+"' classifyName='"+r+"' classifyDesc='"+p+"' classifyProId='"+q+"'>"+g.getMessage("classify.label.modify")+"</a> / <a href='javascript:void(0)' class='classifyDelete' classifyId='"+m+"'>"+g.getMessage("classify.label.delete")+"</a> "}}],rowNum:10,rowList:[10,20,30],pager:"#claasifyListGridPager",jsonReader:{records:"total",total:"totalPages"},afterInsertRow:function(n,m){jQuery(this).jqGrid("setCell",rowid,"operate","<a>"+g.getMessage("order.label.operation")+"</a>")}})}function b(){jQuery("#classifyName").attr("value","");jQuery("#description").html("");var l=bi.dialog.show({title:"新增业务分类",message:jQuery("#add-page").outerHTML(),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:"取消",action:function(m){m.close()}},{label:"保存",cssClass:"btn-info",action:function(m){if(h==""||null==h){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:g.getMessage("classify.msg.chooseProjectName")});return false}var n=l.getModalBody().find("#add-page").validationEngine("validate");if(!n){return false}bi.dialog.confirm({title:"确认",message:"您确定要保存业务分类信息吗？",callback:function(p){if(!p){return}var r=l.getModalBody().find("#classifyName").val();var q=l.getModalBody().find("#description").val();var o={classifyName:r,classifyDesc:q,proId:h};g.ajax({data:o,loading:{title:g.getMessage("classify.label.tip"),text:g.getMessage("classify.label.pleaseWait")},url:g.handleUrlParam("/platform/resmanage/classify/save-classify"),success:function(t){var s=t.saveFlag;if("0"==s){var u=t.nameExist;if("1"==u){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:"当前企业下已经存在该业务分类名称，请修改后重试！"})}}else{jQuery("#claasifyListGrid").trigger("reloadGrid");l.close();bi.dialog.show({title:g.getMessage("classify.label.tip"),message:"业务分类信息保存成功"})}},error:function(s){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:s.responseText||g.getMessage("group.msg.save.exception")})}})}})}}]});l.getModalBody().find("#add-page").validationEngine({autoHidePrompt:true,autoHideDelay:2000,binded:true,promptPosition:"topRight",showOneMessage:true})}function d(o){var l=jQuery(o).attr("classifyId");var q=jQuery(o).attr("classifyName");var n=jQuery(o).attr("classifyDesc");var p=jQuery(o).attr("classifyProId");console.log(p);jQuery("#classifyName").attr("value",q);jQuery("#description").html(n);jQuery("#classifyProjectId").find("option[value="+p+"]").attr("selected",true);var m=bi.dialog.show({title:"修改业务分类",message:jQuery("#add-page").outerHTML(),nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:"取消",action:function(r){r.close()}},{label:"保存",cssClass:"btn-info",action:function(r){if(h==""||null==h){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:g.getMessage("classify.msg.chooseProjectName")});return false}var s=m.getModalBody().find("#add-page").validationEngine("validate");if(!s){return false}bi.dialog.confirm({title:"确认",message:"您确定要保存业务分类信息吗？",callback:function(u){if(!u){return}var w=m.getModalBody().find("#classifyName").val();var v=m.getModalBody().find("#description").val();var t={classifyId:l,classifyName:w,classifyDesc:v,proId:h};g.ajax({data:t,loading:{title:g.getMessage("classify.label.tip"),text:g.getMessage("classify.label.pleaseWait")},url:g.handleUrlParam("/platform/resmanage/classify/save-classify"),success:function(y){var x=y.saveFlag;if("0"==x){var z=y.nameExist;if("1"==z){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:"当前企业下已经存在该业务分类名称，请修改后重试！"})}}else{jQuery("#claasifyListGrid").trigger("reloadGrid");m.close();bi.dialog.show({title:g.getMessage("classify.label.tip"),message:"业务分类信息修改成功"})}},error:function(x){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:g.getMessage("classify.label.tip"),message:x.responseText||g.getMessage("group.msg.save.exception")})}})}})}}]})}function j(m){var l=jQuery(m).attr("classifyId");bi.dialog.confirm({title:"提示",message:"删除业务分类信息，相关数据的业务分类信息会被置为空，确认要删除吗？",callback:function(n){if(n){g.ajax({type:"post",cache:false,dataType:"json",url:g.handleUrlParam("/platform/resmanage/classify/delete-classify/"),data:{classifyId:l},loading:{title:"提示",text:"正在删除信息，请稍候……"},success:function(o){bi.dialog.show({title:"提示",message:"删除成功！",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:"确定",cssClass:"btn-info",action:function(p){jQuery("#claasifyListGrid").trigger("reloadGrid");p.close()}}]})},error:function(o){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:"删除失败",message:o.responseText||"删除失败"})}})}}})}function c(){var l={};l.classifyName=jQuery("#className").val();l.classifyDesc=jQuery("#classDesc").val();l.createId=jQuery("#createName").val();jQuery("#claasifyListGrid").jqGrid("setGridParam",{postData:l}).trigger("reloadGrid")}var f;function k(){var l=g.handleUrlParam("/platform/resmanage/classify/classify-order");f=new bi.dialog.show({title:"业务分类排序",message:jQuery('<div id="classify-order-dialog"></div>').load(l),cssClass:"classify-order-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,onshown:function(){i.init()},buttons:[{label:"取消",cssClass:"btn-default",action:function(m){m.close()}},{label:"确定",cssClass:"btn-info",action:function(m){i.saveOrder()}}]})}function e(){f.close()}window.closeOrderDialog=e});