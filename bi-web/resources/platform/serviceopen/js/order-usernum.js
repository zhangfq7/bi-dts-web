define(["sabace","order/message","slider"],function(t,l,o){var n=100;var d;var m;jQuery(function(){e();c();b();g();q()});$(window).resize(function(){jQuery("#orderListGrid").setGridWidth(jQuery("#orderList").width())});function b(){jQuery("#queryOrderListBtn").on("click",function(){j()});jQuery("#changeOrderDate").on("click",function(){jQuery("#queryOrderDate").focus()});jQuery("#saveOrderInfo").on("click",function(){r()});jQuery("#showOrderPage").on("click",function(){if(jQuery(".orderDiv").hasClass("hide")){jQuery(".orderDiv").removeClass("hide")}else{jQuery(".orderDiv").addClass("hide")}jQuery(".orderListDiv").addClass("hide")});jQuery("#showOrderList").on("click",function(){if(jQuery(".orderListDiv").hasClass("hide")){jQuery(".orderListDiv").removeClass("hide");jQuery("#orderListGrid").setGridWidth(jQuery("#orderList").width())}else{jQuery(".orderListDiv").addClass("hide")}jQuery(".orderDiv").addClass("hide")});jQuery("#orderNum").on("change",function(){s()});jQuery(".btn-group button").bind("click",function(){jQuery(".btn-group button").removeClass("clickedButton theme-background").addClass("normalButton");jQuery(this).addClass("clickedButton theme-background").removeClass("normalButton");var w=jQuery(this).val();k(w)});jQuery(".btn-group").on("mouseover",".normalButton",function(){jQuery(".normalButton").removeClass("theme-background");jQuery(this).addClass("theme-background")}).on("mouseleave",".normalButton",function(){jQuery(this).removeClass("theme-background")});jQuery("#lastbutton").click();jQuery(".orderList").on("click",".orderEdit",function(){p(this)});jQuery(".orderList").on("click",".orderClose",function(){f(this)});jQuery("#back").on("click",function(){jQuery(".orderDiv").addClass("hide");jQuery(".orderListDiv").removeClass("hide");jQuery(".buttons button").prop("disabled","");jQuery("#orderListGrid").setGridWidth(jQuery("#orderList").width());h()})}function r(){var z=jQuery("#orderEndDate").attr("endDate");if(z=="--"){z=""}var x=Number(jQuery("#orderNum").val());var y=Number(jQuery(".costNum").html());var w={orderId:m,orderNum:x,orderEndDate:z,serviceId:serviceId,sumConstIntegral:y};bi.dialog.confirm({title:t.getMessage("order.label.sure"),message:t.getMessage("order.label.sure.save"),callback:function(A){if(A){t.ajax({url:t.handleUrlParam("/platform/serviceopen/save-order"),data:w,loading:{title:t.getMessage("order.label.save"),text:t.getMessage("order.label.saveing")},success:function(B){if(B.saveFlag=="true"){if(t.IsEmpty(m)){totalNum=Number(totalNum)+Number(x);q()}h();bi.dialog.show({title:t.getMessage("order.label.save.succeed"),message:t.getMessage("order.usernum.msg.succeed"),onhidden:function(){jQuery(".buttons button").prop("disabled","");jQuery(".orderDiv").addClass("hide");jQuery(".orderListDiv").removeClass("hide");jQuery("#orderListGrid").trigger("reloadGrid");jQuery("#orderListGrid").setGridWidth(jQuery("#orderList").width())}})}else{var C=B.integralNum;bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:t.getMessage("order.label.save.failed"),message:t.getMessage("order.msg.tooLarge",C)})}},error:function(B){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:t.getMessage("order.label.save.failed"),message:t.getMessage("order.usernum.msg.failed")})}})}}})}function g(){jQuery("#queryOrderDate").dateRange({format:"YYYY-MM-DD",startValue:moment().format("YYYY-MM-DD"),start:{maxDate:moment().format("YYYY-MM-DD"),},end:{maxDate:moment().format("YYYY-MM-DD"),},onhide:function(){var x=jQuery(this).dateRange("getDate")}});var w={};w.serviceId=serviceId;$("#orderListGrid").jqGrid({url:t.handleUrlParam("/platform/serviceopen/order-list"),styleUI:"Bootstrap",autowidth:true,postData:w,height:"auto",mtype:"post",regional:"cn",datatype:"json",viewrecords:true,forceFit:true,rownumbers:true,colModel:[{label:t.getMessage("order.label.orderStartDate"),name:"orderStartDate",width:240,align:"left",hlign:"center",sortable:false},{label:t.getMessage("order.label.orderEndDate"),name:"orderEndDate",width:240,align:"left",hlign:"center",sortable:false},{label:t.getMessage("order.label.orderNum"),name:"orderNum",width:220,align:"left",hlign:"center",sortable:false,formatter:function(x,y,z){return x+t.getMessage("order.label.userUnit")}},{label:t.getMessage("order.label.orderCost"),name:"sumConstIntegral",width:230,align:"left",hlign:"center",sortable:false,formatter:function(x,y,z){return x+t.getMessage("order.label.costUnit")}},{label:t.getMessage("order.label.operation"),name:"operate",width:230,align:"center",hlign:"center",sortable:false,formatter:function(y,z,A){var x=A.orderId;return"<a href='javascript:void(0)' class='orderEdit' orderId='"+x+"' orderEndDate='"+A.orderEndDate+"' orderNum='"+A.orderNum+"'>"+t.getMessage("order.label.modify")+"</a>"}}],rowNum:5,rowList:[5],pager:"#orderListGridPager",jsonReader:{records:"total",total:"totalPages"},afterInsertRow:function(y,x){jQuery(this).jqGrid("setCell",rowid,"operate","<a>"+t.getMessage("order.label.operation")+"</a>")}})}function e(){jQuery("#orderNumSlider").slider({min:0,max:n,range:"min",step:1,slide:function(w,x){v(x.value,true)}}).slider("pips",{rest:"label",step:20,suffix:"",click:false}).slider("float",{handle:true,pips:true,suffix:t.getMessage("order.label.userUnit")});jQuery("#orderNumSlider .ui-widget-header").addClass("theme-background");jQuery("#orderNumSlider .ui-slider-handle").unbind("focusin").on("mouseover",function(){jQuery(this).addClass("theme-border-color")}).on("mouseleave",function(){jQuery(this).removeClass("theme-border-color")})}function v(x,w){if(!w){jQuery("#orderNumSlider").slider("value",x)}jQuery("#orderNum").val(x);d=x;a(x);u()}function s(){var w=jQuery("#orderNum").val();if(!isNaN(w)){if(w>n){w=n}else{if(w<0){w=0}else{w=Math.floor(w)}}v(w,false)}else{jQuery("#orderNum").val(d)}}function k(z){if("--"==z){orderEndDate=z;jQuery("#orderEndDate").html(z);jQuery("#orderEndDate").attr("endDate",z)}else{var y=new Date();y.setDate(1);y.setMonth(y.getMonth()+1+Number(z));cdt=new Date(y.getTime()-1000*60*60*24);var B=cdt.getFullYear();var x=(cdt.getMonth()+1)+"";var A=cdt.getDate()+"";if(x.length==1){x="0"+x}if(A.length==1){A="0"+A}orderEndDate=B+"-"+x+"-"+A;var w='<span class="font-orange dateNum">'+B+"</span>"+t.getMessage("order.label.year")+'<span class="font-orange dateNum">'+x+"</span>"+t.getMessage("order.label.month")+'<span class="font-orange dateNum">'+A+"</span>"+t.getMessage("order.label.day");jQuery("#orderEndDate").html(w);jQuery("#orderEndDate").attr("endDate",orderEndDate)}}function c(){var x=new Date();x.setDate(1);var w=new Date();jQuery(".btn-group button").each(function(z){if(z==0){x.setMonth(x.getMonth())}else{if(z<9){x.setMonth(x.getMonth()+1)}else{if(z<11){x.setMonth(w.getMonth()+12)}else{return}}}var y=(x.getMonth()+1);if(y<10){y="0"+y}jQuery(this).html(x.getFullYear()+"-"+y)})}function a(x){var w=Math.floor(x)*Number(servicePrice);jQuery(".costNum").html(w)}function u(){var w=false;var x=jQuery("#orderNum").val();if(x>0){w=true}if(w){jQuery("#saveOrderInfo").prop("disabled","")}else{jQuery("#saveOrderInfo").prop("disabled","disabled")}}function h(){v(0,false);jQuery("#lastbutton").click();m="";if(jQuery("#orderNumSlider").slider("option","disabled")){jQuery("#orderNumSlider").slider("enable")}if(jQuery("#orderNum").prop("disabled")){jQuery("#orderNum").prop("disabled","")}}function p(y){m=jQuery(y).attr("orderId");var x=jQuery(y).attr("orderEndDate");if(t.IsEmpty(x)){jQuery("#lastbutton").click()}else{x=x.substr(0,7)}var w=jQuery(y).attr("orderNum");w=Number(w);v(w,false);jQuery("#orderNumSlider").slider("disable");jQuery("#orderNum").prop("disabled",true);jQuery(".btn-group button").each(function(z){var A=jQuery(this).html();if(A===x){jQuery(this).click()}});jQuery(".orderListDiv").addClass("hide");jQuery(".orderDiv").removeClass("hide");jQuery(".buttons button").prop("disabled","disabled");jQuery("#back").removeClass("hide")}function f(y){var w=jQuery(y).attr("orderId");var x={orderId:w};bi.dialog.confirm({title:"确认",message:"您确定要关闭该服务？ 注意：服务关闭次月生效",callback:function(z){if(z){t.ajax({type:"post",cache:false,dataType:"json",url:t.handleUrlParam("/platform/serviceopen/close-order"),data:x,loading:{title:"关闭",text:"正在为您关闭该服务！"},success:function(A){if("true"==A.saveFlag){bi.dialog.show({title:"成功",message:"服务关闭成功，次月生效！",onhidden:function(){jQuery("#orderListGrid").trigger("reloadGrid")}})}else{bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:"失败",message:"服务关闭失败！"})}},error:function(A){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:"失败",message:"服务关闭失败！"})}})}}})}function q(){jQuery("#totalNum").empty();for(i=totalNum;i>0;i=parseInt(Number(i)/10)){var w='<span class="numSpan">'+Number(i)%10+"</span>";jQuery("#totalNum").prepend(w)}}function j(){var w=jQuery("#queryOrderDate").dateRange("getDate");var x=jQuery("#queryOrderDate").val();postData={orderDateStart:w.startDate,orderDateEnd:w.endDate,serviceId:serviceId};if(x==""||x==null){postData.orderDateStart="";postData.orderDateEnd=""}jQuery("#orderListGrid").jqGrid("setGridParam",{postData:postData}).trigger("reloadGrid")}});