define(["sabace","dialog","retrievepsd/message"],function(c,b,f){jQuery(function(){jQuery("#sendBtn").on("click",g);jQuery(".btn-next").on("click",e)});jQuery(".validate-img img").on("click",function(){this.src=c.handleUrlParam("/ImageServlet?")+Math.random()});var d={node:null,count:60,start:function(){if(this.count>0){this.node.innerHTML=this.count--+c.getMessage("retripsd.label.msg");var i=this;setTimeout(function(){i.start()},1000)}else{this.node.removeAttribute("disabled");this.node.innerHTML=c.getMessage("retripsd.button.getMsg");this.count=60}},init:function(i){this.node=i;this.node.setAttribute("disabled",true);this.start()}};function g(){d.init(this);jQuery("#tip").show();h()}function h(){var i=jQuery("#msg").val();c.ajax({type:"post",cache:false,data:{userType:"email"},dataType:"json",url:c.handleUrlParam("/platform/retripsd/send-message"),success:function(j){if(j.noSession){c.handleUrlParam("/platform/retripsd/enter-page")}if(!j.validateFlag){a(c.getMessage(j.errorMsg))}},error:function(j){a(c.getMessage("retripsd.msg.Exception"))}})}function e(){if(jQuery("#msg,#code").prop("disabled")){return}var k=jQuery("#msg").val();var i=jQuery("#code").val();if(c.IsEmpty(k)){jQuery("#msg").focus();bi.dialog.show({type:"type-warning",title:c.getMessage("retripsd.msg.prompt"),message:c.getMessage("retripsd.msg.emptyCode"),});return}if(k.length!=4){jQuery("#msg").focus();bi.dialog.show({type:"type-warning",title:c.getMessage("retripsd.msg.prompt"),message:c.getMessage("retripsd.msg.Code.lengthError"),});return}if(c.IsEmpty(i)){jQuery("#code").focus();bi.dialog.show({type:"type-warning",title:c.getMessage("retripsd.msg.prompt"),message:c.getMessage("retripsd.msg.emptyCaptcha"),});return}if(k.length!=4){jQuery("#msg").focus();bi.dialog.show({type:"type-warning",title:c.getMessage("retripsd.msg.prompt"),message:c.getMessage("retripsd.msg.Captcha.lengthError"),});return}var j={msg:k,code:i,type:"email"};jQuery("#msg,#code,.btn-next").prop("disabled",true);c.ajax({type:"post",cache:false,dataType:"json",url:c.handleUrlParam("/platform/retripsd/check-validateCode"),data:j,success:function(l){if(l.noSession){document.location.href=c.handleUrlParam("/platform/retripsd/enter-page")}if(!l.validateFlag){a(c.getMessage(l.errorMsg))}else{document.location.href=c.handleUrlParam("/platform/retripsd/changepsd-page")}},error:function(l){a(c.getMessage("retripsd.msg.Exception"))}})}function a(i){jQuery("#msg,#code,.btn-next").prop("disabled",false);jQuery(".validate-img img").attr("src",c.handleUrlParam("/ImageServlet?")+Math.random());bi.dialog.show({type:"type-warning",title:c.getMessage("retripsd.msg.prompt"),message:i,})}});