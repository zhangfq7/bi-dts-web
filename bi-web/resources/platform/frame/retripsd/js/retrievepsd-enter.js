define(["sabace","dialog","retrievepsd/message"],function(c,b,d){jQuery(function(){jQuery("#first-next").html(c.getMessage("retripsd.button.nextStep"));jQuery("#first-next").on("click",e)});function e(){if(jQuery(".text-step1").prop("disabled")){return}var h=jQuery("#userId").val().toLowerCase();var i=/^((13[0-9])|(15[0-9])|(17[0-9])|(18[0-9]))\d{8}$/;var k=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;var g=/^[U,u]+\d{7}/;if(c.IsEmpty(h)){bi.dialog.show({type:"type-danger",title:c.getMessage("retripsd.msg.prompt"),message:c.getMessage("retripsd.msg.inputUser")});return}var f;if(i.test(h)){f="phone"}if(k.test(h)){f="email"}if(g.test(h)){f="userId"}if(c.IsEmpty(f)){bi.dialog.show({type:"type-warning",title:c.getMessage("retripsd.msg.prompt"),message:c.getMessage("retripsd.msg.errorUser"),});jQuery("#userId").focus();return}jQuery("#userId,#first-next").prop("disabled",true);jQuery("#first-next").html(c.getMessage("retripsd.button.waiting"));var j={userId:h,type:f};c.ajax({type:"post",cache:false,dataType:"json",url:c.handleUrlParam("/platform/retripsd/check-user"),data:j,success:function(l){if(!l.validateFlag){a(c.getMessage(l.errorMsg))}else{if("phone"==f){document.location.href=c.handleUrlParam("/platform/retripsd/mobile-page")}if("email"==f){document.location.href=c.handleUrlParam("/platform/retripsd/email-page")}if("userId"==f){document.location.href=c.handleUrlParam("/platform/retripsd/choose-page")}}},error:function(l){a(c.getMessage("retripsd.msg.Exception"))}})}function a(f){bi.dialog.show({type:"type-warning",title:c.getMessage("retripsd.msg.prompt"),message:f,});jQuery("#first-next").html(c.getMessage("retripsd.button.nextStep"));jQuery("#userId,#first-next").prop("disabled",false)}});