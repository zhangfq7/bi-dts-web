define(["sabace"],function(e){var b;jQuery(function(){jQuery(".download-content>div").bind("click",function(){jQuery(this).siblings().find(".check>div").removeClass("checked").addClass("unchecked");jQuery(this).find(".check>div").addClass("checked").removeClass("unchecked")});jQuery(".download-content>div:eq(0)").trigger("click");c();b=jQuery(".phoneNum").val();var j="";for(var h=0;h<b.length;h++){if(h>2&&h<8){j+="*"}else{j+=b[h]}}jQuery(".phoneNum").val(j);jQuery("#sendCaptcha").on("click",d)});var f={checkSmsApprove:false,gotoDownNumCheck:false,isClickSend:false,phone:"",isNeedSMS:false,validatePage:function(){jQuery(".download-content").addClass("hide");jQuery(".phone-check").removeClass("hide")},checkSMSForDown:function(h){e.ajax({url:e.handleUrlParam("/platform/download/check-download-sms"),data:{smsNumber:h},async:false,success:function(i){if("success"==i.flag){f.checkSmsApprove=true}else{f.checkSmsApprove=false;jQuery("#errorInfo").html(i.message)}},error:function(i){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("safety.msg.error"),message:i.responseText||e.getMessage("safety.msg.exception")})}})}};function d(){f.isClickSend=true;var h=$(this);h.fadeOut(100,function(){jQuery("#scondsReSend").fadeIn()});jQuery(".msgtr").css("visibility","visible");a()}function a(){var i=60;var h=setInterval(function(){i--;$("#scondsReSend span").text(i);if(i==0){g(h)}},1000);e.ajax({url:e.handleUrlParam("/platform/download/download-send-sms"),data:{receivePhone:b},success:function(j){},error:function(j){}})}function g(h){clearInterval(h);jQuery("#scondsReSend").fadeOut(100,function(){jQuery("#sendCaptcha").fadeIn();jQuery(this).children("span").text(45)})}function c(){e.ajax({url:e.handleUrlParam("/platform/sysmanage/safety/query-info-value"),success:function(i){var h=i.infoValue;if(h==undefined){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("safety.msg.error"),message:e.getMessage("safety.msg.exception")})}if("1"==h.smsCaptcha){f.isNeedSMS=true}else{f.isNeedSMS=false}window.sure=function(){var j={};if(f.isNeedSMS&&!f.gotoDownNumCheck){f.validatePage();j.flag=false;f.gotoDownNumCheck=true}else{if(jQuery(".download-content").hasClass("hide")){if(f.isClickSend){var k=jQuery.trim(jQuery("#code").val());f.checkSMSForDown(k);if(f.checkSmsApprove){j.flag=true;j.type=jQuery(".checked").attr("type")}else{j.flag=false}}else{jQuery("#errorInfo").html("请点击发送短信验证码！");j.flag=false}}else{j.flag=true;j.type=jQuery(".checked").attr("type")}}return j};window.cancel=function(){if(!jQuery(".download-content").hasClass("hide")){return true}else{jQuery(".download-content").removeClass("hide");jQuery(".phone-check").addClass("hide");f.gotoDownNumCheck=false;return false}}},error:function(h){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("safety.msg.error"),message:h.responseText||e.getMessage("safety.msg.exception")})}})}});