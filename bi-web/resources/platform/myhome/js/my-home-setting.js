define(["sabace","mymessage"],function(e,g){var c=30;var f="all";jQuery(function(){$(".selectedList").height($(".centerDiv").height()-80).niceScroll();$(".selectList").height($(".rightDiv").height()-140).niceScroll();$(".selectedList").height($(".centerDiv").height()-100);$(window).resize(function(){$(".selectedList").height($(".centerDiv").height()-80).niceScroll();$(".selectList").height($(".rightDiv").height()-140).niceScroll();$(".selectedList").height($(".centerDiv").height()-100)});jQuery("#selectedList").on("click",".parentPanel",function(){var j=jQuery(this).find("input[data-toggle='checkbox']");j.prop("checked",!j.prop("checked"))});jQuery(".btn-group button").bind("click",function(){jQuery(".btn-group button").removeClass("clickedButton theme-background").addClass("normalButton");jQuery(this).addClass("clickedButton theme-background").removeClass("normalButton")});jQuery("#firstbutton").click();jQuery(".reportDelete").bind("click",function(){if(jQuery("#selectedList input:checked").size()==0){bi.dialog.show({title:e.getMessage("home.label.TipBox"),message:e.getMessage("home.msg.deleteMsg"),cssClass:"register-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:e.getMessage("home.button.sure"),action:function(j){j.close()}}]})}else{bi.dialog.confirm({title:e.getMessage("home.label.confirmBox"),message:e.getMessage("home.msg.deleteConfirmMsg"),callback:function(j){if(j){jQuery("#selectedList input:checked").parents(".parentPanel").remove();if($("#selectedList>div").size()==0){$("#selectedList").html("<div id='todelete' style='height:150px;width:100%;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>")}}}})}});e.ajax({url:e.handleUrlParam("/platform/myreport/view/query-myhome"),success:function(j){jQuery.each(j,function(l,k){var m=d(k);b(m,"query")});if($("#selectedList>div").size()==0){$("#selectedList").html("<div id='todelete' style='height:150px;width:100%;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>")}},error:function(j){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("top.label.fail"),message:j.responseText})}});jQuery(".search-btn-group button").bind("click",function(){f=jQuery(this).val();$(".selectList").animate({scrollTop:0},100);i(0,f,"")});jQuery("#firstbutton").click();jQuery("#search").bind("click",function(){i(0,f,"")});function h(l,j,k){var m=jQuery("#searchInput").val();e.ajax({loading:{spin:true,spin:{appendTo:".selectList",lines:11,length:12,width:5,radius:15,color:"#fff",}},url:e.handleUrlParam("/platform/myreport/view/query-reps/"),data:{page:l,rows:c,type:j,labelIds:k,searchText:m},success:function(n){jQuery("#content").html("");$(".selectList").animate({scrollTop:0},100);jQuery.each(n.reportList.rows,function(p,o){var q=d(o);jQuery("#content").append(q)});jQuery(".selectList .thumbnail").draggable({revert:"invalid",cursor:"move",helper:"clone",connectToSortable:"#selectedList",appendTo:"body",start:function(){$(".selectList .thumbnail").removeClass("draped");$(this).addClass("draped");$(".selectedList .parentPanel").addClass("dragBgColor")},stop:function(){$(".selectedList .parentPanel").removeClass("dragBgColor")}})},error:function(n){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("top.label.fail"),message:n.responseText})}})}function i(l,j,k){var m=jQuery("#searchInput").val();e.ajax({data:{page:l,rows:c,type:j,labelIds:k,searchText:m},loading:{spin:true,spin:{appendTo:".selectList",lines:11,length:12,width:5,radius:15,color:"#fff",}},url:e.handleUrlParam("/platform/myreport/view/query-reps"),success:function(p){jQuery("#content").html("");if(p.reportList.rows.length==0){var r=jQuery("<div>",{style:"text-align:center;margin-top:40px;"});var q=jQuery("<img>",{src:resPath+"/resources/platform/myreport/img/noreport.png",style:"width:50%;"});r.append(q);jQuery("#content").html(r)}jQuery.each(p.reportList.rows,function(t,s){var u=d(s);jQuery("#content").append(u)});jQuery(".selectList .thumbnail").draggable({revert:"invalid",cursor:"move",helper:"clone",appendTo:"body",connectToSortable:"#selectedList",start:function(){$(".selectList .thumbnail").removeClass("draped");$(this).addClass("draped");$(".selectedList .parentPanel").addClass("dragBgColor")},stop:function(){$(".selectedList .parentPanel").removeClass("dragBgColor")}});jQuery("#page").page("destroy");jQuery("#page").page({total:p.reportList.total,pageSize:c,showJump:true,firstBtnText:e.getMessage("home.page.first"),lastBtnText:e.getMessage("home.page.last"),jumpBtnText:e.getMessage("home.page.jump")}).on("pageClicked",function(t,s){h(s,j,"")}).on("jumpClicked",function(t,s){h(s,j,"")});var n=jQuery(".page").width();var o=Number(jQuery(".m-pagination-page").width())+Number(jQuery(".m-pagination-jump").width());jQuery(".m-pagination-page").css("margin-left",(n-o)/2+"px")},error:function(n){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("top.label.fail"),message:n.responseText})}})}jQuery(".savebtn").bind("click",function(){var k=jQuery("#selectedList").children().not("#todelete").size();var j=[];jQuery.each(jQuery("#selectedList .thumbnail"),function(m,l){j.push(jQuery(l).attr("reportId"))});bi.dialog.confirm({title:e.getMessage("home.label.confirmBox"),message:e.getMessage("home.msg.sethome1")+k+e.getMessage("home.msg.sethome2"),callback:function(l){if(l){e.ajax({loading:{title:e.getMessage("home.msg.execution"),text:e.getMessage("home.msg.submitMsg")},url:e.handleUrlParam("/platform/myreport/view/set-home/"),data:{reportIds:j.toString()},success:function(m){bi.dialog.show({title:e.getMessage("home.label.TipBox"),message:e.getMessage("home.msg.successSet"),cssClass:"register-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:e.getMessage("home.button.sure"),action:function(n){n.close()}}]})},error:function(m){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("top.label.fail"),message:m.responseText})}})}}})});$("#selectedList").sortable({revert:true,start:function(){},axis:"y",stop:function(l,m){var k=$(m.item);if(k.hasClass("parentPanel")){return}var n=k.attr("reportId");var o=jQuery("#selectedList .thumbnail").arrayAttr("reportId");var j=0;jQuery.each(o,function(q,p){if(p==n){j++}});if(j>1){k.remove();bi.dialog.show({title:e.getMessage("home.label.TipBox"),message:e.getMessage("home.msg.repeatMsg"),cssClass:"register-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:e.getMessage("home.button.sure"),action:function(p){p.close()}}]})}if(jQuery("#selectedList").children().size()>5){bi.dialog.confirm({title:e.getMessage("home.label.confirmBox"),message:e.getMessage("home.msg.mostMsg"),callback:function(p){if(p){jQuery("#selectedList").children().eq(5).remove()}else{jQuery("#selectedList div[reportId="+n+"]").parents(".parentPanel").remove()}}})}e.timeout(function(){k.replaceWith(b(k.outerHTML()));$('[data-toggle="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"})},0);jQuery("#todelete").remove()},opacity:0.8})});function b(n,m){var h=jQuery("<div>",{"class":"parentPanel"});var l=jQuery("<div>",{"class":"imgPanel"});var k=jQuery("<div>",{"class":"checkPanel"});var j=jQuery("<label>",{"class":"checkbox"});var i=jQuery("<input>",{type:"checkbox","data-toggle":"checkbox"});l.append(n);j.append(i);k.append(j);h.append(l).append(k);if(m=="query"){jQuery("#selectedList").append(h)}else{return h}$('[data-toggle="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"})}var a=$(document).height()/5+5;function d(o){var h=jQuery("<div>",{"class":"thumbnail effect",reportId:o.reportId});var p=jQuery("<div>",{css:{height:a+"px",background:"url("+o.imgByte+") no-repeat","background-size":"100% auto"},"class":"repImg"});var q=jQuery("<div>",{"class":"txt"});var s=jQuery("<strong>",{html:o.reportName});var v=jQuery("<div>",{"class":"help-block",html:'<div class="comment">'+e.getMessage("home.label.comment")+"<strong> "+(o.commentCount==null?0:o.commentCount)+" </strong></div>"});var l=o.score;var i=jQuery("<i>",{"class":"fa fa-star-o",});var x=jQuery("<i>",{"class":"fa fa-star-o",});var w=jQuery("<i>",{"class":"fa fa-star-o",});var u=jQuery("<i>",{"class":"fa fa-star-o",});var t=jQuery("<i>",{"class":"fa fa-star-o",});var n=[];n.push(i);n.push(x);n.push(w);n.push(u);n.push(t);if(l.length==1){for(var m=1;m<=l;m++){n[m-1].attr("class","fa fa-star")}}else{for(var m=1;m<=l.substring(0,1);m++){n[m-1].attr("class","fa fa-star")}n[l.substring(0,1)].attr("class","fa fa-star-half-o")}var k=jQuery("<div>",{"class":"stars"});var r='<div class="visit">'+e.getMessage("home.label.visit")+'<strong class="times"> '+o.visitCount+" </strong></div>";k.append(n);v.append(k).append(r);q.append(s).append(v);h.append(p).append(q);return h}});