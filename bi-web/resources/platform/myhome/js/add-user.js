define(["sabace"],function(c){function e(){jQuery(".chosen-select").chosen({disable_search:true});jQuery(".userList").on("click","a",function(){var f=jQuery(this).find("input[data-toggle='checkbox']");f.prop("checked",!f.prop("checked"))});d(jQuery(".sys"),"sys");jQuery(".searchBtn").bind("click",function(){jQuery("#sysuserTable").jqGrid("setGridParam",{postData:{userName:jQuery("#userName").val(),userId:jQuery("#userId").val(),sex:jQuery(".chosen-select").val()}}).trigger("reloadGrid",[{page:1}])});jQuery(".sys .right").bind("click",function(){var k=jQuery("#sysuserTable").jqGrid("getGridParam","selarrrow");if(k.length==0){bi.dialog.show({title:c.getMessage("home.label.TipBox"),message:c.getMessage("report.share.check"),cssClass:"register-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:c.getMessage("home.button.sure"),action:function(i){i.close()}}]});return}jQuery(".sys .ui-jqgrid-bdiv>div").show();jQuery(".sys .ui-jqgrid-bdiv .noResult").hide();var h=jQuery("#sysshareuserTable").jqGrid("getDataIDs");var l=0;if(h.length>0){l=h[h.length-1]}var f=k.length;for(var g=0;g<f;g++){var j=jQuery("#sysuserTable").jqGrid("getRowData",k[0]);jQuery("#sysshareuserTable").jqGrid("addRowData",Number(l)+g+1,j);jQuery("#sysuserTable").jqGrid("delRowData",k[0])}});jQuery(".sys .left").bind("click",function(){var k=jQuery("#sysshareuserTable").jqGrid("getGridParam","selarrrow");if(k.length==0){bi.dialog.show({title:c.getMessage("home.label.TipBox"),message:c.getMessage("report.share.check"),cssClass:"register-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:c.getMessage("home.button.sure"),action:function(i){i.close()}}]});return}var h=jQuery("#sysuserTable").jqGrid("getDataIDs");var l=0;if(h.length>0){l=h[h.length-1]}var f=k.length;for(var g=0;g<f;g++){var j=jQuery("#sysshareuserTable").jqGrid("getRowData",k[0]);jQuery("#sysuserTable").jqGrid("addRowData",Number(l)+g+1,j);jQuery("#sysshareuserTable").jqGrid("delRowData",k[0])}})}function b(f,g){f.find(".selectList").html('<table id="'+g+'userTable"></table>');f.find("#"+g+"userTable").jqGrid({url:c.handleUrlParam("/platform/myreport/manage/user-list")+"?type=1",datatype:"json",loadComplete:function(p){var o=jQuery("."+g).find("#"+g+"shareuserTable");var h=jQuery("."+g).find("#"+g+"userTable");var n=o.jqGrid("getRowData");var m=h.getCol("userID",true);for(var l=0;l<n.length;l++){for(var k=0;k<m.length;k++){if(m[k].value==n[l].userID){h.jqGrid("delRowData",m[k].id)}}}jQuery(".number").html(p.length)},styleUI:"Bootstrap",colModel:[{label:"用户编码",width:75,name:"userID",align:"center"},{label:c.getMessage("report.share.userName"),width:70,name:"userName",align:"left",sortable:false},{label:"性别",width:45,name:"sex",align:"center",sortable:false,formatter:function(h,i,j){if(h==1||h=="男"){return"男"}else{if(h==0||h=="女"){return"女"}else{return"保密"}}}}],shrinkToFit:false,width:290,height:300,viewrecords:true,multiselect:true,loadtext:"",rowNum:100000,rownumbers:true,regional:"cn"})}function d(f,g){f.find(".selectedList").html('<table id="'+g+'shareuserTable"></table>');f.find("#"+g+"shareuserTable").jqGrid({url:c.handleUrlParam("/platform/myreport/manage/share-user-list"),datatype:"json",loadComplete:function(h){b(jQuery("."+g),g);if(h.length>0){jQuery("."+g).find(".selectedList").find(".ui-jqgrid-bdiv>div").css("border-left","none")}else{jQuery("."+g).find(".selectedList").find(".ui-jqgrid-bdiv>div").css("border-left","1px solid #ddd")}},styleUI:"Bootstrap",colModel:[{label:"用户编码",width:75,name:"userID",align:"center"},{label:c.getMessage("report.share.userName"),width:80,name:"userName",align:"left",sortable:false},{label:"性别",width:45,name:"sex",align:"center",sortable:false,formatter:function(h,i,j){if(h==1||h=="男"){return"男"}else{if(h==0||h=="女"){return"女"}else{return"保密"}}}}],shrinkToFit:false,width:290,height:300,viewrecords:true,multiselect:true,loadtext:"",rowNum:100000,rownumbers:true,jsonReader:{records:"total",total:"totalPages"},regional:"cn"})}function a(){var f=jQuery("#sysshareuserTable").jqGrid("getRowData");jQuery("#userList").html("");jQuery.each(f,function(l,k){var j=jQuery("<a>",{href:"#","class":"list-group-item col-xs-12",userId:k.userID});var m=jQuery("<div>",{"class":"col-xs-4",html:'<img src="'+webpath+"/platform/readUserImg/"+funcId+"?t="+new Date()+"&userImgId="+k.userID+'" alt="" class="img-circle img-responsive"/>'});var g=jQuery("<div>",{"class":"col-xs-5",html:'<span class="nickName">'+k.userName+"</span>"});var h=jQuery("<div>",{"class":"col-xs-1",html:'<label class="" ><input type="checkbox" data-toggle="checkbox" /></label> '});j.append(m).append(g).append(h);jQuery("#userList").append(j)});$('[data-toggle="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"})}return{init:e,saveUsers:a}});