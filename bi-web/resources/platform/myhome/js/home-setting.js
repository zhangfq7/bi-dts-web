define(["sabace","message","myhome/addUser"],function(e,h,g){var c=20;var f="all";jQuery(function(){$(".selectedList").height($(".centerDiv").height()-80).niceScroll();$(".userList").height($(".leftDiv").height()-80).niceScroll();$(".selectList").height($(".rightDiv").height()-140).niceScroll();$(".selectedList").height($(".centerDiv").height()-100);$(window).resize(function(){$(".selectedList").height($(".centerDiv").height()-80).niceScroll();$(".userList").height($(".userList").height()-80).niceScroll();$(".selectList").height($(".rightDiv").height()-140).niceScroll();$(".selectedList").height($(".centerDiv").height()-100);jQuery("#selectedFooter").css("left","-"+(jQuery("body").width()*0.235+1)+"px")});$("#allSelect input").iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"});jQuery("#selectedFooter").css("left","-"+(jQuery("body").width()*0.235+1)+"px");$("#allSelect input").on("ifChanged",function(l){var k=!jQuery(this).parent().hasClass("checked");var k=k?"check":"uncheck";jQuery("#userList").find("input[data-toggle='checkbox']").iCheck(k)});jQuery("#selectedList").on("click",".parentPanel",function(){var k=jQuery(this).find("input[data-toggle='checkbox']");k.prop("checked",!k.prop("checked"))});jQuery(".btn-group button").bind("click",function(){jQuery(".btn-group button").removeClass("clickedButton theme-background").addClass("normalButton");jQuery(this).addClass("clickedButton theme-background").removeClass("normalButton")});jQuery("#firstbutton").click();jQuery(".reportDelete").bind("click",function(){if(jQuery("#selectedList input:checked").size()==0){bi.dialog.show({title:e.getMessage("home.label.TipBox"),message:e.getMessage("home.msg.deleteMsg"),cssClass:"register-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:e.getMessage("home.button.sure"),action:function(k){k.close()}}]})}else{bi.dialog.confirm({title:e.getMessage("home.label.confirmBox"),message:e.getMessage("home.msg.deleteConfirmMsg"),callback:function(k){if(k){jQuery("#selectedList input:checked").parents(".parentPanel").remove();if($("#selectedList>div").size()==0){$("#selectedList").html("<div id='todelete' style='height:150px;width:100%;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>")}}}})}});e.ajax({url:e.handleUrlParam("/platform/myreport/view/query-myhome"),success:function(k){jQuery.each(k,function(m,l){var n=d(l);b(n,"query")});if($("#selectedList>div").size()==0){$("#selectedList").html("<div id='todelete' style='height:150px;width:100%;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>")}},error:function(k){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("top.label.fail"),message:k.responseText})}});jQuery(".search-btn-group button").bind("click",function(){f=jQuery(this).val();$(".selectList").animate({scrollTop:0},100);j(0,f,"")});jQuery("#firstbutton").click();jQuery("#search").bind("click",function(){j(0,f,"")});function i(m,k,l){var n=jQuery("#searchInput").val();e.ajax({url:e.handleUrlParam("/platform/myreport/view/query-reps/"),data:{page:m,rows:c,type:k,labelIds:l,searchText:n},loading:{spin:true,spin:{appendTo:".selectList",lines:11,length:12,width:5,radius:15,color:"#fff",}},success:function(o){jQuery("#content").html("");$(".selectList").animate({scrollTop:0},100);jQuery.each(o.reportList.rows,function(q,p){var r=d(p);jQuery("#content").append(r)});jQuery(".selectList .thumbnail").draggable({revert:"invalid",cursor:"move",helper:"clone",appendTo:"body",connectToSortable:"#selectedList",start:function(){$(".selectList .thumbnail").removeClass("draped");$(this).addClass("draped");$(".selectedList .parentPanel").addClass("dragBgColor")},stop:function(){$(".selectedList .parentPanel").removeClass("dragBgColor")}})},error:function(o){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("top.label.fail"),message:o.responseText})}})}function j(m,k,l){var n=jQuery("#searchInput").val();e.ajax({data:{page:m,rows:c,type:k,labelIds:l,searchText:n,appType:appType},loading:{spin:true,spin:{appendTo:".selectList",lines:11,length:12,width:5,radius:15,color:"#fff",}},url:e.handleUrlParam("/platform/myreport/view/query-reps"),success:function(q){jQuery("#content").html("");if(q.reportList.rows.length==0){var s=jQuery("<div>",{style:"text-align:center;margin-top:40px;"});var r=jQuery("<img>",{src:resPath+"/resources/platform/myreport/img/noreport.png",style:"width:50%;"});s.append(r);jQuery("#content").html(s)}jQuery.each(q.reportList.rows,function(u,t){var w=d(t);jQuery("#content").append(w)});jQuery(".selectList .thumbnail").draggable({revert:"invalid",cursor:"move",helper:"clone",connectToSortable:"#selectedList",appendTo:"body",start:function(){$(".selectList .thumbnail").removeClass("draped");$(this).addClass("draped");$(".selectedList .parentPanel").addClass("dragBgColor")},stop:function(){$(".selectedList .parentPanel").removeClass("dragBgColor")}});jQuery("#page").page("destroy");jQuery("#page").page({total:q.reportList.total,pageSize:c,showJump:true,firstBtnText:e.getMessage("home.page.first"),lastBtnText:e.getMessage("home.page.last"),jumpBtnText:e.getMessage("home.page.jump")}).on("pageClicked",function(u,t){i(t,k,"")}).on("jumpClicked",function(u,t){i(t,k,"")});var o=jQuery(".page").width();var p=Number(jQuery(".m-pagination-page").width())+Number(jQuery(".m-pagination-jump").width());jQuery(".m-pagination-page").css("margin-left",(o-p)/2+"px")},error:function(o){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("top.label.fail"),message:o.responseText})}})}jQuery(".savebtn").bind("click",function(){var m=[];jQuery.each(jQuery("#userList a"),function(o,n){m.push(jQuery(n).attr("userId"))});if(m.length==0){bi.dialog.show({title:e.getMessage("home.label.TipBox"),message:"请先选择人员!",cssClass:"register-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:e.getMessage("home.button.sure"),action:function(n){n.close()}}]});return}var l=jQuery("#selectedList").children().not("#todelete").size();var k=[];jQuery.each(jQuery("#selectedList .thumbnail"),function(o,n){k.push(jQuery(n).attr("reportId"))});bi.dialog.confirm({title:e.getMessage("home.label.confirmBox"),message:e.getMessage("home.msg.sethome3")+l+e.getMessage("home.msg.sethome2"),callback:function(n){if(n){e.ajax({loading:{title:e.getMessage("home.msg.execution"),text:e.getMessage("home.msg.submitMsg")},url:e.handleUrlParam("/platform/myreport/view/set-home-users/"),data:{reportIds:k.toString(),userIds:m.toString()},success:function(o){bi.dialog.show({title:e.getMessage("home.label.TipBox"),message:e.getMessage("home.msg.successSet"),cssClass:"register-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:e.getMessage("home.button.sure"),action:function(p){p.close()}}]})},error:function(o){bi.dialog.show({type:bi.dialog.TYPE_DANGER,title:e.getMessage("top.label.fail"),message:o.responseText})}})}}})});jQuery("#selectedList").on("click",".parentPanel",function(){var k=jQuery(this).find("input[data-toggle='checkbox']");k.prop("checked",!k.prop("checked"))});jQuery(".span").bind("click",function(){jQuery("#allSelect input").click()});jQuery(".userDelete").bind("click",function(){jQuery("#userList input:checked").parents(".list-group-item").remove()});jQuery(".addUser").bind("click",function(){var k=e.handleUrlParam("/platform/myhome/add-user");bi.dialog.show({title:"编辑用户",message:$('<div id="add-user-dialog"></div>').load(k),spinicon:"glyphicon glyphicon-refresh",cssClass:"add-user-dialog",closeByBackdrop:false,closeByKeyboard:false,onshown:function(){g.init()},buttons:[{label:"取消",cssClass:"btn-info",action:function(l){l.close()}},{label:"保存",cssClass:"btn-info",action:function(l){g.saveUsers();l.close()}}]})});$("#selectedList").sortable({revert:true,start:function(){},axis:"y",stop:function(m,n){var l=$(n.item);if(l.hasClass("parentPanel")){return}var o=l.attr("reportId");var p=jQuery("#selectedList .thumbnail").arrayAttr("reportId");var k=0;jQuery.each(p,function(r,q){if(q==o){k++}});if(k>1){l.remove();bi.dialog.show({title:e.getMessage("home.label.TipBox"),message:e.getMessage("home.msg.repeatMsg"),cssClass:"register-dialog",nl2br:false,closable:true,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:e.getMessage("home.button.sure"),action:function(q){q.close()}}]})}if(jQuery("#selectedList").children().size()>5){bi.dialog.confirm({title:e.getMessage("home.label.confirmBox"),message:e.getMessage("home.msg.mostMsg"),callback:function(q){if(q){jQuery("#selectedList").children().eq(5).remove()}else{jQuery("#selectedList div[reportId="+o+"]").parents(".parentPanel").remove()}}})}e.timeout(function(){l.replaceWith(b(l.outerHTML()));$('[data-toggle="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"})},0);jQuery("#todelete").remove()},opacity:0.8})});function b(o,n){var i=jQuery("<div>",{"class":"parentPanel"});var m=jQuery("<div>",{"class":"imgPanel"});var l=jQuery("<div>",{"class":"checkPanel"});var k=jQuery("<label>",{"class":"checkbox"});var j=jQuery("<input>",{type:"checkbox","data-toggle":"checkbox"});m.append(o);k.append(j);l.append(k);i.append(m).append(l);if(n=="query"){jQuery("#selectedList").append(i)}else{return i}$('[data-toggle="checkbox"]').iCheck({checkboxClass:"icheckbox_minimal",radioClass:"iradio_minimal"})}var a=$(document).height()/5+5;function d(p){var i=jQuery("<div>",{"class":"thumbnail effect",reportId:p.reportId});var q=jQuery("<div>",{css:{height:a+"px",background:"url("+p.imgByte+") no-repeat","background-size":"100% auto"},"class":"repImg"});var r=jQuery("<div>",{"class":"txt"});var t=jQuery("<strong>",{html:p.reportName});var w=jQuery("<div>",{"class":"help-block",html:'<div class="comment">'+e.getMessage("home.label.comment")+"<strong> "+(p.commentCount==null?0:p.commentCount)+" </strong></div>"});var m=p.score;var k=jQuery("<i>",{"class":"fa fa-star-o",});var y=jQuery("<i>",{"class":"fa fa-star-o",});var x=jQuery("<i>",{"class":"fa fa-star-o",});var v=jQuery("<i>",{"class":"fa fa-star-o",});var u=jQuery("<i>",{"class":"fa fa-star-o",});var o=[];o.push(k);o.push(y);o.push(x);o.push(v);o.push(u);if(m.length==1){for(var n=1;n<=m;n++){o[n-1].attr("class","fa fa-star")}}else{for(var n=1;n<=m.substring(0,1);n++){o[n-1].attr("class","fa fa-star")}o[m.substring(0,1)].attr("class","fa fa-star-half-o")}var l=jQuery("<div>",{"class":"stars"});var s='<div class="visit">'+e.getMessage("home.label.visit")+'<strong class="times"> '+p.visitCount+" </strong></div>";l.append(o);w.append(l).append(s);r.append(t).append(w);i.append(q).append(r);return i}});